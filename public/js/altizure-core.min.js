!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.altizure=t(require("three")):e.altizure=t(e.THREE)}("undefined"!=typeof self?self:this,function(__WEBPACK_EXTERNAL_MODULE_0__){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=38)}([function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_0__},function(e,t,r){!function(t,n){e.exports=n(r(0),r(10))}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}([function(t,r){t.exports=e},function(e,t,r){var n;e.exports=n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],o=function(t){t=t;var r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=o(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},l=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,s=o/(4*i),l=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*i,u=e.min(4*l,o);if(l){for(var c=0;c<l;c+=i)this._doProcessBlock(n,c);var f=n.splice(0,l);r.sigBytes-=u}return new a.init(f,u)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=f.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math)},function(e,t,r){var n;e.exports=(n=r(1),function(e){var t=n,r=t.lib,o=r.WordArray,i=r.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],l=e[t+1],p=e[t+2],d=e[t+3],v=e[t+4],m=e[t+5],y=e[t+6],g=e[t+7],b=e[t+8],_=e[t+9],w=e[t+10],x=e[t+11],k=e[t+12],O=e[t+13],P=e[t+14],A=e[t+15],S=i[0],M=i[1],T=i[2],E=i[3];S=h(S=f(S=f(S=f(S=f(S=c(S=c(S=c(S=c(S=u(S=u(S=u(S=u(S,M,T,E,a,7,s[0]),M=u(M,T=u(T,E=u(E,S,M,T,l,12,s[1]),S,M,p,17,s[2]),E,S,d,22,s[3]),T,E,v,7,s[4]),M=u(M,T=u(T,E=u(E,S,M,T,m,12,s[5]),S,M,y,17,s[6]),E,S,g,22,s[7]),T,E,b,7,s[8]),M=u(M,T=u(T,E=u(E,S,M,T,_,12,s[9]),S,M,w,17,s[10]),E,S,x,22,s[11]),T,E,k,7,s[12]),M=u(M,T=u(T,E=u(E,S,M,T,O,12,s[13]),S,M,P,17,s[14]),E,S,A,22,s[15]),T,E,l,5,s[16]),M=c(M,T=c(T,E=c(E,S,M,T,y,9,s[17]),S,M,x,14,s[18]),E,S,a,20,s[19]),T,E,m,5,s[20]),M=c(M,T=c(T,E=c(E,S,M,T,w,9,s[21]),S,M,A,14,s[22]),E,S,v,20,s[23]),T,E,_,5,s[24]),M=c(M,T=c(T,E=c(E,S,M,T,P,9,s[25]),S,M,d,14,s[26]),E,S,b,20,s[27]),T,E,O,5,s[28]),M=c(M,T=c(T,E=c(E,S,M,T,p,9,s[29]),S,M,g,14,s[30]),E,S,k,20,s[31]),T,E,m,4,s[32]),M=f(M,T=f(T,E=f(E,S,M,T,b,11,s[33]),S,M,x,16,s[34]),E,S,P,23,s[35]),T,E,l,4,s[36]),M=f(M,T=f(T,E=f(E,S,M,T,v,11,s[37]),S,M,g,16,s[38]),E,S,w,23,s[39]),T,E,O,4,s[40]),M=f(M,T=f(T,E=f(E,S,M,T,a,11,s[41]),S,M,d,16,s[42]),E,S,y,23,s[43]),T,E,_,4,s[44]),M=f(M,T=f(T,E=f(E,S,M,T,k,11,s[45]),S,M,A,16,s[46]),E,S,p,23,s[47]),T,E,a,6,s[48]),M=h(M=h(M=h(M=h(M,T=h(T,E=h(E,S,M,T,g,10,s[49]),S,M,P,15,s[50]),E,S,m,21,s[51]),T=h(T,E=h(E,S=h(S,M,T,E,k,6,s[52]),M,T,d,10,s[53]),S,M,w,15,s[54]),E,S,l,21,s[55]),T=h(T,E=h(E,S=h(S,M,T,E,b,6,s[56]),M,T,A,10,s[57]),S,M,y,15,s[58]),E,S,O,21,s[59]),T=h(T,E=h(E,S=h(S,M,T,E,v,6,s[60]),M,T,x,10,s[61]),S,M,p,15,s[62]),E,S,_,21,s[63]),i[0]=i[0]+S|0,i[1]=i[1]+M|0,i[2]=i[2]+T|0,i[3]=i[3]+E|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32;var i=e.floor(n/4294967296),a=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,l=s.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,o,i,a){var s=e+(t&r|~t&n)+o+a;return(s<<i|s>>>32-i)+t}function c(e,t,r,n,o,i,a){var s=e+(t&n|r&~n)+o+a;return(s<<i|s>>>32-i)+t}function f(e,t,r,n,o,i,a){var s=e+(t^r^n)+o+a;return(s<<i|s>>>32-i)+t}function h(e,t,r,n,o,i,a){var s=e+(r^(t|~n))+o+a;return(s<<i|s>>>32-i)+t}t.MD5=i._createHelper(l),t.HmacMD5=i._createHmacHelper(l)}(Math),n.MD5)},function(e,t,r){e.exports=r(1).enc.Hex},function(e,t,r){var n,o;void 0===(o="function"==typeof(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={decodeNumMat:function(e){for(var t=e.width,r=e.height,n=e.data,o=this.decodeNumArray(n),i=0,a=[],s=0;s<t;s++){a[s]=[];for(var l=0;l<r;l++)a[s][l]=o[i],i++}return a},encodeNumMat:function(e){for(var t=e.length,r=e[0].length,n=[],o=0;o<t;o++)for(var i=0;i<r;i++)n.push(e[o][i]);return{width:t,height:r,data:this.encodeNumArray(n)}},_firstChar:48,decodeNumArray:function(e){var t,r=[],n=[];for(t=0;t<e.length;t+=3){var o=e.charAt(t).charCodeAt()-this._firstChar,i=e.charAt(t+1).charCodeAt()-this._firstChar,a=e.charAt(t+2).charCodeAt()-this._firstChar;n.push(63&o>>2),n.push((3&o)<<4|15&i>>4),n.push((15&i)<<2|3&a>>6),n.push(63&a)}for(t=0;t<n.length;t++)63!==n[t]&&r.push(n[t]);return r},encodeNumArray:function(e){for(var t=[],r=0;r<e.length;r+=4){var n=e[r],o=r+1<e.length?e[r+1]:63,i=r+2<e.length?e[r+2]:63,a=r+3<e.length?e[r+3]:63;this.encodeSet(n,o,i,a,t)}return this.stringFromArray(t)},stringFromArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r];return t},encodeSet:function(e,t,r,n,o){var i=String.fromCharCode;o.push(i(((63&e)<<2|3&t>>4)+this._firstChar)),o.push(i(((15&t)<<4|15&r>>2)+this._firstChar)),o.push(i(((3&r)<<6|63&n)+this._firstChar))},pack_boolean:function(e){for(var t={width:e.length,height:e[0].length,data:[]},r=0,n=!1,o=0;o<e.length;o++)for(var i=0;i<e[o].length;i++)e[o][i]===n?r++:e[o][i]===!n?(t.data.push(r),n=!n,r=1):console.warn("Error: unknown entry ["+o+","+i+"]="+e[o][i]);return t.data.push(r),t},unpack_boolean:function(e){function t(e,t,n,o){for(var a=n,s=e,l=t;a--;)i[s][l]=o,++l===r&&(s++,l=0);return{row:s,col:l}}for(var r=e.width,n=e.height,o=e.data,i=[],a=n;a--;)i[a]=[];var s=!1;a=0;for(var l=0,u=0;u<o.length;u+=16)for(var c=0;c<16;++c){var f=t(a,l,o[c+u],s);a=f.row,l=f.col,s=!s}return i},unpackToImage:function(e){function t(e,t,n,o){for(var a=n,s=e,l=t,u=4*(s*r+l);a--;)i[u]=i[u+1]=i[u+2]=i[u+3]=o,u+=4,++l===r&&(s++,l=0);return{row:s,col:l}}for(var r=e.width,n=e.height,o=e.data,i=new Uint8ClampedArray(r*n*4),a=0,s=!1,l=0,u=0,c=0;c<o.length;c+=16)for(var f=0;f<16;++f){var h=t(l,u,o[f+c],s?255:0);l=h.row,u=h.col,a+=!0===s?1:0,s=!s}return{rgba:i,cntWhite:a}},downsampleImage:function(e,t,r,n){for(var o=Math.floor,i=o(t*n),a=o(r*n),s=new Uint8ClampedArray(i*a*4),l=0,u=0,c=0,f=0;f<a;++f)for(var h=0;h<i;++h)c=4*(f/n*t+h/n),s[u=4*(f*i+h)]=e[c],s[u+1]=e[c+1],s[u+2]=e[c+2],s[u+3]=e[c+3],l+=0===s[u]?0:1;return{rgba:s,cntWhite:l}}},e.exports=t.default})?n.apply(t,[e,t]):n)||(e.exports=o)},function(e,r){e.exports=t},function(e,t,r){e.exports=function(){return r(7)('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e,r){(function(e){t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s="./src/ABReader.js")}({"./node_modules/btoa/index.js":\n/*!************************************!*\\\n  !*** ./node_modules/btoa/index.js ***!\n  \\************************************/\n/*! no static exports found */function(t,r){!function(){"use strict";t.exports=function(t){return(t instanceof e?t:e.from(t.toString(),"binary")).toString("base64")}}()},"./node_modules/pako/dist/pako_inflate.min.js":\n/*!****************************************************!*\\\n  !*** ./node_modules/pako/dist/pako_inflate.min.js ***!\n  \\****************************************************/\n/*! no static exports found */function(t,e,r){var n;t.exports=function t(e,r,i){function o(s,u){if(!r[s]){if(!e[s]){var f="function"==typeof n&&n;if(!u&&f)return n(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module \'"+s+"\'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e,r,n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)e=i,r=o,Object.prototype.hasOwnProperty.call(e,r)&&(t[o]=i[o])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(e=n=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],2:[function(t,e,r){"use strict";var n=t("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function u(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,r.string2buf=function(t){var e,r,i,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(u),o=a=0;a<u;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?e[a++]=r:(r<2048?e[a++]=192|r>>>6:(r<65536?e[a++]=224|r>>>12:(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63),e[a++]=128|r>>>6&63),e[a++]=128|63&r);return e},r.buf2binstring=function(t){return u(t,t.length)},r.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,n,i,o,s=e||t.length,f=new Array(2*s);for(r=n=0;r<s;)if((i=t[r++])<128)f[n++]=i;else if(4<(o=a[i]))f[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&t[r++],o--;1<o?f[n++]=65533:i<65536?f[n++]=i:(i-=65536,f[n++]=55296|i>>10&1023,f[n++]=56320|1023&i)}return u(f,n)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;0<=r&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+a[t[r]]>e?r:e}},{"./common":1}],3:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+e[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],6:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,u,f,c,l,h,d,p,g,y,m,v,b,w,_,A,k,E,x,S;r=t.state,n=t.next_in,x=t.input,i=n+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,f=r.wsize,c=r.whave,l=r.wnext,h=r.window,d=r.hold,p=r.bits,g=r.lencode,y=r.distcode,m=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;t:do{p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),b=g[d&m];e:for(;;){if(d>>>=w=b>>>24,p-=w,0==(w=b>>>16&255))S[o++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=g[(65535&b)+(d&(1<<w)-1)];continue e}if(32&w){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}_=65535&b,(w&=15)&&(p<w&&(d+=x[n++]<<p,p+=8),_+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),b=y[d&v];r:for(;;){if(d>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=y[(65535&b)+(d&(1<<w)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(A=65535&b,p<(w&=15)&&(d+=x[n++]<<p,(p+=8)<w&&(d+=x[n++]<<p,p+=8)),u<(A+=d&(1<<w)-1)){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=w,p-=w,(w=o-a)<A){if(c<(w=A-w)&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=h,(k=0)===l){if(k+=f-w,w<_){for(_-=w;S[o++]=h[k++],--w;);k=o-A,E=S}}else if(l<w){if(k+=f+l-w,(w-=l)<_){for(_-=w;S[o++]=h[k++],--w;);if(k=0,l<_){for(_-=w=l;S[o++]=h[k++],--w;);k=o-A,E=S}}}else if(k+=l-w,w<_){for(_-=w;S[o++]=h[k++],--w;);k=o-A,E=S}for(;2<_;)S[o++]=E[k++],S[o++]=E[k++],S[o++]=E[k++],_-=3;_&&(S[o++]=E[k++],1<_&&(S[o++]=E[k++]))}else{for(k=o-A;S[o++]=S[k++],S[o++]=S[k++],S[o++]=S[k++],2<(_-=3););_&&(S[o++]=S[k++],1<_&&(S[o++]=S[k++]))}break}}break}}while(n<i&&o<s);n-=_=p>>3,d&=(1<<(p-=_<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(t,e,r){"use strict";var n=t("../utils/common"),i=t("./adler32"),o=t("./crc32"),a=t("./inffast"),s=t("./inftrees"),u=1,f=2,c=0,l=-2,h=1,d=852,p=592;function g(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function m(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=h,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(d),e.distcode=e.distdyn=new n.Buf32(p),e.sane=1,e.back=-1,c):l}function v(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,m(t)):l}function b(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?l:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,v(t))):l}function w(t,e){var r,n;return t?(n=new y,(t.state=n).window=null,(r=b(t,e))!==c&&(t.state=null),r):l}var _,A,k=!0;function E(t){if(k){var e;for(_=new n.Buf32(512),A=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,_,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(f,t.lens,0,32,A,0,t.work,{bits:5}),k=!1}t.lencode=_,t.lenbits=9,t.distcode=A,t.distbits=5}function x(t,e,r,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,e,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=v,r.inflateReset2=b,r.inflateResetKeep=m,r.inflateInit=function(t){return w(t,15)},r.inflateInit2=w,r.inflate=function(t,e){var r,d,p,y,m,v,b,w,_,A,k,S,T,P,B,U,O,R,L,C,I,j,D,M,N=0,F=new n.Buf8(4),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return l;12===(r=t.state).mode&&(r.mode=13),m=t.next_out,p=t.output,b=t.avail_out,y=t.next_in,d=t.input,v=t.avail_in,w=r.hold,_=r.bits,A=v,k=b,j=c;t:for(;;)switch(r.mode){case h:if(0===r.wrap){r.mode=13;break}for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(2&r.wrap&&35615===w){F[r.check=0]=255&w,F[1]=w>>>8&255,r.check=o(r.check,F,2,0),_=w=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&w)<<8)+(w>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&w)){t.msg="unknown compression method",r.mode=30;break}if(_-=4,I=8+(15&(w>>>=4)),0===r.wbits)r.wbits=I;else if(I>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<I,t.adler=r.check=1,r.mode=512&w?10:12,_=w=0;break;case 2:for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(r.flags=w,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=w>>8&1),512&r.flags&&(F[0]=255&w,F[1]=w>>>8&255,r.check=o(r.check,F,2,0)),_=w=0,r.mode=3;case 3:for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.head&&(r.head.time=w),512&r.flags&&(F[0]=255&w,F[1]=w>>>8&255,F[2]=w>>>16&255,F[3]=w>>>24&255,r.check=o(r.check,F,4,0)),_=w=0,r.mode=4;case 4:for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.head&&(r.head.xflags=255&w,r.head.os=w>>8),512&r.flags&&(F[0]=255&w,F[1]=w>>>8&255,r.check=o(r.check,F,2,0)),_=w=0,r.mode=5;case 5:if(1024&r.flags){for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.length=w,r.head&&(r.head.extra_len=w),512&r.flags&&(F[0]=255&w,F[1]=w>>>8&255,r.check=o(r.check,F,2,0)),_=w=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(v<(S=r.length)&&(S=v),S&&(r.head&&(I=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,y,S,I)),512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,r.length-=S),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===v)break t;for(S=0;I=d[y+S++],r.head&&I&&r.length<65536&&(r.head.name+=String.fromCharCode(I)),I&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,I)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===v)break t;for(S=0;I=d[y+S++],r.head&&I&&r.length<65536&&(r.head.comment+=String.fromCharCode(I)),I&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,y)),v-=S,y+=S,I)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;_<16;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}_=w=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}t.adler=r.check=g(w),_=w=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){w>>>=7&_,_-=7&_,r.mode=27;break}for(;_<3;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}switch(r.last=1&w,_-=1,3&(w>>>=1)){case 0:r.mode=14;break;case 1:if(E(r),r.mode=20,6!==e)break;w>>>=2,_-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}w>>>=2,_-=2;break;case 14:for(w>>>=7&_,_-=7&_;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if((65535&w)!=(w>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&w,_=w=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(S=r.length){if(v<S&&(S=v),b<S&&(S=b),0===S)break t;n.arraySet(p,d,y,S,m),v-=S,y+=S,b-=S,m+=S,r.length-=S;break}r.mode=12;break;case 17:for(;_<14;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(r.nlen=257+(31&w),w>>>=5,_-=5,r.ndist=1+(31&w),w>>>=5,_-=5,r.ncode=4+(15&w),w>>>=4,_-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;_<3;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.lens[Y[r.have++]]=7&w,w>>>=3,_-=3}for(;r.have<19;)r.lens[Y[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,D={bits:r.lenbits},j=s(0,r.lens,0,19,r.lencode,0,r.work,D),r.lenbits=D.bits,j){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;U=(N=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,O=65535&N,!((B=N>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(O<16)w>>>=B,_-=B,r.lens[r.have++]=O;else{if(16===O){for(M=B+2;_<M;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w>>>=B,_-=B,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}I=r.lens[r.have-1],S=3+(3&w),w>>>=2,_-=2}else if(17===O){for(M=B+3;_<M;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}_-=B,I=0,S=3+(7&(w>>>=B)),w>>>=3,_-=3}else{for(M=B+7;_<M;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}_-=B,I=0,S=11+(127&(w>>>=B)),w>>>=7,_-=7}if(r.have+S>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;S--;)r.lens[r.have++]=I}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,D={bits:r.lenbits},j=s(u,r.lens,0,r.nlen,r.lencode,0,r.work,D),r.lenbits=D.bits,j){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,D={bits:r.distbits},j=s(f,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,D),r.distbits=D.bits,j){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=v&&258<=b){t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,a(t,k),m=t.next_out,p=t.output,b=t.avail_out,y=t.next_in,d=t.input,v=t.avail_in,w=r.hold,_=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;U=(N=r.lencode[w&(1<<r.lenbits)-1])>>>16&255,O=65535&N,!((B=N>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(U&&0==(240&U)){for(R=B,L=U,C=O;U=(N=r.lencode[C+((w&(1<<R+L)-1)>>R)])>>>16&255,O=65535&N,!(R+(B=N>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}w>>>=R,_-=R,r.back+=R}if(w>>>=B,_-=B,r.back+=B,r.length=O,0===U){r.mode=26;break}if(32&U){r.back=-1,r.mode=12;break}if(64&U){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&U,r.mode=22;case 22:if(r.extra){for(M=r.extra;_<M;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.length+=w&(1<<r.extra)-1,w>>>=r.extra,_-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;U=(N=r.distcode[w&(1<<r.distbits)-1])>>>16&255,O=65535&N,!((B=N>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(0==(240&U)){for(R=B,L=U,C=O;U=(N=r.distcode[C+((w&(1<<R+L)-1)>>R)])>>>16&255,O=65535&N,!(R+(B=N>>>24)<=_);){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}w>>>=R,_-=R,r.back+=R}if(w>>>=B,_-=B,r.back+=B,64&U){t.msg="invalid distance code",r.mode=30;break}r.offset=O,r.extra=15&U,r.mode=24;case 24:if(r.extra){for(M=r.extra;_<M;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}r.offset+=w&(1<<r.extra)-1,w>>>=r.extra,_-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===b)break t;if(S=k-b,r.offset>S){if((S=r.offset-S)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}S>r.wnext?(S-=r.wnext,T=r.wsize-S):T=r.wnext-S,S>r.length&&(S=r.length),P=r.window}else P=p,T=m-r.offset,S=r.length;for(b<S&&(S=b),b-=S,r.length-=S;p[m++]=P[T++],--S;);0===r.length&&(r.mode=21);break;case 26:if(0===b)break t;p[m++]=r.length,b--,r.mode=21;break;case 27:if(r.wrap){for(;_<32;){if(0===v)break t;v--,w|=d[y++]<<_,_+=8}if(k-=b,t.total_out+=k,r.total+=k,k&&(t.adler=r.check=r.flags?o(r.check,p,k,m-k):i(r.check,p,k,m-k)),k=b,(r.flags?w:g(w))!==r.check){t.msg="incorrect data check",r.mode=30;break}_=w=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;_<32;){if(0===v)break t;v--,w+=d[y++]<<_,_+=8}if(w!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}_=w=0}r.mode=29;case 29:j=1;break t;case 30:j=-3;break t;case 31:return-4;case 32:default:return l}return t.next_out=m,t.avail_out=b,t.next_in=y,t.avail_in=v,r.hold=w,r.bits=_,(r.wsize||k!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&x(t,t.output,t.next_out,k-t.avail_out)?(r.mode=31,-4):(A-=t.avail_in,k-=t.avail_out,t.total_in+=A,t.total_out+=k,r.total+=k,r.wrap&&k&&(t.adler=r.check=r.flags?o(r.check,p,k,t.next_out-k):i(r.check,p,k,t.next_out-k)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===A&&0===k||4===e)&&j===c&&(j=-5),j)},r.inflateEnd=function(t){if(!t||!t.state)return l;var e=t.state;return e.window&&(e.window=null),t.state=null,c},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?l:((r.head=e).done=!1,c):l},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?l:11===r.mode&&i(1,e,n,0)!==r.check?-3:x(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,c):l},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,u,f,c,l,h){var d,p,g,y,m,v,b,w,_,A=h.bits,k=0,E=0,x=0,S=0,T=0,P=0,B=0,U=0,O=0,R=0,L=null,C=0,I=new n.Buf16(16),j=new n.Buf16(16),D=null,M=0;for(k=0;k<=15;k++)I[k]=0;for(E=0;E<u;E++)I[e[r+E]]++;for(T=A,S=15;1<=S&&0===I[S];S--);if(S<T&&(T=S),0===S)return f[c++]=20971520,f[c++]=20971520,h.bits=1,0;for(x=1;x<S&&0===I[x];x++);for(T<x&&(T=x),k=U=1;k<=15;k++)if(U<<=1,(U-=I[k])<0)return-1;if(0<U&&(0===t||1!==S))return-1;for(j[1]=0,k=1;k<15;k++)j[k+1]=j[k]+I[k];for(E=0;E<u;E++)0!==e[r+E]&&(l[j[e[r+E]]++]=E);if(0===t?(L=D=l,v=19):1===t?(L=i,C-=257,D=o,M-=257,v=256):(L=a,D=s,v=-1),k=x,m=c,B=E=R=0,g=-1,y=(O=1<<(P=T))-1,1===t&&852<O||2===t&&592<O)return 1;for(;;){for(b=k-B,l[E]<v?(w=0,_=l[E]):l[E]>v?(w=D[M+l[E]],_=L[C+l[E]]):(w=96,_=0),d=1<<k-B,x=p=1<<P;f[m+(R>>B)+(p-=d)]=b<<24|w<<16|_|0,0!==p;);for(d=1<<k-1;R&d;)d>>=1;if(0!==d?(R&=d-1,R+=d):R=0,E++,0==--I[k]){if(k===S)break;k=e[r+l[E]]}if(T<k&&(R&y)!==g){for(0===B&&(B=T),m+=x,U=1<<(P=k-B);P+B<S&&!((U-=I[P+B])<=0);)P++,U<<=1;if(O+=1<<P,1===t&&852<O||2===t&&592<O)return 1;f[g=R&y]=T<<24|P<<16|m-c|0}}return 0!==R&&(f[m+R]=k-B<<24|64<<16|0),h.bits=T,0}},{"../utils/common":1}],10:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(t,e,r){"use strict";var n=t("./zlib/inflate"),i=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),s=t("./zlib/messages"),u=t("./zlib/zstream"),f=t("./zlib/gzheader"),c=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new f,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=n.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[r])}function h(t,e){var r=new l(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}l.prototype.push=function(t,e){var r,s,u,f,l,h=this.strm,d=this.options.chunkSize,p=this.options.dictionary,g=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?h.input=o.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(d),h.next_out=0,h.avail_out=d),(r=n.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===g&&(r=a.Z_OK,g=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);h.next_out&&(0!==h.avail_out&&r!==a.Z_STREAM_END&&(0!==h.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(u=o.utf8border(h.output,h.next_out),f=h.next_out-u,l=o.buf2string(h.output,u),h.next_out=f,h.avail_out=d-f,f&&i.arraySet(h.output,h.output,u,f,0),this.onData(l)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(g=!0)}while((0<h.avail_in||0===h.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(h.avail_out=0))},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=l,r.inflate=h,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,h(t,e)},r.ungzip=h},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},"./src/ABReader.js":\n/*!*************************!*\\\n  !*** ./src/ABReader.js ***!\n  \\*************************/\n/*! exports provided: downloadAB */function(t,e,r){"use strict";r.r(e),r.d(e,"downloadAB",function(){return a});var n=r(/*! ./lib/AltizureBinaryUtil */"./src/lib/AltizureBinaryUtil.js"),i=r(/*! ./lib/UTF8Decoder */"./src/lib/UTF8Decoder.js"),o=r(/*! ./lib/OSGLoadUtil */"./src/lib/OSGLoadUtil.js");function a(t){var e=t.url,r=t.timeout;switch(t.modelType){case"OSG":return Object(o.downloadSerialized)({url:e,timeout:r});default:return Object(n.downloadEntries)({url:e,timeout:r}).then(function(t){var r=new i.default({resourceKey:e,utf8:t.utf8}),n=r.rdutf8;return n.parseTime=t.parseTime,r.destruct(),n})}}},"./src/Util/GeometryAttribute.js":\n/*!***************************************!*\\\n  !*** ./src/Util/GeometryAttribute.js ***!\n  \\***************************************/\n/*! exports provided: ATTRIBUTE_SIZE */function(t,e,r){"use strict";r.r(e),r.d(e,"ATTRIBUTE_SIZE",function(){return n});var n={position:3,uv:2,color:3,normal:3}},"./src/Util/GeometryBufferOperations.js":\n/*!**********************************************!*\\\n  !*** ./src/Util/GeometryBufferOperations.js ***!\n  \\**********************************************/\n/*! exports provided: computeBoundingBox, mergeBoundingBoxes, computeBufferGeometryGpuUsage */function(t,e,r){"use strict";function n(t){for(var e=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0],n=0,i=t.length;n<i;n+=3)for(var o=0;o<3;o++){var a=t[n+o];a>e[o]&&(e[o]=a),a<r[o]&&(r[o]=a)}return{max:e,min:r}}function i(t){for(var e=t[0].max,r=t[0].min,n=1,i=t.length;n<i;n++)for(var o=t[n],a=0;a<3;a++)o.max[a]>e[a]&&(e[a]=o.max[a]),o.min[a]<r[a]&&(r[a]=o.min[a]);return{max:e,min:r}}function o(t){var e=0;for(var r in t.attributes)e+=t.attributes[r].array.byteLength;return t.index&&(e+=t.index.array.byteLength),e}r.r(e),r.d(e,"computeBoundingBox",function(){return n}),r.d(e,"mergeBoundingBoxes",function(){return i}),r.d(e,"computeBufferGeometryGpuUsage",function(){return o})},"./src/Util/PNG.js":\n/*!*************************!*\\\n  !*** ./src/Util/PNG.js ***!\n  \\*************************/\n/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var n=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(t){this.width=t},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(t){this.height=t},n.prototype.getBitDepth=function(){return this.bitDepth},n.prototype.setBitDepth=function(t){if(-1===[2,4,8,16].indexOf(t))throw new Error("invalid bith depth "+t);this.bitDepth=t},n.prototype.getColorType=function(){return this.colorType},n.prototype.setColorType=function(t){var e=0,r=!1;switch(t){case 0:e=1;break;case 2:e=3;break;case 3:e=1;break;case 4:e=2,r=!0;break;case 6:e=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=e,this.alpha=r,this.colorType=t},n.prototype.getCompressionMethod=function(){return this.compressionMethod},n.prototype.setCompressionMethod=function(t){if(0!==t)throw new Error("invalid compression method "+t);this.compressionMethod=t},n.prototype.getFilterMethod=function(){return this.filterMethod},n.prototype.setFilterMethod=function(t){if(0!==t)throw new Error("invalid filter method "+t);this.filterMethod=t},n.prototype.getInterlaceMethod=function(){return this.interlaceMethod},n.prototype.setInterlaceMethod=function(t){if(0!==t&&1!==t)throw new Error("invalid interlace method "+t);this.interlaceMethod=t},n.prototype.setPalette=function(t){if(t.length%3!=0)throw new Error("incorrect PLTE chunk length");if(t.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=t},n.prototype.getPalette=function(){return this.palette},n.prototype.getPixel=function(t,e){if(!this.pixels)throw new Error("pixel data is empty");if(t>=this.width||e>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(e*this.width+t),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}},e.default=n},"./src/Util/PNGReader.js":\n/*!*******************************!*\\\n  !*** ./src/Util/PNGReader.js ***!\n  \\*******************************/\n/*! exports provided: default */function(t,r,n){"use strict";n.r(r);var i=n(/*! ../../node_modules/pako/dist/pako_inflate.min.js */"./node_modules/pako/dist/pako_inflate.min.js"),o=n(/*! ./PNG */"./src/Util/PNG.js");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(t,e){return new Uint8Array(Array.prototype.slice.call(this,t,e))}});var s=Object.prototype.toString;function u(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+(t[e+3]<<0)}function f(t,e){return t[e]<<0}function c(t){if("string"==typeof t){var e=t;t=new Array(e.length);for(var r=0,n=e.length;r<n;r++)t[r]=e[r].charCodeAt(0)}else{"ArrayBuffer"===s.call(t).slice(8,-1)&&(t=new Uint8Array(t))}this.i=0,this.bytes=t,this.png=new o.default,this.dataChunks=[]}c.prototype.readBytes=function(t){var e=this.i+t;if(e>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=this.bytes.slice(this.i,e);return this.i=e,r},c.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var t=this.readBytes(8);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}(t,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=t},c.prototype.decodeChunk=function(){var t=u(this.readBytes(4),0);if(t<0)throw new Error("Bad chunk length "+(4294967295&t));var e=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}(this.readBytes(4)),r=this.readBytes(t);this.readBytes(4);switch(e){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return e},c.prototype.decodeIHDR=function(t){var e=this.png;e.setWidth(u(t,0)),e.setHeight(u(t,4)),e.setBitDepth(f(t,8)),e.setColorType(f(t,9)),e.setCompressionMethod(f(t,10)),e.setFilterMethod(f(t,11)),e.setInterlaceMethod(f(t,12))},c.prototype.decodePLTE=function(t){this.png.setPalette(t)},c.prototype.decodeIDAT=function(t){this.dataChunks.push(t)},c.prototype.decodeIEND=function(){},c.prototype.decodePixels=function(t){var r,n=this.png,o=this,a=0;for(r=this.dataChunks.length;r--;)a+=this.dataChunks[r].length;var s=e.allocUnsafe(a);for(r=0,a=0;r<this.dataChunks.length;r++)s.set(this.dataChunks[r],a),a+=this.dataChunks[r].length;!function(t,e){try{e(null,Object(i.inflate)(t))}catch(t){e(t)}}(s,function(e,r){if(e)return t(e);try{0===n.getInterlaceMethod()?o.interlaceNone(r):o.interlaceAdam7(r)}catch(e){return t(e)}t()})},c.prototype.interlaceNone=function(t){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),o=i*n.width,a=e.allocUnsafe(i*n.width*n.height),s=0,u=0;u<t.length;u+=o+1){switch(r=t.slice(u+1,u+o+1),f(t,u)){case 0:this.unFilterNone(r,a,i,s,o);break;case 1:this.unFilterSub(r,a,i,s,o);break;case 2:this.unFilterUp(r,a,i,s,o);break;case 3:this.unFilterAverage(r,a,i,s,o);break;case 4:this.unFilterPaeth(r,a,i,s,o);break;default:throw new Error("unkown filtered scanline")}s+=o}n.pixels=a},c.prototype.interlaceAdam7=function(t){throw new Error("Adam7 interlacing is not implemented yet")},c.prototype.unFilterNone=function(t,e,r,n,i){for(var o=0,a=i;o<a;o++)e[n+o]=t[o]},c.prototype.unFilterSub=function(t,e,r,n,i){for(var o=0;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255},c.prototype.unFilterUp=function(t,e,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)e[n+o]=t[o];else for(;o<i;o++){var a=t[o],s=e[n+o-i];e[n+o]=a+s&255}},c.prototype.unFilterAverage=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+(e[n+o-r]>>1)&255}else{for(;o<r;o++)e[n+o]=t[o]+(e[n-i+o]>>1)&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i];e[n+o]=a+(s+u>>1)&255}}},c.prototype.unFilterPaeth=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255}else{for(;o<r;o++)e[n+o]=t[o]+e[n+o-i]&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i],f=e[n+o-i-r],c=s+u-f,l=Math.abs(c-s),h=Math.abs(c-u),d=Math.abs(c-f),p=void 0;p=l<=h&&l<=d?s:h<=d?u:f,e[n+o]=a+p&255}}},c.prototype.parse=function(t,e){"function"==typeof t&&(e=t),"object"!==a(t)&&(t={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===t.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(t){e(t,n)})}catch(t){e(t)}},r.default=c},"./src/Util/PathUtil.js":\n/*!******************************!*\\\n  !*** ./src/Util/PathUtil.js ***!\n  \\******************************/\n/*! exports provided: basename, filename */function(t,e,r){"use strict";function n(t){return t.replace(/.*\\/|\\.[^.]*$/g,"")}function i(t){return t.replace(/^.*[\\\\\\/]/,"")}r.r(e),r.d(e,"basename",function(){return n}),r.d(e,"filename",function(){return i})},"./src/lib/AltizureBinaryUtil.js":\n/*!***************************************!*\\\n  !*** ./src/lib/AltizureBinaryUtil.js ***!\n  \\***************************************/\n/*! exports provided: downloadPNG, readPNG, readImageData, readBundle, downloadEntries, parseBinary */function(t,e,r){"use strict";r.r(e),r.d(e,"downloadPNG",function(){return o}),r.d(e,"readPNG",function(){return a}),r.d(e,"readImageData",function(){return s}),r.d(e,"readBundle",function(){return u}),r.d(e,"downloadEntries",function(){return f}),r.d(e,"parseBinary",function(){return c});var n=r(/*! ../Util/PNGReader */"./src/Util/PNGReader.js"),i=r(/*! ./WebBundle */"./src/lib/WebBundle.js");function o(t){var e=t.url,r=t.timeout,n=new XMLHttpRequest;return n.open("GET",e,!0),n.timeout=r,n.responseType="arraybuffer",new Promise(function(t,e){n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var r=n.response;t(r)}else e(new Error(n.status.toString()))},n.send()})}function a(t){return new Promise(function(e,r){new n.default(t).parse(function(t,n){t?(console.error(t),r(new Error("readPNG"))):e(n)})})}function s(t){var e=t.pixels,r=t.imgWidth,n=t.imgHeight;try{var o=new i.default;return o.parseBundle(e,r,n,{}),Promise.resolve(o)}catch(t){return console.error(t),Promise.reject(new Error("readImageData"))}}function u(t){return new Promise(function(e,r){try{var n={};t.entries.map(function(e){var r,i=e.path,o=i.length;".osgjs"===i.substring(o-6)?r=t.readJSON(i):".json"===i.substring(o-5)?r=t.readJSON(i):".jpg"===i.substring(o-4)||".png"===i.substring(o-4)?r=t.readImg(i,i.substring(o-4)):".aa"===i.substring(o-3)?r=decodeURIComponent(escape(t.readText(i))):".bin"===i.substring(o-4)?r=t.readBuffer(i):".txt"===i.substring(o-4)?r=t.readJSON(i):".info"===i.substring(o-5)?r=t.readJSON(i):console.warn("unknown entry",e.path),n[i]=r}),t.clearData(),e(n)}catch(e){t.clearData(),console.log(t),console.error(e),r(new Error("readBundle"))}})}function f(t){var e=t.url,r=t.trials,n=void 0===r?3:r,i=t.timeout;return function t(e){var r=e.trials,n=e.url,i=e.timeout;return r<=0?Promise.reject(new Error("0")):o({url:n,timeout:i}).catch(function(e){return i*=2,--r<=0?Promise.reject(e):"404"===e.message||"403"===e.message?Promise.reject(e):t({trials:r,url:n,timeout:i})})}({trials:n,url:e,timeout:void 0===i?3e4:i}).then(function(t){return c(t)})}function c(t){var e=new Date;return a(t).then(function(t){return s({pixels:t.pixels,imgWidth:t.getWidth(),imgHeight:t.getHeight()})}).then(function(t){return u(t)}).then(function(t){var r=new Date-e;return Promise.resolve({utf8:t,parseTime:r})}).catch(function(t){return"readPNG"===t.message||"readImageData"===t.message||"readBundle"===t.message?Promise.reject(new Error("downloadEntries")):Promise.reject(t)})}},"./src/lib/OSGLoadUtil.js":\n/*!********************************!*\\\n  !*** ./src/lib/OSGLoadUtil.js ***!\n  \\********************************/\n/*! exports provided: downloadSerialized, parseOSG */function(t,e,r){"use strict";r.r(e),r.d(e,"downloadSerialized",function(){return s}),r.d(e,"parseOSG",function(){return u});var n=r(/*! ./OSGUtil */"./src/lib/OSGUtil.js"),i=r(/*! ./AltizureBinaryUtil */"./src/lib/AltizureBinaryUtil.js"),o=r(/*! ../Util/GeometryBufferOperations */"./src/Util/GeometryBufferOperations.js");function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function s(t){var e=t.url,r=t.trials,n=void 0===r?3:r,o=t.timeout;return Object(i.downloadEntries)({url:e,trials:n,timeout:o}).then(function(t){return u(t)})}function u(t){var e=null,r={},i=null,s=null;for(var u in t){var c=u.length;".osgjs"===u.substring(c-6)?e=t[u]:".jpg"===u.substring(c-4)?r[u]=t[u]:".json"===u.substring(c-5)?i=t[u]:".bin"===u.substring(c-4)&&(s=t[u])}return e?Promise.all([Object(n.osgJsonReader)(e,s),r,i]).then(function(t){var e=a(t,3),r=e[0],i=r.GeometryList,s=r.PagedLODList,u=e[1],c=e[2],l=[],h=[],d=null;if(s.length>0){var p=[];s.forEach(function(t){var e=t.geometryList,r=t.nextLevelParam;e.length>0?(r.estimatedBBox=Object(o.mergeBoundingBoxes)(e.map(function(t){return Object(o.computeBoundingBox)(t.Vertex)})),l.push(r),h=h.concat(e),p.push(r.estimatedBBox)):console.error("Empty pagedLOD.")}),d=Object(o.mergeBoundingBoxes)(p)}else i.length>0?(h=i,d=Object(o.mergeBoundingBoxes)(h.map(function(t){return Object(o.computeBoundingBox)(t.Vertex)}))):console.error("Empty OsgJson.");var g=function(t){if(0===t.length)return void console.error("Empty osg geometry");var e={},r=[],i={};t.forEach(function(t,e){var n,o=c(t.StateSet),a=(n=t.StateSet).TextureAttributeList&&n.TextureAttributeList[0]&&n.TextureAttributeList[0][0]&&n.TextureAttributeList[0][0]["osg.Texture"]&&n.TextureAttributeList[0][0]["osg.Texture"].File&&n.TextureAttributeList[0][0]["osg.Texture"].File.length>0?n.TextureAttributeList[0][0]["osg.Texture"].File:void 0;if(void 0!==i[o]){var s=i[o];!r[s].map_Kd&&a&&(r[s].map_Kd=a,delete r[s].Kd)}else{var u=r.length;i[o]=u,r[u]={Ka:[0,0,0],Ks:[0,0,0],d:1,Ns:0},a?r[u].map_Kd=a:r[u].Kd=[255,255,255]}});var o=[],a=0,s=[];for(var u in t.forEach(function(t){s.push(a),a+=t.Vertex.length/3}),t.forEach(function(t,e){a=s[e];for(var r=0,n=t.Indices.length;r<n;r++)t.Indices[r]+=a;o.push({start:a,count:t.Indices.length,materialIndex:i[c(t.StateSet)]})}),t[0])"StateSet"!==u&&(e[u]=f(t,u));return{osgGeometry:new n.OsgGeometry(e),groups:o,materials:r};function c(t){return t.UniqueID}}(h),y={osgGeometry:g.osgGeometry,groups:g.groups,materials:g.materials,nextLevelParams:l,images:u,bbox:d,meta:c};return Promise.resolve(y)}).then(function(t){return Promise.resolve(t)}):Promise.reject(new Error("No osgjs."))}function f(t,e){var r=new(0,t[0][e].constructor)(t.reduce(function(t,r){return t+r[e].length},0)),n=0;return t.forEach(function(t){t[e]&&(r.set(t[e],n),n+=t[e].length)}),r}},"./src/lib/OSGUtil.js":\n/*!****************************!*\\\n  !*** ./src/lib/OSGUtil.js ***!\n  \\****************************/\n/*! exports provided: osgJsonReader, OsgGeometry */function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.r(e),r.d(e,"osgJsonReader",function(){return u}),r.d(e,"OsgGeometry",function(){return a});var i=function t(e){var r=e.RangeDataList,i=e.UserCenter;n(this,t),r["File 0"]&&".osgjs"===r["File 0"]&&r["File 1"]&&".osgjs"===r["File 1"].substring(r["File 1"].length-6)||console.warn("Unexpected",r);var o=r["File 1"]?r["File 1"]:r["File 0"];this.fileName=o.replace(/\\.[^\\/.]+$/,".ab"),this.userCenter=i,this.estimatedBBox=null},o=function t(e){for(var r in n(this,t),e)e[r]&&(this[r]=e[r])},a=function t(e){var r=e.Indices,i=e.Vertex,o=e.TexCoord0,a=e.StateSet;n(this,t),this.Indices=r,this.Vertex=i,this.TexCoord0=o,this.StateSet=a},s=function t(e){var r=e.nextLevelParam,i=e.geometryList;n(this,t),this.nextLevelParam=r,this.geometryList=i};function u(t,e){("OpenSceneGraph 3.1.7"!==t.Generator&&"OpenSceneGraph 3.2.1"!==t.Generator||9!==t.Version)&&console.warn(t.Generator,"version: ",t.Version,"may not be supported."),e||console.warn("No OSG bin.");var r=f(t,e);return Promise.resolve(r)}function f(t,e){return t["osg.Node"]?function(t,e){return function(t,e,r){return t&&t instanceof Array&&t.length>0?t.reduce(function(t,e,n){var i,o,a=f(e,r),s=(o=a,{PagedLODList:(i=t).PagedLODList.concat(o.PagedLODList),GeometryList:i.GeometryList.concat(o.GeometryList)});return s},e):e}(t.Children,{PagedLODList:[],GeometryList:[]},e)}(t["osg.Node"],e):t["osg.PagedLOD"]?{PagedLODList:c(t["osg.PagedLOD"],e),GeometryList:[]}:t["osg.Geometry"]?{PagedLODList:[],GeometryList:l(t["osg.Geometry"],e)}:void console.error("Unknown structure",t)}function c(t,e){var r=t.Children,n=t.RangeDataList,o=t.UserCenter,a=new i({RangeDataList:n,UserCenter:o}),u=function t(e,r,n){return e&&e instanceof Array&&e.length>0?e.reduce(function(e,r,i){var o=[];return r["osg.Node"]?o=t(r["osg.Node"].Children,[],n):r["osg.Geometry"]?o=[l(r["osg.Geometry"],n)]:(console.error("Unknown structure",r),o=[]),e.concat(o)},r):r}(r,[],e);return new s({nextLevelParam:a,geometryList:u})}function l(t,e){var r=u(t.PrimitiveSetList[0].DrawElementsUInt.Indices),n=u(t.VertexAttributeList.TexCoord0),i=u(t.VertexAttributeList.Vertex),s=new o(t.StateSet["osg.StateSet"]);return new a({Indices:r,TexCoord0:n,Vertex:i,StateSet:s});function u(t){var r,n=null;t.Array.Uint32Array?(n="Uint32Array",r=Uint32Array):t.Array.Float32Array?(n="Float32Array",r=Float32Array):console.error("Unknown Array Type");var i=t.Array[n];if(i.Elements)return new r(i.Elements);if(i.File){var o=t.ItemSize,a=i.Offset,s=i.Size,u=r.BYTES_PER_ELEMENT,f=o*u*s,c=new r(o*s),l=new DataView(e.buffer,a+e.byteOffset,f),h=0,d=c.length;if("Uint32Array"===n)for(;h<d;h++)c[h]=l.getUint32(h*u,!0);else if("Float32Array"===n)for(;h<d;h++)c[h]=l.getFloat32(h*u,!0);return l=null,c}}}},"./src/lib/UTF8Decoder.js":\n/*!********************************!*\\\n  !*** ./src/lib/UTF8Decoder.js ***!\n  \\********************************/\n/*! exports provided: default */function(t,e,r){"use strict";r.r(e);var n=r(/*! ../Util/PathUtil */"./src/Util/PathUtil.js"),i=r(/*! ../Util/GeometryAttribute */"./src/Util/GeometryAttribute.js");function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){var n,i,o,a,s=r.decodeOffsets,u=r.decodeScales,f=e.attribRange[0],c=e.attribRange[1],l=r.decodeScales.length,h=new Float32Array(l*c),d=f;e.hasOwnProperty("attribDelta")&&(n=e.attribDelta.attribRange[0],i=e.attribDelta.decodeParam.decodeOffsets,o=e.attribDelta.decodeParam.decodeScales,a=n);for(var p=0;p<l;p++){var g,y=d+c;a&&(g=a+c);var m,v,b=u[p],w=s[p];i&&(m=o[p],v=i[p]),b&&k(t,d,y,h,p,l,w,b,a,v,m),d=y,g&&(a=g)}var _=3*e.indexRange[1],A=new Uint32Array(_);return function(t,e,r,n,i){for(var o=0,a=0,s=0;s<r;s++)a=t.charCodeAt(e+s),n[s]=o-a,0===a&&o++}(t,d,_,A),{attribsOut:h,indicesOut:A};function k(t,e,r,n,i,o,s,u,f,c,l){for(var h=0,d=0,p=0,g=0,y=e;y<r;y++){if(h+=(d=t.charCodeAt(y))>>1^-(1&d),a){var m=y-e+f;p+=(g=t.charCodeAt(m))>>1^-(1&g)}n[i]=u*(h+s)+(a?l*(p+c):0),i+=o}}}var s=function(){function t(e){var r=e.resourceKey,n=e.utf8;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resourceKey=r,this.utf8=n,this._dutf8=null,this._rdutf8=null}var e,r,s;return e=t,(r=[{key:"destruct",value:function(){for(var t in this.resourceKey=null,this.utf8)this.utf8[t]=null;return this.utf8=null,this._dutf8=null,!0}},{key:"decode",value:function(){var t=this.meshFiles,e={};for(var r in t){var n=t[r],i=this._meshBuffer(r);e[r]=[];for(var o=0;o<n.length;o++){var s=n[o],u=s.indexRange;if(e[r][o]={},u){var f=u[0]+3*u[1];if(i.length<f){console.error("utf8 decode out of range.");break}var c=this.decodeParams;if(s.decodeParam)for(var l in s.decodeParam.decodeScales.length!==this.stride&&console.error("Component decode param in consistent",s.decodeParam,this.decodeParams),s.decodeParam)s.decodeParam[l]&&(c[l]=s.decodeParam[l]);var h=a(i,s,c),d=h.attribsOut,p=h.indicesOut;e[r][o].attributes=d,e[r][o].indices=p,e[r][o].materialName=s.material}}}this._dutf8={geometryArrays:e,materialParams:this.manifest.materials,imageStrings:this.imageStrings}}},{key:"_clearDutf8",value:function(){if(this._dutf8){for(var t in this._dutf8.geometryArrays){for(var e=this._dutf8.geometryArrays[t],r=0;r<e.length;r++)this._dutf8.geometryArrays[t][r].attributes=null,this._dutf8.geometryArrays[t][r].indices=null,this._dutf8.geometryArrays[t][r].materialName=null;this._dutf8.geometryArrays[t]=null}this._dutf8.geometryArrays=null,this._dutf8.materialParams=null,this._dutf8.imageStrings=null,this._dutf8=null}}},{key:"_meshBuffer",value:function(t){var e=t.length;return".aa"!==t.substring(e-3)&&(t=t+=".aa"),this.utf8[t]}},{key:"basename",get:function(){var t=Object(n.basename)(this.resourceKey);return Object.defineProperty(this,"fileName",{value:t,writable:!1,configurable:!0}),this.fileName}},{key:"decodeParams",get:function(){var t=this.manifest.decodeParams,e=t.decodeOffsets,r=t.decodeScales,n=t.decodeTarget,i=t.decodeFormat;return n||(n=["position","uv","normal"]),i||(i=[3,2,3]),Object.defineProperty(this,"decodeParams",{value:{decodeOffsets:e,decodeScales:r,decodeTarget:n,decodeFormat:i},writable:!1,configurable:!0}),this.decodeParams}},{key:"stride",get:function(){var t,e=this.decodeParams.decodeScales.length,r=this.decodeParams.decodeOffsets.length,n=this.decodeParams.decodeFormat.reduce(function(t,e){return t+e},0);return e===r&&r===n||console.error("decodeParams",this.decodeParams),t=e,Object.defineProperty(this,"stride",{value:t,writable:!1,configurable:!0}),this.stride}},{key:"meshFiles",get:function(){return this.manifest.urls}},{key:"dutf8",get:function(){return this._dutf8||this.decode(),this._dutf8}},{key:"rdutf8",get:function(){var t=this;if(this._rdutf8)return this._rdutf8;var e=this.dutf8,r=[];for(var n in e.geometryArrays)for(var o=e.geometryArrays[n],a=0;a<o.length;a++){var s=o[a];r.push(s)}var u=0;r.forEach(function(e,r){if(r>0)for(var n=0,i=e.indices.length;n<i;n++)e.indices[n]+=u;u+=e.attributes.length/t.stride});var f=r.reduce(function(t,e){return t+e.attributes.length},0),c=new Float32Array(f),l=r.reduce(function(t,e){return t+e.indices.length},0),h=new Uint32Array(l),d=[],p=0,g=0;l>0?r.forEach(function(t,e){c.set(t.attributes,p),h.set(t.indices,g),d.push({start:g,count:t.indices.length,materialName:t.materialName}),p+=t.attributes.length,g+=t.indices.length}):r.forEach(function(e,r){c.set(e.attributes,p),d.push({start:p,count:e.attributes.length/t.stride,materialName:e.materialName}),p+=e.attributes.length});var y=e.materialParams,m=e.imageStrings;this._clearDutf8();var v={groups:d};h.length>0&&(v.index=h);for(var b=f/this.stride,w=this.decodeParams.decodeTarget,_=this.decodeParams.decodeFormat,A=[0],k=1;k<_.length;k++)A[k]=A[k-1]+_[k-1];var E={};w.forEach(function(e,r){var n=i.ATTRIBUTE_SIZE[e],o=A[r];if(n){var a=function(t,e,r,n,i){for(var o=new Float32Array(r*i),a=0,s=n*i,u=e;u<s;u+=n)for(var f=0;f<r;f++)o[a++]=t[u+f];return o}(c,o,n,t.stride,b);E[e]=a}}),v.attributes=E;var x=function(t){var e=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0];if(!t)return{max:[0,0,0],min:[0,0,0]};for(var n=0,i=t.length;n<i;n+=3)for(var o=0;o<3;o++){var a=t[n+o];a>e[o]&&(e[o]=a),a<r[o]&&(r[o]=a)}return{max:e,min:r}}(E.position);return E=null,c=null,{geometry:v,materials:y,images:m,bbox:x}}},{key:"imageStrings",get:function(){var t=this,e={},r=["map_Ka","map_Kd","map_Ks"],n=function(n){var i=t.manifest.materials[n];r.forEach(function(r){var n=i[r];(function(t,e){return t&&"string"==typeof t&&t.length>0&&e[t]&&"string"==typeof e[t]})(n,t.utf8)&&(e[n]=t.utf8[n])})};for(var i in this.manifest.materials)n(i);return e}},{key:"manifest",get:function(){var t=null;for(var e in this.utf8){var r=e.length;if(".txt"===e.substring(r-4)){t=e;break}}return t||console.error("UTF8Decoder::manifest missing."),Object.defineProperty(this,"manifest",{value:this.utf8[t],writable:!1,configurable:!0}),this.manifest}}])&&o(e.prototype,r),s&&o(e,s),t}();e.default=s},"./src/lib/WebBundle.js":\n/*!******************************!*\\\n  !*** ./src/lib/WebBundle.js ***!\n  \\******************************/\n/*! exports provided: default */function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e);var i=!1;function o(){var t;i&&(t=console).log.apply(t,arguments)}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={},this.entries=[],this.buffer=null,this.storeBuffer=null!=e&&e}var e,a,s;return e=t,(a=[{key:"_Uint8ToString",value:function(t){var e=32768;"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Edge")&&(e=2048);var r=[];if(Uint8Array.prototype.subarray)for(var n=0;n<t.byteLength;n+=e)r.push(String.fromCharCode.apply(null,t.subarray(n,Math.min(n+e,t.byteLength))));else if(Uint8Array.prototype.slice)for(var i=0;i<t.byteLength;i+=e)r.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+e,t.byteLength))));else for(var o=0;o<t.byteLength;o+=e){for(var a=new Uint8Array(Math.min(e,t.byteLength-o)),s=0;s<a.byteLength;++s)a[s]=t[o+s];r.push(String.fromCharCode.apply(null,a))}return r.join("")}},{key:"_parseImgURI",value:function(t,e){if("undefined"==typeof btoa){var n=r(/*! btoa */"./node_modules/btoa/index.js");if(t instanceof Uint8Array)return null==e?"data:;base64,"+n(this._Uint8ToString(t)):"data:"+e+";base64,"+n(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var i=new Uint8Array(t);return null==e?"data:;base64,"+n(this._Uint8ToString(i)):"data:"+e+";base64,"+n(this._Uint8ToString(i))}console.error("Unknow type ",t)}else{if(t instanceof Uint8Array)return null==e?"data:;base64,"+btoa(this._Uint8ToString(t)):"data:"+e+";base64,"+btoa(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var o=new Uint8Array(t);return null==e?"data:;base64,"+btoa(this._Uint8ToString(o)):"data:"+e+";base64,"+btoa(this._Uint8ToString(o))}console.error("Unknow type ",t)}}},{key:"parseBundle",value:function(t,e,r,n){n=n||{};var a=0,s="",u=new Uint8Array(e*r*3),f=n.password||"";this.storeBuffer&&(this.buffer=u);for(var c=0;c<t.length;c++)(c+1)%4!=0&&(u[a++]=t[c]);if(o("Extracted Uint8Array",u.length,u),i){for(var l="",h=500;h<800;h++)l+=u[h]+",";console.log("".concat(500," to ").concat(800," bytes")),console.log(l)}for(a=0;a<u.length&&!(u[a]<5);)s+=String.fromCharCode(u[a++]);o("Found the string 0 char at index ".concat(a," with value ").concat(u[a])),o(s),a++;var d=0;if(""!==f)for(var p=a;p<u.length;p++){var g=u[p];g^=f.charCodeAt(d),u[p]=g,d=(d+1)%f.length}this.entries=[];var y=s.split("\\n");s=y.join(""),y=s.split(";");for(var m=0;m<y.length;m++)if(""!==y[m]){var v=y[m].split(",");this.entries.push({path:v[0],type:v[1],length:parseInt(v[2],10)})}o("this.entries",this.entries);for(var b=0;b<this.entries.length;b++){var w=this.entries[b],_=u.subarray(a,a+w.length);o("Extracting ".concat(w.path,": length ").concat(_.length)),o("Starts at ".concat(a," with value ").concat(_[0])),o("Ends at ".concat(a+w.length," with value ").concat(_[_.length-1])),a+=w.length,this.data[w.path]=_}}},{key:"read",value:function(t){return null===this.data[t]&&console.error("Bundle: ["+t+"] not found."),this.data[t]}},{key:"readText",value:function(t){var e="",r=this.read(t);if(null==r)return e;for(var n=0;n<r.length;n++)e+=String.fromCharCode(r[n]);return e}},{key:"readBuffer",value:function(t){var e=this.read(t);return null==e?new Uint8Array:e}},{key:"readJSON",value:function(t){var e=this.readText(t);return""===e?{}:JSON.parse(e)}},{key:"readImg",value:function(t,e){var r=this.read(t);if(null===r)return console.error("Cannot read ",t),"";var n=".png"===e?"image/png":"image/jpeg";return this._parseImgURI(r,n)}},{key:"clearData",value:function(){this.data={}}}])&&n(e.prototype,a),s&&n(e,s),t}();e.default=a}})}).call(this,r(3).Buffer)},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";r.r(e);var n=r(0);r(7),onmessage=function(t){var e=t.data.resourceKey,r=t.data.timeout,i=t.data.modelType,o=new Date;switch(i){case"OSG":return Object(n.downloadAB)({url:e,timeout:r,modelType:i}).then(function(t){postMessage({resourceKey:e,modelType:i,status:1,payload:t})}).catch(function(t){console.warn("osg worker",e,t),postMessage({resourceKey:e,modelType:i,status:0,payload:t.message})});default:return Object(n.downloadAB)({url:e,timeout:r}).then(function(t){var r=t.geometry.attributes,n=[];for(var a in t.geometry.index&&t.geometry.index.buffer&&n.push(t.geometry.index.buffer),r)r[a]&&r[a].buffer&&n.push(r[a].buffer);t.consumeTime=new Date-o,postMessage({resourceKey:e,modelType:i,status:200,payload:t},n),0!==t.geometry.attributes.position.buffer.byteLength&&console.warn("Transfer geometry failed.")}).catch(function(t){if("downloadEntries"===t.message)postMessage({resourceKey:e,modelType:i,status:-1,payload:t});else{var r=parseInt(t.message,10);postMessage({resourceKey:e,modelType:i,status:r,payload:{message:t.message}})}})}},onerror=function(t){throw console.error("BundleLoader onerror",t),t}},function(t,e,r){"use strict";(function(t){\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nvar n=r(4),i=r(5),o=r(6);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return f(this,t,e,r)}function f(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=h(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(t,0):h(t,e);if("Buffer"===e.type&&o(e.data))return h(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function l(t,e){if(c(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function h(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(n)return F(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function f(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var c=-1;for(o=r;o<s;o++)if(f(t,o)===f(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var l=!0,h=0;h<u;h++)if(f(t,o+h)!==f(e,h)){l=!1;break}if(l)return o}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function b(t,e,r,n){return Z(F(e,t.length-r),t,r,n)}function w(t,e,r,n){return Z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return w(t,e,r,n)}function A(t,e,r,n){return Z(Y(e),t,r,n)}function k(t,e,r,n){return Z(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function E(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,f=t[i],c=null,l=f>239?4:f>223?3:f>191?2:1;if(i+l<=r)switch(l){case 1:f<128&&(c=f);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&f)<<6|63&o)>127&&(c=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&f)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&f)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,l=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=l}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=S));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return f(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return c(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return l(null,t)},u.allocUnsafeSlow=function(t){return l(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return P(this,e,r);case"base64":return E(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),f=this.slice(n,i),c=t.slice(e,r),l=0;l<s;++l)if(f[l]!==c[l]){o=f[l],a=c[l];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return v(this,t,e,r);case"utf8":case"utf-8":return b(this,t,e,r);case"ascii":return w(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return A(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function P(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=N(t[o]);return i}function U(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function O(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function L(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function C(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function I(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function j(t,e,r,n,o){return o||I(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function D(t,e,r,n,o){return o||I(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||O(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||O(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||O(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||O(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||O(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||O(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||O(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||O(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||O(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||O(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||O(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||O(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||O(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||O(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||O(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||O(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||R(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||R(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):C(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):C(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):C(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return j(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return j(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=u.isBuffer(t)?t:F(new u(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var M=/[^+\\/0-9A-Za-z-_]/g;function N(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}(t).replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(1))},function(t,e,r){"use strict";e.byteLength=function(t){var e=f(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){for(var e,r=f(t),n=r[0],a=r[1],s=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,a)),u=0,c=a>0?n-4:n,l=0;l<c;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===a&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,s[u++]=255&e);1===a&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,r){for(var i,o,a=[],s=e;s<r;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,f=u>>1,c=-7,l=r?i-1:0,h=r?-1:1,d=t[e+l];for(l+=h,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+t[e+l],l+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+l],l+=h,c-=8);if(0===o)o=1-f;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=f}return(d?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,f=8*o-i-1,c=(1<<f)-1,l=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(a++,u/=2),a+l>=c?(s=0,a=c):a+l>=1?(s=(e*u-1)*Math.pow(2,i),a+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,f+=i;f>0;t[r+d]=255&a,d+=p,a/=256,f-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){(function(e,r){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function n(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<v;t+=2){var e=T[t],r=T[t+1];e(r),T[t]=void 0,T[t+1]=void 0}v=0}function o(t,e){var r=this,n=new this.constructor(s);void 0===n[B]&&y(n);var i=r._state;if(i){var o=arguments[i-1];_(function(){return g(i,n,o,r._result)})}else d(r,n,t,e);return n}function a(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return f(e,t),e}function s(){}function u(e,r,n){r.constructor===e.constructor&&n===o&&r.constructor.resolve===a?function(t,e){e._state===O?l(t,e._result):e._state===R?h(t,e._result):d(e,void 0,function(e){return f(t,e)},function(e){return h(t,e)})}(e,r):void 0===n?l(e,r):t(n)?function(t,e,r){_(function(t){var n=!1,i=function(t,e,r,n){try{t.call(e,r,n)}catch(t){return t}}(r,e,function(r){n||(n=!0,e!==r?f(t,r):l(t,r))},function(e){n||(n=!0,h(t,e))},t._label);!n&&i&&(n=!0,h(t,i))},t)}(e,r,n):l(e,r)}function f(t,e){if(t===e)h(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var r=void 0;try{r=e.then}catch(e){return void h(t,e)}u(t,e,r)}else l(t,e)}function c(t){t._onerror&&t._onerror(t._result),p(t)}function l(t,e){t._state===U&&(t._result=e,t._state=O,0!==t._subscribers.length&&_(p,t))}function h(t,e){t._state===U&&(t._state=R,t._result=e,_(c,t))}function d(t,e,r,n){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+O]=r,i[o+R]=n,0===o&&t._state&&_(p,t)}function p(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],i=e[a+r],n?g(r,n,i,o):i(o);t._subscribers.length=0}}function g(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=!0;if(o){try{a=n(i)}catch(t){u=!1,s=t}if(r===a)return void h(r,new TypeError("A promises callback cannot return that same promise."))}else a=i;r._state!==U||(o&&u?f(r,a):!1===u?h(r,s):e===O?l(r,a):e===R&&h(r,a))}function y(t){t[B]=L++,t._state=void 0,t._result=void 0,t._subscribers=[]}var m=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},v=0,b=void 0,w=void 0,_=function(t,e){T[v]=t,T[v+1]=e,2===(v+=2)&&(w?w(i):P())},A="undefined"!=typeof window?window:void 0,k=A||{},E=k.MutationObserver||k.WebKitMutationObserver,x="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),S="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,T=new Array(1e3),P=void 0;P=x?function(){return e.nextTick(i)}:E?function(){var t=0,e=new E(i),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():S?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===A?function(){try{var t=Function("return this")().require("vertx");return void 0!==(b=t.runOnLoop||t.runOnContext)?function(){b(i)}:n()}catch(t){return n()}}():n();var B=Math.random().toString(36).substring(2),U=void 0,O=1,R=2,L=0,C=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[B]||y(this.promise),m(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?l(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&l(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===U&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===a){var i=void 0,f=void 0,c=!1;try{i=t.then}catch(t){c=!0,f=t}if(i===o&&t._state!==U)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(r===I){var l=new r(s);c?h(l,f):u(l,t,i),this._willSettleAt(l,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===U&&(this._remaining--,t===R?h(n,r):this._result[e]=r),0===this._remaining&&l(n,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;d(t,void 0,function(t){return r._settledAt(O,e,t)},function(t){return r._settledAt(R,e,t)})},t}(),I=function(){function e(t){this[B]=L++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){f(t,e)},function(e){h(t,e)})}catch(e){h(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):r.then(e,e)},e}();return I.prototype.then=o,I.all=function(t){return new C(this,t).promise},I.race=function(t){var e=this;return new e(m(t)?function(r,n){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(r,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},I.resolve=a,I.reject=function(t){var e=new this(s);return h(e,t),e},I._setScheduler=function(t){w=t},I._setAsap=function(t){_=t},I._asap=_,I.polyfill=function(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=I},I.Promise=I,I.polyfill(),I}()}).call(this,r(8),r(1))},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,f=[],c=!1,l=-1;function h(){c&&u&&(c=!1,u.length?f=u.concat(f):l=-1,f.length&&d())}function d(){if(!c){var t=s(h);c=!0;for(var e=f.length;e;){for(u=f,f=[];++l<e;)u&&u[l].run();l=-1,e=f.length}u=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new p(t,e)),1!==f.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}]);',r.p+"fe9dd1d86f59edd12abe.worker.js")}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){var n;e.exports=(n=r(1),r(17),r(2),r(10),r(20),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,o=[],i=[],a=[],s=[],l=[],u=[],c=[],f=[],h=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var d=n^n<<1^n<<2^n<<3^n<<4;d=d>>>8^255&d^99,o[r]=d,i[d]=r;var v=e[r],m=e[v],y=e[m],g=257*e[d]^16843008*d;a[r]=g<<24|g>>>8,s[r]=g<<16|g>>>16,l[r]=g<<8|g>>>24,u[r]=g,g=16843009*y^65537*m^257*v^16843008*r,c[d]=g<<24|g>>>8,f[d]=g<<16|g>>>16,h[d]=g<<8|g>>>24,p[d]=g,r?(r=v^e[e[e[y^v]]],n^=e[e[n]]):r=n=1}}();var d=[0,1,2,4,8,16,32,64,128,27,54],v=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],a=0;a<n;a++)if(a<r)i[a]=t[a];else{var s=i[a-1];a%r?r>6&&a%r==4&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=d[a/r|0]<<24),i[a]=i[a-r]^s}for(var l=this._invKeySchedule=[],u=0;u<n;u++)a=n-u,s=u%4?i[a]:i[a-4],l[u]=u<4||a<=4?s:c[o[s>>>24]]^f[o[s>>>16&255]]^h[o[s>>>8&255]]^p[o[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,l,u,o)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,f,h,p,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,i,a,s){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],f=e[t+2]^r[2],h=e[t+3]^r[3],p=4,d=1;d<l;d++){var v=n[u>>>24]^o[c>>>16&255]^i[f>>>8&255]^a[255&h]^r[p++],m=n[c>>>24]^o[f>>>16&255]^i[h>>>8&255]^a[255&u]^r[p++],y=n[f>>>24]^o[h>>>16&255]^i[u>>>8&255]^a[255&c]^r[p++],g=n[h>>>24]^o[u>>>16&255]^i[c>>>8&255]^a[255&f]^r[p++];u=v,c=m,f=y,h=g}v=(s[u>>>24]<<24|s[c>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^r[p++],m=(s[c>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&u])^r[p++],y=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[u>>>8&255]<<8|s[255&c])^r[p++],g=(s[h>>>24]<<24|s[u>>>16&255]<<16|s[c>>>8&255]<<8|s[255&f])^r[p++],e[t]=v,e[t+1]=m,e[t+2]=y,e[t+3]=g},keySize:8});e.AES=t._createHelper(v)}(),n.AES)},function(e,t,r){e.exports=r(1).enc.Utf8},function(e,t,r){var n,o,i,a,s,l,u,c;e.exports=(n=r(1),r(18),r(19),a=(i=(o=n).lib).Base,s=i.WordArray,u=(l=o.algo).MD5,c=l.EvpKDF=a.extend({cfg:a.extend({keySize:4,hasher:u,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),o=s.create(),i=o.words,a=r.keySize,l=r.iterations;i.length<a;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<l;c++)u=n.finalize(u),n.reset();o.concat(u)}return o.sigBytes=4*a,o}}),o.EvpKDF=function(e,t,r){return c.create(r).compute(e,t)},n.EvpKDF)},function(e,t,r){var n,o;void 0===(o="function"==typeof(n=function(){var e,t,r="lscache-",n="-cacheexpiration",o=10,i=6e4,a=w(i),s="",l=!1;function u(){var t="__lscachetest__";if(void 0!==e)return e;try{if(!localStorage)return!1}catch(e){return!1}try{v(t,"__lscachetest__"),m(t),e=!0}catch(t){e=!(!c(t)||!localStorage.length)}return e}function c(e){return e&&("QUOTA_EXCEEDED_ERR"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||"QuotaExceededError"===e.name)}function f(){return void 0===t&&(t=null!=window.JSON),t}function h(e){return e+n}function p(){return Math.floor((new Date).getTime()/i)}function d(e){return localStorage.getItem(r+s+e)}function v(e,t){localStorage.removeItem(r+s+e),localStorage.setItem(r+s+e,t)}function m(e){localStorage.removeItem(r+s+e)}function y(e){for(var t=new RegExp("^"+r+s.replace(/[[\]{}()*+?.\\^$|]/g,"\\$&")+"(.*)"),o=localStorage.length-1;o>=0;--o){var i=localStorage.key(o);(i=(i=i&&i.match(t))&&i[1])&&i.indexOf(n)<0&&e(i,h(i))}}function g(e){var t=h(e);m(e),m(t)}function b(e){var t=h(e),r=d(t);if(r){var n=parseInt(r,o);if(p()>=n)return m(e),m(t),!0}}function _(e,t){l&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+e),t&&window.console.warn("lscache - The error was: "+t.message))}function w(e){return Math.floor(864e13/e)}return{set:function(e,t,r){if(!u())return!1;if(!f())return!1;try{t=JSON.stringify(t)}catch(e){return!1}try{v(e,t)}catch(r){if(!c(r))return _("Could not add item with key '"+e+"'",r),!1;var n,i=[];y(function(e,t){var r=d(t);r=r?parseInt(r,o):a,i.push({key:e,size:(d(e)||"").length,expiration:r})}),i.sort(function(e,t){return t.expiration-e.expiration});for(var s=(t||"").length;i.length&&s>0;)n=i.pop(),_("Cache is full, removing item with key '"+e+"'"),g(n.key),s-=n.size;try{v(e,t)}catch(t){return _("Could not add item with key '"+e+"', perhaps it's too big?",t),!1}}return r?v(h(e),(p()+r).toString(o)):m(h(e)),!0},get:function(e){if(!u())return null;if(b(e))return null;var t=d(e);if(!t||!f())return t;try{return JSON.parse(t)}catch(e){return t}},remove:function(e){u()&&g(e)},supported:function(){return u()},flush:function(){u()&&y(function(e){g(e)})},flushExpired:function(){u()&&y(function(e){b(e)})},setBucket:function(e){s=e},resetBucket:function(){s=""},getExpiryMilliseconds:function(){return i},setExpiryMilliseconds:function(e){a=w(i=e)},enableWarnings:function(e){l=e}}})?n.apply(t,[]):n)||(e.exports=o)},function(e,t,r){e.exports=function(){return r(7)('!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){(function(e,i){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function r(){var t=setTimeout;return function(){return t(n,1)}}function n(){for(var t=0;t<p;t+=2){var e=S[t],i=S[t+1];e(i),S[t]=void 0,S[t+1]=void 0}p=0}function o(t,e){var i=this,r=new this.constructor(a);void 0===r[N]&&y(r);var n=i._state;if(n){var o=arguments[n-1];w(function(){return v(n,r,o,i._result)})}else l(i,r,t,e);return r}function s(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(a);return c(e,t),e}function a(){}function h(e,i,r){i.constructor===e.constructor&&r===o&&i.constructor.resolve===s?function(t,e){e._state===k?_(t,e._result):e._state===P?f(t,e._result):l(e,void 0,function(e){return c(t,e)},function(e){return f(t,e)})}(e,i):void 0===r?_(e,i):t(r)?function(t,e,i){w(function(t){var r=!1,n=function(t,e,i,r){try{t.call(e,i,r)}catch(t){return t}}(i,e,function(i){r||(r=!0,e!==i?c(t,i):_(t,i))},function(e){r||(r=!0,f(t,e))},t._label);!r&&n&&(r=!0,f(t,n))},t)}(e,i,r):_(e,i)}function c(t,e){if(t===e)f(t,new TypeError("You cannot resolve a promise with itself"));else if(function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)){var i=void 0;try{i=e.then}catch(e){return void f(t,e)}h(t,e,i)}else _(t,e)}function u(t){t._onerror&&t._onerror(t._result),g(t)}function _(t,e){t._state===A&&(t._result=e,t._state=k,0!==t._subscribers.length&&w(g,t))}function f(t,e){t._state===A&&(t._state=P,t._result=e,w(u,t))}function l(t,e,i,r){var n=t._subscribers,o=n.length;t._onerror=null,n[o]=e,n[o+k]=i,n[o+P]=r,0===o&&t._state&&w(g,t)}function g(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var r=void 0,n=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],n=e[s+i],r?v(i,r,n,o):n(o);t._subscribers.length=0}}function v(e,i,r,n){var o=t(r),s=void 0,a=void 0,h=!0;if(o){try{s=r(n)}catch(t){h=!1,a=t}if(i===s)return void f(i,new TypeError("A promises callback cannot return that same promise."))}else s=n;i._state!==A||(o&&h?c(i,s):!1===h?f(i,a):e===k?_(i,s):e===P&&f(i,s))}function y(t){t[N]=j++,t._state=void 0,t._result=void 0,t._subscribers=[]}var d=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},p=0,m=void 0,b=void 0,w=function(t,e){S[p]=t,S[p+1]=e,2===(p+=2)&&(b?b(n):T())},x="undefined"!=typeof window?window:void 0,M=x||{},z=M.MutationObserver||M.WebKitMutationObserver,E="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,S=new Array(1e3),T=void 0;T=E?function(){return e.nextTick(n)}:z?function(){var t=0,e=new z(n),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}():q?function(){var t=new MessageChannel;return t.port1.onmessage=n,function(){return t.port2.postMessage(0)}}():void 0===x?function(){try{var t=Function("return this")().require("vertx");return void 0!==(m=t.runOnLoop||t.runOnContext)?function(){m(n)}:r()}catch(t){return r()}}():r();var N=Math.random().toString(36).substring(2),A=void 0,k=1,P=2,j=0,O=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(a),this.promise[N]||y(this.promise),d(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?_(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&_(this.promise,this._result))):f(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===A&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,r=i.resolve;if(r===s){var n=void 0,c=void 0,u=!1;try{n=t.then}catch(t){u=!0,c=t}if(n===o&&t._state!==A)this._settledAt(t._state,e,t._result);else if("function"!=typeof n)this._remaining--,this._result[e]=t;else if(i===R){var _=new i(a);u?f(_,c):h(_,t,n),this._willSettleAt(_,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,i){var r=this.promise;r._state===A&&(this._remaining--,t===P?f(r,i):this._result[e]=i),0===this._remaining&&_(r,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;l(t,void 0,function(t){return i._settledAt(k,e,t)},function(t){return i._settledAt(P,e,t)})},t}(),R=function(){function e(t){this[N]=j++,this._result=this._state=void 0,this._subscribers=[],a!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){c(t,e)},function(e){f(t,e)})}catch(e){f(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this,r=i.constructor;return t(e)?i.then(function(t){return r.resolve(e()).then(function(){return t})},function(t){return r.resolve(e()).then(function(){throw t})}):i.then(e,e)},e}();return R.prototype.then=o,R.all=function(t){return new O(this,t).promise},R.race=function(t){var e=this;return new e(d(t)?function(i,r){for(var n=t.length,o=0;o<n;o++)e.resolve(t[o]).then(i,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},R.resolve=s,R.reject=function(t){var e=new this(a);return f(e,t),e},R._setScheduler=function(t){b=t},R._setAsap=function(t){w=t},R._asap=w,R.polyfill=function(){var t=void 0;if(void 0!==i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var r=null;try{r=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===r&&!e.cast)return}t.Promise=R},R.Promise=R,R.polyfill(),R}()}).call(this,i(1),i(2))},function(t,e){var i,r,n=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var h,c=[],u=!1,_=-1;function f(){u&&h&&(u=!1,h.length?c=h.concat(c):_=-1,c.length&&l())}function l(){if(!u){var t=a(f);u=!0;for(var e=c.length;e;){for(h=c,c=[];++_<e;)h&&h[_].run();_=-1,e=c.length}h=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function v(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new g(t,e)),1!==c.length||u||a(l)},g.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=v,n.addListener=v,n.once=v,n.off=v,n.removeListener=v,n.removeAllListeners=v,n.emit=v,n.prependListener=v,n.prependOnceListener=v,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var r=6378137,n=6356752.314245,o=40075016.68557849;function s(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}var a={constructor:s,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(t){return this.multiplyScalar(1/t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,e){if(void 0!==e)return this.crossVectors(t,e);var i=this.x,r=this.y,n=this.z;return this.x=r*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-r*t.x,this},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,o=e.x,s=e.y,a=e.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this}};for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(s.prototype[h]=a[h]);var c=s;function u(t,e,i){var r=o/2,n=2*r/Math.pow(2,t),s=e*n-r,a=r-i*n;return{minX:s,minY:a-n,maxX:s+n,maxY:a}}function _(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}var g,v=new(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.a_,o=void 0===i?r:i,s=e.b_,a=void 0===s?n:s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.a_=o,this.b_=a,this.f_=(this.a_-this.b_)/this.a_,this.f_inv_=1/this.f_,this.a_sq_=this.a_*this.a_,this.b_sq_=this.b_*this.b_,this.e_sq_=this.f_*(2-this.f_),this.eps_=this.e_sq_/(1-this.e_sq_),this.e_sqsq_=this.e_sq_*this.e_sq_,this.E_sq_=this.a_sq_-this.b_sq_,this.bda_sq_=1-this.e_sq_,this.perimeter_=this.a_*Math.PI,this.radii_inv=new c(1/this.a_sq_,1/this.a_sq_,1/this.b_sq_),this.wgs84_origin_=[0,0,0],this.ecef_origin_=[0,0,0],this.sin_lambda_origin_=0,this.cos_lambda_origin_=0,this.cos_phi_origin_=0,this.sin_phi_origin_=0}var e,i,o;return e=t,(i=[{key:"setWGS84Reference",value:function(t){this.wgs84_origin_=t;var e=this.wgs84_origin_[0],i=this.wgs84_origin_[1],r=this.wgs84_origin_[2],n=f(e),o=f(i);this.sin_lambda_origin_=Math.sin(n),this.cos_lambda_origin_=Math.cos(n),this.cos_phi_origin_=Math.cos(o),this.sin_phi_origin_=Math.sin(o);var s=Math.sin(n),a=this.a_/Math.sqrt(1-this.e_sq_*s*s);this.ecef_origin_[0]=(r+a)*this.cos_lambda_origin_*this.cos_phi_origin_,this.ecef_origin_[1]=(r+a)*this.cos_lambda_origin_*this.sin_phi_origin_,this.ecef_origin_[2]=(r+(1-this.e_sq_)*a)*this.sin_lambda_origin_}},{key:"setECEFReference",value:function(t){this.ecef_origin_=t;var e=this.ecef2Wgs84(this.ecef_origin_[0],this.ecef_origin_[1],this.ecef_origin_[2]),i=e.latitude,r=e.longitude,n=e.height,o=f(i),s=f(r);this.sin_lambda_origin_=Math.sin(o),this.cos_lambda_origin_=Math.cos(o),this.cos_phi_origin_=Math.cos(s),this.sin_phi_origin_=Math.sin(s),this.wgs84_origin_[0]=i,this.wgs84_origin_[1]=r,this.wgs84_origin_[2]=n}},{key:"wgs84Reference",value:function(){return this.wgs84_origin_}},{key:"ecefReference",value:function(){return this.ecef_origin_}},{key:"wgs842Ecef",value:function(t,e,i){var r=f(t),n=f(e),o=Math.sin(r),s=this.a_/Math.sqrt(1-this.e_sq_*o*o),a=Math.sin(r),h=Math.cos(r);return{x:(i+s)*h*Math.cos(n),y:(i+s)*h*Math.sin(n),z:(i+(1-this.e_sq_)*s)*a}}},{key:"ecef2Wgs84",value:function(t,e,i){var r=t*t+e*e,n=Math.sqrt(r),o=i*i,s=54*this.b_sq_*o,a=r+this.bda_sq_*o-this.e_sq_*this.E_sq_,h=a*a,c=this.e_sqsq_*s*r/h/a,u=Math.pow(1+c+Math.sqrt(c*c+2*c),1/3),_=u+1/u+1,f=s/3/_/_/h,g=Math.sqrt(1+2*this.e_sqsq_*f),v=-f*this.e_sq_*n/(1+g)+Math.sqrt(this.a_sq_*(1+1/g)/2-f*this.bda_sq_*o/(g+1)/g-f*r/2),y=n-this.e_sq_*v;y*=y;var d=Math.sqrt(y+o),p=Math.sqrt(y+this.bda_sq_*o),m=this.b_sq_*i/this.a_/p,b=d*(1-this.b_sq_/this.a_/p),w=Math.atan2(i+this.eps_*m,n),x=Math.atan2(e,t);return{latitude:l(w),longitude:l(x),height:b}}},{key:"ecef2Enu",value:function(t,e,i){var r=t-this.ecef_origin_[0],n=e-this.ecef_origin_[1],o=i-this.ecef_origin_[2];return{xEast:-this.sin_phi_origin_*r+this.cos_phi_origin_*n,yNorth:-this.cos_phi_origin_*this.sin_lambda_origin_*r-this.sin_lambda_origin_*this.sin_phi_origin_*n+this.cos_lambda_origin_*o,zUp:this.cos_lambda_origin_*this.cos_phi_origin_*r+this.cos_lambda_origin_*this.sin_phi_origin_*n+this.sin_lambda_origin_*o}}},{key:"enu2Ecef",value:function(t,e,i){var r=-this.sin_phi_origin_*t-this.cos_phi_origin_*this.sin_lambda_origin_*e+this.cos_lambda_origin_*this.cos_phi_origin_*i,n=this.cos_phi_origin_*t-this.sin_lambda_origin_*this.sin_phi_origin_*e+this.cos_lambda_origin_*this.sin_phi_origin_*i,o=this.cos_lambda_origin_*e+this.sin_lambda_origin_*i;return{x:r+this.ecef_origin_[0],y:n+this.ecef_origin_[1],z:o+this.ecef_origin_[2]}}},{key:"wgs842Enu",value:function(t,e,i){var r=this.wgs842Ecef(t,e,i),n=r.x,o=r.y,s=r.z,a=this.ecef2Enu(n,o,s);return{xEast:a.xEast,yNorth:a.yNorth,zUp:a.zUp}}},{key:"enu2Wgs84",value:function(t,e,i){var r=this.enu2Ecef(t,e,i),n=r.x,o=r.y,s=r.z,a=this.ecef2Wgs84(n,o,s);return{latitude:a.latitude,longitude:a.longitude,height:a.height}}},{key:"wgs842WebMercator",value:function(t,e){var i=e*this.perimeter_/180,r=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return{x:i,y:r=r*this.perimeter_/180}}},{key:"webMercator2Wgs84",value:function(t,e){var i=t/this.perimeter_*180,r=e/this.perimeter_*180;return{latitude:r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),longitude:i}}},{key:"ecef2WebMercator",value:function(t,e,i){var r=this.ecef2Wgs84(t,e,i),n=r.latitude,o=r.longitude,s=r.height,a=this.wgs842WebMercator(n,o,s);return{x:a.x,y:a.y,z:s}}},{key:"webMercator2Ecef",value:function(t,e,i){var r=this.webMercator2Wgs84(t,e),n=r.latitude,o=r.longitude,s=i,a=this.wgs842Ecef(n,o,s);return{x:a.x,y:a.y,z:a.z}}},{key:"load",value:function(t){var e=JSON.parse(t);this.wgs84_origin_=e.wgs84_origin,this.ecef_origin_=e.ecef_origin,this.sin_lambda_origin_=e.sin_lambda_origin,this.cos_lambda_origin_=e.cos_lambda_origin,this.cos_phi_origin_=e.cos_phi_origin,this.sin_phi_origin_=e.sin_phi_origin}},{key:"save",value:function(){var t={wgs84_origin:this.wgs84_origin_,ecef_origin:this.ecef_origin_,sin_lambda_origin:this.sin_lambda_origin_,cos_lambda_origin:this.cos_lambda_origin_,cos_phi_origin:this.cos_phi_origin_,sin_phi_origin:this.sin_phi_origin_};return JSON.stringify(t)}},{key:"toSRSString",value:function(){if(0===this.ecef_origin_[0]&&0===this.ecef_origin_[1]&&0===this.ecef_origin_[2])return"";return 0===this.wgs84_origin_[2]?"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1]):"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1],",").concat(this.wgs84_origin_[2])}},{key:"fromSRSString",value:function(t){var e=t.split(":");if(2!==e.length&&"ENU"!==e[0])return!1;var i=e[1].split(",");if(2!==i.length&&3!==i.length)return!1;var r=parseFloat(i[0]),n=parseFloat(i[1]),o=0;return 3===i.length&&(o=parseFloat(i[2])),!(r<-90||r>90)&&(!(n<-180||n>180)&&(this.setWGS84Reference([r,n,o]),!0))}},{key:"getENUSystem",value:function(t,e,i){void 0!==i&&console.warn("ENU is always on oblate surface, not affected by the altitude.");var r=this.wgs842Ecef(t,e,0),n=new c(r.x,r.y,r.z);0===n.lengthSq()&&(n.z=1);var o=this.geodeticSurfaceNormal(n),s=new c(0,0,1),a=(new c).crossVectors(s,o);0===a.lengthSq()&&(a=new c(1,0,0)),a.normalize();var h=(new c).crossVectors(o,a);return h.normalize(),{east:a,up:o,north:h,origin:n}}},{key:"geodeticSurfaceNormal",value:function(t){var e=(new c).multiplyVectors(this.radii_inv,t);return e.normalize(),e}}])&&_(e.prototype,i),o&&_(e,o),t}());function y(t){for(var e=[-1/0,-1/0,-1/0],i=[1/0,1/0,1/0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length;r<n;r+=3)for(var o=0;o<3;o++){var s=t[r+o];s>e[o]&&(e[o]=s),s<i[o]&&(i[o]=s)}return{max:e,min:i}}!function(t){t[t.TERRAIN_RGB=0]="TERRAIN_RGB",t[t.HEIGHT=1]="HEIGHT"}(g||(g={}));var d=32;function p(t,e,i,r,n){return{u:(e+r)/t,v:(i+n)/t}}function m(t,e,i,r,n){return{u:t*r-e,v:t*n-i}}function b(t,e,i){var r=t.width,n=t.height,o=Math.min(r-1,Math.max(Math.floor(e),0)),s=Math.min(n-1,Math.max(Math.floor(i),0));return t.data[o+s*r]}function w(t){t.level,t.x,t.y;var e=t.showDem,i=t.segment,r=void 0===i?d:i,n=(r+1)*(r+1)*3;e&&(n+=4*(r+1)*3);for(var o=new Float32Array(n),s=0,a=0;a<=r;a++)for(var h=0;h<3*(r+1);h++){var c=(h+3*(a%3))%9;o[s++]=0===c||4===c||8===c?1:0}if(e){for(var u=0;u<3*(r+1);u++){var _=(u+6)%9;o[s++]=0===_||4===_||8===_?1:0}for(var f=0;f<3*(r+1);f++){var l=(f+3*((r+1)%3))%9;o[s++]=0===l||4===l||8===l?1:0}for(var g=0;g<3*(r+1);g++){var v=(g+6)%9;o[s++]=0===v||4===v||8===v?1:0}for(var y=0;y<3*(r+1);y++){var p=(y+3*((r+1)%3))%9;o[s++]=0===p||4===p||8===p?1:0}}return{barycentric:o}}var x=25e3,M=2,z=3;function E(t,e,i,r,n,o){var s;r?s=function(t){var e=t.level,i=t.x,r=t.y,n=t.demResource,o=t.demImageData,s=t.demEncoding,a=t.segment,h=void 0===a?d:a;n.level<0&&(n={level:0,x:0,y:0});for(var c,_,f=u(e,i,r),l=f.minX,x=f.minY,M=f.maxX,z=f.maxY,E=new Array((h+1)*(h+1)*3+4*(h+1)*3),q=(M-l)/h,S=(z-x)/h,T=[],N=[],A=[],k=[],P=o.width,j=o.height,O=Math.pow(2,e),R=Math.pow(2,n.level),I=0;I<=h;I++){T.push(M-I*q),N.push(x+I*S),c=p(O,i,r,1-I/h,1-I/h),_=m(R,n.x,n.y,c.u,c.v);var W=Math.min(P-1,Math.max(_.u*P-.5,0)),U=Math.min(j-1,Math.max(_.v*j-.5,0));A.push(W),k.push(U)}for(var L=0,V=null,F=null,Y=0,C=[0,0,0],G=0;G<=h;G++)for(var H=0;H<=h;H++)V=v.webMercator2Ecef(T[H],N[G],0),F=v.geodeticSurfaceNormal(V),s===g.HEIGHT?Y=b(o,A[H],k[G]):(Pt(o,A[H],k[G],C),Y=.1*(256*C[0]*256+256*C[1]+C[2])-1e4),(isNaN(V.x)||isNaN(V.y)||isNaN(V.z))&&console.error("p",V),(isNaN(F.x)||isNaN(F.y)||isNaN(F.z))&&console.error("n",F),isNaN(Y)&&console.error("ele",Y),E[L]=V.x+Y*F.x,E[L+1]=V.y+Y*F.y,E[L+2]=V.z+Y*F.z,L+=3;for(var X=new Uint32Array(h*h*6+4*h*6),B=0,D=0;D<h;D++)for(var K=0;K<h;K++){var J=(h+1)*D+K,Q=(h+1)*(D+1)+K,Z=Q+1,$=J+1;X[B++]=J,X[B++]=Q,X[B++]=Z,X[B++]=Z,X[B++]=$,X[B++]=J}for(var tt=y(E,0,(h+1)*(h+1)*3),et=0,it=0;it<3;it++){var rt=tt.max[it]-tt.min[it];et=Math.max(rt,et)}et*=.1;var nt=0,ot=0;for(ot=0;ot<=h;ot++){V=v.webMercator2Ecef(T[ot],N[nt],0),F=v.geodeticSurfaceNormal(V);var st=3*((h+1)*nt+ot);E[L]=E[st]-F.x*et,E[L+1]=E[st+1]-F.y*et,E[L+2]=E[st+2]-F.z*et,L+=3}for(nt=h,ot=0;ot<=h;ot++){V=v.webMercator2Ecef(T[ot],N[nt],0),F=v.geodeticSurfaceNormal(V);var at=3*((h+1)*nt+ot);E[L]=E[at]-F.x*et,E[L+1]=E[at+1]-F.y*et,E[L+2]=E[at+2]-F.z*et,L+=3}for(ot=0,nt=0;nt<=h;nt++){V=v.webMercator2Ecef(T[ot],N[nt],0),F=v.geodeticSurfaceNormal(V);var ht=3*((h+1)*nt+ot);E[L]=E[ht]-F.x*et,E[L+1]=E[ht+1]-F.y*et,E[L+2]=E[ht+2]-F.z*et,L+=3}for(ot=h,nt=0;nt<=h;nt++){V=v.webMercator2Ecef(T[ot],N[nt],0),F=v.geodeticSurfaceNormal(V);var ct=3*((h+1)*nt+ot);E[L]=E[ct]-F.x*et,E[L+1]=E[ct+1]-F.y*et,E[L+2]=E[ct+2]-F.z*et,L+=3}var ut=(h+1)*(h+1);for(nt=0,ot=0;ot<h;ot++){var _t=ut,ft=(h+1)*nt+ot,lt=ft+1,gt=_t+1;ut+=1,X[B++]=_t,X[B++]=ft,X[B++]=lt,X[B++]=lt,X[B++]=gt,X[B++]=_t}for(ut+=1,nt=h,ot=0;ot<h;ot++){var vt=(h+1)*nt+ot,yt=ut,dt=yt+1,pt=vt+1;ut+=1,X[B++]=vt,X[B++]=yt,X[B++]=dt,X[B++]=dt,X[B++]=pt,X[B++]=vt}for(ut+=1,ot=0,nt=0;nt<h;nt++){var mt=ut,bt=ut+1,wt=(h+1)*nt+ot,xt=wt+(h+1);ut+=1,X[B++]=mt,X[B++]=bt,X[B++]=xt,X[B++]=xt,X[B++]=wt,X[B++]=mt}for(ut+=1,ot=h,nt=0;nt<h;nt++){var Mt=(h+1)*nt+ot,zt=Mt+(h+1),Et=ut,qt=ut+1;ut+=1,X[B++]=Mt,X[B++]=zt,X[B++]=qt,X[B++]=qt,X[B++]=Et,X[B++]=Mt}for(var St=w({level:e,x:i,y:r,segment:h,showDem:void 0!==o}).barycentric,Tt={x:0,y:0,z:0},Nt=E.length/3,At=0;At<E.length;At+=3)Tt.x+=E[At],Tt.y+=E[At+1],Tt.z+=E[At+2];Tt.x/=Nt,Tt.y/=Nt,Tt.z/=Nt;for(var kt=0;kt<E.length;kt+=3)E[kt]-=Tt.x,E[kt+1]-=Tt.y,E[kt+2]-=Tt.z;return{position:E,positionOffset:Tt,index:X,boundingBox:tt,barycentric:St};function Pt(t,e,i,r){for(var n=Math.min(P-1,Math.max(Math.floor(e),0)),o=Math.min(j-1,Math.max(Math.floor(i),0)),s=n===P-1?n:n+1,a=o===j-1?o:o+1,h=e%1,c=i%1,u=4*(n+o*P),_=4*(s+o*P),f=4*(n+a*P),l=4*(s+a*P),g=t.data,v=0;v<3;v++){var y=(g[_++]-g[u])*h+g[u++],d=(g[l++]-g[f])*h+g[f++];r[v]=(d-y)*c+y}return r}}({level:t,x:e,y:i,demImageData:r,demResource:n,demEncoding:o}):s=function(t){var e=t.level,i=t.x,r=t.y,n=t.mapResource,o=t.segment,s=void 0===o?d:o,a=u(e,i,r),h=a.minX,c=a.minY,_=a.maxX,f=a.maxY,l=new Array((s+1)*(s+1)*3),g=new Uint32Array(s*s*6),p=(_-h)/s,m=(f-c)/s;n||(n={level:e,x:i,y:r});for(var b=[],x=[],M=0;M<=s;M++)b.push(_-M*p),x.push(c+M*m);for(var z=0,E=null,q=0;q<=s;q++)for(var S=0;S<=s;S++)E=v.webMercator2Ecef(b[S],x[q],0),l[z=3*((s+1)*q+S)]=E.x,l[z+1]=E.y,l[z+2]=E.z;for(var T=0,N=0;N<s;N++)for(var A=0;A<s;A++){var k=(s+1)*N+A,P=(s+1)*(N+1)+A,j=P+1,O=k+1;g[T++]=k,g[T++]=P,g[T++]=j,g[T++]=j,g[T++]=O,g[T++]=k}for(var R=y(l),I=w({level:e,x:i,y:r,segment:s,showDem:!1}).barycentric,W={x:0,y:0,z:0},U=l.length/3,L=0;L<l.length;L+=3)W.x+=l[L],W.y+=l[L+1],W.z+=l[L+2];W.x/=U,W.y/=U,W.z/=U;for(var V=0;V<l.length;V+=3)l[V]-=W.x,l[V+1]-=W.y,l[V+2]-=W.z;return{position:l,positionOffset:W,index:g,boundingBox:R,barycentric:I}}({level:t,x:e,y:i,mapResource:{level:t,x:e,y:i}});return s.position=new Float32Array(s.position),Promise.resolve(s)}i(0),onmessage=function(t){var e=this,i=t.data.action,r=t.data.resourceKey,n=t.data.params;if(i===z){var o=n.mapName;(function(t){if(!t)return Promise.reject(new Error("10086"));try{var e=new XMLHttpRequest;e.open("GET",t,!0),e.timeout=x,e.responseType="blob"}catch(e){return console.error("XML",t),Promise.reject(new Error("10087"))}return new Promise(function(t,i){e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){var r=new Blob([e.response],{type:e.response.type});createImageBitmap(r).then(function(e){t({bitmap:e,status:200})})}else i(new Error(e.status.toString()))},e.send()})})(n.url).then(function(t){var e=t.bitmap,i={status:t.status,resourceKey:r,payload:{bitmap:e,mapName:o}};postMessage(i,[e]),0!==i.payload.bitmap.height&&console.warn("Transfer ImageBitmap has problem.")}).catch(function(t){var e=parseInt(t.message,10);postMessage({status:e,resourceKey:r,payload:t.message})})}else if(i===M){E(n.level,n.x,n.y,n.demImageData,n.demResource,n.demEncoding).then(function(t){var i=t.position,n=t.index,o=[i.buffer,n.buffer];t.barycentric&&o.push(t.barycentric.buffer),postMessage({resourceKey:r,status:200,payload:t},o),0===i.buffer.byteLength&&0===n.buffer.byteLength||e.console.warn("Transfer geometry has a problem")}).catch(function(t){console.error("planet worker",t),e.postMessage({resourceKey:r,status:0,payload:t.message})})}},onerror=function(t){throw console.error("PlanetTileLoader onerror",t),t}}]);',r.p+"623f7c038aaf59b71aac.worker.js")}},function(e,t,r){e.exports=function(){return r(7)('!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){var n;e.exports=function e(t,r,i){function o(s,f){if(!r[s]){if(!t[s]){var c="function"==typeof n&&n;if(!f&&c)return n(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module \'"+s+"\'");throw l.code="MODULE_NOT_FOUND",l}var h=r[s]={exports:{}};t[s][0].call(h.exports,function(e){return o(t[s][1][e]||e)},h,h.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(e){for(var t,r,n=Array.prototype.slice.call(arguments,1);n.length;){var i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var o in i)t=i,r=o,Object.prototype.hasOwnProperty.call(t,r)&&(e[o]=i[o])}}return e},r.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(t=n=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),t=i=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},o={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};r.setTyped=function(e){e?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,o))},r.setTyped(n)},{}],2:[function(e,t,r){"use strict";var n=e("./common"),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;function f(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var r="",a=0;a<t;a++)r+=String.fromCharCode(e[a]);return r}a[254]=a[254]=1,r.string2buf=function(e){var t,r,i,o,a,s=e.length,f=0;for(o=0;o<s;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),f+=r<128?1:r<2048?2:r<65536?3:4;for(t=new n.Buf8(f),o=a=0;a<f;o++)55296==(64512&(r=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?t[a++]=r:(r<2048?t[a++]=192|r>>>6:(r<65536?t[a++]=224|r>>>12:(t[a++]=240|r>>>18,t[a++]=128|r>>>12&63),t[a++]=128|r>>>6&63),t[a++]=128|63&r);return t},r.buf2binstring=function(e){return f(e,e.length)},r.binstring2buf=function(e){for(var t=new n.Buf8(e.length),r=0,i=t.length;r<i;r++)t[r]=e.charCodeAt(r);return t},r.buf2string=function(e,t){var r,n,i,o,s=t||e.length,c=new Array(2*s);for(r=n=0;r<s;)if((i=e[r++])<128)c[n++]=i;else if(4<(o=a[i]))c[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;1<o&&r<s;)i=i<<6|63&e[r++],o--;1<o?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return f(c,n)},r.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;0<=r&&128==(192&e[r]);)r--;return r<0?t:0===r?t:r+a[e[r]]>t?r:t}},{"./common":1}],3:[function(e,t,r){"use strict";t.exports=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+t[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(e,t,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(e,t,r){"use strict";var n=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();t.exports=function(e,t,r,i){var o=n,a=i+r;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}},{}],6:[function(e,t,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(e,t,r){"use strict";t.exports=function(e,t){var r,n,i,o,a,s,f,c,l,h,u,d,p,b,m,w,v,g,y,k,_,x,E,A,S;r=e.state,n=e.next_in,A=e.input,i=n+(e.avail_in-5),o=e.next_out,S=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),f=r.dmax,c=r.wsize,l=r.whave,h=r.wnext,u=r.window,d=r.hold,p=r.bits,b=r.lencode,m=r.distcode,w=(1<<r.lenbits)-1,v=(1<<r.distbits)-1;e:do{p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),g=b[d&w];t:for(;;){if(d>>>=y=g>>>24,p-=y,0==(y=g>>>16&255))S[o++]=65535&g;else{if(!(16&y)){if(0==(64&y)){g=b[(65535&g)+(d&(1<<y)-1)];continue t}if(32&y){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}k=65535&g,(y&=15)&&(p<y&&(d+=A[n++]<<p,p+=8),k+=d&(1<<y)-1,d>>>=y,p-=y),p<15&&(d+=A[n++]<<p,p+=8,d+=A[n++]<<p,p+=8),g=m[d&v];r:for(;;){if(d>>>=y=g>>>24,p-=y,!(16&(y=g>>>16&255))){if(0==(64&y)){g=m[(65535&g)+(d&(1<<y)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(_=65535&g,p<(y&=15)&&(d+=A[n++]<<p,(p+=8)<y&&(d+=A[n++]<<p,p+=8)),f<(_+=d&(1<<y)-1)){e.msg="invalid distance too far back",r.mode=30;break e}if(d>>>=y,p-=y,(y=o-a)<_){if(l<(y=_-y)&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(E=u,(x=0)===h){if(x+=c-y,y<k){for(k-=y;S[o++]=u[x++],--y;);x=o-_,E=S}}else if(h<y){if(x+=c+h-y,(y-=h)<k){for(k-=y;S[o++]=u[x++],--y;);if(x=0,h<k){for(k-=y=h;S[o++]=u[x++],--y;);x=o-_,E=S}}}else if(x+=h-y,y<k){for(k-=y;S[o++]=u[x++],--y;);x=o-_,E=S}for(;2<k;)S[o++]=E[x++],S[o++]=E[x++],S[o++]=E[x++],k-=3;k&&(S[o++]=E[x++],1<k&&(S[o++]=E[x++]))}else{for(x=o-_;S[o++]=S[x++],S[o++]=S[x++],S[o++]=S[x++],2<(k-=3););k&&(S[o++]=S[x++],1<k&&(S[o++]=S[x++]))}break}}break}}while(n<i&&o<s);n-=k=p>>3,d&=(1<<(p-=k<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(e,t,r){"use strict";var n=e("../utils/common"),i=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),f=1,c=2,l=0,h=-2,u=1,d=852,p=592;function b(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=u,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(d),t.distcode=t.distdyn=new n.Buf32(p),t.sane=1,t.back=-1,l):h}function v(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,w(e)):h}function g(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?h:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,v(e))):h}function y(e,t){var r,n;return e?(n=new m,(e.state=n).window=null,(r=g(e,t))!==l&&(e.state=null),r):h}var k,_,x=!0;function E(e){if(x){var t;for(k=new n.Buf32(512),_=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(f,e.lens,0,288,k,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(c,e.lens,0,32,_,0,e.work,{bits:5}),x=!1}e.lencode=k,e.lenbits=9,e.distcode=_,e.distbits=5}function A(e,t,r,i){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,t,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(i<(o=a.wsize-a.wnext)&&(o=i),n.arraySet(a.window,t,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,t,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}r.inflateReset=v,r.inflateReset2=g,r.inflateResetKeep=w,r.inflateInit=function(e){return y(e,15)},r.inflateInit2=y,r.inflate=function(e,t){var r,d,p,m,w,v,g,y,k,_,x,S,T,C,B,D,M,I,O,Z,P,U,N,R,z=0,L=new n.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;12===(r=e.state).mode&&(r.mode=13),w=e.next_out,p=e.output,g=e.avail_out,m=e.next_in,d=e.input,v=e.avail_in,y=r.hold,k=r.bits,_=v,x=g,U=l;e:for(;;)switch(r.mode){case u:if(0===r.wrap){r.mode=13;break}for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(2&r.wrap&&35615===y){L[r.check=0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0),k=y=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",r.mode=30;break}if(8!=(15&y)){e.msg="unknown compression method",r.mode=30;break}if(k-=4,P=8+(15&(y>>>=4)),0===r.wbits)r.wbits=P;else if(P>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<P,e.adler=r.check=1,r.mode=512&y?10:12,k=y=0;break;case 2:for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(r.flags=y,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=y>>8&1),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0,r.mode=3;case 3:for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.head&&(r.head.time=y),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,L[2]=y>>>16&255,L[3]=y>>>24&255,r.check=o(r.check,L,4,0)),k=y=0,r.mode=4;case 4:for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.head&&(r.head.xflags=255&y,r.head.os=y>>8),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0,r.mode=5;case 5:if(1024&r.flags){for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.length=y,r.head&&(r.head.extra_len=y),512&r.flags&&(L[0]=255&y,L[1]=y>>>8&255,r.check=o(r.check,L,2,0)),k=y=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(v<(S=r.length)&&(S=v),S&&(r.head&&(P=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,d,m,S,P)),512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,r.length-=S),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===v)break e;for(S=0;P=d[m+S++],r.head&&P&&r.length<65536&&(r.head.name+=String.fromCharCode(P)),P&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,P)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===v)break e;for(S=0;P=d[m+S++],r.head&&P&&r.length<65536&&(r.head.comment+=String.fromCharCode(P)),P&&S<v;);if(512&r.flags&&(r.check=o(r.check,d,S,m)),v-=S,m+=S,P)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;k<16;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}k=y=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}e.adler=r.check=b(y),k=y=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last){y>>>=7&k,k-=7&k,r.mode=27;break}for(;k<3;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}switch(r.last=1&y,k-=1,3&(y>>>=1)){case 0:r.mode=14;break;case 1:if(E(r),r.mode=20,6!==t)break;y>>>=2,k-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}y>>>=2,k-=2;break;case 14:for(y>>>=7&k,k-=7&k;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&y,k=y=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(S=r.length){if(v<S&&(S=v),g<S&&(S=g),0===S)break e;n.arraySet(p,d,m,S,w),v-=S,m+=S,g-=S,w+=S,r.length-=S;break}r.mode=12;break;case 17:for(;k<14;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(r.nlen=257+(31&y),y>>>=5,k-=5,r.ndist=1+(31&y),y>>>=5,k-=5,r.ncode=4+(15&y),y>>>=4,k-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;k<3;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.lens[F[r.have++]]=7&y,y>>>=3,k-=3}for(;r.have<19;)r.lens[F[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,N={bits:r.lenbits},U=s(0,r.lens,0,19,r.lencode,0,r.work,N),r.lenbits=N.bits,U){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;D=(z=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(M<16)y>>>=B,k-=B,r.lens[r.have++]=M;else{if(16===M){for(R=B+2;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y>>>=B,k-=B,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}P=r.lens[r.have-1],S=3+(3&y),y>>>=2,k-=2}else if(17===M){for(R=B+3;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}k-=B,P=0,S=3+(7&(y>>>=B)),y>>>=3,k-=3}else{for(R=B+7;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}k-=B,P=0,S=11+(127&(y>>>=B)),y>>>=7,k-=7}if(r.have+S>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;S--;)r.lens[r.have++]=P}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,N={bits:r.lenbits},U=s(f,r.lens,0,r.nlen,r.lencode,0,r.work,N),r.lenbits=N.bits,U){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,N={bits:r.distbits},U=s(c,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,N),r.distbits=N.bits,U){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=v&&258<=g){e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,a(e,x),w=e.next_out,p=e.output,g=e.avail_out,m=e.next_in,d=e.input,v=e.avail_in,y=r.hold,k=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;D=(z=r.lencode[y&(1<<r.lenbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(D&&0==(240&D)){for(I=B,O=D,Z=M;D=(z=r.lencode[Z+((y&(1<<I+O)-1)>>I)])>>>16&255,M=65535&z,!(I+(B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}y>>>=I,k-=I,r.back+=I}if(y>>>=B,k-=B,r.back+=B,r.length=M,0===D){r.mode=26;break}if(32&D){r.back=-1,r.mode=12;break}if(64&D){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&D,r.mode=22;case 22:if(r.extra){for(R=r.extra;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.length+=y&(1<<r.extra)-1,y>>>=r.extra,k-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;D=(z=r.distcode[y&(1<<r.distbits)-1])>>>16&255,M=65535&z,!((B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(0==(240&D)){for(I=B,O=D,Z=M;D=(z=r.distcode[Z+((y&(1<<I+O)-1)>>I)])>>>16&255,M=65535&z,!(I+(B=z>>>24)<=k);){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}y>>>=I,k-=I,r.back+=I}if(y>>>=B,k-=B,r.back+=B,64&D){e.msg="invalid distance code",r.mode=30;break}r.offset=M,r.extra=15&D,r.mode=24;case 24:if(r.extra){for(R=r.extra;k<R;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}r.offset+=y&(1<<r.extra)-1,y>>>=r.extra,k-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===g)break e;if(S=x-g,r.offset>S){if((S=r.offset-S)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}S>r.wnext?(S-=r.wnext,T=r.wsize-S):T=r.wnext-S,S>r.length&&(S=r.length),C=r.window}else C=p,T=w-r.offset,S=r.length;for(g<S&&(S=g),g-=S,r.length-=S;p[w++]=C[T++],--S;);0===r.length&&(r.mode=21);break;case 26:if(0===g)break e;p[w++]=r.length,g--,r.mode=21;break;case 27:if(r.wrap){for(;k<32;){if(0===v)break e;v--,y|=d[m++]<<k,k+=8}if(x-=g,e.total_out+=x,r.total+=x,x&&(e.adler=r.check=r.flags?o(r.check,p,x,w-x):i(r.check,p,x,w-x)),x=g,(r.flags?y:b(y))!==r.check){e.msg="incorrect data check",r.mode=30;break}k=y=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;k<32;){if(0===v)break e;v--,y+=d[m++]<<k,k+=8}if(y!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}k=y=0}r.mode=29;case 29:U=1;break e;case 30:U=-3;break e;case 31:return-4;case 32:default:return h}return e.next_out=w,e.avail_out=g,e.next_in=m,e.avail_in=v,r.hold=y,r.bits=k,(r.wsize||x!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&A(e,e.output,e.next_out,x-e.avail_out)?(r.mode=31,-4):(_-=e.avail_in,x-=e.avail_out,e.total_in+=_,e.total_out+=x,r.total+=x,r.wrap&&x&&(e.adler=r.check=r.flags?o(r.check,p,x,e.next_out-x):i(r.check,p,x,e.next_out-x)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===_&&0===x||4===t)&&U===l&&(U=-5),U)},r.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,l},r.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?h:((r.head=t).done=!1,l):h},r.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?h:11===r.mode&&i(1,t,n,0)!==r.check?-3:A(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,l):h},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(e,t,r){"use strict";var n=e("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,r,f,c,l,h,u){var d,p,b,m,w,v,g,y,k,_=u.bits,x=0,E=0,A=0,S=0,T=0,C=0,B=0,D=0,M=0,I=0,O=null,Z=0,P=new n.Buf16(16),U=new n.Buf16(16),N=null,R=0;for(x=0;x<=15;x++)P[x]=0;for(E=0;E<f;E++)P[t[r+E]]++;for(T=_,S=15;1<=S&&0===P[S];S--);if(S<T&&(T=S),0===S)return c[l++]=20971520,c[l++]=20971520,u.bits=1,0;for(A=1;A<S&&0===P[A];A++);for(T<A&&(T=A),x=D=1;x<=15;x++)if(D<<=1,(D-=P[x])<0)return-1;if(0<D&&(0===e||1!==S))return-1;for(U[1]=0,x=1;x<15;x++)U[x+1]=U[x]+P[x];for(E=0;E<f;E++)0!==t[r+E]&&(h[U[t[r+E]]++]=E);if(0===e?(O=N=h,v=19):1===e?(O=i,Z-=257,N=o,R-=257,v=256):(O=a,N=s,v=-1),x=A,w=l,B=E=I=0,b=-1,m=(M=1<<(C=T))-1,1===e&&852<M||2===e&&592<M)return 1;for(;;){for(g=x-B,h[E]<v?(y=0,k=h[E]):h[E]>v?(y=N[R+h[E]],k=O[Z+h[E]]):(y=96,k=0),d=1<<x-B,A=p=1<<C;c[w+(I>>B)+(p-=d)]=g<<24|y<<16|k|0,0!==p;);for(d=1<<x-1;I&d;)d>>=1;if(0!==d?(I&=d-1,I+=d):I=0,E++,0==--P[x]){if(x===S)break;x=t[r+h[E]]}if(T<x&&(I&m)!==b){for(0===B&&(B=T),w+=A,D=1<<(C=x-B);C+B<S&&!((D-=P[C+B])<=0);)C++,D<<=1;if(M+=1<<C,1===e&&852<M||2===e&&592<M)return 1;c[b=I&m]=T<<24|C<<16|w-l|0}}return 0!==I&&(c[w+I]=x-B<<24|64<<16|0),u.bits=T,0}},{"../utils/common":1}],10:[function(e,t,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(e,t,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(e,t,r){"use strict";var n=e("./zlib/inflate"),i=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),f=e("./zlib/zstream"),c=e("./zlib/gzheader"),l=Object.prototype.toString;function h(e){if(!(this instanceof h))return new h(e);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new f,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,t.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new c,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=n.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(s[r])}function u(e,t){var r=new h(t);if(r.push(e,!0),r.err)throw r.msg||s[r.err];return r.result}h.prototype.push=function(e,t){var r,s,f,c,h,u=this.strm,d=this.options.chunkSize,p=this.options.dictionary,b=!1;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?u.input=o.binstring2buf(e):"[object ArrayBuffer]"===l.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(d),u.next_out=0,u.avail_out=d),(r=n.inflate(u,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&p&&(r=n.inflateSetDictionary(this.strm,p)),r===a.Z_BUF_ERROR&&!0===b&&(r=a.Z_OK,b=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),!(this.ended=!0);u.next_out&&(0!==u.avail_out&&r!==a.Z_STREAM_END&&(0!==u.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(f=o.utf8border(u.output,u.next_out),c=u.next_out-f,h=o.buf2string(u.output,f),u.next_out=c,u.avail_out=d-c,c&&i.arraySet(u.output,u.output,f,c,0),this.onData(h)):this.onData(i.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(b=!0)}while((0<u.avail_in||0===u.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(u.avail_out=0))},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},r.Inflate=h,r.inflate=u,r.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},r.ungzip=u},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(e,t,r){"use strict";r.r(t);var n=r(0),i=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};i.prototype.getWidth=function(){return this.width},i.prototype.setWidth=function(e){this.width=e},i.prototype.getHeight=function(){return this.height},i.prototype.setHeight=function(e){this.height=e},i.prototype.getBitDepth=function(){return this.bitDepth},i.prototype.setBitDepth=function(e){if(-1===[2,4,8,16].indexOf(e))throw new Error("invalid bith depth "+e);this.bitDepth=e},i.prototype.getColorType=function(){return this.colorType},i.prototype.setColorType=function(e){var t=0,r=!1;switch(e){case 0:t=1;break;case 2:t=3;break;case 3:t=1;break;case 4:t=2,r=!0;break;case 6:t=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=t,this.alpha=r,this.colorType=e},i.prototype.getCompressionMethod=function(){return this.compressionMethod},i.prototype.setCompressionMethod=function(e){if(0!==e)throw new Error("invalid compression method "+e);this.compressionMethod=e},i.prototype.getFilterMethod=function(){return this.filterMethod},i.prototype.setFilterMethod=function(e){if(0!==e)throw new Error("invalid filter method "+e);this.filterMethod=e},i.prototype.getInterlaceMethod=function(){return this.interlaceMethod},i.prototype.setInterlaceMethod=function(e){if(0!==e&&1!==e)throw new Error("invalid interlace method "+e);this.interlaceMethod=e},i.prototype.setPalette=function(e){if(e.length%3!=0)throw new Error("incorrect PLTE chunk length");if(e.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=e},i.prototype.getPalette=function(){return this.palette},i.prototype.getPixel=function(e,t){if(!this.pixels)throw new Error("pixel data is empty");if(e>=this.width||t>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(t*this.width+e),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}};var o=i;function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))}});var s=Object.prototype.toString;function f(e,t){return(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+(e[t+3]<<0)}function c(e,t){return e[t]<<0}function l(e){if("string"==typeof e){var t=e;e=new Array(t.length);for(var r=0,n=t.length;r<n;r++)e[r]=t[r].charCodeAt(0)}else{"ArrayBuffer"===s.call(e).slice(8,-1)&&(e=new Uint8Array(e))}this.i=0,this.bytes=e,this.png=new o,this.dataChunks=[]}l.prototype.readBytes=function(e){var t=this.i+e;if(t>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=this.bytes.slice(this.i,t);return this.i=t,r},l.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var e=this.readBytes(8);if(!function(e,t){if(e.length!==t.length)return!1;for(var r=e.length;r--;)if(e[r]!==t[r])return!1;return!0}(e,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=e},l.prototype.decodeChunk=function(){var e=f(this.readBytes(4),0);if(e<0)throw new Error("Bad chunk length "+(4294967295&e));var t=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(this.readBytes(4)),r=this.readBytes(e);this.readBytes(4);switch(t){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return t},l.prototype.decodeIHDR=function(e){var t=this.png;t.setWidth(f(e,0)),t.setHeight(f(e,4)),t.setBitDepth(c(e,8)),t.setColorType(c(e,9)),t.setCompressionMethod(c(e,10)),t.setFilterMethod(c(e,11)),t.setInterlaceMethod(c(e,12))},l.prototype.decodePLTE=function(e){this.png.setPalette(e)},l.prototype.decodeIDAT=function(e){this.dataChunks.push(e)},l.prototype.decodeIEND=function(){},l.prototype.decodePixels=function(e){var t,r=this.png,i=this,o=0;for(t=this.dataChunks.length;t--;)o+=this.dataChunks[t].length;var a=new Uint8Array(o);for(t=0,o=0;t<this.dataChunks.length;t++)a.set(this.dataChunks[t],o),o+=this.dataChunks[t].length;!function(e,t){try{t(null,Object(n.inflate)(e))}catch(e){t(e)}}(a,function(t,n){if(t)return e(t);try{0===r.getInterlaceMethod()?i.interlaceNone(n):i.interlaceAdam7(n)}catch(t){return e(t)}e()})},l.prototype.interlaceNone=function(e){for(var t,r=this.png,n=Math.max(1,r.colors*r.bitDepth/8),i=n*r.width,o=new Uint8Array(n*r.width*r.height),a=0,s=0;s<e.length;s+=i+1){switch(t=e.slice(s+1,s+i+1),c(e,s)){case 0:this.unFilterNone(t,o,n,a,i);break;case 1:this.unFilterSub(t,o,n,a,i);break;case 2:this.unFilterUp(t,o,n,a,i);break;case 3:this.unFilterAverage(t,o,n,a,i);break;case 4:this.unFilterPaeth(t,o,n,a,i);break;default:throw new Error("unkown filtered scanline")}a+=i}r.pixels=o},l.prototype.interlaceAdam7=function(e){throw new Error("Adam7 interlacing is not implemented yet")},l.prototype.unFilterNone=function(e,t,r,n,i){for(var o=0,a=i;o<a;o++)t[n+o]=e[o]},l.prototype.unFilterSub=function(e,t,r,n,i){for(var o=0;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255},l.prototype.unFilterUp=function(e,t,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)t[n+o]=e[o];else for(;o<i;o++){var a=e[o],s=t[n+o-i];t[n+o]=a+s&255}},l.prototype.unFilterAverage=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+(t[n+o-r]>>1)&255}else{for(;o<r;o++)t[n+o]=e[o]+(t[n-i+o]>>1)&255;for(;o<i;o++){var a=e[o],s=t[n+o-r],f=t[n+o-i];t[n+o]=a+(s+f>>1)&255}}},l.prototype.unFilterPaeth=function(e,t,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)t[n+o]=e[o];for(;o<i;o++)t[n+o]=e[o]+t[n+o-r]&255}else{for(;o<r;o++)t[n+o]=e[o]+t[n+o-i]&255;for(;o<i;o++){var a=e[o],s=t[n+o-r],f=t[n+o-i],c=t[n+o-i-r],l=s+f-c,h=Math.abs(l-s),u=Math.abs(l-f),d=Math.abs(l-c),p=void 0;p=h<=u&&h<=d?s:u<=d?f:c,t[n+o]=a+p&255}}},l.prototype.parse=function(e,t){"function"==typeof e&&(t=e),"object"!==a(e)&&(e={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===e.data||"IEND"===r)break}var n=this.png;this.decodePixels(function(e){t(e,n)})}catch(e){t(e)}};var h=l;function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var d=function(){var e=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t=4017,r=799,n=3406,i=2276,o=1567,a=3784,s=5793,f=2896;function c(){}function l(e,t){for(var r,n,i=0,o=[],a=16;a>0&&!e[a-1];)a--;o.push({children:[],index:0});var s,f=o[0];for(r=0;r<a;r++){for(n=0;n<e[r];n++){for((f=o.pop()).children[f.index]=t[i];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=r;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;i++}r+1<a&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function h(t,r,n,i,o,a,s,f,c){var l=n.mcusPerLine,h=n.progressive,d=r,p=0,b=0;function m(){if(b>0)return p>>--b&1;if(255===(p=t[r++])){var e=t[r++];if(e)throw new Error("unexpected marker: "+(p<<8|e).toString(16))}return b=7,p>>>7}function w(e){for(var t,r=e;null!==(t=m());){if("number"==typeof(r=r[t]))return r;if("object"!==u(r))throw new Error("invalid huffman sequence")}return null}function v(e){for(var t=0;e>0;){var r=m();if(null===r)return;t=t<<1|r,e--}return t}function g(e){var t=v(e);return t>=1<<e-1?t:t+(-1<<e)+1}var y=0;var k,_=0;function x(e,t,r,n,i){var o=r%l,a=(r/l|0)*e.v+n,s=o*e.h+i;t(e,e.blocks[a][s])}function E(e,t,r){var n=r/e.blocksPerLine|0,i=r%e.blocksPerLine;t(e,e.blocks[n][i])}var A,S,T,C,B,D,M=i.length;D=h?0===a?0===f?function(e,t){var r=w(e.huffmanTableDC),n=0===r?0:g(r)<<c;t[0]=e.pred+=n}:function(e,t){t[0]|=m()<<c}:0===f?function(t,r){if(y>0)y--;else for(var n=a,i=s;n<=i;){var o=w(t.huffmanTableAC),f=15&o,l=o>>4;if(0!==f)r[e[n+=l]]=g(f)*(1<<c),n++;else{if(l<15){y=v(l)+(1<<l)-1;break}n+=16}}}:function(t,r){for(var n=a,i=s,o=0;n<=i;){var f=e[n],l=r[f]<0?-1:1;switch(_){case 0:var h=w(t.huffmanTableAC),u=15&h;if(o=h>>4,0===u)o<15?(y=v(o)+(1<<o),_=4):(o=16,_=1);else{if(1!==u)throw new Error("invalid ACn encoding");k=g(u),_=o?2:3}continue;case 1:case 2:r[f]?r[f]+=(m()<<c)*l:0==--o&&(_=2===_?3:0);break;case 3:r[f]?r[f]+=(m()<<c)*l:(r[f]=k<<c,_=0);break;case 4:r[f]&&(r[f]+=(m()<<c)*l)}n++}4===_&&0==--y&&(_=0)}:function(t,r){var n=w(t.huffmanTableDC),i=0===n?0:g(n);r[0]=t.pred+=i;for(var o=1;o<64;){var a=w(t.huffmanTableAC),s=15&a,f=a>>4;if(0!==s)r[e[o+=f]]=g(s),o++;else{if(f<15)break;o+=16}}};var I,O,Z,P,U=0;for(O=1===M?i[0].blocksPerLine*i[0].blocksPerColumn:l*n.mcusPerColumn,o||(o=O);U<O;){for(S=0;S<M;S++)i[S].pred=0;if(y=0,1===M)for(A=i[0],B=0;B<o;B++)E(A,D,U),U++;else for(B=0;B<o;B++){for(S=0;S<M;S++)for(Z=(A=i[S]).h,P=A.v,T=0;T<P;T++)for(C=0;C<Z;C++)x(A,D,U,T,C);if(++U===O)break}if(b=0,(I=t[r]<<8|t[r+1])<65280)throw new Error("marker was not found");if(!(I>=65488&&I<=65495))break;r+=2}return r-d}function d(e,c){var l,h,u=[],d=c.blocksPerLine,p=c.blocksPerColumn,b=d<<3,m=new Int32Array(64),w=new Uint8Array(64);function v(e,l,h){var u,d,p,b,m,w,v,g,y,k,_=c.quantizationTable,x=h;for(k=0;k<64;k++)x[k]=e[k]*_[k];for(k=0;k<8;++k){var E=8*k;0!==x[1+E]||0!==x[2+E]||0!==x[3+E]||0!==x[4+E]||0!==x[5+E]||0!==x[6+E]||0!==x[7+E]?(u=s*x[0+E]+128>>8,d=s*x[4+E]+128>>8,p=x[2+E],b=x[6+E],m=f*(x[1+E]-x[7+E])+128>>8,g=f*(x[1+E]+x[7+E])+128>>8,w=x[3+E]<<4,v=x[5+E]<<4,y=u-d+1>>1,u=u+d+1>>1,d=y,y=p*a+b*o+128>>8,p=p*o-b*a+128>>8,b=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=g+w+1>>1,w=g-w+1>>1,g=y,y=u-b+1>>1,u=u+b+1>>1,b=y,y=d-p+1>>1,d=d+p+1>>1,p=y,y=m*i+g*n+2048>>12,m=m*n-g*i+2048>>12,g=y,y=w*r+v*t+2048>>12,w=w*t-v*r+2048>>12,v=y,x[0+E]=u+g,x[7+E]=u-g,x[1+E]=d+v,x[6+E]=d-v,x[2+E]=p+w,x[5+E]=p-w,x[3+E]=b+m,x[4+E]=b-m):(y=s*x[0+E]+512>>10,x[0+E]=y,x[1+E]=y,x[2+E]=y,x[3+E]=y,x[4+E]=y,x[5+E]=y,x[6+E]=y,x[7+E]=y)}for(k=0;k<8;++k){var A=k;0!==x[8+A]||0!==x[16+A]||0!==x[24+A]||0!==x[32+A]||0!==x[40+A]||0!==x[48+A]||0!==x[56+A]?(u=s*x[0+A]+2048>>12,d=s*x[32+A]+2048>>12,p=x[16+A],b=x[48+A],m=f*(x[8+A]-x[56+A])+2048>>12,g=f*(x[8+A]+x[56+A])+2048>>12,w=x[24+A],v=x[40+A],y=u-d+1>>1,u=u+d+1>>1,d=y,y=p*a+b*o+2048>>12,p=p*o-b*a+2048>>12,b=y,y=m-v+1>>1,m=m+v+1>>1,v=y,y=g+w+1>>1,w=g-w+1>>1,g=y,y=u-b+1>>1,u=u+b+1>>1,b=y,y=d-p+1>>1,d=d+p+1>>1,p=y,y=m*i+g*n+2048>>12,m=m*n-g*i+2048>>12,g=y,y=w*r+v*t+2048>>12,w=w*t-v*r+2048>>12,v=y,x[0+A]=u+g,x[56+A]=u-g,x[8+A]=d+v,x[48+A]=d-v,x[16+A]=p+w,x[40+A]=p-w,x[24+A]=b+m,x[32+A]=b-m):(y=s*h[k+0]+8192>>14,x[0+A]=y,x[8+A]=y,x[16+A]=y,x[24+A]=y,x[32+A]=y,x[40+A]=y,x[48+A]=y,x[56+A]=y)}for(k=0;k<64;++k){var S=128+(x[k]+8>>4);l[k]=S<0?0:S>255?255:S}}for(var g=0;g<p;g++){var y=g<<3;for(l=0;l<8;l++)u.push(new Uint8Array(b));for(var k=0;k<d;k++){v(c.blocks[g][k],w,m);var _=0,x=k<<3;for(h=0;h<8;h++){var E=u[y+h];for(l=0;l<8;l++)E[x+l]=w[_++]}}}return u}function p(e){return e<0?0:e>255?255:e}return c.prototype={parse:function(t){var r=0;function n(){var e=t[r]<<8|t[r+1];return r+=2,e}function i(e){var t,r,n=0,i=0;for(r in e.components)e.components.hasOwnProperty(r)&&(n<(t=e.components[r]).h&&(n=t.h),i<t.v&&(i=t.v));var o=Math.ceil(e.samplesPerLine/8/n),a=Math.ceil(e.scanLines/8/i);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/n),f=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),c=o*t.h,l=a*t.v,h=[],u=0;u<l;u++){for(var d=[],p=0;p<c;p++)d.push(new Int32Array(64));h.push(d)}t.blocksPerLine=s,t.blocksPerColumn=f,t.blocks=h}e.maxH=n,e.maxV=i,e.mcusPerLine=o,e.mcusPerColumn=a}var o,a,s,f,c=null,u=null,p=[],b=[],m=[],w=[],v=n();if(65496!==v)throw new Error("SOI not found");for(v=n();65497!==v;){var g,y;switch(v){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var k=(s=void 0,f=void 0,s=n(),f=t.subarray(r,r+s-2),r+=f.length,f);65504===v&&74===k[0]&&70===k[1]&&73===k[2]&&70===k[3]&&0===k[4]&&(c={version:{major:k[5],minor:k[6]},densityUnits:k[7],xDensity:k[8]<<8|k[9],yDensity:k[10]<<8|k[11],thumbWidth:k[12],thumbHeight:k[13],thumbData:k.subarray(14,14+3*k[12]*k[13])}),65518===v&&65===k[0]&&100===k[1]&&111===k[2]&&98===k[3]&&101===k[4]&&0===k[5]&&(u={version:k[6],flags0:k[7]<<8|k[8],flags1:k[9]<<8|k[10],transformCode:k[11]});break;case 65499:for(var _=n()+r-2;r<_;){var x=t[r++],E=new Int32Array(64);if(x>>4==0)for(y=0;y<64;y++){E[e[y]]=t[r++]}else{if(x>>4!=1)throw new Error("DQT: invalid table spec");for(y=0;y<64;y++){E[e[y]]=n()}}p[15&x]=E}break;case 65472:case 65473:case 65474:n(),(o={}).extended=65473===v,o.progressive=65474===v,o.precision=t[r++],o.scanLines=n(),o.samplesPerLine=n(),o.components={},o.componentsOrder=[];var A,S=t[r++];for(g=0;g<S;g++){A=t[r];var T=t[r+1]>>4,C=15&t[r+1],B=t[r+2];o.componentsOrder.push(A),o.components[A]={h:T,v:C,quantizationIdx:B},r+=3}i(o),b.push(o);break;case 65476:var D=n();for(g=2;g<D;){var M=t[r++],I=new Uint8Array(16),O=0;for(y=0;y<16;y++,r++)O+=I[y]=t[r];var Z=new Uint8Array(O);for(y=0;y<O;y++,r++)Z[y]=t[r];g+=17+O,(M>>4==0?w:m)[15&M]=l(I,Z)}break;case 65501:n(),a=n();break;case 65498:n();var P,U=t[r++],N=[];for(g=0;g<U;g++){P=o.components[t[r++]];var R=t[r++];P.huffmanTableDC=w[R>>4],P.huffmanTableAC=m[15&R],N.push(P)}var z=t[r++],L=t[r++],F=t[r++],H=h(t,r,o,N,a,z,L,F>>4,15&F);r+=H;break;case 65535:255!==t[r]&&r--;break;default:if(255===t[r-3]&&t[r-2]>=192&&t[r-2]<=254){r-=3;break}throw new Error("unknown JPEG marker "+v.toString(16))}v=n()}if(1!==b.length)throw new Error("only single frame JPEGs supported");for(var j=0;j<b.length;j++){var X=b[j].components;for(var Y in X)X[Y].quantizationTable=p[X[Y].quantizationIdx],delete X[Y].quantizationIdx}this.width=o.samplesPerLine,this.height=o.scanLines,this.jfif=c,this.adobe=u,this.components=[];for(var K=0;K<o.componentsOrder.length;K++){var G=o.components[o.componentsOrder[K]];this.components.push({lines:d(0,G),scaleX:G.h/o.maxH,scaleY:G.v/o.maxV})}},getData:function(e,t){var r,n,i,o,a,s,f,c,l,h,u,d,b,m,w,v,g,y,k,_,x,E=this.width/e,A=this.height/t,S=0,T=e*t*this.components.length,C=new Uint8Array(T);switch(this.components.length){case 1:for(r=this.components[0],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],l=0;l<e;l++)u=a[0|l*r.scaleX*E],C[S++]=u;break;case 2:for(r=this.components[0],n=this.components[1],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],l=0;l<e;l++)u=a[0|l*r.scaleX*E],C[S++]=u,u=s[0|l*n.scaleX*E],C[S++]=u;break;case 3:for(x=!0,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],f=i.lines[0|h*i.scaleY*A],l=0;l<e;l++)x?(u=a[0|l*r.scaleX*E],d=s[0|l*n.scaleX*E],y=p(u+1.402*((b=f[0|l*i.scaleX*E])-128)),k=p(u-.3441363*(d-128)-.71413636*(b-128)),_=p(u+1.772*(d-128))):(y=a[0|l*r.scaleX*E],k=s[0|l*n.scaleX*E],_=f[0|l*i.scaleX*E]),C[S++]=y,C[S++]=k,C[S++]=_;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(x=!1,this.adobe&&this.adobe.transformCode?x=!0:void 0!==this.colorTransform&&(x=!!this.colorTransform),r=this.components[0],n=this.components[1],i=this.components[2],o=this.components[3],h=0;h<t;h++)for(a=r.lines[0|h*r.scaleY*A],s=n.lines[0|h*n.scaleY*A],f=i.lines[0|h*i.scaleY*A],c=o.lines[0|h*o.scaleY*A],l=0;l<e;l++)x?(u=a[0|l*r.scaleX*E],d=s[0|l*n.scaleX*E],b=f[0|l*i.scaleX*E],m=c[0|l*o.scaleX*E],w=255-p(u+1.402*(b-128)),v=255-p(u-.3441363*(d-128)-.71413636*(b-128)),g=255-p(u+1.772*(d-128))):(w=a[0|l*r.scaleX*E],v=s[0|l*n.scaleX*E],g=f[0|l*i.scaleX*E],m=c[0|l*o.scaleX*E]),C[S++]=255-w,C[S++]=255-v,C[S++]=255-g,C[S++]=255-m;break;default:throw new Error("Unsupported color mode")}return C},copyToImageData:function(e){var t,r,n,i,o,a,s,f,c,l=e.width,h=e.height,u=e.data,d=this.getData(l,h),b=0,m=0;switch(this.components.length){case 1:for(r=0;r<h;r++)for(t=0;t<l;t++)n=d[b++],u[m++]=n,u[m++]=n,u[m++]=n,u[m++]=255;break;case 3:for(r=0;r<h;r++)for(t=0;t<l;t++)s=d[b++],f=d[b++],c=d[b++],u[m++]=s,u[m++]=f,u[m++]=c,u[m++]=255;break;case 4:for(r=0;r<h;r++)for(t=0;t<l;t++)o=d[b++],a=d[b++],n=d[b++],s=255-p(o*(1-(i=d[b++])/255)+i),f=255-p(a*(1-i/255)+i),c=255-p(n*(1-i/255)+i),u[m++]=s,u[m++]=f,u[m++]=c,u[m++]=255;break;default:throw new Error("Unsupported color mode")}}},c}();function p(e,t,r){if("png"===r)new h(e).parse(function(e,r){if(e)postMessage({success:!1,message:"readPNG: "+t,url:t});else{var n={width:r.width,height:r.height,data:r.pixels};postMessage({decoded:n,url:t,success:!0},[n.data.buffer])}});else if("jpg"===r){var n=function(e,t){var r={useTArray:!0,colorTransform:!0};t?"object"===u(t)?t={useTArray:void 0===t.useTArray?r.useTArray:t.useTArray,colorTransform:void 0===t.colorTransform?r.colorTransform:t.colorTransform}:(t=r).useTArray=!0:t=r;var n=new Uint8Array(e),i=new d;i.parse(n),i.colorTransform=t.colorTransform;var o={width:i.width,height:i.height,data:new Uint8Array(i.width*i.height*4)};return i.copyToImageData(o),o}(e,{useTArray:!0});postMessage({decoded:n,url:t,success:!0},[n.data.buffer])}else postMessage({success:!1,message:"Unsupported type "+r,url:t})}onmessage=function(e){var t=e.data.bufferArray,r=e.data.url,n=e.data.type;t?p(t,r,n):function(e,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200===r.status){var n=new Uint8Array(r.response||r.mozResponseArrayBuffer);n.length>0?t(n):postMessage({success:!1,message:"404",url:e})}else postMessage({success:!1,message:"404",url:e})},r.send()}(r,function(e){p(e,r,n)})},onerror=function(e){throw console.error("PicDecoder onerror",e),e}}]);',r.p+"88ff53b1f01587cafa49.worker.js")}},function(e,t){
/*!
 * normalize-path <https://github.com/jonschlinkert/normalize-path>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */
e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var r=e.length;if(r<=1)return e;var n="";if(r>4&&"\\"===e[3]){var o=e[2];"?"!==o&&"."!==o||"\\\\"!==e.slice(0,2)||(e=e.slice(2),n="//")}var i=e.split(/[\/\\]+/);return!1!==t&&""===i[i.length-1]&&i.pop(),n+i.join("/")}},function(e,t,r){r(16),e.exports=r(24)},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=_;var f="suspendedStart",h="suspendedYield",p="executing",d="completed",v={},m={};m[a]=function(){return this};var y=Object.getPrototypeOf,g=y&&y(y(C([])));g&&g!==n&&o.call(g,a)&&(m=g);var b=O.prototype=x.prototype=Object.create(m);k.prototype=b.constructor=O,O.constructor=k,O[l]=k.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===k||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,O):(e.__proto__=O,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(b),e},c.awrap=function(e){return{__await:e}},P(A.prototype),A.prototype[s]=function(){return this},c.AsyncIterator=A,c.async=function(e,t,r,n){var o=new A(_(e,t,r,n));return c.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},P(b),b[l]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},c.values=C,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function _(e,t,r,n){var o=t&&t.prototype instanceof x?t:x,i=Object.create(o.prototype),a=new E(n||[]);return i._invoke=function(e,t,r){var n=f;return function(o,i){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=S(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var l=w(e,t,r);if("normal"===l.type){if(n=r.done?d:h,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=d,r.method="throw",r.arg=l.arg)}}}(e,r,a),i}function w(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function k(){}function O(){}function P(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function A(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var s=w(e[r],e,n);if("throw"!==s.type){var l=s.arg,u=l.value;return u&&"object"==typeof u&&o.call(u,"__await")?Promise.resolve(u.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(u).then(function(e){l.value=e,i(l)},function(e){return t("throw",e,i,a)})}a(s.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function S(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,S(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=w(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){var n,o,i;e.exports=(n=r(1),i=(o=n).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var l=n.charAt(64);if(l)for(;o.length%4;)o.push(l);return o.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var o=0;o<r.length;o++)n[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,l=r[e.charCodeAt(a)]>>>6-a%4*2;n[o>>>2]|=(s|l)<<24-o%4*8,o++}return i.create(n,o)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},function(e,t,r){var n,o,i,a,s,l,u,c;e.exports=(i=(o=n=r(1)).lib,a=i.WordArray,s=i.Hasher,l=o.algo,u=[],c=l.SHA1=s.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],s=r[4],l=0;l<80;l++){if(l<16)u[l]=0|e[t+l];else{var c=u[l-3]^u[l-8]^u[l-14]^u[l-16];u[l]=c<<1|c>>>31}var f=(n<<5|n>>>27)+s+u[l];f+=l<20?1518500249+(o&i|~o&a):l<40?1859775393+(o^i^a):l<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=n,n=f}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=s._createHelper(c),o.HmacSHA1=s._createHmacHelper(c),n.SHA1)},function(e,t,r){var n,o,i,a;e.exports=(o=(n=r(1)).lib.Base,i=n.enc,a=i.Utf8,void(n.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),s=o.words,l=i.words,u=0;u<r;u++)s[u]^=1549556828,l[u]^=909522486;o.sigBytes=i.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){var n;e.exports=(n=r(1),r(10),void(n.lib.Cipher||function(e){var t=n,r=t.lib,o=r.Base,i=r.WordArray,a=r.BufferedBlockAlgorithm,s=t.enc,l=(s.Utf8,s.Base64),u=t.algo.EvpKDF,c=r.Cipher=a.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?b:y}return function(t){return{encrypt:function(r,n,o){return e(n).encrypt(t,r,n,o)},decrypt:function(r,n,o){return e(n).decrypt(t,r,n,o)}}}}()}),f=(r.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),h=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=f.CBC=function(){var t=h.extend();function r(t,r,n){var o=this._iv;if(o){var i=o;this._iv=e}else i=this._prevBlock;for(var a=0;a<n;a++)t[r+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize;r.call(this,e,t,o),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=e.slice(t,t+o);n.decryptBlock(e,t),r.call(this,e,t,o),this._prevBlock=i}}),t}(),d=(t.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var l=i.create(a,n);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},v=(r.BlockCipher=c.extend({cfg:c.cfg.extend({mode:p,padding:d}),reset:function(){c.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=i.create([1398893684,1701076831]).concat(r).concat(t);else n=t;return n.toString(l)},parse:function(e){var t=l.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=i.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return v.create({ciphertext:t,salt:n})}},y=r.SerializableCipher=o.extend({cfg:o.extend({format:m}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var o=e.createEncryptor(r,n),i=o.finalize(t),a=o.cfg;return v.create({ciphertext:i,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(t.kdf={}).OpenSSL={execute:function(e,t,r,n){n||(n=i.random(8));var o=u.create({keySize:t+r}).compute(e,n),a=i.create(o.words.slice(t),4*r);return o.sigBytes=4*t,v.create({key:o,iv:a,salt:n})}},b=r.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(e,t,r,n){var o=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=o.iv;var i=y.encrypt.call(this,e,t,o.key,n);return i.mixIn(o),i},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var o=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);return n.iv=o.iv,y.decrypt.call(this,e,t,o.key,n)}})}()))},function(e,t,r){(function(t,r){e.exports=function(){"use strict";function e(e){return"function"==typeof e}function n(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<g;e+=2){(0,S[e])(S[e+1]),S[e]=void 0,S[e+1]=void 0}g=0}function i(e,t){var r=this,n=new this.constructor(s);void 0===n[T]&&m(n);var o=r._state;if(o){var i=arguments[o-1];w(function(){return v(o,n,i,r._result)})}else p(r,n,e,t);return n}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(s);return u(t,e),t}function s(){}function l(t,r,n){r.constructor===t.constructor&&n===i&&r.constructor.resolve===a?function(e,t){t._state===C?f(e,t._result):t._state===j?h(e,t._result):p(t,void 0,function(t){return u(e,t)},function(t){return h(e,t)})}(t,r):void 0===n?f(t,r):e(n)?function(e,t,r){w(function(e){var n=!1,o=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?u(e,r):f(e,r))},function(t){n||(n=!0,h(e,t))},e._label);!n&&o&&(n=!0,h(e,o))},e)}(t,r,n):f(t,r)}function u(e,t){if(e===t)h(e,new TypeError("You cannot resolve a promise with itself"));else if(function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)){var r=void 0;try{r=t.then}catch(t){return void h(e,t)}l(e,t,r)}else f(e,t)}function c(e){e._onerror&&e._onerror(e._result),d(e)}function f(e,t){e._state===E&&(e._result=t,e._state=C,0!==e._subscribers.length&&w(d,e))}function h(e,t){e._state===E&&(e._state=j,e._result=t,w(c,e))}function p(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+C]=r,o[i+j]=n,0===i&&e._state&&w(d,e)}function d(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)n=t[a],o=t[a+r],n?v(r,n,o,i):o(i);e._subscribers.length=0}}function v(t,r,n,o){var i=e(n),a=void 0,s=void 0,l=!0;if(i){try{a=n(o)}catch(e){l=!1,s=e}if(r===a)return void h(r,new TypeError("A promises callback cannot return that same promise."))}else a=o;r._state!==E||(i&&l?u(r,a):!1===l?h(r,s):t===C?f(r,a):t===j&&h(r,a))}function m(e){e[T]=R++,e._state=void 0,e._result=void 0,e._subscribers=[]}var y=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},g=0,b=void 0,_=void 0,w=function(e,t){S[g]=e,S[g+1]=t,2===(g+=2)&&(_?_(o):M())},x="undefined"!=typeof window?window:void 0,k=x||{},O=k.MutationObserver||k.WebKitMutationObserver,P="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,S=new Array(1e3),M=void 0;M=P?function(){return t.nextTick(o)}:O?function(){var e=0,t=new O(o),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():A?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===x?function(){try{var e=Function("return this")().require("vertx");return void 0!==(b=e.runOnLoop||e.runOnContext)?function(){b(o)}:n()}catch(e){return n()}}():n();var T=Math.random().toString(36).substring(2),E=void 0,C=1,j=2,R=0,L=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(s),this.promise[T]||m(this.promise),y(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===E&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===a){var o=void 0,u=void 0,c=!1;try{o=e.then}catch(e){c=!0,u=e}if(o===i&&e._state!==E)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===I){var f=new r(s);c?h(f,u):l(f,e,o),this._willSettleAt(f,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===E&&(this._remaining--,e===j?h(n,r):this._result[t]=r),0===this._remaining&&f(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;p(e,void 0,function(e){return r._settledAt(C,t,e)},function(e){return r._settledAt(j,t,e)})},e}(),I=function(){function t(e){this[T]=R++,this._result=this._state=void 0,this._subscribers=[],s!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){u(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):r.then(t,t)},t}();return I.prototype.then=i,I.all=function(e){return new L(this,e).promise},I.race=function(e){var t=this;return new t(y(e)?function(r,n){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},I.resolve=a,I.reject=function(e){var t=new this(s);return h(t,e),t},I._setScheduler=function(e){_=e},I._setAsap=function(e){w=e},I._asap=w,I.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=I},I.Promise=I,I.polyfill(),I}()}).call(this,r(22),r(23))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,u=[],c=!1,f=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):f=-1,u.length&&p())}function p(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new d(e,t)),1!==u.length||c||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"env",function(){return U});var o={};r.r(o),r.d(o,"delayPromise",function(){return G}),r.d(o,"timedPromise",function(){return K}),r.d(o,"throttle",function(){return X}),r.d(o,"debounce",function(){return Y});var i={};r.r(i),r.d(i,"MAJOR_AXIS",function(){return q}),r.d(i,"MINOR_AXIS",function(){return Z}),r.d(i,"MINOR_OVER_MAJOR",function(){return Q}),r.d(i,"EQUATOR",function(){return J}),r.d(i,"EARTH_RADIUS",function(){return $}),r.d(i,"ATMOSTPHERE_OUTER_RATIO",function(){return ee}),r.d(i,"ATMOSTPHERE_INNER_RATIO",function(){return te});var a={};r.r(a),r.d(a,"getTileWebMercatorEnvelopeByGrid",function(){return le}),r.d(a,"intersectRayAndEllipsoid",function(){return ue});var s={};r.r(s),r.d(s,"oblate",function(){return me});var l={};r.r(l),r.d(l,"deprecated",function(){return ye}),r.d(l,"removed",function(){return ge});var u={};r.r(u),r.d(u,"loadTexture",function(){return Fn}),r.d(u,"stringsToTextures",function(){return Vn}),r.d(u,"stringToTexture",function(){return Hn}),r.d(u,"loadImageData",function(){return Wn}),r.d(u,"loadDemImageData",function(){return Gn}),r.d(u,"loadDemBil4326Data",function(){return Kn});var c={};r.r(c),r.d(c,"loadUVMap",function(){return so}),r.d(c,"solidColorTexture",function(){return lo});var f={};r.r(f),r.d(f,"loadMaskAPI",function(){return wf}),r.d(f,"loadMaskLocal",function(){return xf});var h=r(0),p={};p.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),p.createDiv=function(e,t,r,n){var o=document.createElement("div");return"undefined"!=typeof id&&(o.id=t+"_div"),void 0!==t&&(o.className=t),void 0!==r&&(o.style.cssText=r),void 0!==n&&(o.innerHTML=n),e.appendChild(o),o},p.createMessageDiv=function(e,t,r,n){var o=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),i=p.createDiv(e,"ErrorDiv",o),a=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),s=p.createDiv(i,"ErrorTextDiv",a);return s.innerHTML=t,n&&(s.innerHTML+='<br><br><a href="'+n+'" class="btn-link">Learn More</a>'),i},p.createThree=function(e,t){var r=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];return t&&r.push("background-image: ".concat(t)),r=r.join(""),p.createDiv(e,"ThreeDiv",r)},p.displayDepthTexture=function(e,t){var r=window.open("","_blank"),n=e.dimension.width,o=e.dimension.height;r.document.write("\n      <title>".concat(t,"</title>\n      <p>").concat(t,'</p>\n      <p>depth</p>\n      <div><canvas id="targetdepth" width=').concat(n," height=").concat(o," /></div>\n      "));var i=r.document.getElementById("targetdepth").getContext("2d");i.clearRect(0,0,n,o);for(var a=i.createImageData(n,o),s=0;s<a.data.length;s+=4)a.data[s]=e.buffer[s/4],a.data[s+1]=e.buffer[s/4],a.data[s+2]=e.buffer[s/4],a.data[s+3]=e.buffer[s/4];i.putImageData(a,0,0)},p.displayTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"texture",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgb",n=window.open("",t),o=e.dimension.width,i=e.dimension.height;n.document.write("\n      <title>".concat(t,"</title>\n      <p>").concat(t,'</p>\n      <p>depth</p>\n      <div><canvas id="textureCanvas" width=').concat(o," height=").concat(i," /></div>\n      "));var a=n.document.getElementById("textureCanvas").getContext("2d");a.clearRect(0,0,o,i);var s=a.createImageData(o,i);if("rgb"===r)for(var l=0;l<s.data.length;l+=1)s.data[l]=e.buffer[l];else if("depth"===r)for(var u=0;u<s.data.length;u+=4)s.data[u]=e.buffer[u/4],s.data[u+1]=e.buffer[u/4],s.data[u+2]=e.buffer[u/4],s.data[u+3]=e.buffer[u/4];a.putImageData(s,0,0)};var d=p,v={disposeMesh:function(e){e&&(e.geometry&&e.geometry.dispose&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose&&(e.material.map.dispose(),e.material.map=void 0),e.material.alphaMap&&e.material.alphaMap.dispose&&(e.material.alphaMap.dispose(),e.material.alphaMap=void 0),e.material.dispose&&e.material.dispose()))},clearRenderListRenferenceToMesh:function(e){for(var t=0;t<e.transparent.length;++t){var r=e.transparent[t];r.id=void 0,r.object=void 0,r.geometry=void 0,r.material=void 0,r.program=void 0,r.renderOrder=void 0,r.z=void 0,r.group=void 0}for(var n=0;n<e.opaque.length;++n){var o=e.opaque[n];o.id=void 0,o.object=void 0,o.geometry=void 0,o.material=void 0,o.program=void 0,o.renderOrder=void 0,o.z=void 0,o.group=void 0}}};function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._viewer=t,this._transparent=r.transparent,this._opacity=r.opacity,this._color=new h.Color(r.color),this._image=r.image}var t,r;return t=e,(r=[{key:"destruct",value:function(){this._viewer=void 0,this._transparent=void 0,this._opacity=void 0,this._color=void 0,this._image=void 0}},{key:"transparent",get:function(){return this._transparent}},{key:"opacity",set:function(e){this._viewer.renderer.setClearAlpha(e),this._opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){var t=new h.Color(e);this._viewer.renderer.setClearColor(t,this.opacity),this._color=e},get:function(){return this._color}},{key:"image",set:function(e){var t=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];e&&t.push("background-image: ".concat(e)),t=t.join(""),this._viewer.threeContainer.style.cssText=t,this._image=e},get:function(){return this._image}}])&&m(t.prototype,r),e}(),g=r(5),b=r.n(g),_=r(11),w=r.n(_);function x(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var O=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),k(this,"name",void 0),k(this,"lscache",void 0),this.name=t.name,this.lscache=w.a,this.lscache.setBucket(this.name+"-")}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.name=void 0,this.lscache=void 0,!0}},{key:"setItem",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=this.lscache.set(e,t,r);return Promise.resolve(n)}},{key:"getItem",value:function(e){var t=this.lscache.get(e);return t?Promise.resolve(t):Promise.reject(new Error("404"))}},{key:"remove",value:function(e){return this.lscache.remove(e)}},{key:"flush",value:function(){return this.lscache.flush()}},{key:"flushExpired",value:function(){return this.lscache.flushExpired()}},{key:"stat",get:function(){var e,t=0;for(e in localStorage)localStorage.hasOwnProperty(e)&&(t+=2*(localStorage[e].length+e.length));return{used:t/=1024}}}])&&x(t.prototype,r),e}(),P=r(2),A=r.n(P),S=r(3),M=r.n(S);function T(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),E(this,"apiUrl",void 0),E(this,"_key",void 0),E(this,"_altitoken",void 0),E(this,"cache",void 0),this.apiUrl=t.apiUrl,this.key=t.key,this.altitoken=t.altitoken,this.cache=new O({name:A()("EngineApi").toString(M.a)})}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.cache.flushExpired(),!0}},{key:"project",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { id name owner { id name } isImported modelType views date versionControl cloudPath { key dataUrl } geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong } annotations{edges{node{ id modelx modely modelz title description color glyph createTimestamp editTimestamp cameraPosition {x y z} centerPosition {x y z}}}} modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter initialCamPos {cameraPos centerPos} }}}';return this._requestNcache(n,r).then(function(e){return Promise.resolve(e.data.data.project)}).catch(function(e){return console.error("api:project",e),Promise.reject(e)})}},{key:"my",value:function(e){var t=e&&e.timeout?e.timeout:1e4;return this._requestNcache("{my{self{ id name email balance company country joined}\n   projects { edges {node { id name owner {id username name} views date versionControl  cloudPath { key dataUrl }  geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong }  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}}}}}}",t).then(function(e){return Promise.resolve(e.data.data.my)}).catch(function(e){return console.error("api:my",e),Promise.reject(e)})}},{key:"allProjects",value:function(e){var t=e.limit,r=e.timeout?e.timeout:2e4,n="{ allProjects (first: "+t+") { edges { node { id name showLocation visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date  } } } }";return this._requestNcache(n,r).then(function(e){for(var t=[],r=e.data.data.allProjects.edges,n=0;n<r.length;n++)t.push(r[n].node);return Promise.resolve(t)}).catch(function(e){return console.error("api:allProjects",e),Promise.reject(e)})}},{key:"getCountryName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.timeout?e.timeout:1e4;return this._requestNcache("{ getGeoIPInfo { countryName } }",t).then(function(e){return Promise.resolve(e.data.data.getGeoIPInfo.countryName)}).catch(function(e){return console.warn("api:getGeoIPInfo",e,"set to China"),Promise.resolve("China")})}},{key:"geoNearProjects",value:function(e){var t=e.limit,r=e.center,n=e.span,o=e.timeout?e.timeout:1e4,i=function(e){var t=e[0],r=e[1];return t<-180?t=-180:t>180&&(t=180),r<-90?r=-90:r>90&&(r=90),[t,r]}([r.lng,r.lat]),a="{geoNearProjects(center: { latitude: "+i[1]+", longitude:"+i[0]+" }, span:"+n+", limit: "+t+") {id name visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date }}";return this._request(a,o).then(function(e){var t=e.data.data.geoNearProjects;return Promise.resolve(t)}).catch(function(e){return console.error("api:geoNearProjects",e),Promise.reject(e)})}},{key:"getMatchingPose",value:function(e){for(var t=e.intrinsic,r=e.pairs,n=e.timeout?e.timeout:1e4,o="intrinsic:{u:"+t.u+",v:"+t.v+",f:"+t.f+"}",i="pairs:[",a=0;a<5;++a){var s=r[a],l=s.imageCoord,u=s.objectCoord;i+="{imageCoord:"+f([l[0],l[1]])+",objectCoord:"+f([u[0],u[1],u[2]])+"}",4!==a&&(i+=",")}var c="{utility{poseEstimation(input:{"+o+","+(i+="]")+"}){ok message{en{errorCode description solution}zh_cn{errorCode description solution}} reprojectionError pose}}}";function f(e){for(var t="[",r=0;r<e.length-1;++r)t+=e[r]+",";return t+(e[e.length-1]+"]")}return this._request(c,n).then(function(e){return Promise.resolve(e)}).catch(function(e){return console.error("api:getMatchingPose",e),Promise.reject(e)})}},{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={key:this.key,altitoken:void 0};this.altitoken&&(n.altitoken=this.altitoken);var o=this;return r--,b()({method:"post",url:this.apiUrl,timeout:t,headers:n,data:"query="+e+" #sdk",responseType:"json"}).catch(function(n){return n instanceof Error&&n.message.includes("timeout")&&r>0?o._request(e,2*t,r):Promise.reject(n)})}},{key:"_requestNcache",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4320,o=A()(e+this.key+this.altitoken).toString(M.a),i=this,a=i._request(e,t,r).then(function(e){return i.cache.setItem(o,{data:e.data},n).catch(function(e){return console.warn(e),Promise.resolve()}),Promise.resolve(e)});return this.cache.getItem(o).catch(function(e){return"404"!==e.message&&console.warn(e),a})}},{key:"cropMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { \n      cropMask { \n        usage \n        maskBox { minX minY maxX maxY } \n        maskInfos { polyNum width height data } \n      } \n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.cropMask)}).catch(function(e){return console.error("api:cropMask",e),Promise.reject(e)})}},{key:"waterMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'"){\n      waterMask {\n        maskInfos { level alpha wave color polyNum width height data }\n        maskBox { minX minY maxX maxY }\n      }\n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.waterMask)}).catch(function(e){return console.error("api:waterMask",e),Promise.reject(e)})}},{key:"projectMask",value:function(e){var t=e.pid,r=e.usage;return"crop"===r?this.cropMask({pid:t,timeout:1e4}):"water"===r?this.waterMask({pid:t,timeout:1e4}):Promise.reject(new Error("Unknown mask usage "+r))}},{key:"altitoken",set:function(e){this._altitoken=e},get:function(){return this._altitoken}},{key:"key",set:function(e){this._key=e},get:function(){return this._key}}])&&T(t.prototype,r),e}(),j=r(8),R=r.n(j),L=r(9),I=r.n(L);function D(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._version="0.0.1"}var t,r;return t=e,r=[{key:"detectIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}},{key:"isMobile",get:function(){var e=navigator.userAgent.indexOf("Windows")>-1;return!(!navigator||!navigator.userAgent)&&(/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent)||navigator.maxTouchPoints&&navigator.maxTouchPoints>1&&!e)}},{key:"canvas",get:function(){return!!window.CanvasRenderingContext2D}},{key:"webgl",get:function(){return function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}()}},{key:"webgl2",get:function(){return!!document.createElement("canvas").getContext("webgl2")}},{key:"workers",get:function(){return!!window.Worker}},{key:"browser",get:function(){return{isWeChat:navigator.userAgent.indexOf("MicroMessenger")>=0,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome,isIE:!!document.documentMode}}}],null&&D(t.prototype,null),r&&D(t,r),e}();function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var U=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,"_countryName","China"),B(this,"_ISMOBILE",!0),B(this,"_WEBGL",!0),B(this,"_BROWSER",void 0),this._countryName=this._tryAssignByCache("countryName"),this._ISMOBILE=z.isMobile,this._WEBGL=z.webgl,this._BROWSER=z.browser}var t,r;return t=e,(r=[{key:"_tryAssignByCache",value:function(e){try{var t=localStorage.getItem(e);if(t)return t}catch(e){console.error(e)}return"China"}},{key:"countryName",get:function(){return this._countryName},set:function(e){e!==this.countryName&&(this._countryName=e,localStorage.setItem("countryName",e))}},{key:"ISMOBILE",get:function(){return this._ISMOBILE}},{key:"WEBGL",get:function(){return this._WEBGL}},{key:"BROWSER",get:function(){return this._BROWSER}}])&&N(t.prototype,r),e}());function F(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var V=function(){function e(t,r){var n=r.HOST,o=r.api,i=r.background,a=void 0===i?{transparent:!1,opacity:.8,color:2565927,image:void 0}:i,s=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!o||!o.key||o.apiUrl;var l=this;this.debug=s,this._HOST=n,this._apiParams=o,this.rootContainer=null,this.threeContainer=null,this.renderer=null,this.scene=null,this.camera=null,this.effect=null,this._freeze=!1,this._live=!1,this.frameQueue=[],this.clock=null,this.lastFreezeTime=null,this.freezeDuration=1e3,this.lastUnfreezeTime=null,this.unfreezeDuration=500,this.freezeRecord=[],this.lastDecreaseTime=null,this.lastIncreaseTime=null,this.ORIGIN_FOREST_GPU_RAM_LIMIT=null,this.ORIGIN_CACHE_GPU_RAM_LIMIT=null,this.ORIGIN_MIN_AREA=null,this.layers={},this.control=null,window.viewer=this,function(){if(l.rootContainer=document.getElementById(t),!l.rootContainer)return console.error("Invalid "+t),!1;if(l.threeContainer=d.createThree(l.rootContainer,a.image),!U.WEBGL){if(U.BROWSER.isWeChat){var e=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return d.createMessageDiv(l.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+e+'".',a.color),!1}d.createMessageDiv(l.rootContainer,"No WebGL Support",a.color,"/support/articles/faq_compatibility")}}(),function(){l.scene=new h.Scene;var e={eye:new h.Vector3(0,0,0),NEAR:l.scale/1e10,FAR:6*l.scale},t=l.width/l.height,r=e.NEAR,n=e.FAR;l.camera=new h.PerspectiveCamera(45,t,r,n),l.scene.add(l.camera),l.camera.position.copy(e.eye);var o=a;l.renderer=new h.WebGLRenderer({antialias:!0,alpha:o.transparent,logarithmicDepthBuffer:!1}),window.__renderer=l.renderer,l.renderer.setClearColor(new h.Color(o.color),o.transparent?o.opacity:void 0),l.renderer.autoClear=!1;var i=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,s=Math.max(1.2,.1*(i-1)+1);l.renderer.setPixelRatio(s),l.renderer.setSize(l.width,l.height),l.renderer.context.getExtension("OES_standard_derivatives"),l.threeContainer.appendChild(l.renderer.domElement);var u=new h.AmbientLight(4210752,1);l.scene.add(u);var c=new h.PointLight(13696511,1.1,0);c.color.setHex(16777215),c.position.set(0,0,0),l.camera.add(c),l._lights={ambient:u,point:c}}(),this.background=new y(this,a),this._live=!0,function e(){l.isUpdating&&(l.control&&l.control.update(),u&&function(){if(!f&&l.renderItems&&l.forest){l.ORIGIN_FOREST_GPU_RAM_LIMIT||(l.ORIGIN_FOREST_GPU_RAM_LIMIT=l.forest.FOREST_GPU_RAM_LIMIT,l.ORIGIN_CACHE_GPU_RAM_LIMIT=l.forest.CACHE_GPU_RAM_LIMIT,l.ORIGIN_MIN_AREA=l.forest.MIN_AREA),!f&&l.forest._userFreezeTouched&&(l.forest.FOREST_GPU_RAM_LIMIT=l.ORIGIN_FOREST_GPU_RAM_LIMIT,l.forest.CACHE_GPU_RAM_LIMIT=l.ORIGIN_CACHE_GPU_RAM_LIMIT,l.forest.MIN_AREA=l.ORIGIN_MIN_AREA),f=l.forest._userFreezeTouched,l.clock||(l.clock=new h.Clock);var e,t,r,n=l.clock.getDelta();if(n&&l.frameQueue.push(n),l.frameQueue.length>30&&l.frameQueue.shift(),30===l.frameQueue.length){var o,i=(e=l.frameQueue,2,t=0,r=0,e.map(function(e){e>2||(t+=e,r+=1)}),t/=r);l&&!l.forest.__freeze&&1/i<45&&(!l.lastUnfreezeTime||new Date-l.lastUnfreezeTime>l.unfreezeDuration)?(o=1/i<20?4e3:1/i<30?3e3:2e3,l.freezeDuration=o,l.freezeRecord.push({time:new Date,duration:o}),window.DEBUGING&&(document.getElementById("if-freeze").innerHTML="freeze-".concat(o)),l.forest.throttleFreeze(),l.lastFreezeTime=new Date):l&&l.forest.__freeze&&new Date-l.lastFreezeTime>l.freezeDuration&&(window.DEBUGING&&(document.getElementById("if-freeze").innerHTML="unfreeze"),l.forest.throttleUnFreeze(),l.lastUnfreezeTime=new Date)}l.freezeRecord.length>0&&l.freezeRecord[0].time<new Date-1e4&&l.freezeRecord.shift();var a=0;if(l.freezeRecord.map(function(e){a+=e.duration}),a>=6e3){if(l.lastDecreaseTime&&new Date-l.lastDecreaseTime<1e3)return;l.forest.FOREST_GPU_RAM_LIMIT>.06*c&&(l.forest.FOREST_GPU_RAM_LIMIT-=.01*c),l.forest.CACHE_GPU_RAM_LIMIT>.072*c&&(l.forest.CACHE_GPU_RAM_LIMIT-=.012*c),l.forest.MIN_AREA<.05&&(l.forest.MIN_AREA+=.002),l.lastDecreaseTime=new Date,window.DEBUGING&&(document.getElementById("decrease").innerHTML="current forest gpu limit: ".concat(l.forest.FOREST_GPU_RAM_LIMIT/1024/1024))}else if(0===a){if(l.lastIncreaseTime&&new Date-l.lastIncreaseTime<2e3)return;l.forest.FOREST_GPU_RAM_LIMIT<l.ORIGIN_FOREST_GPU_RAM_LIMIT&&(l.forest.FOREST_GPU_RAM_LIMIT+=.01*c),l.forest.CACHE_GPU_RAM_LIMIT<l.ORIGIN_CACHE_GPU_RAM_LIMIT&&(l.forest.CACHE_GPU_RAM_LIMIT+=.012*c),l.forest.MIN_AREA>l.ORIGIN_MIN_AREA&&(l.forest.MIN_AREA-=.002),l.lastIncreaseTime=new Date,window.DEBUGING&&(document.getElementById("decrease").innerHTML="current forest gpu limit: ".concat(l.forest.FOREST_GPU_RAM_LIMIT/1024/1024))}}}(),l.animate(),l.render(),l._stats&&l._stats.update(),requestAnimationFrame(e))}();var u=U.ISMOBILE,c=1073741824,f=!1}var t,r;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return this.background.destruct(),this.background=void 0,this.layers={},this.layersReady=null,this.control&&(e=this.control.destruct()&&e,this.control=void 0),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer.dispose(),this.renderer=null,this._welcomeMesh&&(this._welcomeMesh.geometry.dispose(),this._welcomeMesh.material.dispose(),this._welcomeMesh=void 0),this._live=!1,window.viewer=void 0,e}},{key:"freeze",value:function(){this._freeze=!0}},{key:"unfreeze",value:function(){this._freeze=!1}},{key:"animate",value:function(){}},{key:"render",value:function(){this.effect?this.effect.render(this.scene,this.camera):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.renderer.clearDepth(),this.renderer.render(this.__sceneOrtho,this.__cameraOrtho),v.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.__sceneOrtho,this.__cameraOrtho))),v.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,this.camera)))}},{key:"cameraChangeHandler",value:function(){}},{key:"updateViewDependentContent",value:function(){}},{key:"updateViewDependentVisibility",value:function(){}},{key:"attachEffect",value:function(e,t){return this.threeContainer&&this.renderer?(this.effect=new e(this.renderer,t),this.effect&&this.effect.setSize(this.width,this.height),this.effect):(console.error("The renderer has not been initialized"),null)}},{key:"resize",value:function(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect&&this.effect.setSize(this.width,this.height)}},{key:"_updateVisibility",value:function(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0),this.camera.updateProjectionMatrix(),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);var e=new h.Frustum;e.setFromMatrix((new h.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));var t={frustum:e};for(var r in this.layers)this.layers[r]&&this.layers[r].updateVisibility(t);return!0}},{key:"_displayTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256;void 0===this.__sceneOrtho&&(this.__sceneOrtho=new h.Scene),void 0===this.__textureSprite&&(this.__textureSprite=new h.Sprite,this.__sceneOrtho.add(this.__textureSprite)),void 0===this.__cameraOrtho&&(this.__cameraOrtho=new h.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,1,10),this.__cameraOrtho.position.z=10),this.__textureSprite.visible=!0,this.__textureSprite.scale.set(t,r,1);var n=this.width/2,o=this.height/2,i=t/2,a=r/2;this.__textureSprite.position.set(-n+i,o-a,1),e&&(this.__textureSprite.material.map=e,this.__textureSprite.material.transparent=!0,this.__textureSprite.material.needsUpdate=!0),this.__displayingTexture=!0}},{key:"_hideTexture",value:function(){this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.__textureSprite.visible=!1,this.__displayingTexture=!1)}},{key:"width",get:function(){return this.threeContainer.clientWidth}},{key:"height",get:function(){return this.threeContainer.clientHeight}},{key:"HOST",get:function(){return this._HOST}},{key:"altizureApi",get:function(){var e="China"===U.countryName?"U2FsdGVkX19l4+V8uQYRigbhRUbtp+TqhjxwRO/FKTliJ0AFJkFXCzSs+ehN700y":"U2FsdGVkX1+4NPYcWb4OT1DtznlOxtfVxvmlbvbsJtDc929Fj2i8H+oXYiIHG2h2QXmweoJYwWJjkPNXS/29SQ==",t=Object.assign({},{API_HOST:e,API_KEY:"U2FsdGVkX19phGn0b5VCcKo7Vu7x1XAz2BKyuIasob2KrQD1CLAC9Ls72FjPeP+/NBhDGn19Gsh13EumIGZ95w=="},this._apiParams),r=R.a.decrypt(t.API_HOST,"altizure-environment").toString(I.a),n=R.a.decrypt(t.API_KEY,"altizure-environment").toString(I.a);return Object.defineProperty(this,"altizureApi",{value:new C({apiUrl:r,key:n,altitoken:t.altitoken}),writable:!1,configurable:!0}),this.altizureApi},set:function(e){var t=e.apiUrl,r=e.key,n=e.altitoken;t&&(this.altizureApi.apiUrl=t),r&&(this.altizureApi.key=r),n&&(this.altizureApi.altitoken=n)}},{key:"countryName",get:function(){var e=this;return this.altizureApi.getCountryName().then(function(e){return U.countryName=e,Promise.resolve(e)}).catch(function(e){return console.warn(e),Promise.resolve("China")}).then(function(t){return Object.defineProperty(e,"countryName",{value:Promise.resolve(t),writable:!1,configurable:!0}),t})}},{key:"lights",get:function(){return this._lights}},{key:"isFreezing",get:function(){return this._freeze}},{key:"isLiving",get:function(){return this._live}},{key:"isUpdating",get:function(){return!this.isFreezing&&this.isLiving}}])&&F(t.prototype,r),e}();function H(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var W=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t,this._node=new h.Object3D,this._children=[],null!==t&&t.addChild(this),this.visible=!0,this._property={type:"HyperNode"}}var t,r;return t=e,(r=[{key:"destruct",value:function(){this._property.type="destructed";var e=!0;if(this.children&&this.children.length>0)for(var t=this.children.length-1;t>=0;t--)e=e&&this.children[t].destruct();return this._children=[],this.parent&&(e=e&&this.parent.removeChild(this)),this._parent=null,this._node=void 0,e||console.warn("HyperNode destruct failure."),e}},{key:"addChild",value:function(e){return-1!==this._children.indexOf(e)?(console.warn("Trying to add an exisitng child."),!1):(this._children.push(e),this._node.add(e.sceneNode),!0)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return-1===t?(console.warn("Trying to remove an un-exisitng child."),!1):(this._children.splice(t,1),this._node.remove(e.sceneNode),!0)}},{key:"applyToChildren",value:function(e,t,r,n){for(var o=!0,i=0;i<this._children.length;i++)o=e(this._children[i],t,r,n)&&o;return o}},{key:"traverse",value:function(e){var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseVisible",value:function(e){if(!1===this.visible)return!0;var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseAncestors",value:function(e){var t=this.parent,r=!0;return null!==t&&(r=e(t)&&r,r=t.traverseAncestors(e)&&r),r}},{key:"setMatrix",value:function(e,t){this.sceneNode.matrix.copy(e),this.sceneNode.matrixWorldNeedsUpdate=!0}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"updateVisibility",value:function(e){this.applyToChildren(function(e,t){e.updateVisibility(t)},e)}},{key:"animate",value:function(e){this.applyToChildren(function(e,t){e.animate(t)},e)}},{key:"initInfo",value:function(){console.warn("HyperNode.initInfo is not implemented")}},{key:"sceneNode",get:function(){return this._node}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parent}},{key:"matrix",get:function(){return this.sceneNode.matrix}},{key:"matrixWorld",get:function(){return this.sceneNode.matrixWorld}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e}},{key:"type",get:function(){return this._property.type}},{key:"property",get:function(){return JSON.parse(JSON.stringify(this._property))},set:function(e){this._property=JSON.parse(JSON.stringify(e))}},{key:"JSON",get:function(){for(var e=[],t=0;t<this.children.length;t++)e.push(this.children[t].JSON);return{property:this.property,children:e}}}])&&H(t.prototype,r),e}();function G(e){return function(t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})}}function K(e,t){var r=new Promise(function(e,r){var n=setTimeout(function(){clearTimeout(n),r(new Error("408"))},t)});return Promise.race([e,r])}var X=function(e,t){var r,n,o;return function(){var i=this,a=arguments;r?(clearTimeout(n),n=setTimeout(function(){Date.now()-o>=t&&(e.apply(i,a),o=Date.now())},t-(Date.now()-o))):(e.apply(i,a),o=Date.now(),r=!0)}},Y=function(e,t){var r;return function(){var n=this,o=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,o)},t)}},q=6378137,Z=6356752.314245,Q=.9966471893352243,J=40075016.68557849,$=q,ee=1.00505,te=.999;function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,o=t.lat,i=void 0===o?0:o,a=t.alt,s=void 0===a?0:a,l=t.north,u=void 0===l?0:l,c=t.tilt,f=void 0===c?0:c,h=t.up,p=void 0===h?0:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=i,this.alt=s,this.north=u,this.tilt=f,this.up=p}var t,r;return t=e,(r=[{key:"reset",value:function(){this.lng=0,this.lat=0,this.alt=0,this.north=0,this.tilt=0,this.up=0}},{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"lng",set:function(e){(e%=360)>=180?e-=360:e<=-180&&(e+=360),this._lng=e},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(87,e),-87)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*Z,e)},get:function(){return this._alt}},{key:"north",set:function(e){e=(e%360+360)%360,this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,o=e.north,i=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==o&&(this._pose.north=o),void 0!==i&&(this._pose.tilt=i),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}])&&re(t.prototype,r),e}();function oe(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}var ie={constructor:oe,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(e){return this.multiplyScalar(1/e)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e,t){if(void 0!==t)return this.crossVectors(e,t);var r=this.x,n=this.y,o=this.z;return this.x=n*e.z-o*e.y,this.y=o*e.x-r*e.z,this.z=r*e.y-n*e.x,this},crossVectors:function(e,t){var r=e.x,n=e.y,o=e.z,i=t.x,a=t.y,s=t.z;return this.x=n*s-o*a,this.y=o*i-r*s,this.z=r*a-n*i,this}};for(var ae in ie)Object.prototype.hasOwnProperty.call(ie,ae)&&(oe.prototype[ae]=ie[ae]);var se=oe;function le(e,t,r){var n=J/2,o=2*n/Math.pow(2,e),i=t*o-n,a=n-r*o;return{minX:i,minY:a-o,maxX:i+o,maxY:a}}function ue(e,t){var r,n,o,i,a,s=new se(1/t.a,1/t.b,1/t.c),l=(new se).multiplyVectors(s,e.origin),u=(new se).multiplyVectors(s,e.direction),c=l.lengthSq(),f=l.clone().dot(u);if(c>1){if(f>=0)return;var h=f*f;if(r=c-1,h<(o=(n=u.lengthSq())*r))return;if(h>o){i=f*f-o;var p=(a=-f+Math.sqrt(i))/n,d=r/a;return p<d?{start:p,stop:d}:{start:d,stop:p}}var v=Math.sqrt(r/n);return{start:v,stop:v}}return c<1?(r=c-1,i=f*f-(o=(n=u.lengthSq())*r),{start:0,stop:(a=-f+Math.sqrt(i))/n}):f<0?{start:0,end:-f/(n=u.lengthSq())}:void 0}function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ray=new h.Ray(new h.Vector3(0,0,0),new h.Vector3(0,0,-1))}var t,r;return t=e,(r=[{key:"destruct",value:function(){this._ray=void 0}},{key:"intersect",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h.Vector2(0,0),this._ray.origin.set(0,0,0),this._ray.direction.set(0,0,-1),this._ray.applyMatrix4(e);var t={a:q,b:q,c:Z},r=ue(this._ray,t);if(r){var n=r.start;return this._ray.origin.clone().addScaledVector(this._ray.direction,n)}}}])&&ce(t.prototype,r),e}();function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pe(e){return e*(Math.PI/180)}function de(e){return e*(180/Math.PI)}var ve,me=new(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.a_,n=void 0===r?q:r,o=t.b_,i=void 0===o?Z:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.a_=n,this.b_=i,this.f_=(this.a_-this.b_)/this.a_,this.f_inv_=1/this.f_,this.a_sq_=this.a_*this.a_,this.b_sq_=this.b_*this.b_,this.e_sq_=this.f_*(2-this.f_),this.eps_=this.e_sq_/(1-this.e_sq_),this.e_sqsq_=this.e_sq_*this.e_sq_,this.E_sq_=this.a_sq_-this.b_sq_,this.bda_sq_=1-this.e_sq_,this.perimeter_=this.a_*Math.PI,this.radii_inv=new se(1/this.a_sq_,1/this.a_sq_,1/this.b_sq_),this.wgs84_origin_=[0,0,0],this.ecef_origin_=[0,0,0],this.sin_lambda_origin_=0,this.cos_lambda_origin_=0,this.cos_phi_origin_=0,this.sin_phi_origin_=0}var t,r;return t=e,(r=[{key:"setWGS84Reference",value:function(e){this.wgs84_origin_=e;var t=this.wgs84_origin_[0],r=this.wgs84_origin_[1],n=this.wgs84_origin_[2],o=pe(t),i=pe(r);this.sin_lambda_origin_=Math.sin(o),this.cos_lambda_origin_=Math.cos(o),this.cos_phi_origin_=Math.cos(i),this.sin_phi_origin_=Math.sin(i);var a=Math.sin(o),s=this.a_/Math.sqrt(1-this.e_sq_*a*a);this.ecef_origin_[0]=(n+s)*this.cos_lambda_origin_*this.cos_phi_origin_,this.ecef_origin_[1]=(n+s)*this.cos_lambda_origin_*this.sin_phi_origin_,this.ecef_origin_[2]=(n+(1-this.e_sq_)*s)*this.sin_lambda_origin_}},{key:"setECEFReference",value:function(e){this.ecef_origin_=e;var t=this.ecef2Wgs84(this.ecef_origin_[0],this.ecef_origin_[1],this.ecef_origin_[2]),r=t.latitude,n=t.longitude,o=t.height,i=pe(r),a=pe(n);this.sin_lambda_origin_=Math.sin(i),this.cos_lambda_origin_=Math.cos(i),this.cos_phi_origin_=Math.cos(a),this.sin_phi_origin_=Math.sin(a),this.wgs84_origin_[0]=r,this.wgs84_origin_[1]=n,this.wgs84_origin_[2]=o}},{key:"wgs84Reference",value:function(){return this.wgs84_origin_}},{key:"ecefReference",value:function(){return this.ecef_origin_}},{key:"wgs842Ecef",value:function(e,t,r){var n=pe(e),o=pe(t),i=Math.sin(n),a=this.a_/Math.sqrt(1-this.e_sq_*i*i),s=Math.sin(n),l=Math.cos(n);return{x:(r+a)*l*Math.cos(o),y:(r+a)*l*Math.sin(o),z:(r+(1-this.e_sq_)*a)*s}}},{key:"ecef2Wgs84",value:function(e,t,r){var n=e*e+t*t,o=Math.sqrt(n),i=r*r,a=54*this.b_sq_*i,s=n+this.bda_sq_*i-this.e_sq_*this.E_sq_,l=s*s,u=this.e_sqsq_*a*n/l/s,c=Math.pow(1+u+Math.sqrt(u*u+2*u),1/3),f=c+1/c+1,h=a/3/f/f/l,p=Math.sqrt(1+2*this.e_sqsq_*h),d=-h*this.e_sq_*o/(1+p)+Math.sqrt(this.a_sq_*(1+1/p)/2-h*this.bda_sq_*i/(p+1)/p-h*n/2),v=o-this.e_sq_*d;v*=v;var m=Math.sqrt(v+i),y=Math.sqrt(v+this.bda_sq_*i),g=this.b_sq_*r/this.a_/y,b=m*(1-this.b_sq_/this.a_/y),_=Math.atan2(r+this.eps_*g,o),w=Math.atan2(t,e);return{latitude:de(_),longitude:de(w),height:b}}},{key:"ecef2Enu",value:function(e,t,r){var n=e-this.ecef_origin_[0],o=t-this.ecef_origin_[1],i=r-this.ecef_origin_[2];return{xEast:-this.sin_phi_origin_*n+this.cos_phi_origin_*o,yNorth:-this.cos_phi_origin_*this.sin_lambda_origin_*n-this.sin_lambda_origin_*this.sin_phi_origin_*o+this.cos_lambda_origin_*i,zUp:this.cos_lambda_origin_*this.cos_phi_origin_*n+this.cos_lambda_origin_*this.sin_phi_origin_*o+this.sin_lambda_origin_*i}}},{key:"enu2Ecef",value:function(e,t,r){var n=-this.sin_phi_origin_*e-this.cos_phi_origin_*this.sin_lambda_origin_*t+this.cos_lambda_origin_*this.cos_phi_origin_*r,o=this.cos_phi_origin_*e-this.sin_lambda_origin_*this.sin_phi_origin_*t+this.cos_lambda_origin_*this.sin_phi_origin_*r,i=this.cos_lambda_origin_*t+this.sin_lambda_origin_*r;return{x:n+this.ecef_origin_[0],y:o+this.ecef_origin_[1],z:i+this.ecef_origin_[2]}}},{key:"wgs842Enu",value:function(e,t,r){var n=this.wgs842Ecef(e,t,r),o=n.x,i=n.y,a=n.z,s=this.ecef2Enu(o,i,a);return{xEast:s.xEast,yNorth:s.yNorth,zUp:s.zUp}}},{key:"enu2Wgs84",value:function(e,t,r){var n=this.enu2Ecef(e,t,r),o=n.x,i=n.y,a=n.z,s=this.ecef2Wgs84(o,i,a);return{latitude:s.latitude,longitude:s.longitude,height:s.height}}},{key:"wgs842WebMercator",value:function(e,t){var r=t*this.perimeter_/180,n=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return{x:r,y:n=n*this.perimeter_/180}}},{key:"webMercator2Wgs84",value:function(e,t){var r=e/this.perimeter_*180,n=t/this.perimeter_*180;return{latitude:n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),longitude:r}}},{key:"ecef2WebMercator",value:function(e,t,r){var n=this.ecef2Wgs84(e,t,r),o=n.latitude,i=n.longitude,a=n.height,s=this.wgs842WebMercator(o,i,a);return{x:s.x,y:s.y,z:a}}},{key:"webMercator2Ecef",value:function(e,t,r){var n=this.webMercator2Wgs84(e,t),o=n.latitude,i=n.longitude,a=r,s=this.wgs842Ecef(o,i,a);return{x:s.x,y:s.y,z:s.z}}},{key:"load",value:function(e){var t=JSON.parse(e);this.wgs84_origin_=t.wgs84_origin,this.ecef_origin_=t.ecef_origin,this.sin_lambda_origin_=t.sin_lambda_origin,this.cos_lambda_origin_=t.cos_lambda_origin,this.cos_phi_origin_=t.cos_phi_origin,this.sin_phi_origin_=t.sin_phi_origin}},{key:"save",value:function(){var e={wgs84_origin:this.wgs84_origin_,ecef_origin:this.ecef_origin_,sin_lambda_origin:this.sin_lambda_origin_,cos_lambda_origin:this.cos_lambda_origin_,cos_phi_origin:this.cos_phi_origin_,sin_phi_origin:this.sin_phi_origin_};return JSON.stringify(e)}},{key:"toSRSString",value:function(){return 0===this.ecef_origin_[0]&&0===this.ecef_origin_[1]&&0===this.ecef_origin_[2]?"":0===this.wgs84_origin_[2]?"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1]):"ENU:".concat(this.wgs84_origin_[0],",").concat(this.wgs84_origin_[1],",").concat(this.wgs84_origin_[2])}},{key:"fromSRSString",value:function(e){var t=e.split(":");if(2!==t.length&&"ENU"!==t[0])return!1;var r=t[1].split(",");if(2!==r.length&&3!==r.length)return!1;var n=parseFloat(r[0]),o=parseFloat(r[1]),i=0;return 3===r.length&&(i=parseFloat(r[2])),!(n<-90||n>90||o<-180||o>180||(this.setWGS84Reference([n,o,i]),0))}},{key:"getENUSystem",value:function(e,t,r){void 0!==r&&console.warn("ENU is always on oblate surface, not affected by the altitude.");var n=this.wgs842Ecef(e,t,0),o=new se(n.x,n.y,n.z);0===o.lengthSq()&&(o.z=1);var i=this.geodeticSurfaceNormal(o),a=new se(0,0,1),s=(new se).crossVectors(a,i);0===s.lengthSq()&&(s=new se(1,0,0)),s.normalize();var l=(new se).crossVectors(i,s);return l.normalize(),{east:s,up:i,north:l,origin:o}}},{key:"geodeticSurfaceNormal",value:function(e){var t=(new se).multiplyVectors(this.radii_inv,e);return t.normalize(),t}}])&&he(t.prototype,r),e}());function ye(e,t,r){var n=r.value;"function"==typeof n&&(r.value=function(){console.error(t+"() has deprecated and will be removed in a future version");for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.apply(this,r)})}function ge(e,t,r){var n=r.value;"function"==typeof n&&(r.value=function(){console.error(t+"() has been removed in this version");for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return n.apply(this,r)})}function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function we(e,t,r,n){return(we="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=Oe(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function xe(e,t,r,n,o){if(!we(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function ke(e,t,r){return(ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Oe(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Oe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pe(e)););return e}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ae(e,t){return(Ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Se(e,t,r,n,o){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var Me=Math.PI/180,Te=180/Math.PI,Ee=.1,Ce=(Se((ve=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=Object.assign({},{minTilt:Ee,maxTilt:75,minAlt:.1,maxAlt:2*$},e);return(r=function(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Pe(t).call(this,e)))._mat=new h.Matrix4,r._anchor=new h.Vector3,r._orbitSphDelta=new h.Spherical(0,0,0),r._swirlSphDelta=new h.Spherical(0,0,0),r.needsApplyDelta=!1,r.matNeedsUpdate=!1,r.poseNeedsUpdate=!1,r.minTilt=n.minTilt,r.maxTilt=n.maxTilt,r.minAlt=n.minAlt,r.maxAlt=n.maxAlt,r.minPolarAngleVert=10*Me,r.maxPolarAngleVert=170*Me,r._lastValidPose={lng:0,lat:0,alt:100,tilt:Ee,north:0},r._updateMat(!0),r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ae(e,t)}(t,ne),r=t,o=[{key:"poseToMat",value:function(e){return e.tilt<Ee&&(e.tilt=Ee),t._poseToMat(e)}},{key:"_poseToMat",value:function(e){var t=me.getENUSystem(e.lat,e.lng),r=t.origin,n=t.east,o=t.north,i=t.up,a=(new h.Matrix4).makeBasis(n,o,i).setPosition(r),s=(new h.Matrix4).makeRotationX(Math.PI/2),l=(new h.Matrix4).multiplyMatrices(a,s),u=e.tilt*Me,c=e.north*Me,f=new h.Spherical(Math.max(e.alt,.01),u,c),p=(new h.Vector3).setFromSpherical(f),d=(new h.Vector3).copy(o).applyAxisAngle(i,c),v=p.applyMatrix4(l),m=(new h.Matrix4).lookAt(v,r,d);return m.setPosition(v),m}},{key:"matToPose",value:function(e){var r=t._earthPicker.intersect(e.clone());if(r){var n=me.ecef2Wgs84(r.x,r.y,r.z),o=n.latitude,i=n.longitude,a=me.getENUSystem(o,i),s=a.east,l=a.north,u=a.up,c=a.origin,f=(new h.Matrix4).makeBasis(s,l,u).setPosition(c),p=(new h.Matrix4).makeRotationX(Math.PI/2),d=(new h.Matrix4).multiplyMatrices(f,p),v=(new h.Matrix4).getInverse(d,!0),m=(new h.Vector3).setFromMatrixPosition(e).applyMatrix4(v),y=(new h.Spherical).setFromVector3(m),g=y.phi*Te,b=y.theta*Te;return{lng:i,lat:o,alt:y.radius,north:b,tilt:g}}}},{key:"MAX_TILT",get:function(){return 75}}],(n=[{key:"destruct",value:function(){return this.reset(),!0}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"reset",value:function(){ke(Pe(t.prototype),"reset",this).call(this),this._onPoseChange(),this._updateMat(!0)}},{key:"_updateMat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.matNeedsUpdate||e){var r=t.poseToMat(this.value);this._mat.copy(r)}this.matNeedsUpdate=!1}},{key:"_updatePose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.poseNeedsUpdate||e)&&this._matToPose(),this.poseNeedsUpdate=!1}},{key:"_matToPose",value:function(e){e||(e=this.matrix.clone());var r=t.matToPose(e);r&&(xe(Pe(t.prototype),"_lng",r.lng,this,!0),xe(Pe(t.prototype),"_lat",r.lat,this,!0),xe(Pe(t.prototype),"_alt",r.alt,this,!0),xe(Pe(t.prototype),"_north",r.north,this,!0),xe(Pe(t.prototype),"_tilt",Math.max(r.tilt,Ee),this,!0))}},{key:"_matToPoseWithAnchor",value:function(e,t){}},{key:"_matToAltNorthTiltWithAnchor",value:function(e,t){}},{key:"_onPoseChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.matNeedsUpdate=!0)}},{key:"_onMatChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.poseNeedsUpdate=!0)}},{key:"_sphereLocalCoordinates",value:function(e,t){}},{key:"_toEarthLocalSpherical",value:function(e,t){}},{key:"orbitLeft",value:function(e){0!==e&&(this._orbitSphDelta.theta+=e*this._screenfov,this.needsApplyDelta=!0)}},{key:"orbitUp",value:function(e){e&&(this._orbitSphDelta.phi+=e*this._screenfov,this.needsApplyDelta=!0)}},{key:"dolly",value:function(e){0!==e&&(this._orbitSphDelta.radius+=e,this.needsApplyDelta=!0)}},{key:"swirlLeft",value:function(e){this._swirlSphDelta.theta+=e*Me,this.needsApplyDelta=!0}},{key:"swirlUp",value:function(e){this._swirlSphDelta.phi+=e*Me,this.needsApplyDelta=!0}},{key:"applyDeltaPrev",value:function(){if(this.needsApplyDelta){var e,r=this.matrix.clone(),n=this.anchor,o=(new h.Vector3).setFromMatrixPosition(r),i=new h.Vector3(1,0,0).transformDirection(r),a=new h.Vector3(0,1,0).transformDirection(r),s=o.clone().sub(n);if(this._orbitSphDelta.radius){var l=1+this._orbitSphDelta.radius/10;l=Math.min(1.5,Math.max(.01,l));var u,c=s.length()*l;u=c>this.maxAlt?n.clone().addScaledVector(s.clone().normalize(),this.maxAlt):c<this.minAlt?n.clone().addScaledVector(s.clone().normalize(),this.minAlt):n.clone().addScaledVector(s,l),e=r.clone().setPosition(u)}else e=r;var f=e.clone();if(this._swirlSphDelta.theta){var p=n.clone().normalize(),d=(new h.Matrix4).makeRotationAxis(p,this._swirlSphDelta.theta);f.premultiply((new h.Matrix4).getInverse(d))}if(this._swirlSphDelta.phi){var v=n.clone(),m=(new h.Vector3).copy(i);v.projectOnPlane(m);var y=v.angleTo(a);if(this._swirlSphDelta.phi+y>=Math.PI/2-this.minTilt*Me-.01);else if(this._swirlSphDelta.phi+y<Math.PI/2-this.maxTilt*Me+.01);else{var g=(new h.Matrix4).setPosition(n.clone().negate()),b=(new h.Matrix4).makeRotationAxis(i,this._swirlSphDelta.phi),_=(new h.Matrix4).setPosition(n).multiply(b).multiply(g),w=f.clone().premultiply((new h.Matrix4).getInverse(_)),x=t.matToPose(w);if(!x)return void console.error("Failed to locate.");x.tilt>this.maxTilt?(x.tilt=this.maxTilt,f.copy(t.poseToMat(x))):x.tilt<this.minTilt?(x.tilt=this.minTilt,f.copy(t.poseToMat(x))):f.copy(w)}var k=(new h.Matrix4).getInverse(f),O=(new h.Vector3).setFromMatrixPosition(k);if(0!==O.x){var P=n.clone().applyMatrix4(k),A=O.clone().sub(P).normalize(),S=A.clone().setX(0).normalize(),M=(new h.Matrix4).setPosition(P.clone().negate()).premultiply((new h.Matrix4).makeRotationFromQuaternion((new h.Quaternion).setFromUnitVectors(A,S))).premultiply((new h.Matrix4).setPosition(P.clone()));f.multiply((new h.Matrix4).getInverse(M))}}var T=(new h.Matrix4).identity();if(this._orbitSphDelta.theta){var E=(new h.Matrix4).makeRotationAxis(a,this._orbitSphDelta.theta);T.copy(E)}if(this._orbitSphDelta.phi){var C=(new h.Matrix4).makeRotationAxis(i,this._orbitSphDelta.phi);T.multiply(C)}var j=(new h.Matrix4).getInverse(T).multiply(f);this.matrix=j,this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._swirlSphDelta.radius=0,this.needsApplyDelta=!1}}},{key:"applyDelta",value:function(){this.applyDeltaNext()}},{key:"applyDeltaNext",value:function(){if(this.needsApplyDelta){var e=this.matrix.clone(),r=this.anchor,n=(new h.Vector3).setFromMatrixPosition(e),o=new h.Vector3(1,0,0).transformDirection(e),i=new h.Vector3(0,1,0).transformDirection(e),a=n.clone().sub(r),s=e;if(this._orbitSphDelta.radius){var l=1+this._orbitSphDelta.radius/10;l=Math.min(1.5,Math.max(.01,l));var u=a.length()*l;u=Math.max(this.minAlt,Math.min(this.maxAlt,u));var c=r.clone().addScaledVector(a.clone().normalize(),u);s=e.clone().setPosition(c)}var f=s.clone();if(this._swirlSphDelta.theta){var p=r.clone().normalize(),d=(new h.Matrix4).makeRotationAxis(p,this._swirlSphDelta.theta);f.premultiply((new h.Matrix4).getInverse(d))}if(this._swirlSphDelta.phi){var v=r.clone(),m=(new h.Vector3).copy(o);v.projectOnPlane(m);var y=v.angleTo(i);if(this._swirlSphDelta.phi+y>=Math.PI/2-this.minTilt*Me-.01);else if(this._swirlSphDelta.phi+y<Math.PI/2-this.maxTilt*Me+.01);else{var g=(new h.Matrix4).setPosition(r.clone().negate()),b=(new h.Matrix4).makeRotationAxis(o,this._swirlSphDelta.phi),_=(new h.Matrix4).setPosition(r).multiply(b).multiply(g),w=f.clone().premultiply((new h.Matrix4).getInverse(_));f.copy(w)}}var x=(new h.Matrix4).identity();if(this._orbitSphDelta.theta){var k=(new h.Matrix4).makeRotationAxis(i,this._orbitSphDelta.theta);x.copy(k)}if(this._orbitSphDelta.phi){var O=(new h.Matrix4).makeRotationAxis(o,this._orbitSphDelta.phi);x.multiply(O)}var P=(new h.Matrix4).getInverse(x).multiply(f),A=t.matToPose(P);return A?(A.tilt>this.maxTilt?A.tilt=this.maxTilt-.01:A.tilt<this.minTilt&&(A.tilt=this.minTilt+.01),this.matrix=t.poseToMat(A),this._updateLastValidPose(A),this._attenuateDelta(),!0):(console.error("Failed to locate."),this._rescueDelta(),!1)}}},{key:"_attenuateDelta",value:function(){this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._swirlSphDelta.radius=0,this.needsApplyDelta=!1}},{key:"_clearDelta",value:function(){var e=this;["theta","phi","radius"].forEach(function(t){e._orbitSphDelta[t]=0,e._swirlSphDelta[t]=0}),this.needsApplyDelta=!1}},{key:"_rescueDelta",value:function(){this._clearDelta(),this.matrix=t.poseToMat(this._lastValidPose)}},{key:"_updateLastValidPose",value:function(e){this._isPoseValid(e)&&(this._lastValidPose.lng=e.lng,this._lastValidPose.lat=e.lat,this._lastValidPose.alt=e.alt,this._lastValidPose.north=e.north,this._lastValidPose.tilt=e.tilt)}},{key:"_isPoseValid",value:function(e){var t=this,r=!0;return["alt","north","tilt"].forEach(function(n){var o=n.charAt(0).toUpperCase()+n.substring(1);e[n]>t["max"+o]&&(r=!1),e[n]<t["min"+o]&&(r=!1)}),r}},{key:"putAnchor",value:function(e){return e?this._anchor.copy(e):this._updateAnchor()}},{key:"recommendedFrustum",value:function(e){e.camera,e.targetFocus}},{key:"_updateAnchor",value:function(){var e=this._centerIntersection();return e&&this._anchor.copy(e),this.anchor}},{key:"_centerIntersection",value:function(){return t._earthPicker.intersect(this.matrix)}},{key:"matrix",get:function(){return this._updateMat(),this._mat.clone()},set:function(e){e.isMatrix4?e.equals(this.matrix)||(this._mat.copy(e),this._onMatChange()):console.error("Unknown matrix",e)}},{key:"POS",get:function(){var e=new h.Vector3,t=new h.Quaternion,r=new h.Vector3;return this.matrix.clone().decompose(e,t,r),{position:e,orientation:t,scale:r}}},{key:"value",get:function(){return ke(Pe(t.prototype),"value",this)},set:function(e){var t=Object.assign({},this.value,e);this.lng=t.lng,this.lat=t.lat,this.alt=t.alt,this.north=t.north,this.tilt=t.tilt,this.up=t.up}},{key:"lng",set:function(e){isNaN(e)||e===this.lng||(xe(Pe(t.prototype),"lng",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"lng",this)}},{key:"lat",set:function(e){isNaN(e)||e===this.lat||(xe(Pe(t.prototype),"lat",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"lat",this)}},{key:"alt",set:function(e){!isNaN(e)&&e!==this.alt&&e>=.1&&(void 0===this.minAlt&&void 0===this.maxAlt||(e=Math.max(this.minAlt,Math.min(this.maxAlt,e))),xe(Pe(t.prototype),"alt",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"alt",this)}},{key:"north",set:function(e){isNaN(e)||e===this.north||(xe(Pe(t.prototype),"north",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"north",this)}},{key:"tilt",set:function(e){e=Math.max(0,Math.min(t.MAX_TILT,e)),isNaN(e)||(isNaN(this.minTilt)||(e=Math.max(this.minTilt,e)),isNaN(this.maxTilt)||(e=Math.min(this.maxTilt,e)),xe(Pe(t.prototype),"tilt",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"tilt",this)}},{key:"up",set:function(e){isNaN(e)||e===this.up||(xe(Pe(t.prototype),"up",e,this,!0),this._onPoseChange())},get:function(){return this._updatePose(),ke(Pe(t.prototype),"up",this)}},{key:"anchor",set:function(e){this._anchor.copy(e)},get:function(){return this._anchor.clone()}},{key:"maxAlt",set:function(e){(e=Math.max(.1,Math.min(2*$,e)))<this.minAlt&&(console.warn("altRangeMax",e,this.minAlt),this._minAlt=e),this._maxAlt=e},get:function(){return this._maxAlt}},{key:"minAlt",set:function(e){(e=Math.max(.1,Math.min(2*$,e)))>this.maxAlt&&(console.warn("altRangeMin",e,this.maxAlt),this._maxAlt=e),this._minAlt=e},get:function(){return this._minAlt}},{key:"maxTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))<this.minTilt&&(console.warn("TiltRangeMax",e,this.minTilt),this._minTilt=e),this._maxTilt=e,this.tilt>this.maxTilt&&(this.tilt=e)},get:function(){return this._maxTilt}},{key:"minTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))>this.maxTilt&&(console.warn("TiltRangeMin",e,this.maxTilt),this._maxTilt=e),this._minTilt=e,this.tilt<e&&(this.tilt=e)},get:function(){return this._minTilt}},{key:"distanceToAnchor",get:function(){var e=(new h.Vector3).setFromMatrixPosition(this.matrix),t=this.anchor;return e.distanceTo(t)}},{key:"_screenfov",get:function(){var e=this.distanceToAnchor;e=Math.max(1,Math.min(e,$));var t=45*Me,r=e*Math.tan(t/2);return 2*Math.atan2(r,$)}}])&&_e(r.prototype,n),o&&_e(r,o),t}()).prototype,"_matToPoseWithAnchor",[ge],Object.getOwnPropertyDescriptor(ve.prototype,"_matToPoseWithAnchor"),ve.prototype),Se(ve.prototype,"_matToAltNorthTiltWithAnchor",[ge],Object.getOwnPropertyDescriptor(ve.prototype,"_matToAltNorthTiltWithAnchor"),ve.prototype),Se(ve.prototype,"_sphereLocalCoordinates",[ge],Object.getOwnPropertyDescriptor(ve.prototype,"_sphereLocalCoordinates"),ve.prototype),Se(ve.prototype,"_toEarthLocalSpherical",[ge],Object.getOwnPropertyDescriptor(ve.prototype,"_toEarthLocalSpherical"),ve.prototype),Se(ve.prototype,"recommendedFrustum",[ge],Object.getOwnPropertyDescriptor(ve.prototype,"recommendedFrustum"),ve.prototype),ve);Ce._earthPicker=new fe;var je=Ce;function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Le=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,(r=[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,o=r.length;n<o;n++)r[n].call(this,e)}}}}])&&Re(t.prototype,r),e}();function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ze(e,t){return!t||"object"!==Ie(t)&&"function"!=typeof t?Be(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Be(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fe=function(e){function t(e){var r,n=e.camera,o=e.handlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=Be(r=ze(this,Ne(t).call(this))),a=["onCameraChange","onCameraStart","onCameraEnd"];return!n||(o&&a.forEach(function(e){o&&o[e]&&(i[e]=o[e])}),0)?ze(r,void 0):(r._camera=n,r._enabled=!0,r._handlers={},a.forEach(function(e){i._handlers["_"+e]=function(t){if(i.dispatchEvent({type:e}),i[e])return i[e](t)}}),r)}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,Le),r=t,(n=[{key:"destruct",value:function(){return!0}},{key:"triggerChangeEvent",value:function(){this.dispatchEvent({type:"onCameraChange"})}},{key:"camera",get:function(){return this._camera}}])&&De(r.prototype,n),t}();function Ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var He=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof je&&r instanceof je&&n instanceof Object&&void 0!==n.start&&void 0!==n.end?(this.src=t,this.dst=r,this.time=n,this.setAlphaAdaptFunc(),this.setInterpolateFunc(),this._enabled=!1):console.error("EarthCameraPath",t,r,n)}var t,r,n;return t=e,n=[{key:"MAX_FLY_DURATION",get:function(){return 3e5}}],(r=[{key:"destruct",value:function(){var e=!0;return this.enabled=!1,e=this.src.destruct()&&e,e=this.dst.destruct()&&e,this.time={},e}},{key:"sync",value:function(e){e instanceof ne?this.src.value=e.value:e.isMatrix4&&(this.src.matrix=e)}},{key:"destinate",value:function(t,r){if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2],this.onFail(new Error("destination changed")),t.isMatrix4)this.dst.matrix=t;else{if(!(t instanceof Object))return Promise.reject(new Error("unknown destination type"));this.dst.value=t}this.duration=r,this.enabled=!0;var n=this;return this.destinated=K(new Promise(function(e,t){n._onDestinated=e,n._onInterrupted=t}),e.MAX_FLY_DURATION),this.destinated}},{key:"interrupt",value:function(e){this.onFail(e)}},{key:"setAlphaAdaptFunc",value:function(e){this._alphaAdaptFunc=e||this._alphaSinMitigate}},{key:"setInterpolateFunc",value:function(e){this._interpolateFunc=e?function(t){var r=new je;return r.matrix=e(t),r}:this._interpolatePose}},{key:"_alphaSinMitigate",value:function(e){var t=.50005*(Math.sin((e-.5)*Math.PI)+1);return Math.min(Math.max(t,0),1)}},{key:"_interpolateMatirx",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,a=o.orientation,s=r.clone().lerp(i,e),l=n.clone().slerp(a,e).normalize(),u=new h.Vector3(1,1,1),c=(new h.Matrix4).compose(s,l,u),f=new je;return f.matrix=c,f}},{key:"_interpolatePose",value:function(e){var t,r,n,o=this.src.value,i=this.dst.value,a={};return["lat","alt","tilt","up"].forEach(function(t){a[t]=s(o[t],i[t],e)}),r=o[t="lng"]+180,n=i[t]+180,Math.abs(n-r)>180?a[t]=l(r,n,e)-180:a[t]=s(o[t],i[t],e),r=o[t="north"],n=i[t],Math.abs(n-r)>180?a[t]=l(r,n,e):a[t]=s(o[t],i[t],e),new je(a);function s(e,t,r){return e*(1-r)+r*t}function l(e,t,r){var n=s(e,t+=t>e?-360:360,r);return(n=n<0?n+360:n)>360?n-360:n}}},{key:"_interpolateSpherical",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,a=o.orientation,s=(new h.Spherical).setFromVector3(r.clone()),l=(new h.Spherical).setFromVector3(i.clone()),u=new h.Spherical((1-e)*s.radius+e*l.radius,(1-e)*s.phi+e*l.phi,(1-e)*s.theta+e*l.theta),c=(new h.Vector3).setFromSpherical(u),f=n.clone().slerp(a,e).normalize(),p=new h.Vector3(1,1,1),d=(new h.Matrix4).compose(c,f,p),v=new je;return v.matrix=d,v}},{key:"orbitLeft",value:function(e,t){}},{key:"swirlLeft",value:function(e,t){}},{key:"onComplete",value:function(){this.src.value=this.dst.value,this.enabled=!1,this._onDestinated()}},{key:"_onDestinated",value:function(){}},{key:"onFail",value:function(e){if(this.enabled){var t=this.pose;if(t){var r=t.matrix;this.src.matrix=r,this.dst.matrix=r}this.enabled=!1,this._onInterrupted(e)}}},{key:"_onInterrupted",value:function(){}},{key:"reset",value:function(){this.src.reset(),this.dst.reset(),this.duration=0,this.onFail()}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"focus",get:function(){return new h.Vector3}},{key:"pose",get:function(){if(this.enabled){this.time.current=Date.now();var e=this.time.current-this.time.start,t=e/(this.time.end-this.time.start);return isNaN(t)?(console.error("pose",t),void this.onFail()):(t>1?t=1:t<0?(console.warn("".concat(e/1e3," seconds to start.")),t=0):t=this._alphaAdaptFunc(t),t>=1?(this.onComplete(),this.dst):this._interpolateFunc(t))}}},{key:"duration",set:function(t){if(t<0||t>e.MAX_FLY_DURATION)console.error("EarthCameraPath.duration",t);else{var r=Date.now();this.time.start=r-1,this.time.current=r,this.time.end=r+t}}}])&&Ve(t.prototype,r),n&&Ve(t,n),e}();function We(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ge=function(){function e(t){var r=t.camera,n=t.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._camera=r,this._domElement=n,this._rayCaster=new h.Raycaster,this.mouseOffsetNeedsUpdate=!0}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this._camera=void 0,this._domElement=void 0,this._rayCaster=void 0,this.mouseOffsetNeedsUpdate=!1,!0}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,o=r.y;return this._rayCaster.setFromCamera(new h.Vector2(n,o),this.camera),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"pickByRay",value:function(e,t){return this._rayCaster.ray.set(e,t),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"_NDC",value:function(e,t){var r=this.mouseOffset;return e-=r.left,t-=r.top,{x:e=e/this.domWidth*2-1,y:t=-t/this.domHeight*2+1}}},{key:"_NDCinv",value:function(e,t){var r=this.mouseOffset;return{x:(e+1)/2*this.domWidth+r.left,y:(1-t)/2*this.domHeight+r.top}}},{key:"_updateMouseOffset",value:function(){var e=this._domElement.getBoundingClientRect();this._mouseOffset={left:e.left,top:e.top},this.mouseOffsetNeedsUpdate=!1}},{key:"camera",get:function(){return this._camera}},{key:"mouseOffset",get:function(){return this.mouseOffsetNeedsUpdate&&this._updateMouseOffset(),this._mouseOffset}},{key:"domWidth",get:function(){return this._domElement.clientWidth}},{key:"domHeight",get:function(){return this._domElement.clientHeight}},{key:"targets",get:function(){return[]}}])&&We(t.prototype,r),e}();function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ye(e,t,r){return(Ye="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qe(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ze(e,t){return(Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qe=function(e){function t(e){var r,n=e.camera,o=e.layers,i=e.domElement;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,qe(t).call(this,{camera:n,domElement:i})))._layers=o,r.layerName="project",r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(t,Ge),r=t,(n=[{key:"destruct",value:function(){return this._layers=void 0,this.layerName=void 0,Ye(qe(t.prototype),"destruct",this).call(this)}},{key:"layer",get:function(){return this._layers[this.layerName]},set:function(e){this.layerName=e}},{key:"targets",get:function(){if(!this.layer)return[];for(var e=[],t=this._rayCaster.ray,r=0;r<this.layer.children.length;r++){var n=this.layer.children[r];if(n._tree){"planet"===this.layerName&&(n.northCap&&e.push(n.northCap),n.southCap&&e.push(n.southCap));var o=(new h.Matrix4).getInverse(n._tree.sceneGraphRoot.matrixWorld);a(t.clone().applyMatrix4(o),n._tree.root,e)}else{var i=n.treeNode;i&&(n.sceneNode&&(n.sceneNode.updateMatrix(),n.sceneNode.updateMatrixWorld()),e.push(i))}}return e;function a(e,t,r){t&&e.intersectsBox(t.estimatedBBox)&&(t.isInScene?r.push(t.content):(a(e,t.nodes[0],r),a(e,t.nodes[1],r),a(e,t.nodes[2],r),a(e,t.nodes[3],r)))}},set:function(e){console.warn("Not allowed")}}])&&Xe(r.prototype,n),t}();function Je(e){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var rt=function(e){function t(e){var r,n=e.camera,o=e.domElement,i=e.control,a=e.layers;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==Je(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,et(t).call(this,{camera:n,domElement:o})))._control=i,r._layers=a,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,Ge),r=t,(n=[{key:"destruct",value:function(){this._control=void 0}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,o=r.y;return this.pickNDC(n,o)}},{key:"pickNDC",value:function(e,t){this._rayCaster.setFromCamera(new h.Vector2(e,t),this.camera);var r=this._rayCaster.ray;return this.pickByRay(r.origin,r.direction)}},{key:"pickByRay",value:function(e,t){var r=this._rayCaster.ray.clone();r.set(e,t);var n=this._control._pose.matrix;r.applyMatrix4(n);var o=ue(r,{a:q,b:q,c:Z});if(o){var i=o.start;return r.origin.clone().addScaledVector(r.direction,i)}}},{key:"needsIntersectMesh",value:function(){var e=this._layers.planet;if(!e||!e.earthEntityOptions.planet.showDem)return!1;for(var t=!1,r=0;r<e.children.length;++r)if(e.children[r]&&e.children[r]._tree){t=!0;break}return t}},{key:"pickTree",value:function(e,t){var r=this._NDC(e,t),n=r.x,o=r.y;this._rayCaster.setFromCamera(new h.Vector2(n,o),this.camera);var i=this._rayCaster.ray.clone(),a=this._control._pose.matrix;i.applyMatrix4(a);var s=this._intersectTree(i);if(s.length>0){var l=s[0].point.clone();return l.applyMatrix4(a),l}}},{key:"pickTreeFromCenter",value:function(){this._rayCaster.setFromCamera(new h.Vector2(0,0),this.camera);var e=this._rayCaster.ray.clone(),t=this._control._pose.matrix;e.applyMatrix4(t);var r=this._intersectTree(e);if(r.length>0){var n=r[0].point.clone();return n.applyMatrix4(t),n}}},{key:"_intersectTree",value:function(e){for(var t=this._layers.planet,r=[],n=0;n<t.children.length;++n)t.children[n]&&t.children[n]._tree&&l(t.children[n]._tree.root,r);for(var o=r.map(function(e){return e.content}),i=0;i<t.children.length;++i)t.children[i]&&(t.children[i].northCap&&o.push(t.children[i].northCap),t.children[i].southCap&&o.push(t.children[i].southCap));var a=o.map(function(e){var t=e.visible;return e.visible=!0,t}),s=this._rayCaster.intersectObjects(o,!0);return a.map(function(e,t){o[t].visible=e}),s;function l(t,r){t&&function(e,t){return e.intersectsBox(t)}(e,t.estimatedBBox)&&(t.isInScene?r.push(t):(l(t.nodes[0],r),l(t.nodes[1],r),l(t.nodes[2],r),l(t.nodes[3],r)))}}}])&&$e(r.prototype,n),t}(),nt=function(e,t){if(void 0!==e){(t=t||{}).handlers=t.handlers||{},t.thresholds=t.thresholds||{},this.domElement=e,this.enabled=!0,this.debug=t.debug||!1,this.rawTouchDebug=!1,this.handlers={tap:t.handlers.tap||null,"double-tap":t.handlers["double-tap"]||null,"drag-start":t.handlers["drag-start"]||null,drag:t.handlers.drag||null,"drag-end":t.handlers["drag-end"]||null,"pinch-start":t.handlers["pinch-start"]||null,pinch:t.handlers.pinch||null,"pinch-end":t.handlers["pinch-end"]||null,"rotate-start":t.handlers["rotate-start"]||null,rotate:t.handlers.rotate||null,"rotate-end":t.handlers["rotate-end"]||null,"twofingersweep-start":t.handlers["twofingersweep-start"]||null,twofingersweep:t.handlers.twofingersweep||null,"twofingersweep-end":t.handlers["twofingersweep-end"]||null},this.thresholds={doubleTapTimeout:void 0===t.thresholds.doubleTapTimeout?500:t.thresholds.doubleTapTimeout,singleTapTimeout:250,holdTapTimeout:600,twoFingerSweepTorlerance:4,twoFingerSweepOffset:void 0===t.thresholds.twoFingerSweepOffset?2:t.thresholds.twoFingerSweepOffset,gestureQueueLength:void 0===t.thresholds.gestureQueueLength?3:t.thresholds.gestureQueueLength,gestureConsistency:void 0===t.thresholds.gestureConsistency?.66:t.thresholds.gestureConsistency},this.thresholds.twoFingerSweepOffset=Math.max(1,this.thresholds.twoFingerSweepOffset),this.thresholds.twoFingerSweepTorlerance=Math.max(1,this.thresholds.twoFingerSweepTorlerance),this.debug&&console.log("Init recognizer",this.handlers,this.thresholds);var r=-1,n=0,o=0,i=null,a=null,s={NONE:-1,TOUCHSTART:0,TOBETAP:1,TOBEDOUBLETAP:2,TAP:3,DOUBLETAP:4,TOBEDRAG:10,DRAGSTART:11,DRAGGING:12,DRAGEND:13,TOBEPINCH:20,PINCHSTART:21,PINCH:22,PINCHEND:22,TOBEROTATE:30,ROTATESTART:31,ROTATE:32,ROTATEEND:33,TOBETWOFINGERSWEEP:40,TWOFINGERSWEEPSTART:41,TWOFINGERSWEEP:42,TWOFINGERSWEEPEND:43,DBLTAPDRAGSTART:51,DBLTAPDRAGGING:52,DBLTAPDRAGEND:53};this.recognizerState=s.NONE,this.recognizerStateQueue=[];var l=this;l.domElement.addEventListener("touchstart",v,!1),this.removeListeners=function(){l.domElement.removeEventListener("touchstart",v,!1)}}else console.error("Invalid domElement");function u(e){l.debug&&e!==l.recognizerState&&console.log("RecognizerState =>",e),l.recognizerState=e}function c(e){for(var t,r={touches:[]},n=0;n<e.touches.length;++n)r.touches.push({identifier:(t=e.touches[n]).identifier,pageX:t.pageX,pageY:t.pageY});return r.type=e.type,r}function f(e){for(;l.recognizerStateQueue.length>=l.thresholds.gestureQueueLength;)l.recognizerStateQueue.shift();l.recognizerStateQueue.push(e),l.debug&&console.log(l.recognizerStateQueue)}function p(){l.recognizerStateQueue=[]}function d(e){if(l.recognizerStateQueue.length!==l.thresholds.gestureQueueLength)return!1;for(var t=0,r=0;r<l.recognizerStateQueue.length;++r)l.recognizerStateQueue[r]===e&&(t+=1);return t/l.thresholds.gestureQueueLength>=l.thresholds.gestureConsistency}function v(e){if(l.debug&&console.log("onTouchStart"),l.rawTouchDebug&&console.log(e),!1!==l.enabled)switch(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.preventDefault(),l.domElement.addEventListener("touchend",y,!1),l.domElement.addEventListener("touchmove",m,!1),l.debug&&console.log(l.recognizerState),r=0,n=Date.now(),i=c(e),e.touches.length){case 1:l.recognizerState===s.TOBETAP?u(s.TOBEDOUBLETAP):u(s.TOUCHSTART);break;case 2:if(l.recognizerState===s.NONE)u(s.TOUCHSTART),p();else if(l.recognizerState===s.DRAGGING){u(s.TOUCHSTART),p();var t={type:"drag-end"};t.touchEvent=e,l.dispatchEvent(t)}}}function m(e){if(l.debug&&console.log("onTouchMove"),l.rawTouchDebug&&console.log(e),!1!==l.enabled){e.preventDefault(),e.stopPropagation(),r+=1;var t=Date.now();if(o>1e3/60)return l.debug&&console.log("skip the events",o),o=0,void(n=t);switch(e.touches.length){case 1:if(l.recognizerState===s.TOUCHSTART){if(f(s.TOBEDRAG),d(s.TOBEDRAG)){u(s.DRAGSTART);var p={type:"drag-start"};p.touchEvent=null===a?i:a,l.dispatchEvent(p)}}else if(l.recognizerState===s.TOBEDOUBLETAP&&(f(s.TOBEDRAG),d(s.TOBEDRAG))){u(s.DBLTAPDRAGSTART);var v={type:"dbltap-drag-start"};v.touchEvent=null===a?i:a,l.dispatchEvent(v)}if(l.recognizerState===s.DRAGSTART||l.recognizerState===s.DRAGGING){u(s.DRAGGING);var m={type:"drag"};m.touchEvent=e,l.dispatchEvent(m)}else if(l.recognizerState===s.DBLTAPDRAGSTART||l.recognizerState===s.DBLTAPDRAGGING){u(s.DBLTAPDRAGGING);var y={type:"dbltap-drag"};y.touchEvent=e,l.dispatchEvent(y)}break;case 2:if(l.recognizerState===s.TOUCHSTART||l.recognizerState===s.TOBEROTATE||l.recognizerState===s.TOBEPINCH||l.recognizerState===s.TOBETWOFINGERSWEEP){for(var g=[new h.Vector2,new h.Vector2],b=[new h.Vector2,new h.Vector2],_=0;_<2;++_)g[_].set(i.touches[_].pageX,i.touches[_].pageY);for(var w=0;w<2;++w)b[w].set(e.touches[w].pageX,e.touches[w].pageY);for(var x=[new h.Vector2,new h.Vector2],k=0;k<2;++k)x[k].subVectors(b[k],g[k]);var O=[new h.Vector2,new h.Vector2];O[0].subVectors(g[1],g[0]),O[1].subVectors(g[0],g[1]);var P=[new h.Vector2,new h.Vector2];P[0].subVectors(b[1],b[0]),P[1].subVectors(b[0],b[1]);var A=O[0].length()*P[0].length(),S=O[0].dot(P[0])/A,M=new h.Vector3(O[0].x,O[0].y,0),T=new h.Vector3(P[0].x,P[0].y,0),E=M.cross(T).z/A,C=Math.atan2(E,S),j=Math.abs(P[0].length()-O[0].length()),R=Math.abs(O[0].length()*C);if(l.debug&&(console.log("last",g,"current",b,"delta",x),console.log("dir-angle",180*C/Math.PI,"scale-delta",j,"rotate-delta",R)),j-R>l.thresholds.twoFingerSweepTorlerance||j>R&&R>l.thresholds.twoFingerSweepTorlerance){for(var L=j;L>l.thresholds.twoFingerSweepTorlerance;)f(s.TOBEPINCH),L-=l.thresholds.twoFingerSweepTorlerance;if(d(s.TOBEPINCH)){u(s.PINCHSTART),i=null===a?i:a;var I={type:"pinch-start",scale:1,rotation:0},D=new h.Vector2;D.addVectors(g[0],g[1]),D.multiplyScalar(.5),I.center={pageX:D.x,pageY:D.y},I.deltaTime=1e3/60,I.touchEvent=i,I.deltaX=0,I.deltaY=0,l.dispatchEvent(I),I.type="pinchrotate-start",l.dispatchEvent(I)}}else if(R-j>l.thresholds.twoFingerSweepTorlerance||j<R&&j>l.thresholds.twoFingerSweepTorlerance){for(var z=R;z>l.thresholds.twoFingerSweepTorlerance;)f(s.TOBEROTATE),z-=l.thresholds.twoFingerSweepTorlerance;if(d(s.TOBEROTATE)){u(s.ROTATESTART);var N={type:"rotate-start",scale:1,rotation:0},B=new h.Vector2;B.addVectors(g[0],g[1]),B.multiplyScalar(.5),N.center={pageX:B.x,pageY:B.y},N.deltaTime=1e3/60,N.touchEvent=i,N.deltaX=0,N.deltaY=0,l.dispatchEvent(N),N.type="pinchrotate-start",l.dispatchEvent(N)}}else if(x[0].y*x[1].y>0&&Math.abs(x[0].y)>l.thresholds.twoFingerSweepOffset&&Math.abs(x[1].y)>l.thresholds.twoFingerSweepOffset){for(var U=.5*(Math.abs(x[0].y)+Math.abs(x[1].y));U>l.thresholds.twoFingerSweepOffset;)f(s.TOBETWOFINGERSWEEP),U-=l.thresholds.twoFingerSweepOffset;if(d(s.TOBETWOFINGERSWEEP)){u(s.TWOFINGERSWEEPSTART);var F={type:"twofingersweep-start",scale:1,rotation:0},V=new h.Vector2;V.addVectors(g[0],g[1]),V.multiplyScalar(.5),F.center={pageX:V.x,pageY:V.y},F.deltaTime=1e3/60,F.touchEvent=i,F.deltaX=0,F.deltaY=0,l.dispatchEvent(F)}}else f(s.TOUCHSTART)}if(l.recognizerState===s.TWOFINGERSWEEPSTART||l.recognizerState===s.TWOFINGERSWEEP){u(s.TWOFINGERSWEEP);for(var H=[new h.Vector2,new h.Vector2],W=0;W<2;++W)H[W].set(e.touches[W].pageX,e.touches[W].pageY);var G={type:"twofingersweep",scale:1,rotation:0},K=new h.Vector2;K.addVectors(H[0],H[1]),K.multiplyScalar(.5),G.center={pageX:K.x,pageY:K.y},G.deltaTime=1e3/60,G.touchEvent=e,G.deltaX=0,G.deltaY=0,l.dispatchEvent(G)}else if(l.recognizerState===s.PINCHSTART||l.recognizerState===s.PINCH){for(var X=[new h.Vector2,new h.Vector2],Y=0;Y<2;++Y)X[Y].set(i.touches[Y].pageX,i.touches[Y].pageY);u(s.PINCH);for(var q=[new h.Vector2,new h.Vector2],Z=0;Z<2;++Z)q[Z].set(e.touches[Z].pageX,e.touches[Z].pageY);var Q={type:"pinch"},J=new h.Vector2;J.subVectors(X[1],X[0]);var $=new h.Vector2;$.subVectors(q[1],q[0]);var ee=J.length(),te=$.length(),re=J.dot($)/(ee*te),ne=new h.Vector3(J.x,J.y,0),oe=new h.Vector3($.x,$.y,0),ie=ne.cross(oe).z/(ee*te);Q.scale=te/ee,Math.abs(ee)<1e-7&&(Q.scale=1),Q.rotation=180*Math.atan2(ie,re)/Math.PI;var ae=new h.Vector2;ae.addVectors(q[0],q[1]),ae.multiplyScalar(.5),Q.center={pageX:ae.x,pageY:ae.y},Q.deltaTime=1e3/60,Q.touchEvent=e,Q.deltaX=0,Q.deltaY=0,l.dispatchEvent(Q),Q.type="pinchrotate",l.dispatchEvent(Q)}else if(l.recognizerState===s.ROTATESTART||l.recognizerState===s.ROTATE){for(var se=[new h.Vector2,new h.Vector2],le=0;le<2;++le)se[le].set(i.touches[le].pageX,i.touches[le].pageY);u(s.ROTATE);for(var ue=[new h.Vector2,new h.Vector2],ce=0;ce<2;++ce)ue[ce].set(e.touches[ce].pageX,e.touches[ce].pageY);var fe={type:"rotate"},he=new h.Vector2;he.subVectors(se[1],se[0]);var pe=new h.Vector2;pe.subVectors(ue[1],ue[0]);var de=he.length(),ve=pe.length(),me=he.dot(pe)/(de*ve),ye=new h.Vector3(he.x,he.y,0),ge=new h.Vector3(pe.x,pe.y,0),be=ye.cross(ge).z/(de*ve);fe.scale=ve/de,Math.abs(de)<1e-7&&(fe.scale=1),fe.rotation=180*Math.atan2(be,me)/Math.PI;var _e=new h.Vector2;_e.addVectors(ue[0],ue[1]),_e.multiplyScalar(.5),fe.center={pageX:_e.x,pageY:_e.y},fe.deltaTime=1e3/60,fe.touchEvent=e,fe.deltaX=0,fe.deltaY=0,l.dispatchEvent(fe),fe.type="pinchrotate",l.dispatchEvent(fe)}break;default:l.debug&&console.log(e)}a=c(e),o=Date.now()-t,l.debug&&console.log("touchMove",n,"ms")}}function y(e){if(l.debug&&console.log("onTouchEnd"),l.rawTouchDebug&&console.log(e),!1!==l.enabled){l.debug&&console.log(r),l.debug&&console.log(l.handlers),l.debug&&console.log(e),l.debug&&console.log(i),l.debug&&console.log(l.recognizerState);var t,o=Date.now();if(l.recognizerState===s.TWOFINGERSWEEP){u(s.NONE),p();var c={type:"twofingersweep-end"};c.touchEvent=a,l.dispatchEvent(c)}else if(l.recognizerState===s.ROTATE){u(s.NONE),p();var f={type:"rotate-end"};f.touchEvent=a,l.dispatchEvent(f),f.type="pinchrotate-end",l.dispatchEvent(f)}if(l.recognizerState===s.PINCH){u(s.NONE),p();var h={type:"pinch-end"};h.touchEvent=a,l.dispatchEvent(h),h.type="pinchrotate-end",l.dispatchEvent(h)}else switch(i.touches.length){case 1:if(0===r){if(o-n>l.thresholds.singleTapTimeout){u(s.NONE),l.debug&&console.log("Cancel a tap because it is hold for too long");break}if(l.recognizerState!==s.TOBEDOUBLETAP)l.debug&&console.log("first Tapping"),u(s.TOBETAP),setTimeout((t=i,function(){if(l.recognizerState===s.TOBETAP){u(s.TAP);var e={type:"tap"};e.touchEvent=t,l.dispatchEvent(e),u(s.NONE)}}),l.thresholds.doubleTapTimeout);else{l.debug&&console.log("second Tapping"),u(s.DOUBLETAP);var d={type:"double-tap"};d.touchEvent=i,l.dispatchEvent(d),u(s.NONE)}}else if(l.recognizerState===s.DRAGGING){u(s.NONE),p();var v={type:"drag-end"};v.touchEvent=e,l.dispatchEvent(v)}else if(l.recognizerState===s.DBLTAPDRAGGING){u(s.NONE),p();var g={type:"dbltap-drag-end"};g.touchEvent=e,l.dispatchEvent(g)}}r=-1,i=null,a=null,l.domElement.removeEventListener("touchend",y,!1),l.domElement.removeEventListener("touchmove",m,!1)}}};(nt.prototype=Object.create(h.EventDispatcher.prototype)).constructor=nt,nt.prototype.destruct=function(){return this.removeListeners(),this.enabled=!1,this.domElement=void 0,this.handlers=void 0,this.thresholds=void 0,this.recognizerStateQueue=void 0,!0};var ot,it=nt;function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e,t,r){return(ut="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ct(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ft(e,t){return(ft=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ht,pt,dt,vt,mt,yt,gt={NONE:0,ORBIT:1,DOLLY:2,SWIRL:3,TOUCH_ORBIT:11,TOUCH_DOLLY:12,TOUCH_SWIRL:13,FLYTO:21},bt={ORBIT:h.MOUSE.LEFT,DOLLY:h.MOUSE.MIDDLE,SWIRL:h.MOUSE.RIGHT},_t=(ht=(ot=function(e){function t(e){var r,n=e.camera,o=e.openning,i=void 0===o?{}:o,a=e.handlers,s=e.ecefNode,l=e.layers,u=e.domElement,c=e.showAnchor,f=void 0!==c&&c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var p=lt(r=function(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?lt(e):t}(this,ct(t).call(this,{camera:n,handlers:a})));r._pose=new je,r._cameraPath=null,r.ecefNode=s,r.layers=l,r.domElement=u,function(){p.preventDefault=p._preventDefault.bind(p),p.onMouseDown=p._onMouseDown.bind(p),p.onMouseMove=p._onMouseMove.bind(p),p.onMouseUp=p._onMouseUp.bind(p);var e=p._onMouseWheel.bind(p),t=Y(function(e){p._wheelBursting=!1},500);p.___wheelThrottlePrev=Date.now(),p.onMouseWheel=function(r){r.preventDefault(),p.___wheelThrottleNow=Date.now(),p.___wheelThrottleNow-p.___wheelThrottlePrev<45||(p.___wheelThrottlePrev=p.___wheelThrottleNow,e(r),t(r))},p.onDragStart=p._onDragStart.bind(p),p.onDrag=p._onDrag.bind(p),p.onDragEnd=p._onDragEnd.bind(p),p.onTwoFingerStart=p._onTwoFingerStart.bind(p),p.onTwoFinger=p._onTwoFinger.bind(p),p.onTwoFingerEnd=p._onTwoFingerEnd.bind(p)}(),r.gestureRecognizer=new it(r.domElement,{debug:!1}),r.orbitSpeed=.1,r.swirlSpeed=12,r.dollySpeed=1.5,r.enabled=!0,r._enabledDamping=!1,r._state=gt.NONE,r._orbitStart=new h.Vector2(0,0),r._orbitEnd=new h.Vector2(0,0),r._swirlStart=new h.Vector2(0,0),r._swirlEnd=new h.Vector2(0,0),r._rotateStart=new h.Vector2(0,0),r._rotateEnd=new h.Vector2(0,0),r._dollyStart=0,r._dollyEnd=0,r._wheelBursting=!1,r._buttonConfig={ORBIT:[bt.ORBIT],SWIRL:[bt.SWIRL],SWIRLLEFTREVERSE:!1,SWIRLUPREVERSE:!1,ORBITLEFTREVERSE:!1,ORBITUPREVERSE:!1,DOLLYREVERSE:!1},r._showAnchor=f,r.showContact=!1,r.showENU=!1,r._anchorScaleFactor=1,r._targetCenterFocus=null,r._picker=new Qe({camera:n,layers:l,domElement:u}),r._earthPicker=new rt({camera:n,domElement:u,layers:l,control:lt(r)});var d,v,m,y,g=new h.SphereBufferGeometry(5,32,32),b=new h.MeshBasicMaterial({color:16776960,side:h.DoubleSide});return r.showAnchor&&(r.__anchorPoint=new h.Mesh(g,b),r.ecefNode.sceneNode.add(r.__anchorPoint)),r.showContact&&(r.__contactPoint=new h.Mesh(g,b),r.ecefNode.sceneNode.add(r.__contactPoint)),r.__enu=new h.AxesHelper(1e6),r.__enu.matrixAutoUpdate=!1,r.showENU&&r.ecefNode.sceneNode.add(r.__enu),d=i.poseTo,v=Object.assign({},{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0},d),m=Object.assign({},v,d),y=Date.now(),p._cameraPath=new He(new je(m),new je(m),{start:y-1,current:y,end:y}),p._pose.value=m,p._updateFrustum=X(function(){p.__updateFrustum()},30),p._updateNearFar=X(function(){p.__updateNearFar()},100),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ft(e,t)}(t,Fe),r=t,(n=[{key:"destruct",value:function(){return this.enabled=!1,this._cameraPath&&this._cameraPath.destruct(),this._cameraPath=void 0,this._pose&&this._pose.destruct(),this._pose=void 0,this.gestureRecognizer&&this.gestureRecognizer.destruct(),this.gestureRecognizer=void 0,this._picker&&this._picker.destruct(),this._picker=void 0,this._earthPicker&&this._earthPicker.destruct(),this._earthPicker=void 0,this._updateFrustum&&(this._updateFrustum=void 0),this._updateNearFar&&(this._updateNearFar=void 0),this.ecefNode=void 0,this._orbitStart=void 0,this._orbitEnd=void 0,this._swirlStart=void 0,this._swirlEnd=void 0,this._rotateStart=void 0,this._rotateEnd=void 0,ut(ct(t.prototype),"destruct",this).call(this)}},{key:"cameraPose",value:function(){return this._pose.value}},{key:"freeze",value:function(){this.enabled=!1}},{key:"unfreeze",value:function(){this.enabled=!0}},{key:"tiltRange",value:function(e){var t=e.max,r=e.min;return isNaN(r)||(this.pose.tilt<r&&(this._pose.tilt=r+1e-4),this._pose.minTilt=r),isNaN(t)||(t>je.maxTilt&&(console.warn("maxTilt cannot exceed",je.maxTilt),t=je.maxTilt-1e-4),this.pose.tilt>t&&(this._pose.tilt=t-1e-4),this._pose.maxTilt=t),{max:this._pose.maxTilt,min:this._pose.minTilt}}},{key:"altRange",value:function(e){var t=e.max,r=e.min;return isNaN(r)||(this.pose.alt<r&&(this._pose.alt=r+1e-4),this._pose.minAlt=r),isNaN(t)||(this.pose.alt>t&&(this._pose.alt=t-1e-4),this._pose.maxAlt=t),{max:this._pose.maxAlt,min:this._pose.minAlt}}},{key:"flyToPose",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=this;return this.state!==gt.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=gt.FLYTO),this._putAnchor(),this.cameraPath.destinate(e,r).then(function(){return n._pose.value=n.cameraPath.dst.value,t._putAnchor(),n.state=gt.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return t._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;return this.state!==gt.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=gt.FLYTO),this._putAnchor(),r&&r.isVector3?this._targetCenterFocus=r.clone():this._targetCenterFocus=null,this.cameraPath.destinate(e,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=gt.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMatNorthUp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new h.Vector3,o=new h.Quaternion,i=new h.Vector3;e.decompose(n,o,i);var a=n.clone(),s=i.clone(),l=n.clone().normalize(),u=new h.Vector3(0,0,-1).applyQuaternion(o.clone()),c=u.clone().cross(l).normalize(),f=c.clone().cross(u).normalize();(new h.Matrix4).makeBasis(c.normalize(),f.normalize(),u.negate().normalize()).decompose(n,o,i);var p=o.clone(),d=(new h.Matrix4).compose(a,p,s);return this.flyToMat(d,t,r)}},{key:"flyToMatWithFocus",value:function(e,t,r){return this._targetCenterFocus=r.clone(),this.flyToMat(e,t)}},{key:"flyAlong",value:function(e,t){var r=this,n=this;this.cameraPath.setAlphaAdaptFunc(function(e){return e});var o=e(0);return this.flyToMat(o,1e3).then(function(){r.state!==gt.FLYTO&&(r.cameraPath.sync(r._pose.matrix),r.state=gt.FLYTO),r._putAnchor();var o=e(1);return r.cameraPath.setInterpolateFunc(e),r.cameraPath.destinate(o,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=gt.NONE,n.onCameraChange(),n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve()}).catch(function(e){return n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve(e.message)):"disabled"===e.message?(n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.resolve(e.message)):(n._pose.matrix=n.cameraPath.dst.matrix,n.cameraPath.setAlphaAdaptFunc(),n.cameraPath.setInterpolateFunc(),Promise.reject(e))})})}},{key:"stopFlying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===gt.FLYTO){var t=e?new Error("destination changed"):new Error("stopFlying");this.cameraPath.interrupt(t),this.state=gt.NONE}}},{key:"restoreView",value:function(){this._targetCenterFocus=null;var e=this._camera,t=e.view,r=this;return t?new Promise(function(n,o){setTimeout(function(){e.setViewOffset(t.fullWidth,t.fullHeight,0,0,t.fullWidth,t.fullHeight),r._handlers._onCameraChange(),n()},1e3)}):Promise.reject(new Error("No view"))}},{key:"update",value:function(){if(!this.cameraPath)return!1;var e;if(this.state!==gt.FLYTO)this._pose.applyDelta(),e=this._pose.matrix;else{var t=this.cameraPath.pose;if(t){var r=t.matrix;this._pose.matrix=r,e=r,this.__updateFrustum()}else e=this._pose.matrix}if(!this.__prevCamToEarth||!e.equals(this.__prevCamToEarth)){try{var n=(new h.Matrix4).getInverse(e,!0)}catch(e){return console.error("no inverse"),!1}if(this.ecefNode.setMatrix(n),this._handlers._onCameraChange(),this.__prevCamToEarth?this.__prevCamToEarth.copy(e):this.__prevCamToEarth=e,(this.showContact||this.showAnchor)&&this.ecefNode){var o=(new h.Vector3).setFromMatrixPosition(e),i=this._pose.anchor,a=o.distanceTo(i),s=.002*this._anchorScaleFactor*a;if(this.showAnchor){var l=this.__anchorPoint;l.position.copy(i),l.scale.set(s,s,s),l.visible=!0}if(this.showContact&&this.__contactPoint.scale.set(s,s,s),this.showENU){var u=me.ecef2Wgs84(i.x,i.y,i.z),c=u.longitude,f=u.latitude,p=me.getENUSystem(f,c),d=p.origin,v=p.east,m=p.north,y=p.up,g=(new h.Matrix4).makeBasis(v,m,y).setPosition(d);this.__enu.matrix.copy(g)}}}return!0}},{key:"_mount",value:function(){this.domElement.addEventListener("contextmenu",this.preventDefault),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mousewheel",this.onMouseWheel),this.domElement.addEventListener("MozMousePixelScroll",this.onMouseWheel),this.gestureRecognizer.addEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.addEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_unmount",value:function(){this.domElement.removeEventListener("contextmenu",this.preventDefault,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.gestureRecognizer.removeEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.removeEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_preventDefault",value:function(e){e.preventDefault()}},{key:"_onMouseDown",value:function(e){if(this.enabled){if(e.preventDefault(),this.stopFlying(!0),t(e.button,this._buttonConfig.ORBIT)){if(!this.enabledOrbit)return;this._handleOrbitStart(e.clientX,e.clientY),this.state=gt.ORBIT}else if(t(e.button,this._buttonConfig.SWIRL)){if(!this.enabledSwirl)return;this._handleSwirlStart(e.clientX,e.clientY),this.state=gt.SWIRL}this.state!==gt.NONE&&(this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mouseup",this.onMouseUp),this.domElement.addEventListener("mouseout",this.onMouseUp),this._handlers._onCameraStart(e))}function t(e,t){if(e===t)return!0;if(Array.isArray(t))for(var r=0;r<t.length;++r)if(e===t[r])return!0;return!1}}},{key:"_onMouseWheel",value:function(e){if(this.enabled&&this.enabledDolly){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?t=this.dollySpeed:t<0&&(t=-this.dollySpeed),this._wheelBursting||(this.stopFlying(!0),this._pose.distanceToAnchor>.1*$?this._putAnchor():this._putAnchor({x:e.clientX,y:e.clientY}),this._wheelBursting=!0),this.dolly(-t)}}},{key:"_onMouseMove",value:function(e){if(this.enabled){e.preventDefault();var t=this.state;if(t===gt.ORBIT){if(!this.enabledOrbit)return;this._handleOrbitMove(e.clientX,e.clientY)}else if(t===gt.SWIRL){if(!this.enabledSwirl)return;this._handleSwirl(e.clientX,e.clientY)}if(this.showContact){var r={x:e.clientX,y:e.clientY},n=this._earthPicker.pick(r.x,r.y);if(n){var o=this.__contactPoint;o.position.copy(n),o.visible=!0}}}}},{key:"_onMouseUp",value:function(e){this.enabled&&(this.state===gt.ORBIT?(this.enabledOrbit&&this._handlers._onCameraEnd(e),this.state=gt.NONE):this.state===gt.SWIRL&&(this.enabledSwirl&&this._handlers._onCameraEnd(e),this.state=gt.NONE),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("mouseout",this.onMouseUp))}},{key:"_onDragStart",value:function(e){if(this.enabledOrbit){this.stopFlying(!0);var t=e.touchEvent,r=t.touches[0].pageX,n=t.touches[0].pageY;this._handleOrbitStart(r,n),this.state=gt.ORBIT,this.gestureRecognizer.addEventListener("drag",this.onDrag),this.gestureRecognizer.addEventListener("drag-end",this.onDragEnd),this._handlers._onCameraStart(t)}}},{key:"_onDrag",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this._handleOrbitMove(t.touches[0].pageX,t.touches[0].pageY),this.state=gt.ORBIT}}},{key:"_onDragEnd",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this.gestureRecognizer.removeEventListener("drag",this.onDrag),this.gestureRecognizer.removeEventListener("drag-end",this.onDragEnd),this._handlers._onCameraEnd(t),this.state=gt.NONE}}},{key:"_onTwoFingerStart",value:function(e){if(this.enabledSwirl||this.enabledDolly){this.stopFlying(!0);for(var t=e.center,r=[new h.Vector2,new h.Vector2],n=0;n<2;++n)r[n].set(event.touches[n].pageX,event.touches[n].pageY);var o=new h.Vector2;o.subVectors(r[1],r[0]),this._handleSwirlStart(t.pageX,t.pageY,o),this.state=gt.SWIRL;var i=this.__twoTouchPoints(e),a=i.p,s=i.q,l=a.distanceTo(s);isNaN(l)||(this._dollyStart=l),this.gestureRecognizer.addEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.addEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.addEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.addEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraStart(event)}}},{key:"_onTwoFinger",value:function(e){if(this.enabledSwirl||this.enabledDolly){for(var t=e.center,r=[new h.Vector2,new h.Vector2],n=0;n<2;++n)r[n].set(event.touches[n].pageX,event.touches[n].pageY);var o=new h.Vector2;o.subVectors(r[1],r[0]),this._handleSwirl(t.pageX,t.pageY,o);var i=this.__twoTouchPoints(e),a=i.p,s=i.q,l=a.distanceTo(s);if(!isNaN(l)){if(this._dollyEnd=l,0!==this._dollyStart){var u=(this._dollyEnd-this._dollyStart)/-50;this.dolly(u*this.dollySpeed)}this._dollyStart=this._dollyEnd}this.state=gt.SWIRL}}},{key:"_onTwoFingerEnd",value:function(e){if(this._onDragEnd(e),this.enabledSwirl||this.enabledDolly){var t=e.touchEvent;this._dollyStart=this._dollyEnd=0,this.gestureRecognizer.removeEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.removeEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.removeEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.removeEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraEnd(t),this.state=gt.NONE}}},{key:"_handleOrbitStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._orbitStart.set(e,t)}},{key:"_handleOrbitMove",value:function(e,t){this._orbitEnd.set(e,t);var r=(new h.Vector3).subVectors(this._orbitEnd,this._orbitStart);r.lengthSq()>100&&(console.warn("Abnormal large orbit move."),r.normalize().multiplyScalar(10));var n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.orbitLeft(r.x/n*this.orbitSpeed),this.orbitUp(r.y/n*this.orbitSpeed),this._orbitStart.copy(this._orbitEnd)}},{key:"_handleSwirlStart",value:function(e,t,r){this._putAnchor({x:e,y:t}),this._swirlStart.set(e,t),r&&this._rotateStart.copy(r)}},{key:"_handleSwirl",value:function(e,t,r){this._swirlEnd.set(e,t);var n=(new h.Vector3).subVectors(this._swirlEnd,this._swirlStart),o=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);if(this.swirlLeft(n.x/o*this.swirlSpeed),this.swirlUp(n.y/o*this.swirlSpeed),this._swirlStart.copy(this._swirlEnd),r){this._rotateEnd=r;var i=this._rotateStart.length()*this._rotateEnd.length(),a=this._rotateStart.dot(this._rotateEnd)/i,s=new h.Vector3(this._rotateStart.x,this._rotateStart.y,0),l=new h.Vector3(this._rotateEnd.x,this._rotateEnd.y,0),u=s.cross(l).z/i,c=Math.atan2(u,a);this.swirlLeft(-2*c*this.swirlSpeed),this._rotateStart.copy(this._rotateEnd)}}},{key:"_putAnchor",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pose;if(e){var n=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");return n||(n=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y})),void(n?r.putAnchor(n):this._earthPicker.needsIntersectMesh()?(n=this._earthPicker.pickTreeFromCenter(),r.putAnchor(n)):r.putAnchor())}this._earthPicker.needsIntersectMesh()&&(t=this._earthPicker.pickTreeFromCenter()),t?r.putAnchor(t):r.putAnchor()}},{key:"__updateNearFar",value:function(){var e,t,r=this._camera,n=this._pose.matrix,o=(new h.Vector3).setFromMatrixPosition(n),i=this._pose.anchor,a=o.distanceTo(i),s=o.length();if(i.lengthSq()<.8*$)e=1,t=s;else{e=.01*a,t=s+Math.min(Math.max(10*a,s),2*$);var l=ee*$,u=l-$;a<(ee-1)*$?(e=.01*a,t=Math.sqrt(a*(a+2*l))+Math.sqrt(u*(2*$+u))+2e5):(e=.1*a,t=30*$)}r.near=e,r.far=t,r.updateProjectionMatrix()}},{key:"__updateFrustum",value:function(){var e=this._targetCenterFocus;if(e){var t=this._camera,r=this._pose.matrix;if(!t.view)return void console.warn("No view ready.");var n=e.clone(),o=(new h.Matrix4).getInverse(r);n.applyMatrix4(o);var i=t.fov,a=t.aspect,s=t.near,l=t.far,u=new h.PerspectiveCamera(i,a,s,l),c=n.project(u),f=(c.x+1)/2*this.domWidth,p=(1-c.y)/2*this.domHeight,d=t.view,v=f-(d.offsetX+d.width/2),m=p-(d.offsetY+d.height/2),y=d.offsetX+v,g=d.offsetY+m;t.setViewOffset(d.fullWidth,d.fullHeight,y,g,d.width,d.height)}}},{key:"__twoTouchPoints",value:function(e){var t=e.touchEvent.touches;return{p:new h.Vector2(t[0].pageX,t[0].pageY),q:new h.Vector2(t[1].pageX,t[1].pageY)}}},{key:"putCenterAnchor",value:function(){var e=this.domWidth/2,t=this.domHeight/2;return this._putAnchor({x:e,y:t})}},{key:"orbitLeft",value:function(e){if(0!==e){var t=this._buttonConfig.ORBITLEFTREVERSE?-1:1;this._pose.orbitLeft(e*t)}}},{key:"orbitUp",value:function(e){if(0!==e){var t=this._buttonConfig.ORBITUPREVERSE?-1:1;this._pose.orbitUp(e*t)}}},{key:"dolly",value:function(e){if(0!==e){var t=this._buttonConfig.DOLLYREVERSE?-1:1;this._pose.dolly(e*t)}}},{key:"swirlLeft",value:function(e){if(this.enabledSwirlLeft&&e){var t=this._buttonConfig.SWIRLLEFTREVERSE?-1:1;this._pose.swirlLeft(e*t)}}},{key:"swirlUp",value:function(e){if(this.enabledSwirlUp&&e){var t=this._buttonConfig.SWIRLUPREVERSE?-1:1;this._pose.swirlUp(e*t)}}},{key:"pickEarthContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=this._earthPicker.pick(t,r);if(n){var o=me.ecef2Wgs84(n.x,n.y,n.z),i=o.latitude;return{lng:o.longitude,lat:i,alt:0}}}},{key:"pickEarthContactPointByPose",value:function(e){var t=this._poseToRay(e),r=t.origin,n=t.direction,o=this._earthPicker.pickByRay(r,n);if(o){var i=me.ecef2Wgs84(o.x,o.y,o.z),a=i.latitude;return{lng:i.longitude,lat:a,alt:0}}}},{key:"pickProjectContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project",o=this.pickProjectContactPointInEarth({rawX:t,rawY:r},n);if(o){var i=me.ecef2Wgs84(o.x,o.y,o.z),a=i.latitude;return{lng:i.longitude,lat:a,alt:i.height}}}},{key:"pickProjectContactPointByPose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project",r=this.pickProjectContactPointInEarthByPose(e,t);if(r){var n=me.ecef2Wgs84(r.x,r.y,r.z),o=n.latitude;return{lng:n.longitude,lat:o,alt:n.height}}}},{key:"pickProjectContactPointInEarth",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project";this._picker.layerName=n;var o=this._picker.pick(t,r);if(o.length>0){var i=this._pose.matrix,a=o[0].point.clone();return a.applyMatrix4(i),a}}},{key:"pickProjectContactPointInEarthByPose",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project",r=this._poseToRay(e),n=r.origin,o=r.direction;this._picker.layerName=t;var i=this._picker.pickByRay(n,o);if(i.length>0){var a=this._pose.matrix,s=i[0].point.clone();return s.applyMatrix4(a),s}}},{key:"_poseToRay",value:function(e){var t=e.lng,r=e.lat,n=e.alt,o=e.tilt,i=e.north,a=(new h.Vector3).copy(me.wgs842Ecef(r,t,n)),s=me.getENUSystem(r,t),l=Math.PI/180,u=i*l,c=o*l,f=Math.cos(u),p=Math.sin(u),d=Math.cos(c),v=Math.sin(c),m=a.clone().add(s.north.clone().multiplyScalar(f*v)).add(s.east.clone().multiplyScalar(-p*v)).add(s.up.clone().multiplyScalar(-d)),y=this._pose.matrix,g=(new h.Matrix4).getInverse(y),b=(new h.Vector3).copy(a).applyMatrix4(g);return{origin:b,direction:(new h.Vector3).copy(m).applyMatrix4(g).clone().sub(b).normalize()}}},{key:"mapToWindow",value:function(e,t){return this._picker._NDCinv(e,t)}},{key:"onCameraChange",value:function(){this._updateNearFar()}},{key:"buttonConfig",set:function(e){Object.assign(this._buttonConfig,e)},get:function(){return this._buttonConfig}},{key:"cameraPath",get:function(){return this._cameraPath}},{key:"pose",get:function(){return this._pose.value},set:function(e){this._pose.value=e,this._handlers._onCameraChange()}},{key:"camToEarth",get:function(){return this._pose.matrix}},{key:"POS",get:function(){return this._pose.POS}},{key:"state",set:function(e){this._state=e},get:function(){return this._state}},{key:"enabled",set:function(e){this._enabled=e,this.enabledOrbit=e,this.enabledDolly=e,this.enabledSwirl=e,e?this._mount():(this._unmount(),this.state=gt.NONE,this.cameraPath.interrupt(new Error("disabled")))},get:function(){return this._enabled}},{key:"enabledOrbit",set:function(e){this._enabledOrbit=e},get:function(){return this._enabledOrbit}},{key:"enabledDolly",set:function(e){this._enabledDolly=e},get:function(){return this._enabledDolly}},{key:"enabledSwirl",set:function(e){this.enabledSwirlLeft=e,this.enabledSwirlUp=e},get:function(){return this.enabledSwirlLeft||this.enabledSwirlUp}},{key:"enabledSwirlUp",set:function(e){this._enabledSwirlUp=e},get:function(){return this._enabledSwirlUp}},{key:"enabledSwirlLeft",set:function(e){this._enabledSwirlLeft=e},get:function(){return this._enabledSwirlLeft}},{key:"enableRotate",set:function(e){this.enabledOrbit=e}},{key:"focus",get:function(){return this._pose.value}},{key:"domWidth",get:function(){return this.domElement.clientWidth}},{key:"domHeight",get:function(){return this.domElement.clientHeight}},{key:"showAnchor",get:function(){return this._showAnchor},set:function(e){this._showAnchor=e}}])&&st(r.prototype,n),t}()).prototype,pt="enableRotate",dt=[ye],vt=Object.getOwnPropertyDescriptor(ot.prototype,"enableRotate"),mt=ot.prototype,yt={},Object.keys(vt).forEach(function(e){yt[e]=vt[e]}),yt.enumerable=!!yt.enumerable,yt.configurable=!!yt.configurable,("value"in yt||yt.initializer)&&(yt.writable=!0),yt=dt.slice().reverse().reduce(function(e,t){return t(ht,pt,e)||e},yt),mt&&void 0!==yt.initializer&&(yt.value=yt.initializer?yt.initializer.call(mt):void 0,yt.initializer=void 0),void 0===yt.initializer&&(Object.defineProperty(ht,pt,yt),yt=null),ot);function wt(e){return(wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==wt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,kt(t).call(this,e)))._property.type="HyperLayer",r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,W),r=t,(n=[{key:"clear",value:function(){console.warn("clear is not implemented")}}])&&xt(r.prototype,n),t}();function At(e){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Mt(e,t,r){return(Mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Et(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Tt(e,t,r,n){return(Tt="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=Et(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function Et(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ct(e)););return e}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function jt(e,t){return(jt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Rt=function(e){function t(e,r){var n,o=r.name,i=void 0===o?"HyperEntity":o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==At(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Ct(t).call(this,e))).name=i,n._property.type="HyperEntity",n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&jt(e,t)}(t,W),r=t,(n=[{key:"initInfo",value:function(){return Promise.reject(new Error("initInfo not impelemented."))}},{key:"visible",set:function(e){!function(e,t,r,n,o){if(!Tt(e,"visible",r,n||e))throw new Error("failed to set property")}(Ct(t.prototype),0,e,this),this._tree&&(this._tree.visible=e)},get:function(){return Mt(Ct(t.prototype),"visible",this)}}])&&St(r.prototype,n),t}();function Lt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var It=function(){function e(t,r){var n=r.name,o=r.sceneGraphRoot,i=r.eventHandlers,a=void 0===i?{}:i,s=r.maxLevel,l=r.minLevel,u=r.priorityRank,c=void 0===u?1:u,f=r.showBBox,p=void 0!==f&&f,d=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=n,this.Node=t,this.sceneGraphRoot=o,this.eventHandlers=a,this.maxLevel=s,this.minLevel=l,this.debug=d,this.root=null,this.numOfNodes=0;var v=a.onTileDownloaded,m=a.onError;this.sharedOptions={sceneGraphRoot:o,debug:d,onError:m,onTileDownloaded:v,priorityRank:c,showBBox:p,frustumInTree:new h.Frustum,camInTree:new h.Vector3,fov:50},this.flags={modelInitialized:!1};var y=this;this.initialized=new Promise(function(e,t){y._onInitSuccess=e,y._onInitFail=t}),this.style={}}var t,r;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return e=e&&this.dispose(this.root),this.root=null,this._onContentDisposed(),this.tile_retriever&&(console.warn("deprecated"),e=e&&this.tile_retriever.destruct(),this.tile_retriever=null),e}},{key:"expand",value:function(e){return console.error("expand is not implemented"),!1}},{key:"dispose",value:function(e){var t=this.debug;if(null==e)return!0;var r=!0;void 0===e.nodes&&console.warn("inspect",e.info);for(var n=0;n<e.nodes.length;n++)r=this.dispose(e.nodes[n])&&r;return t&&console.log("delete",JSON.stringify(e.info)),r=e.destruct()&&r,e=void 0,this.numOfNodes--,r}},{key:"prune",value:function(e){if(void 0===e)return console.warn("Trying to prune undefined node"),!1;var t=!0;if(e.isInScene||e.displayByPrune(),e.nodes.length>0){for(var r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;e.nodes=[]}return t}},{key:"traverse",value:function(e,t,r,n){var o=!0;o=t(e,r,n)&&o;for(var i=0;i<e.nodes.length;i++)o=this.traverse(e.nodes[i],t,r,n)&&o;return o}},{key:"preSceneUpdate",value:function(e){var t=e.camera;return this._onCameraChanged(),this._updateCameraPose({camera:t}),!0}},{key:"updateVisibility",value:function(){return this.root&&this.traverse(this.root,function(e){return e.updateVisibility(),!0}),!0}},{key:"_onCameraChanged",value:function(){return this.root&&this.traverse(this.root,function(e){return e.cameraChanged(),!0}),!0}},{key:"_updateCameraPose",value:function(e){var t=e.camera,r=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld);this.sharedOptions.frustumInTree.setFromMatrix((new h.Matrix4).multiplyMatrices(t.projectionMatrix,r)),this.sharedOptions.camInTree.setFromMatrixPosition((new h.Matrix4).getInverse(r)),this.sharedOptions.fov=t.fov}},{key:"_onContentInitialized",value:function(){this.flags.modelInitialized=!0,this.eventHandlers.onContentInitialized&&this.eventHandlers.onContentInitialized(),this._onInitSuccess(this)}},{key:"_onContentDisposed",value:function(){this.flags.modelInitialized=!1,this.eventHandlers.onContentDisposed&&this.eventHandlers.onContentDisposed()}},{key:"name",get:function(){return this._name}},{key:"visible",get:function(){return this.sceneGraphRoot.visible},set:function(e){this.sceneGraphRoot.visible=e}},{key:"size",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return e++,!0}),e}},{key:"estimatedGpuUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.isInScene&&t.estimatedGpuUsage&&(e+=t.estimatedGpuUsage),!0}),e}},{key:"gpuUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.isInScene&&t.gpuUsage&&(e+=t.gpuUsage),!0}),e}},{key:"estimatedGpuMaxUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.estimatedGpuUsage&&(e+=t.estimatedGpuUsage),!0}),e}},{key:"gpuMaxUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.gpuUsage&&(e+=t.gpuUsage),!0}),e}},{key:"estimatedRamUsage",get:function(){var e=0;return this.root&&this.traverse(this.root,function(t){return t.estimatedRamUsage&&(e+=t.estimatedRamUsage),!0}),e}}])&&Lt(t.prototype,r),e}();function Dt(e){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nt(e,t,r){return(Nt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Bt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ut(e,t){return(Ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ft=function(e){function t(e,r){var n,o=r.name,i=r.sceneGraphRoot,a=r.eventHandlers,s=r.maxLevel,l=r.minLevel,u=r.priorityRank,c=r.showBBox,f=r.debug,h=r.TreeMaterialType,p=r.NodeMaterialType;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Bt(t).call(this,e,{name:o,sceneGraphRoot:i,eventHandlers:a,maxLevel:s,minLevel:l,priorityRank:u,showBBox:c,debug:f})))._TreeMaterialType=h,n._NodeMaterialType=p,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}(t,It),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._material&&(e=this._material.destruct()&&e),Nt(Bt(t.prototype),"destruct",this).call(this)&&e}},{key:"material",get:function(){if(!this._material){var e=this._NodeMaterialType,t=this._TreeMaterialType;this._material=new t({tree:this,Type:e})}return this._material},set:function(e){e!==this._material&&(e.tree=this,this._material&&this._material.destruct(),this._material=e,this._TreeMaterialType=e.constructor,this._NodeMaterialType=e.Type,this.sharedOptions.treeMaterial=this._material,this._material.updateMaterial()||console.warn("set material"))}},{key:"TreeMaterialType",get:function(){return this._TreeMaterialType}},{key:"NodeMaterialType",get:function(){return this.material.Type}}])&&zt(r.prototype,n),t}();function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Wt(e,t,r[t])})}return e}function Wt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Kt(e,t,r){return(Kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xt(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Xt(e){return(Xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yt(e,t){return(Yt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qt=function(e){function t(e,r){var n,o=r.sceneGraphRoot,i=r.name,a=void 0===i?"QuadLodTree":i,s=r.eventHandlers,l=r.maxLevel,u=r.minLevel,c=r.priorityRank,f=r.showBBox,h=r.camera,p=r.debug,d=r.TreeMaterialType,v=r.NodeMaterialType;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Xt(t).call(this,e,{name:a,sceneGraphRoot:o,eventHandlers:s,maxLevel:l,minLevel:u,priorityRank:c,showBBox:f,debug:p,TreeMaterialType:d,NodeMaterialType:v}))).sharedOptions.maxLevel=l,n.sharedOptions.minLevel=u,n.camera=h,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yt(e,t)}(t,Ft),r=t,(n=[{key:"destruct",value:function(){return this.sharedOptions.maxLevel=0,this.sharedOptions.minLevel=0,this.camera=void 0,Kt(Xt(t.prototype),"destruct",this).call(this)}},{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){var t=e.x,r=e.y,n={level:e.level+1,parent:e,sharedOptions:this.sharedOptions};return e.nodes[0]=new this.Node(Ht({x:2*t,y:2*r},n)),e.nodes[1]=new this.Node(Ht({x:2*t,y:2*r+1},n)),e.nodes[2]=new this.Node(Ht({x:2*t+1,y:2*r},n)),e.nodes[3]=new this.Node(Ht({x:2*t+1,y:2*r+1},n)),this.numOfNodes+=4,this.debug&&console.log("tree expand"),!0}return console.warn("unknown expand error"),!1}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return Kt(Xt(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this.camera!==r&&(this.camera&&console.warn("Camera instance Changed.",r,this.camera),this.camera=r),!0}}])&&Gt(r.prototype,n),t}();function Zt(e){var t={};return Object.keys(e).filter(function(t){return void 0!==e[t]&&null!==e[t]}).forEach(function(r){t[r]=e[r]}),t}function Qt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Object?Object.assign({},Zt(e),Zt(t)):e}function Jt(e){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $t(e){return($t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function er(e,t){return(er=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var tr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.color,l=a.map,u=a.transparent,c=void 0!==u&&u,f=a.opacity,h=void 0===f?1:f;return(e=function(e,t){return!t||"object"!==Jt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,$t(t).call(this,Zt({color:s,map:l,transparent:c,opacity:h})))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&er(e,t)}(t,h.MeshBasicMaterial),t}();function rr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var or,ir=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.tree,n=t.Type,o=void 0===n?tr:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tree=r,this._Type=o}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){rr(e,t,r[t])})}return e}({},Zt(e.style),Zt(this.tree.style));return new this.Type(t)}},{key:"releaseMemoryOf",value:function(e){return!0}},{key:"tree",get:function(){return this._tree},set:function(e){this._tree=e}},{key:"Type",set:function(e){return this._Type=e,this.updateMaterial()},get:function(){return this._Type}}])&&nr(t.prototype,r),e}(),ar=r(12),sr=r.n(ar);function lr(e){var t=0;for(var r in e.attributes)t+=e.attributes[r].array.byteLength;return e.index&&(t+=e.index.array.byteLength),t}!function(e){e[e.TERRAIN_RGB=0]="TERRAIN_RGB",e[e.HEIGHT=1]="HEIGHT"}(or||(or={}));function ur(e){var t=le(e.level,e.x,e.y),r=t.minX,n=t.minY,o=t.maxX,i=t.maxY;return[[r,n],[o,n],[o,i],[r,i]].map(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e,2),r=t[0],n=t[1];return me.webMercator2Ecef(r,n,0)})}function cr(e,t,r,n,o){return{u:(t+n)/e,v:(e-1-r+o)/e}}function fr(e,t,r,n,o){return{u:e*n-t,v:e*o-(e-1-r)}}function hr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var pr=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=r,this.listeners=new Map,this.workers=[],this.jobs=[];for(var n=function(e){t.workers.push(new sr.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.status,o=r.data.payload,i=r.data.resourceKey;if(t.listeners.has(i)){var a=t.listeners.get(i);t.listeners.delete(i),a.forEach(function(e){var t=e.resolve,r=e.reject;200===n?t(o):r(new Error(n))})}else console.error("Worker cannot find callback for",i);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("PlanetLoader",e)}},o=0;o<this.workerSize;o++)n(o)}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"downloadMapForTile",value:function(e,t){var r=this,n=t;return new Promise(function(o,i){var a={resolve:o,reject:i};if(r.listeners.has(n))r.listeners.get(n).push(a);else{r.listeners.set(n,[a]);var s={action:3,resourceKey:n,params:{mapName:e,url:t}},l=r.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);r.jobs[l]++,r.workers[l].postMessage(s)}})}},{key:"requestMesh",value:function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{timeout:3e3},i=(o.timeout,o.demImageData),a=o.demResource,s=o.demEncoding,l="2-"+e+"-"+t+"-"+r;return i&&(l+="-"+a.level+"-"+a.x+"-"+a.y),new Promise(function(o,u){var c={resolve:o,reject:u};if(n.listeners.has(l))n.listeners.get(l).push(c);else{n.listeners.set(l,[c]);var f={action:2,resourceKey:l,params:{level:e,x:t,y:r,demImageData:i,demResource:a,demEncoding:s}},h=n.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);n.jobs[h]++,n.workers[h].postMessage(f)}})}}])&&hr(t.prototype,r),e}(),dr=r(13),vr=r.n(dr);function mr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var yr=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=r,this.listeners=new Map,this.workers=[],this.jobs=[];for(var n=function(e){t.workers.push(new vr.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.url,o=r.data.success;if(t.listeners.has(n)){var i=t.listeners.get(n);t.listeners.delete(n),i.forEach(function(e){var t=e.resolve,n=e.reject;o?t(r.data.decoded):n(new Error(r.data.message))})}else console.error("Worker cannot find callback for",n);t.jobs[e]--}},o=0;o<this.workerSize;++o)n(o)}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"decode",value:function(e,t){var r=this,n=t;return new Promise(function(i,a){var s={resolve:i,reject:a};if(r.listeners.has(n))r.listeners.get(n).push(s);else{r.listeners.set(n,[s]);var l=r.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);r.jobs[l]++,e?r.workers[l].postMessage({bufferArray:e,url:t,type:o(t,"jpg")?"jpg":"png"},[e.buffer]):r.workers[l].postMessage({bufferArray:e,url:t,type:o(t,"jpg")?"jpg":"png"})}});function o(e,t){var r=e.length;return e.substring(r-t.length,r)===t}}},{key:"download",value:function(e){return this.decode(null,e)}}])&&mr(t.prototype,r),e}(),gr=["// Atmospheric scattering vertex shader","// Author: Sean O'Neil","// Copyright (c) 2004 Sean O'Neil","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","const int nSamples = 3;","const float fSamples = 3.0;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","uniform vec3 v3LightPosition;","varying vec3 ncenter;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","varying float inspace;","varying vec3 cloudPos;","void main(void)","{","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fHeight = inSpace ? fOuterRadius : length(v3Start);","float fStartAngle = dot(v3Ray, v3Start) / fHeight;","float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));","float fStartDepth = inSpace ? exp(-1.0 / fScaleDepth) : exp(fScaleOverScaleDepth * closeSurfaceDiff);","float fStartOffset = fStartDepth*scale(fStartAngle);","startDepth = clamp(fStartOffset,0.0,1.0);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","float fScatter;","float fDepth;","float fLightAngle;","float fCameraAngle;","vec3 v3Attenuate;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","fHeight = fHeight < fInnerRadius && fHeight >= fInnerRadius * 0.99 ? fInnerRadius : fHeight;","fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));","fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;","fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;","fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","v3FrontColor = fHeight < fInnerRadius ? vec3(0.5803921568627451,0.7725490196078432,1.0) : v3FrontColor;","}","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","c0 = v3FrontColor * (v3InvWavelength * fKrESun);","c1 = v3FrontColor * fKmESun;","cloudPos = normalize(position);","float l = length(translatedCameraPosition) / fOuterRadius * 1.0;","l = l - 1.0;","inspace = clamp(l, 0.0, 1.0);","v3Direction = translatedCameraPosition - translatedPosition;","#include <logdepthbuf_vertex>","}"].join("\n"),br="\n// with help and reference to these shadertoy examples:\n// https://www.shadertoy.com/view/XslGRr\n// https://www.shadertoy.com/view/ldyXRw\n// https://www.shadertoy.com/view/MlSSR1\n// https://www.shadertoy.com/view/XscXRs\n// https://www.shadertoy.com/view/Msdfz8\n// https://www.shadertoy.com/view/Xs2fDw\n// https://www.shadertoy.com/view/XdXyz8\n// https://www.shadertoy.com/view/4tGBDd\n// https://www.shadertoy.com/view/MsXSDN\n\nvarying vec3 cloudPos;\nuniform float time;\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat random3_2nd(vec3 p, float time){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    float f = o4.y * d.y + o4.x * (1.0 - d.y);\n    return f;\n}\nfloat fbm(vec3 p,float time)\n{\n  mat2 m=mat2(cos(time),-sin(time), sin(time),cos(time));\n  float f = 0.0;\n  vec3 c = p;\n  f += 0.5000*random3_2nd(c,time); c = c*2.02;c.xy=m*c.xy;\n  f += 0.2500*random3_2nd(c,time); c = c*2.03;c.zx=m*c.zx;\n  f += 0.1250*random3_2nd(c,time); c = c*2.01;c.yz=m*c.yz;\n  f += 0.0625*random3_2nd(c,time);\n  return f/0.9375;\n}\nfloat get_inner_clouds (vec3 p, float time) {\n  float f = fbm(p*100.0,time); // tuned parameter 100.0, make clouds smaller\n  f = f * f;\n  return smoothstep(0.0, 1.0, f);\n}\nfloat get_clouds_mask_value (vec3 pos, float time) {\n  // random3_2nd, some tuned parameters\n  // 3.0 5.5 10.0\n  // 3.0, 5.6, 10.6\n  // 3.0 5.6 10.5\n  // 3.0 5.6 15.6\n  mat2 m=mat2(cos(time),-sin(time), sin(time),cos(time)); // use to rotate the different mask\n  vec3 p = pos;\n  float f0 = random3_2nd(p*3.0, time); // the large mask\n  p.xz = m*p.xz;\n  float f1 = abs(random3_2nd(p*5.6, time)); // the middle size mask\n  p.yx = m*p.yx;\n  p -= 0.3 * random3_2nd(p, time); // to make the shape different, tuned 0.3\n  float f2 = (random3_2nd(p*15.6, time)); // smaller clouds shape\n  float f = (f0+f1+f2)/2.0*(f0)*(f1); // 2.0 to control the size and density of the cloud, tuned magic parameter\n  // make cloud having more contrast, the hsbc contrast are applied here\n  f = (f - 0.5) * 2.5 + 0.5; // 2.5 is the contrast parameter, default 1.0\n  // f = f * f * 3.0;\n  // f = clamp(f,0.0,1.0);\n  return smoothstep(0.0, 1.0, f);\n}\n",_r=["uniform float fExposure;","uniform vec3 v3LightPosition;","uniform float g;","uniform float g2;","uniform float fOuterRadius;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","varying vec3 ncenter;","float getMiePhase(float fCos, float fCos2, float g, float g2)","{","return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(max(0.0, 1.0 + g2 - 2.0 * g * fCos), 1.5);","}","float getRayleighPhase(float fCos2)","{","return 0.75 + 0.75 * fCos2;","}","#include <logdepthbuf_pars_fragment>","varying float inspace;",br,"void main (void)","{","#include <logdepthbuf_fragment>","float fCameraHeight = length(cameraPosition - ncenter);","float fCos = dot(v3LightPosition, v3Direction) / length(v3Direction);","float fCos2 = fCos * fCos;","float rayleighPhase = getRayleighPhase(fCos2);","float miePhase = getMiePhase(fCos, fCos2, g, g2);","float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(max(0.0, 1.0 + 0.2 - 2.0*(-0.2)*fCos), 1.0);","float noisevalue = inspace > 0.0 ? get_clouds_mask_value(cloudPos, time) * inspace : get_inner_clouds(cloudPos, time);","vec3 color = rayleighPhase * c0 +","miePhase * c1 +","startDepth * sun * mix(vec3(0.05,0.05,0.1), vec3(1.0), noisevalue);","color = vec3(1.0) - exp(-fExposure*color);","float nightmult = clamp(max(color.x, max(color.y, color.z))*1.5,0.0,1.0);","gl_FragColor = vec4(color, nightmult);","gl_FragColor.a = fCameraHeight<=fOuterRadius ? nightmult + fOuterRadius - fCameraHeight : gl_FragColor.a;","}"].join("\n"),wr=["uniform vec3 v3LightPosition;","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","uniform sampler2D tDiffuse;","uniform mat4 EarthToWorld;","uniform mat4 WorldToEarth;","uniform bool showGroundCloud;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","const int nSamples = 3;","const float fSamples = 3.0;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","varying float inspace;","varying vec3 cloudPos;","attribute vec3 vBarycentric;","varying vec3 barycentric;","void main(void)","{","vec3 ncenter = (EarthToWorld * vec4(0, 0, 0, 1.0)).xyz;","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);","float fCameraAngle = dot(-v3Ray, translatedPosition) / length(translatedPosition);","float fLightAngle = dot(v3LightPosition, translatedPosition) / length(translatedPosition);","float fCameraScale = scale(fCameraAngle);","float fLightScale = scale(fLightAngle);","float fCameraOffset = fDepth*fCameraScale;","float fTemp = (fLightScale + fCameraScale);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","vec3 v3Attenuate;","float fHeight;","float fScatter;","float closeSurfaceDiff;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","closeSurfaceDiff = min(0.6 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));","fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);","fCameraOffset = clamp(fCameraOffset, -0.1, 0.1);","fScatter = fDepth*fTemp - fCameraOffset;","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","}","c0 = v3Attenuate;","c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vUv = uv;","if (showGroundCloud) {","vec3 earthPosition = (WorldToEarth * modelMatrix * vec4(position, 1.0)).xyz;","cloudPos = normalize(earthPosition);","float l = length(translatedCameraPosition) / fOuterRadius * 1.0;","l = l - 1.0;","inspace = clamp(l, 0.0, 1.0);","}","barycentric = vBarycentric;","#include <logdepthbuf_vertex>","}"].join("\n"),xr=["uniform float fNightScale;","uniform sampler2D tDiffuse;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","uniform float fExposure;","#include <logdepthbuf_pars_fragment>","varying float inspace;",br,"\n  varying vec3 barycentric;\n  uniform float coWireframe;\n  float getWireframeFactor () {\n    vec3 d = fwidth(barycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * 0.8, barycentric);\n    a3 = 1.0 - a3;\n    float edge = max(max(a3.x, a3.y), a3.z);\n    edge = edge * edge * edge;\n    return edge;\n  }\n  ","void main (void)","{","#include <logdepthbuf_fragment>","vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;","float noisevalue = inspace > 0.0 ? get_clouds_mask_value(cloudPos, time) * inspace : 0.0;","float shadowNoisevalue = inspace > 0.0 ? clamp(noisevalue * 2.5, 0.0, 1.0) : get_inner_clouds(cloudPos, time);","diffuseTex = mix(diffuseTex, diffuseTex * 0.5, shadowNoisevalue);","diffuseTex = mix(diffuseTex, vec3(1.0), noisevalue);","vec3 diffuseNightTex = diffuseTex * 0.1;","vec3 day = diffuseTex * c0;","vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);","vec3 color = c1 + day + night;","color = 1.0 - exp(-fExposure * color);","gl_FragColor = vec4(color, 1.0);","float edge = coWireframe > 0.5 ? getWireframeFactor() : 0.0;","gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), edge);","}"].join("\n");function kr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Or(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pr(e){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ar(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Sr(e,t){return!t||"object"!==Pr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mr(e){return(Mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Tr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}var Er={Kr:.0025,Km:.001,ESun:20,g:-.95,innerRadius:te*q,outerRadius:ee*q,wavelength:[.65,.57,.475],scaleDepth:.25},Cr={uniforms:{v3LightPosition:{type:"v3",value:new h.Vector3(1,1,1).normalize()},focus:{type:"v3",value:new h.Vector3(0,0,0)},v3InvWavelength:{type:"v3",value:new h.Vector3(1/Math.pow(Er.wavelength[0],4),1/Math.pow(Er.wavelength[1],4),1/Math.pow(Er.wavelength[2],4))},fInnerRadius:{type:"f",value:Er.innerRadius},fInnerRadius2:{type:"f",value:Er.innerRadius*Er.innerRadius},fOuterRadius:{type:"f",value:Er.outerRadius},fOuterRadius2:{type:"f",value:Er.outerRadius*Er.outerRadius},fKrESun:{type:"f",value:Er.Kr*Er.ESun},fKmESun:{type:"f",value:Er.Km*Er.ESun},fKr4PI:{type:"f",value:4*Er.Kr*Math.PI},fKm4PI:{type:"f",value:4*Er.Km*Math.PI},fScale:{type:"f",value:1/(Er.outerRadius-Er.innerRadius)},fScaleDepth:{type:"f",value:Er.scaleDepth},fScaleOverScaleDepth:{type:"f",value:1/(Er.outerRadius-Er.innerRadius)/Er.scaleDepth},g:{type:"f",value:Er.g},g2:{type:"f",value:Er.g*Er.g},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:2},time:{type:"f",value:0},EarthToWorld:{type:"m4",value:new h.Matrix4},WorldToEarth:{type:"m4",value:new h.Matrix4}},vertexShader_atmosphere:gr,fragmentShader_atmosphere:_r,vertexShader_ground:wr,fragmentShader_ground:xr},jr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.flatShading;return Ar(this,t),(e=Sr(this,Mr(t).call(this))).uniforms=Cr.uniforms,e.vertexShader=Cr.vertexShader_atmosphere,e.fragmentShader=Cr.fragmentShader_atmosphere,e.transparent=!0,e.extensions.derivatives=!0,e.side=h.BackSide,e.level=n,e.x=o,e.y=i,e.flatShading=a,e}return Tr(t,h.ShaderMaterial),t}(),Rr=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.map,o=r.level,i=r.x,a=r.y,s=r.flatShading,l=r.coWireframe,u=void 0!==l&&l,c=r.transparent,f=void 0!==c&&c,h=r.showGroundCloud,p=void 0===h||h;return Ar(this,t),(e=Sr(this,Mr(t).call(this))).uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){kr(e,t,r[t])})}return e}({},Cr.uniforms,{tDiffuse:{type:"t",value:n},coWireframe:{type:"f",value:null==u||!1===u?0:1},showGroundCloud:{type:"bool",value:p}}),e.vertexShader=Cr.vertexShader_ground,e.fragmentShader=Cr.fragmentShader_ground,e.transparent=f,e.extensions.derivatives=!0,e.level=o,e.x=i,e.y=a,e.flatShading=s,e}var r,n;return Tr(t,h.ShaderMaterial),r=t,(n=[{key:"map",set:function(e){this.uniforms.tDiffuse.value=e},get:function(){return this.uniforms.tDiffuse.value}},{key:"sun",set:function(e){this.uniforms.v3LightPosition.value.copy(e)},get:function(){return this.uniforms.v3LightPosition.value}},{key:"coWireframe",set:function(e){this.uniforms.coWireframe.value=null==e||!1===e?0:1},get:function(){return this.uniforms.coWireframe.value>.5}},{key:"showGroundCloud",set:function(e){this.uniforms.showGroundCloud.value=e},get:function(){return this.uniforms.showGroundCloud.value}}])&&Or(r.prototype,n),t}(),Lr=Cr.uniforms;function Ir(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Dr(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Dr(this,"queue",[]),Dr(this,"offset",0)}var t,r;return t=e,(r=[{key:"getLength",value:function(){return this.queue.length-this.offset}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"enqueue",value:function(e){this.queue.push(e)}},{key:"dequeue",value:function(){if(0!==this.queue.length){var e=this.queue[this.offset];return 2*++this.offset>=this.queue.length&&(this.queue=this.queue.slice(this.offset),this.offset=0),e}}},{key:"peek",value:function(){return this.queue.length>0?this.queue[this.offset]:void 0}},{key:"clear",value:function(){this.queue=[],this.offset=0}}])&&Ir(t.prototype,r),e}();function Nr(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Br(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ur(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Vr=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Fr(this,e),Ur(this,"_capacity",void 0),Ur(this,"_size",0),Ur(this,"waitQueue",new zr),Ur(this,"taskMap",new Map),Ur(this,"status","live"),Ur(this,"debug",void 0),this._capacity=t,this.debug=r}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.waitQueue.clear(),this.taskMap.clear(),this._capacity=0,this._size=0,this.status="dead",!0}},{key:"clear",value:function(){return this.waitQueue.clear(),this.taskMap.clear(),this._size=0,!0}},{key:"abortPending",value:function(){for(;!this.waitQueue.isEmpty();){var e=this.waitQueue.dequeue();if(void 0===e)break;e.onerror(new Error("[Dock] abortPending"))}return Promise.resolve()}},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();if(void 0===n)break;this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){t._size--}),r=this.capacity-this.size}}},{key:"act",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.onsuccess,o=t.onerror,e.abrupt("return",K(r(),3e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return"408"!==e.message&&console.error("act error",e),o(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Nr(i,n,o,a,s,"next",e)}function s(e){Nr(i,n,o,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=this,n=e.dockKey,o=e.asyncAction,i=this.taskMap.get(n);return void 0===i&&(i=new Promise(function(e,i){var a=new function e(t,r,n,o){Fr(this,e),this.dockKey=t,this.func=r,this.onsuccess=n,this.onerror=o}(n,o,function(t){"live"===r.status&&r.taskMap.delete(n),e(t)},function(e){"live"===r.status&&r.taskMap.delete(n),i(e)});t.waitQueue.enqueue(a)}),this.taskMap.set(n,i),this.fill()),i}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}])&&Br(t.prototype,r),e}();function Hr(e){return(Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gr(e,t,r){return(Gr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Kr(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Kr(e){return(Kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xr(e,t){return(Xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Yr,qr=U.ISMOBILE,Zr=function(e){function t(e,r){var n,o=r.sceneGraphRoot,i=r.name,a=void 0===i?"QuadLodTree":i,s=r.eventHandlers,l=r.maxLevel,u=void 0===l?20:l,c=r.minLevel,f=r.priorityRank,h=void 0===f?8:f,p=r.debug,d=void 0!==p&&p,v=r.planet,m=r.countryName,y=void 0===m?"US":m,g=r.showBBox,b=void 0!==g&&g,_=r.solidColorTexture,w=r.TreeMaterialType,x=void 0===w?ir:w,k=r.NodeMaterialType,O=void 0===k?Rr:k;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Hr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Kr(t).call(this,e,{sceneGraphRoot:o,name:a,eventHandlers:s,maxLevel:u,minLevel:c,priorityRank:h,debug:d,showBBox:b,TreeMaterialType:x,NodeMaterialType:O}))).sharedOptions.planet=v,n.sharedOptions.neighborFindingStats={time:0,number:0},n.sharedOptions.countryName=y,n.sharedOptions.solidColorTexture=_;var P=qr?1:2;n.sharedOptions.loadWorker=new pr(P),n.sharedOptions.picDecoder=new yr(qr?1:2),n.sharedOptions.dock=new Vr(qr?5:7,!1),n.nodeMap={},n.sharedOptions.nodeMap=n.nodeMap;var A,S,M,T=v.basemapName,E=v.mapMaxLevel;return n.sharedOptions.mapSettings=(M={maxLevel:E},(S=T)in(A={})?Object.defineProperty(A,S,{value:M,enumerable:!0,configurable:!0,writable:!0}):A[S]=M,A),n.root=new n.Node({parent:null,name:"Planet root",x:0,y:0,level:0,sharedOptions:n.sharedOptions}),n.nodeMap[n.root.nodeID]=n.root,n.numOfNodes++,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xr(e,t)}(t,qt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.sharedOptions.solidColorTexture=void 0,this.sharedOptions.loadWorker.destruct(),this.sharedOptions.loadWorker=void 0,this.sharedOptions.picDecoder.destruct(),this.sharedOptions.picDecoder=void 0,Gr(Kr(t.prototype),"destruct",this).call(this)&&e}},{key:"expand",value:function(e){var r=this;if(this.stop)return!0;var n=Gr(Kr(t.prototype),"expand",this).call(this,e);return e.nodes.forEach(function(e){r.nodeMap[e.nodeID]=e}),n}},{key:"prune",value:function(e){return!!this.stop||Gr(Kr(t.prototype),"prune",this).call(this,e)}},{key:"updatePlanetMap",value:function(){this.sharedOptions.dock.abortPending().then(function(){return Promise.resolve()}),this.traverse(this.root,function(e){e.updateMap()})}},{key:"changeMapMaxLevel",value:function(e){var t=e.level,r=e.name;if("number"==typeof t){var n=this.sharedOptions.mapSettings[r]?this.sharedOptions.mapSettings[r].maxLevel:1/0;this.sharedOptions.mapSettings[r]={maxLevel:t},t>n&&this.traverse(this.root,function(e){e.level>n&&e.level<=t&&e.sendDownloadRequest(r)})}}},{key:"updatePlanetWireframeVisibility",value:function(){this.traverse(this.root,function(e){e.updatePlanetWireframeVisibility()})}},{key:"updatePlanetGroundCloudVisibility",value:function(){this.traverse(this.root,function(e){e.updatePlanetGroundCloudVisibility()})}},{key:"_updateCameraPose",value:function(e){var r=e.camera;Gr(Kr(t.prototype),"_updateCameraPose",this).call(this,{camera:r});var n=this.sharedOptions.camInTree,o=q,i=q,a=Z,s=n.x/o,l=n.y/i,u=n.z/a,c=s*s+l*l+u*u-1;if(this.sharedOptions.cvX=s,this.sharedOptions.cvY=l,this.sharedOptions.cvZ=u,this.sharedOptions.vhMagnitudeSquared=c,!this.sharedOptions.pointsHelper){for(var f=[],p=0;p<8;++p)f.push(new h.Vector3);this.sharedOptions.pointsHelper=f}}}])&&Wr(r.prototype,n),t}();function Qr(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Jr(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Qr(i,n,o,a,s,"next",e)}function s(e){Qr(i,n,o,a,s,"throw",e)}a(void 0)})}}function $r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var en=(function(e,t,r,n,o){var i={};Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((Yr=function(){function e(t){var r=this,n=t.parent,o=t.name,i=t.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=n,this.name=o,this.sharedOptions=i,this.lifeState="empty",this._is404=!1,this.needsPrune=!1,this.shapeHolder=new h.Object3D,this.shapeHolder.name="LodNodeShapeHolder",this.contentHolder=new h.Object3D,this.contentHolder.name="LodNodeContentHolder",this.decoHolder=new h.Object3D,this.decoHolder.name="LodNodeDecoHolder",this.shapeHolder.add(this.contentHolder),this.shapeHolder.add(this.decoHolder),this.content=void 0,this.nodes=[],this.contentLoaded=new Promise(function(e,t){r._onContentLoadCompleted=e,r._onContentLoadFailed=t}),this._boundingBox=void 0,this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.debug&&console.log("destruct",JSON.stringify(this.info)),this.isInScene&&this._removeFromSceneGraph(),this._destroyBBox(),this.shapeHolder.remove(this.contentHolder),this.shapeHolder.remove(this.decoHolder),this.contentHolder.remove(this.content),this.content=void 0,this.parent=void 0,this.name=void 0,this.lifeState="expired",this._gpuUsage=void 0,this.sharedOptions={},this.nodes=void 0,this._visible=!0,this._isPlaceHolder=!1,!0}},{key:"preDownload",value:function(){var e=Jr(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"downloading",value:function(){var e=Jr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="downloading is not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"postDownload",value:function(){var e=Jr(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.sharedOptions&&this.sharedOptions.onTileDownloaded&&this.sharedOptions.onTileDownloaded(),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=Jr(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="cook not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Jr(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="defaultCooked not implemented",console.warn(t),e.abrupt("return",Promise.reject(new Error(t)));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){console.warn("digest not implemented")}},{key:"_computeEstimatedGpuUsage",value:function(){if(this.isRoot)return this.estimatedRootGpuUsage;var e=this.parent.estimatedGpuUsage*this.estimationCoefficient,t=this.maxGpuUsage;return isNaN(t)?e:e>t?t:e}},{key:"_computeEstimatedRamUsage",value:function(){return this.isRoot?4194304:this.parent.estimatedRamUsage*this.estimationCoefficient}},{key:"_computeEstimatedBBox",value:function(){console.error("_computeEstimatedBBox is not implemented.")}},{key:"_updateVisibility",value:function(){return!(this.is404||!this.estimatedBBox)&&this.sharedOptions.frustumInTree.intersectsBox(this.estimatedBBox)}},{key:"_updateScreenArea",value:function(){if(!this.visible)return 0;var e=new h.Vector3;this.estimatedBBox.getCenter(e);var t=new h.Vector3;this.estimatedBBox.getSize(t);for(var r=t.toArray(),n=0,o=1;o<3;o++)r[o]<r[n]&&(n=o);for(var i=1,a=0;a<3;a++)a!==n&&(i*=r[a]);var s=Math.max(e.distanceTo(this.sharedOptions.camInTree),Number.MIN_VALUE);return isNaN(this.fov)||(s=1.732*s*Math.tan(this.fov/180*Math.PI)),i/s/s/this.priorityRank}},{key:"_displayBBox",value:function(){if(this.showBBox&&!this.__box3helper&&this.boundingBox){var e=255<<this.level%3*8;this.__box3helper=new h.Box3Helper(this.boundingBox,e),this.sceneGraphRoot.add(this.__box3helper)}}},{key:"_destroyBBox",value:function(){this.__box3helper&&(this.sceneGraphRoot.remove(this.__box3helper),this.__box3helper.geometry.dispose(),this.__box3helper.material.dispose(),this.__box3helper=void 0)}},{key:"traverse",value:function(e,t){var r=!0;r=e(this,t)&&r;for(var n=0;n<this.nodes.length;n++)r=this.nodes[n].traverse(e,t)&&r;return r}},{key:"download",value:function(){var e=Jr(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.preDownload().then(function(e){return t.downloading(e)}).then(function(e){return t.postDownload(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onContentLoaded",value:function(e){var t=!0;return this.content?(console.warn("trying to assign content to a loaded tile",this,e),t=!1):(this.content=e,this.contentHolder.add(this.content),this.debug&&console.log("onload",JSON.stringify(this.info)),this.lifeState="loaded",this._onContentLoadCompleted(e)),t}},{key:"cameraChanged",value:function(){this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}},{key:"updateVisibility",value:function(){return this.visible}},{key:"displayByload",value:function(){this.debug&&console.log("displayByload",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.loaded&&!this.isInScene&&(e=this._addToSceneAsync()&&e):e=this._replaceParentAttempt()&&e,e):(console.error("not loaded but display attempt"),e=!1)}},{key:"displayByPrune",value:function(){this.debug&&console.log("displayByPrune",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.isInScene?e=!0:this.loaded?(this._addToSceneGraph(),e=!0):e=!1:function(e){for(var t=e;null!==t.parent;)t=t.parent;return t.loaded}(this)?function(e){for(var t=e.parent;null!==t;){if(t.isInScene)return t;t=t.parent}}(this)?e=!1:this.isInScene?e=!0:(this.loaded?this._addToSceneGraph():console.error("node is not loaded but descendants in scene"),e=!0):e=!1,e):e=!1}},{key:"_replaceParentAttempt",value:function(){var e=!1;if("loaded"!==this.lifeState)return console.error("not loaded but display atttempt"),!1;if(this.isRoot)console.warn("unreachable");else if(this.siblingsLoaded&&this.parent.isInScene){var t=this.parent.nodes;this.parent._removeFromSceneGraph();for(var r=0;r<t.length;r++)t[r]._addToSceneAsync();e=!0}return e}},{key:"_addToSceneAsync",value:function(){return this._addToSceneGraph(),this._beReplacedAttempt(),!0}},{key:"_beReplacedAttempt",value:function(e){var t=!0;if(!this.loaded)return console.error("not loaded but display atttempt"),!1;if(!this.isInScene)return console.error("not in scene but be replaced atttempt"),!1;if(0===this.nodes.length)t=!1;else if(this.nodes.length>0){if(this.childrenLoaded){this._removeFromSceneGraph();for(var r=0;r<this.nodes.length;r++)this.nodes[r]._addToSceneAsync();t=!0}}else console.error("node with unexpected number of children",this),t=!1;return t}},{key:"_addToSceneGraph",value:function(){var e=this.debug,t=!0;return"loaded"!==this.lifeState?(console.warn(JSON.stringify(this.info)+", content undefined, cannot add to scene"),t=!1):this.isInScene?(console.warn("Twice adding to scene attempt",this.info),t=!1):(this.sceneGraphRoot.add(this.shapeHolder),this._displayBBox(),e&&console.log("add to scene",this.info),void 0===this.gpuUsage&&console.error("gpuUsage is missing")),t}},{key:"_removeFromSceneGraph",value:function(){var e=!0;return this.isInScene&&this.content?(this.sceneGraphRoot.remove(this.shapeHolder),this._destroyBBox(),this.debug&&console.log("remove from scene",this.info),e):(console.warn("_removeFromSceneGraph fail",this),e=!1)}},{key:"setVisibility",value:function(e){console.warn("deprecated")}},{key:"resourceKey",get:function(){console.error("resourceKey undefined")}},{key:"expandable",get:function(){return!this.is404}},{key:"estimationCoefficient",get:function(){return 4}},{key:"maxGpuUsage",get:function(){}},{key:"estimatedRootGpuUsage",get:function(){return 4194304}},{key:"estimatedGpuUsage",get:function(){return void 0!==this.gpuUsage?this.gpuUsage:this._computeEstimatedGpuUsage()}},{key:"gpuUsage",get:function(){return this._gpuUsage},set:function(e){e>10485760&&console.warn("Unusual large chuck of size",e,this.resourceKey),this._gpuUsage=e}},{key:"estimatedRamUsage",get:function(){return void 0!==this.ramUsage?this.ramUsage:this._computeEstimatedRamUsage()}},{key:"ramUsage",get:function(){return this._ramUsage},set:function(e){this._ramUsage=e}},{key:"boundingBox",get:function(){return this._boundingBox},set:function(e){!e.isBox3||isNaN(e.min.x)||isNaN(e.min.y)||isNaN(e.min.z)||isNaN(e.max.x)||isNaN(e.max.y)||isNaN(e.max.z)?console.warn("Invalid boundingBox"):(this._boundingBox=e,this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0)}},{key:"estimatedBBox",get:function(){return this.boundingBox?this.boundingBox:this._computeEstimatedBBox()}},{key:"priorityRank",get:function(){return Math.max(1,this.sharedOptions.priorityRank)}},{key:"frustumInTree",get:function(){return this.sharedOptions.frustumInTree}},{key:"camInTree",get:function(){return this.sharedOptions.camInTree}},{key:"fov",get:function(){return this.sharedOptions.fov}},{key:"showBBox",get:function(){return this.sharedOptions.showBBox}},{key:"sceneGraphRoot",get:function(){return this.sharedOptions.sceneGraphRoot}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"info",get:function(){return{name:this.name}}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isPlaceHolder",get:function(){return this._isPlaceHolder},set:function(e){this._isPlaceHolder=e}},{key:"is404",get:function(){return this._is404},set:function(e){this._is404=e,e&&(this.traverse(function(t){t._is404=e,t.screenAreaNeedsUpdate=!0}),this.gpuUsage=10)}},{key:"visible",get:function(){return this.visibilityNeedsUpdate&&(this._visible=this._updateVisibility(),this.visibilityNeedsUpdate=!1),this._visible}},{key:"loaded",get:function(){return"loaded"===this.lifeState}},{key:"expired",get:function(){return"expired"===this.lifeState}},{key:"screenArea",get:function(){return this.screenAreaNeedsUpdate&&(this._screenArea=this._updateScreenArea(),this.screenAreaNeedsUpdate=!1),this._screenArea}},{key:"isInScene",get:function(){return!(null===this.shapeHolder.parent||void 0===this.shapeHolder.parent)}},{key:"siblingsLoaded",get:function(){for(var e=this.parent.nodes,t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}},{key:"childrenLoaded",get:function(){var e=this.nodes;if(e.length>0){for(var t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}return!1}}])&&$r(t.prototype,r),e}()).prototype,"setVisibility",[ye],Object.getOwnPropertyDescriptor(Yr.prototype,"setVisibility"),Yr.prototype),Yr),tn=function(e,t){var r;switch(t){case"standard":r=rn(e);break;case"phong":r=nn(e);break;default:console.warn("Unknown type",t),r=nn(e)}return r},rn=function(e){var t=Object.assign({},{opacity:1,map:null},{opacity:e.opacity,color:e.color,map:e.map,emissive:e.emissive,metalness:e.metalness,roughness:e.roughness,emissiveIntensity:e.shininess});return t.opacity<1?t.transparent=!0:t.transparent=!1,Zt(t)},nn=function(e){var t={opacity:1,emissive:new h.Color(1,1,1),color:new h.Color(1,1,1),map:null},r=Object.assign({},t,{opacity:e.opacity||e.d,emissive:e.emissive||n(e.Ka),emissiveMap:e.emissiveMap||n(e.map_Ka),color:e.color||n(e.Kd),map:e.map||e.map_Kd,specular:e.specular||n(e.Ks),specularMap:e.specularMap||e.map_Ks,shininess:e.shininess||e.Ns});function n(e){if(e&&e instanceof Array&&3===e.length)return new h.Color(e[0]/255,e[1]/255,e[2]/255)}return r.opacity<1?r.transparent=!0:r.transparent=!1,Zt(r)},on=function(e){return e instanceof Array?e.forEach(function(e){e.dispose()}):e.dispose(),!0},an=function(e){return e instanceof Array?e.forEach(function(e){t(e)}):t(e),!0;function t(e){["map","emissiveMap","specularMap"].forEach(function(t){e[t]&&(e[t].dispose(),e[t]=null)})}};function sn(e){var t=0;return e instanceof Array?e.forEach(function(e){t+=r(e)}):t+=r(e),t;function r(e){var t=0;return["map","emissiveMap","specularMap"].forEach(function(r){e[r]&&(t+=e[r].image.width*e[r].image.height*4)}),t}}function ln(e){return(ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function un(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cn(e,t,r){return(cn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fn(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function fn(e){return(fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hn(e,t){return(hn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pn=function(e){function t(e){var r=e.parent,n=e.name,o=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){return!t||"object"!==ln(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,fn(t).call(this,{parent:r,name:n,sharedOptions:o}))}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hn(e,t)}(t,en),r=t,(n=[{key:"destruct",value:function(){return this._material&&(on(this._material),this._material=void 0),cn(fn(t.prototype),"destruct",this).call(this)}}])&&un(r.prototype,n),t}();function dn(e){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mn(e,t,r){return(mn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=yn(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function yn(e){return(yn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bn=function(e){function t(e){var r,n=e.parent,o=e.x,i=e.y,a=e.level,s=e.name,l=void 0===s?a+" "+o+" "+i:s,u=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==dn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,yn(t).call(this,{parent:n,name:l,sharedOptions:u})))._level=a,r._x=o,r._y=i,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(t,pn),r=t,(n=[{key:"destruct",value:function(){return this._level=void 0,this._x=void 0,this._y=void 0,mn(yn(t.prototype),"destruct",this).call(this)}},{key:"level",get:function(){return this._level}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"minLevel",get:function(){return this.sharedOptions.minLevel}},{key:"camera",get:function(){return this.sharedOptions.camera}},{key:"expandable",get:function(){return mn(yn(t.prototype),"expandable",this)&&this.level<=this.maxLevel}}])&&vn(r.prototype,n),t}();function _n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var wn=function(){function e(t){var r=t.key,n=t.value,o=t.weight,i=void 0===o?100:o,a=t.gpuUsage,s=void 0===a?4194304:a,l=t.ramUsage,u=void 0===l?4194304:l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._key=r,this._value=n,this._weight=i,this._gpuUsage=s,this._ramUsage=u,(isNaN(s)||s<=0)&&console.warn("GpuUsage Error",this._key)}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this._key=void 0,this._value=void 0,this._weight=0,!0}},{key:"weight",get:function(){return this._weight}},{key:"gpuUsage",get:function(){return this._gpuUsage}},{key:"ramUsage",get:function(){return this._ramUsage}},{key:"value",get:function(){return this._value}},{key:"valid",get:function(){return console.warn("CacheEntry::valid not implemented."),!0}}])&&_n(t.prototype,r),e}();function xn(e){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function On(e,t,r){return(On="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Pn(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Pn(e){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function An(e,t){return(An=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sn=function(e){function t(e){var r,n=e.key,o=e.value,i=e.weight,a=void 0===i?100:i,s=e.gpuUsage,l=e.ramUsage,u=e.is404,c=void 0!==u&&u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Pn(t).call(this,{key:n,value:o,weight:a,gpuUsage:s,ramUsage:l})))._is404=c,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&An(e,t)}(t,wn),r=t,(n=[{key:"destruct",value:function(){return this._value=void 0,On(Pn(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this._value||this.is404}},{key:"is404",get:function(){return this._is404}}])&&kn(r.prototype,n),t}(),Mn=document.createElement("canvas"),Tn=Mn.getContext("2d");function En(e){return Mn.width=e.width,Mn.height=e.height,Tn.drawImage(e,0,0),Tn.getImageData(0,0,e.width,e.height)}function Cn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var jn,Rn=20037508.34278925,Ln=function(e){return e/Rn*180},In=function(e){var t=e/Rn*180;return 180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2)};function Dn(e,t,r,n){var o=e>0?e-1:0,i=function(e){var t=e.lngMin,r=(e.lngMax,e.latMin),n=e.latMax,o=e.zoom,i=180/Math.pow(2,o),a=Math.floor((t+180)/i),s=a,l=Math.floor((r+90)/i),u=Math.floor((n+90)/i);return{colMin:a,colMax:s,rowMin:l,rowMinPercent:zn(r,l,o),rowMax:u,rowMaxPercent:zn(n,u,o)}}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Cn(e,t,r[t])})}return e}({},function(e,t,r){var n=2*Rn/Math.pow(2,r),o=e*n-Rn,i=o+n,a=t*n-Rn,s=a+n;return{lngMin:Ln(o),lngMax:Ln(i),latMin:In(a),latMax:In(s)}}(t,Math.pow(2,e)-r-1,e),{zoom:o}));if(i.rowMin===i.rowMax)return Nn(n(o,i.colMin,Math.pow(2,o)-i.rowMax-1)).then(function(e){var t=parseInt(Math.pow(e.length,.5)),r=Math.max(0,Math.floor((1-i.rowMaxPercent)*t)),n=Math.min(t,Math.ceil((1-i.rowMinPercent)*t)),o=t,a=n-r;return{data:e.slice(r*o,n*o),height:a,width:o}});var a=i.colMin,s=Math.pow(2,o)-i.rowMin-1,l=Math.pow(2,o)-i.rowMax-1,u=n(o,a,s),c=n(o,a,l);return Promise.all([Nn(u),Nn(c)]).then(function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(e,2),r=t[0],n=t[1],o=parseInt(Math.pow(r.length,.5)),a=Math.max(0,Math.floor((1-i.rowMaxPercent)*o)),s=Math.min(o,Math.ceil((1-i.rowMinPercent)*o)),l=o,u=s+o-a,c=n.slice(a*l,o*l),f=r.slice(0,s*l),h=new Uint8Array(u*l);return h.set(c),h.set(f,c.length),{data:h,height:u,width:l}})}function zn(e,t,r){var n=180/Math.pow(2,r);return(e-(t*n-90))/n}function Nn(e){var t=new XMLHttpRequest;return t.open("GET",e,!0),t.responseType="arraybuffer",new Promise(function(e,r){t.onload=function(){if(200===t.status){var n=t.response,o=new Int16Array(n);o.length>0?e(o):r(new Error("404"))}else r(new Error("404"))},t.send()})}function Bn(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Un(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Bn(i,n,o,a,s,"next",e)}function s(e){Bn(i,n,o,a,s,"throw",e)}a(void 0)})}}function Fn(e){var t=e.textureUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4;if(window)var n=window.URL||window.webkitURL;return K(new Promise(function(e,r){var o=new h.TextureLoader;function i(e){"msSaveOrOpenBlob"in navigator||n&&n.revokeObjectURL&&n.revokeObjectURL(t)}o.setCrossOrigin("anonymous"),o.withCredentials=!0,o.load(t,function(t){i(),e(t)},function(e){},function(e){i(),r(new Error("404"))})}),r)}function Vn(e){return function(){return Un(regeneratorRuntime.mark(function e(t){var r,n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(i in r={},n=[],o=function(e){var o=Hn(t[e]).then(function(t){return r[e]=t,Promise.resolve()}).catch(function(t){return console.warn(t),r[e]=null,Promise.resolve()});n.push(o)},t)o(i);return e.abrupt("return",Promise.all(n).then(function(){return Promise.resolve(r)}));case 5:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Hn(e){return function(){return Un(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window&&(r=window.URL||window.webkitURL),n=new h.TextureLoader,e.abrupt("return",new Promise(function(e,o){n.load(t,function(n){r&&r.revokeObjectURL(t),n.wrapS=n.wrapT=h.RepeatWrapping,e(n)},void 0,function(e){o(e)})}));case 3:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Wn(e){return function(){return Un(regeneratorRuntime.mark(function e(t){var r,n,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:2e4,n=new Promise(function(e,r){var n=new Image;n.crossOrigin="Anonymous",n.onload=function(){e(En(n))},n.onerror=function(){r(new Error("404"))},n.src=t}),e.abrupt("return",K(n,r));case 3:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Gn(e,t){return function(){return Un(regeneratorRuntime.mark(function e(t,r){var n,o,i=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:2e4,o=t.download(r),e.abrupt("return",K(o,n));case 3:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Kn(e,t,r,n){return function(){return Un(regeneratorRuntime.mark(function e(t,r,n,o){var i,a,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>4&&void 0!==s[4]?s[4]:2e4,a=Dn(t,r,n,o),e.abrupt("return",K(a,i));case 3:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function Xn(e){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yn(e,t,r){return(Yn=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ro(o,r.prototype),o}).apply(null,arguments)}function qn(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Zn(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Qn(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Zn(i,n,o,a,s,"next",e)}function s(e){Zn(i,n,o,a,s,"throw",e)}a(void 0)})}}function Jn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function eo(e,t,r){return(eo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=to(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function to(e){return(to=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ro(e,t){return(ro=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function no(e){return e.level+"-"+e.x+"-"+e.y}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.JPEG=1]="JPEG",e[e.PNG=2]="PNG",e[e.BIL=3]="BIL"}(jn||(jn={}));var oo=function(e){function t(e){var r,n,o=e.parent,i=e.name,a=e.x,s=e.y,l=e.level,u=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Xn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,to(t).call(this,{parent:o,name:i,x:a,y:s,level:l,sharedOptions:u})))._geometry=void 0,n._material=void 0,n.tneighbors=[],n.bneighbors=[],n.lneighbors=[],n.rneighbors=[],n._mapResources=(Jn(r={},n.baseMapName,{level:-1,x:0,y:0}),Jn(r,n.demName,{level:-1,x:0,y:0}),r),n._cache=new Sn({key:n.resourceKey,value:{maps:{},geometry:{}},gpuUsage:262144,weight:1}),n.style={map:void 0,color:16777215,level:l,x:a,y:s},n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ro(e,t)}(t,bn),r=t,(n=[{key:"destruct",value:function(){this._clearNeighbors(),delete this.sharedOptions.nodeMap[this.nodeID];var e=eo(to(t.prototype),"destruct",this).call(this);return this._geometry&&this._geometry.dispose(),this._material&&this._material.dispose(),this.__wireframe&&(this.__wireframe.geometry.dispose(),this.__wireframe.material.dispose()),this._cache&&(this._cache=void 0),this._mapResources={},e}},{key:"downloading",value:function(){var e=Qn(regeneratorRuntime.mark(function e(){var t,r,n,o,i,a,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.baseMapName,r=this.baseMapURL,this.sendDownloadRequest(t,r),this.showDem)if(this.level>=2){for(n=2,o=this;n--;)o=o.parent;i=o.demName,a=o.demURL,o.sendDownloadRequest(i,a)}else s=this.demName,l=this.demURL,this.sendDownloadRequest(s,l);return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendDownloadRequest",value:function(e,t){var r=this;if(!this.sharedOptions.planet.showPlanetTexture)return Promise.resolve();if(this.expired)return Promise.resolve();if(!t||0===t.length)return Promise.resolve();if(this.hasMap(e))return Promise.resolve();var n=this.sharedOptions.mapSettings[e]?this.sharedOptions.mapSettings[e].maxLevel:1/0,o=e===this.demName;if(!(this.level<=n))return Promise.resolve();var i=t;this.sharedOptions.dock.queue({dockKey:i,asyncAction:function(){return r.expired?Promise.resolve():(o?r.planet.demWmtsTileURL.imageFormat===jn.BIL?Kn(r.level,r.x,r.y,r.planet.demWmtsTileURL._URLGenerator,2e4):Gn(r.sharedOptions.picDecoder,t,2e4):Fn({textureUrl:t},2e4)).then(function(t){return r.expired?Promise.resolve():(n=r.sharedOptions.mapSettings[e]?r.sharedOptions.mapSettings[e].maxLevel:1/0,r.level<=n&&r.onTextureDownloaded(e,t),Promise.resolve())}).catch(function(e){return"404"===e.message||"408"===e.message||console.warn(e),Promise.resolve()})}}).then(function(e){return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"408"===e.message||console.error(e),Promise.resolve()})}},{key:"onTextureDownloaded",value:function(e,t){if(!this.expired){if(this.hasMap(e))return;this.setMap(e,t);var r={level:this.level,x:this.x,y:this.y};this.traverse(function(t){var n=t._getMapResource(e);return n||console.warn(t),n.level<r.level&&t.redigest(t._cache),!0})}}},{key:"cook",value:function(){var e=Qn(regeneratorRuntime.mark(function e(t){var r,n,o,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.showDem&&(i=this.demName,n=this._findAncestorMapResource(i),r=this._getMapByResource(i,n),o=this.planet.demWmtsTileURL.demEncoding),e.abrupt("return",this.sharedOptions.loadWorker.requestMesh(this.level,this.x,this.y,{demImageData:r,demResource:n,demEncoding:o}).then(function(e){return a._cache.value.geometry=e,a._cache.value.gpuUsage=1048576,Promise.resolve(a._cache)}));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Qn(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Sn({key:this.resourceKey,value:{isPlaceHolder:!1},weight:1,gpuUsage:10,is404:this.is404}),console.warn("shouldnt reach here"),e.abrupt("return",Promise.resolve(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){this._cache=e,this.gpuUsage=e.gpuUsage;var t=e.value.geometry,r=t.position,n=t.index,o=t.boundingBox,i=t.barycentric,a=t.positionOffset;this.boundingBox=new h.Box3(Yn(h.Vector3,qn(o.min)),Yn(h.Vector3,qn(o.max))),this._geometry=new h.BufferGeometry,this.showDem?this._demUpdate(!0):this._geometry.addAttribute("position",new h.BufferAttribute(r,3)),this._geometry.setIndex(new h.BufferAttribute(n,1)),this._geometry.addAttribute("vBarycentric",new h.BufferAttribute(i,3)),this._material=new Rr({coWireframe:this.showPlanetWireframe,showGroundCloud:this.planet.showGroundCloud}),this._baseMapUpdate(!0);var s=new h.Object3D,l=new h.Mesh(this.geometry,this.material);return s.add(l),s.name=this.resourceKey,l.name=this.resourceKey,this.__mesh=l,this.__mesh.position.copy(a),l.frustumCulled=!1,this.__mesh.frustumCulled=!1,s}},{key:"_checkNaN",value:function(e,t){var r=!0,n=0;e.forEach(function(e,t){isNaN(e)&&(n++,r=!1)}),r||console.log("invalid",t,this,n)}},{key:"redigest",value:function(e){this.content&&(this._demUpdate(!1),this._baseMapUpdate(!1))}},{key:"updatePlanetWireframeVisibility",value:function(){this._material&&(this._material.coWireframe=this.showPlanetWireframe)}},{key:"updatePlanetGroundCloudVisibility",value:function(){this._material&&(this._material.showGroundCloud=this.planet.showGroundCloud)}},{key:"updateVisibility",value:function(){if(this.content)if(this.visibilityNeedsUpdate=!!this.isInScene||this.visibilityNeedsUpdate,this.visibilityNeedsUpdate){var e=eo(to(t.prototype),"updateVisibility",this).call(this);if(e){var r,n=q,o=q,i=Z,a=this.sharedOptions.cvX,s=this.sharedOptions.cvY,l=this.sharedOptions.cvZ,u=this.sharedOptions.vhMagnitudeSquared,c=this.sharedOptions.pointsHelper;for(c[0].set(this.boundingBox.min.x,this.boundingBox.min.y,this.boundingBox.min.z),c[1].set(this.boundingBox.min.x,this.boundingBox.min.y,this.boundingBox.max.z),c[2].set(this.boundingBox.min.x,this.boundingBox.max.y,this.boundingBox.min.z),c[3].set(this.boundingBox.min.x,this.boundingBox.max.y,this.boundingBox.max.z),c[4].set(this.boundingBox.max.x,this.boundingBox.min.y,this.boundingBox.min.z),c[5].set(this.boundingBox.max.x,this.boundingBox.min.y,this.boundingBox.max.z),c[6].set(this.boundingBox.max.x,this.boundingBox.max.y,this.boundingBox.min.z),c[7].set(this.boundingBox.max.x,this.boundingBox.max.y,this.boundingBox.max.z),r=0;r<c.length;++r){var f=c[r],h=f.x/n-a,p=f.y/o-s,d=f.z/i-l,v=-(h*a+p*s+d*l);if(!(v>u&&v*v/(h*h+p*p+d*d)>u))break}r===c.length&&(e=!1)}this.content.visible=e}else this.content.visible=this.visible}},{key:"updateMap",value:function(){var e=this.baseMapName,t=this.baseMapURL;this._createMapResource(e,{level:-1,x:0,y:0}),this.redigest(this._cache),this.hasMap(e)||this.sendDownloadRequest(e,t)}},{key:"hasMap",value:function(e){return this._cache&&this._cache.value&&this._cache.value.maps&&this._cache.value.maps[e]}},{key:"getMap",value:function(e){if(this._cache&&this._cache.value&&this._cache.value.maps)return this._cache.value.maps[e];console.warn("Cache not ready")}},{key:"setMap",value:function(e,t){this._cache&&this._cache.value&&this._cache.value.maps||console.warn("Cache not ready"),this._cache.value.maps[e]=t}},{key:"_computeEstimatedBBox",value:function(){if(this.level>1){var e=ur({level:this.level,x:this.x,y:this.y}),t=new h.Vector3(1/0,1/0,1/0),r=new h.Vector3(-1/0,-1/0,-1/0);return e.forEach(function(e){t.min(e),r.max(e)}),new h.Box3(t,r)}return 1===this.level?new h.Box3(new h.Vector3(-q,-q,-q),new h.Vector3(q,q,q)):0===this.level?new h.Box3(new h.Vector3(-q,-q,-q),new h.Vector3(q,q,q)):(console.error("unknow bbox"),new h.Box3(new h.Vector3(0,0,0),new h.Vector3(0,0,0)))}},{key:"_getMapResource",value:function(e){var t=this._mapResources[e];return{level:t.level,x:t.x,y:t.y}}},{key:"_setMapResource",value:function(e,t){this._mapResources[e].level=t.level,this._mapResources[e].x=t.x,this._mapResources[e].y=t.y}},{key:"_createMapResource",value:function(e,t){this._mapResources[e]=t}},{key:"_getMapByResource",value:function(e,r){return r.level<0?e===this.demName?t.DEFAULT_DEM_IMAGEDATA:this.sharedOptions.solidColorTexture:this.sharedOptions.nodeMap[no(r)].getMap(e)}},{key:"_demUpdate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.showDem)return!1;var r=this.demName,n=this._findAncestorMapResource(r),o=this._getMapResource(r);if(!t&&o.level>=n.level)return!1;var i=this,a=this.planet.demWmtsTileURL.demEncoding,s=this._getMapByResource(r,n);return s?this.sharedOptions.loadWorker.requestMesh(this.level,this.x,this.y,{demImageData:s,demResource:n,demEncoding:a}).then(function(t){if(!e.expired&&e._getMapResource(r).level<n.level){e._cache.value.geometry.position=t.position,e._cache.value.geometry.positionOffset=t.positionOffset,e._cache.value.geometry.barycentric=t.barycentric,e._cache.value.geometry.boundingBox=t.boundingBox,e._setMapResource(r,n),l();var o=t.boundingBox;e.boundingBox=new h.Box3(Yn(h.Vector3,qn(o.min)),Yn(h.Vector3,qn(o.max)))}}):console.error("No image data"),t&&l(),!0;function l(){var e=i._cache.value.geometry.position,t=i._cache.value.geometry.positionOffset;void 0===i._geometry.getAttribute("position")?i._geometry.addAttribute("position",new h.BufferAttribute(e,3)):(i._geometry.getAttribute("position").array.set(e),i._geometry.getAttribute("position").needsUpdate=!0),i.__mesh&&i.__mesh.position.copy(t);var r=i._cache.value.geometry.barycentric;void 0===i._geometry.getAttribute("vBarycentric")?i._geometry.addAttribute("vBarycentric",new h.BufferAttribute(r,3)):(i._geometry.getAttribute("vBarycentric").array.set(r),i._geometry.getAttribute("vBarycentric").needsUpdate=!0)}}},{key:"_baseMapUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.baseMapName,r=this._findAncestorMapResource(t),n=this._getMapResource(t);if(!e&&n.level>=r.level)return!1;this._setMapResource(t,r);var o=this._getMapByResource(t,r),i=function(e){var t=e.level,r=e.x,n=e.y,o=e.mapResource,i=e.segment,a=void 0===i?32:i,s=e.showDem;o.level<0&&(o={level:0,x:0,y:0});for(var l,u,c=[],f=[],h=Math.pow(2,t),p=Math.pow(2,o.level),d=0;d<=a;d++)l=cr(h,r,n,1-d/a,d/a),u=fr(p,o.x,o.y,l.u,l.v),c.push(u.u),f.push(u.v);var v=0,m=(a+1)*(a+1)*2;s&&(m+=4*(a+1)*2);for(var y=new Float32Array(m),g=0;g<=a;g++)for(var b=0;b<=a;b++)y[v=2*((a+1)*g+b)]=c[b],y[v+1]=f[g];if(s){var _=v+2,w=0,x=0;for(x=0;x<=a;x++)y[_++]=c[x],y[_++]=f[w];for(w=a+1,x=0;x<=a;x++)y[_++]=c[x],y[_++]=f[w];for(x=0,w=0;w<=a;w++)y[_++]=c[x],y[_++]=f[w];for(x=a+1,w=0;w<=a;w++)y[_++]=c[x],y[_++]=f[w]}return y}({level:this.level,x:this.x,y:this.y,mapResource:r,showDem:this.showDem});this._material.map=o,this._material.needsUpdate=!0,e?this._geometry.addAttribute("uv",new h.BufferAttribute(i,2)):(this._geometry.attributes.uv.array.set(i),this._geometry.attributes.uv.needsUpdate=!0)}},{key:"_clearNeighbors",value:function(){this.tneighbors.length=0,this.bneighbors.length=0,this.lneighbors.length=0,this.rneighbors.length=0}},{key:"_findTopologyNeighbor",value:function(){this._clearNeighbors();var e,t=this.level,r=this.x,n=this.y,o=Math.pow(2,t);0!==n&&(this._nodeExist(t,r,n-1)?this._findNeighborInChildren(this.sharedOptions.nodeMap[no({level:t,x:r,y:n-1})]):this._findNeighborInParent({level:t,x:r,y:n-1})),this.y!==o-1&&(this._nodeExist(t,r,n+1)?this._findNeighborInChildren(this.sharedOptions.nodeMap[no({level:t,x:r,y:n+1})]):this._findNeighborInParent({level:t,x:r,y:n+1})),e={level:t,x:r-1>=0?r-1:r-1+o,y:n},this._nodeExist(e.level,e.x,e.y)?this._findNeighborInChildren(this.sharedOptions.nodeMap[no(e)]):this._findNeighborInParent(e);var i=r+1<o?r+1:r+1-o;e.x!==i&&(e={level:t,x:i,y:n},this._nodeExist(e.level,e.x,e.y)?this._findNeighborInChildren(this.sharedOptions.nodeMap[no(e)]):this._findNeighborInParent(e))}},{key:"_findNeighborInChildren",value:function(e){var t=this._isNeighbor(e);if(0===e.nodes.length)t.top&&this.tneighbors.push(e),t.bottom&&this.bneighbors.push(e),t.left&&this.lneighbors.push(e),t.right&&this.rneighbors.push(e);else if(t.isNeighbor)for(var r=0;r<e.nodes.length;++r)this._findNeighborInChildren(e.nodes[r])}},{key:"_findNeighborInParent",value:function(e){for(var t=e.level,r=e.x,n=e.y,o=this._getParent(t,r,n);null!==o;){if(this._nodeExist(o.level,o.x,o.y)){var i=this.sharedOptions.nodeMap[no(o)],a=this._isNeighbor(o);if(a.top&&this.tneighbors.push(i),a.bottom&&this.bneighbors.push(i),a.left&&this.lneighbors.push(i),a.right&&this.rneighbors.push(i),a.isNeighbor)break}o=this._getParent(o.level,o.x,o.y)}}},{key:"_nodeExist",value:function(e,t,r){return!!this.sharedOptions.nodeMap[no({level:e,x:t,y:r})]}},{key:"_getParent",value:function(e,t,r){return 0===e?null:{level:e-1,x:Math.floor(t/2),y:Math.floor(r/2)}}},{key:"_isNeighbor",value:function(e){var t={isNeighbor:!1},r=no(e.level,e.x,e.y);if(this.nodeID===r)return t;var n=Math.pow(2,this.level),o=this.x/n,i=(this.x+1)/n,a=this.y/n,s=(this.y+1)/n,l=Math.pow(2,e.level),u=e.x/l,c=(e.x+1)/l,f=e.y/l,h=(e.y+1)/l;return h===a&&p(o,i,u,c)&&(t.top=!0,t.isNeighbor=!0),f===s&&p(o,i,u,c)&&(t.bottom=!0,t.isNeighbor=!0),c!==o&&c-1!==o||!p(a,s,f,h)||(t.left=!0,t.isNeighbor=!0),u!==i&&i-1!==u||!p(a,s,f,h)||(t.right=!0,t.isNeighbor=!0),t;function p(e,t,r,n){return!(t<=r||n<=e)}}},{key:"_findAncestorMapResource",value:function(e){return this.isRoot?this.hasMap(e)?{level:0,x:0,y:0}:{level:-1,x:0,y:0}:this.hasMap(e)?{level:this.level,x:this.x,y:this.y}:this.parent._findAncestorMapResource(e)}},{key:"resourceKey",get:function(){return"PlanetTile-"+this.nodeID}},{key:"baseMapName",get:function(){return this.sharedOptions.planet.wmtsTileURL.mapName}},{key:"baseMapURL",get:function(){return this.sharedOptions.planet.wmtsTileURL.url(this.level,this.x,this.y)}},{key:"demName",get:function(){return this.planet.demWmtsTileURL.mapName}},{key:"demURL",get:function(){return this.planet.demWmtsTileURL.url(this.level,this.x,this.y)}},{key:"nodeID",get:function(){return no(this)}},{key:"planet",get:function(){return this.sharedOptions.planet}},{key:"estimationCoefficient",get:function(){return 1.2}},{key:"estimatedRootGpuUsage",get:function(){return 262144}},{key:"priorityRank",get:function(){return this.sharedOptions.priorityRank*Math.log(this.level+2)/2.302585092994046}},{key:"geometry",get:function(){return this._geometry}},{key:"material",get:function(){return this._material}},{key:"showDem",get:function(){return this.sharedOptions.planet.showDem}},{key:"showPlanetWireframe",get:function(){return this.sharedOptions.planet.showPlanetWireframe}}])&&$n(r.prototype,n),t}();oo.DEFAULT_DEM_IMAGEDATA=(0,1,137,256,256,Mn.width=256,Mn.height=256,Tn.fillStyle="rgb(\n    ".concat(0,",\n    ").concat(1,",\n    ").concat(137,")"),Tn.fillRect(0,0,256,256),Tn.getImageData(0,0,256,256));var io=oo,ao=null;function so(){var e;return ao||(e=new h.TextureLoader,ao=new Promise(function(t,r){e.load("../public/img/UV_Grid_Sm.jpg",function(e){e.wrapS=e.wrapT=h.RepeatWrapping,t(e)},void 0,function(e){r(e)})})),ao}function lo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40,n=new Uint8Array(3);n[0]=e,n[1]=t,n[2]=r;var o=new h.DataTexture(n,1,1,h.RGBFormat);return o.needsUpdate=!0,o}function uo(e){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function co(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fo(e,t,r,n){return(fo="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=po(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function ho(e,t,r){return(ho="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=po(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function po(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vo(e)););return e}function vo(e){return(vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mo(e,t){return(mo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yo=function(e){function t(e){var r,n=e.earthEntity,o=e.scale;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==uo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,vo(t).call(this,n));var i=function(e,t,r){for(var n=le(0,0,0),o=n.minX,i=n.minY,a=n.maxX,s=n.maxY,l=new Float32Array(50697),u=new Uint32Array(99840),c=new Float32Array(33798),f=(a-o)/r,p=(s-i)/r,d=Math.pow(2,0),v=Math.pow(2,0),m=1*v/d-0,y=0*v/d-0,g=1/r*v/d,b=[],_=[],w=[],x=[],k=0;k<=r;k++)b.push(a-k*f),_.push(i+k*p),w.push(m-k*g),x.push(y+k*g);var O=0,P=0,A=null,S=(e-1)*t;A=me.wgs842Ecef(-90,0,S);for(var M=0;M<=r;M++)l[O]=A.x,l[O+1]=A.y,l[O+2]=A.z,O+=3,c[P]=m,c[P+1]=y,P+=2;for(var T=0;T<=r;T++)for(var E=0;E<=r;E++)A=me.webMercator2Ecef(b[E],_[T],S),l[O]=A.x,l[O+1]=A.y,l[O+2]=A.z,O+=3,c[P]=w[E],c[P+1]=x[T],P+=2;A=me.wgs842Ecef(90,0,S);for(var C=0;C<=r;C++)l[O]=A.x,l[O+1]=A.y,l[O+2]=A.z,O+=3,c[P]=m-r*g,c[P+1]=y+r*g,P+=2;for(var j=0,R=0;R<130;R++)for(var L=0;L<r;L++){var I=129*R+L,D=129*(R+1)+L,z=D+1,N=I+1;u[j++]=I,u[j++]=D,u[j++]=z,u[j++]=z,u[j++]=N,u[j++]=I}var B=new h.BufferGeometry;return B.addAttribute("position",new h.Float32BufferAttribute(l,3)),B.addAttribute("uv",new h.Float32BufferAttribute(c,2)),B.setIndex(new h.BufferAttribute(u,1)),B}(ee,o,128);return r.material=new jr,r.mesh=new h.Mesh(i,r.material),r.mesh.name="Atmosphere mesh",r.sceneNode.name="Atmosphere Class",r.sceneNode.add(r.mesh),r.height=0,r._speedPara=2,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mo(e,t)}(t,W),r=t,(n=[{key:"animate",value:function(e){if(this._lastTime&&this._speedPara>0){var r=(e.currentTime-this._lastTime)/1e3;this.material.uniforms.time.value+=r*this._speedPara}this._lastTime=e.currentTime,ho(vo(t.prototype),"animate",this).call(this,e)}},{key:"destruct",value:function(){return this.sceneNode.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh=null,ho(vo(t.prototype),"destruct",this).call(this)}},{key:"visible",get:function(){return ho(vo(t.prototype),"visible",this)},set:function(e){this.sceneNode.visible=e,function(e,t,r,n,o){if(!fo(e,"visible",r,n||e))throw new Error("failed to set property")}(vo(t.prototype),0,e,this)}}])&&co(r.prototype,n),t}();function go(e){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wo(e,t,r,n){return(wo="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=Oo(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else xo(n,t,r);return!0})(e,t,r,n)}function xo(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ko(e,t,r){return(ko="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=Oo(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Oo(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Po(e)););return e}function Po(e){return(Po=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ao(e,t){return(Ao=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}for(var So=function(e){function t(e,r){var n,o=r.name,i=void 0===o?"PlanetEntity":o,a=r.forest,s=r.planet,l=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["name","forest","planet"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==go(t)&&"function"!=typeof t?_o(e):t}(this,Po(t).call(this,e,{name:i}))).sceneNode.name=i+" sceneNode",n.earthTreeOptions=l,n.planet=s,n._maxAnisotropy=l.maxAnisotropy,n.visible=n.planet.visible,n._useTexture=n.planet.showPlanetTexture,n.northCap=null,n.southCap=null,n.atmosphere=null,n._treeNode=new h.Object3D,n._treeNode.name="_treeNode",n.sceneNode.add(n._treeNode),n._tree=null,n._forest=a,n.planet.entity=_o(n),Lr.EarthToWorld.value=n.sceneNode.matrixWorld,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ao(e,t)}(t,Rt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest&&this._forest.remove(this._tree),e=this._tree.destruct()&&e,this._tree=null),this.atmosphere&&(this.atmosphere.destruct(),this.atmosphere=void 0),this.sceneNode.remove(this._treeNode),this.sceneNode.remove(this.northCap),this.sceneNode.remove(this.southCap),e=ko(Po(t.prototype),"destruct",this).call(this)&&e,this.earthTreeOptions=void 0,this.renderItems=void 0,this._treeNode=void 0,this._forest=void 0,v.disposeMesh(this.northCap),v.disposeMesh(this.southCap),this.northCap=void 0,this.southCap=void 0,this._solidColorTexture.dispose(),this._solidColorTexture=void 0,e}},{key:"import",value:function(){var e=this,t=this;return t._solidColorTexture=lo(),t._tree=new Zr(io,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){xo(e,t,r[t])})}return e}({sceneGraphRoot:t._treeNode,name:"Earth Tree",solidColorTexture:t._solidColorTexture,showBBox:!1,planet:this.planet},this.earthTreeOptions)),t._tree.visible=this.visible,this._forest&&this._forest.add(t._tree),t._tree.initialized.then(function(){return e.initUI()}).then(function(){return t.initOptionalItems()}).then(function(){return Promise.resolve(t)})}},{key:"initUI",value:function(){var e=this,t={polar:"south",imageUrl:"south"};return r({polar:"north",imageUrl:"north"}).then(function(n){return n.name="northCap",e.northCap=n,e.sceneNode.add(n),r(t)}).then(function(t){return t.name="southCap",e.southCap=t,e.sceneNode.add(t),Promise.resolve()}).then(function(){return e.atmosphere=new yo({earthEntity:e,scale:q}),Promise.resolve()}).catch(function(e){return console.warn("PlanetEntity initUI error:",e),Promise.resolve()});function r(t){for(var r,n=t.polar,o=t.imageUrl,i="north"===n,a=Math.pow(2,6),s=J/2,l=-s,u=s,c=i?s:-s,f=me.wgs842Ecef(i?90:-90,0,0),p=(u-l)/a,d=new Float32Array(9*a),v=new Float32Array(6*a),m=0;m<a;m++){d[9*m]=f.x,d[9*m+1]=f.y,d[9*m+2]=f.z,v[6*m]=.5,v[6*m+1]=.5;var y=i?m:(m+1)%a,g=me.webMercator2Ecef(l+p*y,c,0);d[9*m+3]=g.x,d[9*m+4]=g.y,d[9*m+5]=g.z,v[6*m+2]=.5+.5*Math.cos(2*Math.PI*y/a),v[6*m+3]=.5+.5*Math.sin(2*Math.PI*y/a);var b=i?(m+1)%a:m,_=me.webMercator2Ecef(l+p*b,c,0);d[9*m+6]=_.x,d[9*m+7]=_.y,d[9*m+8]=_.z,v[6*m+4]=.5+.5*Math.cos(2*Math.PI*b/a),v[6*m+5]=.5+.5*Math.sin(2*Math.PI*b/a)}var w=new h.BufferGeometry;return w.addAttribute("position",new h.BufferAttribute(d,3)),w.addAttribute("uv",new h.BufferAttribute(v,2)),function(t){return(n=o,new Promise(function(e,t){var r;r="north"===n?"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAdAABAQEBAQEBAQAAAAAAAAAAAAECAwQFBgcBAQEBAQEAAAAAAAAAAAAAAAABAgMEEAEBAAICAgIBBAIBBQAAAAAAARECITESA0FRBGEiMhNxBYGhwUIjBhEBAQEBAQEAAwEAAAAAAAAAAAERAjEhQVESA//aAAwDAQACEQMRAD8A9/qnu/3X5l9nsn/o1vT6s/1l9ms00/8AVrOH0Px/xPR+J6/HSTWTuxz/ADvZ7tfT5fjzynzW71vyMY+R/s/wfV+N6pdtvLHNr8d+f7dfZ7rdOZnh9H/cfkfk+d139lsver4vEvHz8PT/AJc5Ncu6VFtR0rmAAKIoqCiEY22Xa4c9qlrUhawtrNrNq4uTLHkTNqauLtblvSJ4t6xYlSy1rWYa4Z8pGkaSs3dm7ouOiVjzx2XfJo1lLamTIJSzgysuUWOWcVo9mmOYkvAqmeEvSS/CC5WVkzc4po1bglQnBpjS8JnKWqjfayOetrXlVGjhMog0YjOTyUarO2uWvKJ5QHK6UuuI3vtnpzxte2asSZMNYwzcopFTKXZBfJMoCmUBAAFAAAyA/p3t/wBlr6tNtvZ7L44fI0/+k/I9Ot00/fptb39Mfma6fmba6+y3TWfykfL/ANl6/wAb0ezx/F2u2uPn7TjiWsddWOf5v5m35Xs223mLl5VvPfaV6Mk+Rz9QFQRUFALwxtsDeYl2crul3S1cdNtpXPas3ZPJnWpC1nbbhLvm4LEqr6+XSas6Y1jXlSFa4iX2MeSzmLrOL/ZmJdk4hf0NXDJlBNVbys6YWUMaMpbwmVRrFJNsktTyuUVrabWdMSWOnlcM3blRi7cou11+lm2tnSaGUal1+kuPgVAWIJLlUFRqKzF+AxchOhUAyAnJhVyDOBbWbUIM1crwNOdjOHbETxiYa48q6eES6pYSsCiKiZXB4gmV7MLgES1rB4mD+l/7P8D8T0aX2+raZk/fMvxf5e+v9tmvOuX6P/6Db8bG+3p3vlt/KZfl7z21/jPm1n/T3EKcDq5iKgB0W4Y22TVNtnLbZbsxWbVkMmUTKNLWdtsRXOy2/olWGvNzXXOXONZBVymQFMoKmNcMcyqIpkAA5goCcAIuT5ZymTVx1ljG/aZwZyamLMWYrOLKLnM5FItAAAAAFQFFlW3hnmKaixcsy4b/AG1UTWpvw1Jou2utgrnOYl5a8eMRma7SpQxhLlrpLQSWnkcmKil2ymaYwZBi0/w34ZT+vCKzyuFxhYmFqLwuEw0i8JgBX6f/AH23489909FtxeXyP8tezffbe7bXOay3zMjj1dqANAzdsLa5bVLSF2ZtZtTLNrcis0yIqBQVEw0iCKACoAohkFAAABFAAADDPy0lBFAEMKoIqUBRAFAABAaQAGs8MZXKosbvTnlZuGJnnCbSzkvay/FRUlysSzHSwGuGbRAMhUgGblfJCQFsyi8gLCgIyRan+BX0M55EV1chFPgHPauVrpu5VmtREq1mstAiggCKAAYRUoAAAAC5QBRAFEyuQAACwARKoCKAAAAACoAogChkBEaQEKAKimAJlUAUCA3NZWbrhZcLa0yx+hJ9tSfKIpQAQ5akhQYo34xLJgHsBMujkpkTKVWN3Ouu3TlYjUYqYasTCVqJgvCliCIshQZFEVAAAAAAAQFAAAAiouQAAQVAAAAABFAAAAAAAAAAAioZBcJzFlbmssUc/JYzZ47YamE/Iq5Qio3MJdYnRlUTDWElXIpZhC2oC5S0Khj11nJaxltjHXLJnhm3kGqxtFtwzaixmmFEVmhQVApOQZqRqxEVDCiCAAAAgKAAAAABAVFSgAAAAIoCKAAAAAAgCgAAAIUAy3rthghBv2TNzGTKiEqoqgAAHABmRLtFmmbyv9UBz8k8nT+s/r4Sxdd9mZ26WOe3FdGG/hk03nybdiGWaqIomVTCKzaTJvMJrRWuMJr2RM/uBdkXZEEBM8igCAAAAAAAAAAAAAAAAAAAACooCAoIAAAAACI0gI18IsBFgfALBFAVAGliLVSrlfJgyqNXZm7VKiar1fDF7dJOHPZusRnBm5BloBMgUyhdaDWJtHL+OzprrszvptnIoxe8tW2RnOUGs5MJOFzgVKzW5zGbASVWY0gAgKAAAAAAAAAAAAAABgAUAAAABBUAAAABBUBRFBKp2AAAsAAVAFAlVFMCXgHq1vDNia7cNZjUYY2mGMum3LlZilWGUq4T5wy0SltSd4KDWtq7ViXDVssBnySb4vSS4q7TPMRV8v0XMsYiwgvwzhekyoYFEEwjSABFoIAAAAAAACEpYQFEUBUWAAoIKAgqACmARGqgCKgAAAAAAAAKAAAAYVYqJMrgURvXaeOIzrvi8vH6/dvO29fZdrb8M89zxq8PX5ZmSYrlrtw3rcN6zhvMdMZw7cbOW+uNgLPmI18M91FMI0nYM4JmNCKmCLgUEwoDOFBALABIUAAABMmQUAAVAEKoJSFTMBpWZeWoCqkaVKhWsJtqqazgs4ahUVhZ2l7UF26c46YyxeKBFSdqioKAgAGBUAABRFAVAFWVBUaLElUR48Lpbrf0FjlJ9dbXTWuvw5azMdJ1h0jnV0ty6byXX9XKN+WWolMXDMmK6w29fGTDXK3nCY5Z1/lXSxFSzhlus4AnIsLAQVLwAioAAiiKgAAJUnbSAozaeciDaMzY8jRqoZZ5UW0EQJw1KzkyaOmvLWcMa7yQ1zeaspjtpc1u4ctbhZs2zY3dY57S5xHTOYSZEc7ricsx03c2WoSm3IUGVKiKZVAAAAIoIoAAACgIqKINZ4ZawqV5L2ShHN1am1jpNrXKNRZWa7SrHOVuNxl116y66/ujnpZjCzMvDUZrHs9eLmMS84ei2Vx8MVLFlS8pVsxM/LPcRVUiAFBRErVSxBlcAioAAACC1kF8PJm+nZc2Nz2/Zg43TeJmzt2tlTGtTBiXhPKytTxhvIikvCWpKZRQTICzt0m3w5NSrKldosrnNmtdsVuVmx3nSxjTaVvqtMue/NwxZi4dd5nlz74RYIuMCKliLemcZFVBUEUAMAAAAUgsABcKiBeCAqyAo8axIri6KsqEWI6RuVzlXW8txmvRHSVz0sreZG5WLFsNbzippbstxKqOe85s+GJOcOvs6y56xmtRUawzRQFBKi1EGakjVjORVEECgAM2NICVmt2J4wGZtg7axqlnPDK4zjC2pazyCoZPlFBQEyZQTVbla8nKVY1qWPR6rh18+cV5ZvXWbZn6tysWO21Tw+Wc5dJyqOVvODHDW2uOWJeQhLxymGrEiKmBqxkABFAAAAFQBqCCotmScGQFyIWXCo8oK5OiLKAK1GYqwb12sddbby4x10vw3GLHSbWThJk1rfDTLGUkxTeY6JftBSwKKyq4KGspVwzv/GpVLtMds5n2wlZ/prHTM+y2fbl8lllxZip/RjpmfZmfbmH9GOoa/wAYrSIljWYzaDNiZ4aZqVdSzK44I1rhBzuJUv263TW8udlSqhVSioIIqrGVgjTetwxHTXFnLXLNdZ0TaxNeBtl11s2mHPx8dmvXcL/K5VGNyRvbTMZxhDU2Id8GMQVNiRPlqAxcykq7THKf4RVAAAAXKAKIqouVt4ZX4B5p0JRzbUAFWIQG466Ocb1uG4zXSrqx5NRplq4Z2n0lpNgJVNpxmJKDQCjOzHs/jW9o57z9tZvixyKO3r9c1n9vs6nUYk2tW4vp9WP3bd/Ea93q85mfyn/Vn1b32ezba/E4/R133xMTt25nN5z8MW3XiG/brz5T/lzlcOplx0l121/jCpreIZmW5WUpLL0b3j/LP8dp+pauNW4OE2vCbZ4ZtMazJ/yzbipdrMJtmmi+dXyzHPnOF+cJqqlLcM28pVgGftOUVoIKLlZsxmrklSx1m9dNOs1582ct/wBl8eGpWbHby54b0v24S7SZxw3N9rMycNzpmx38oWOWu2Zl01uWvWbGPCzbPwzds3D04ljzba3XfPwlmLKti/BmUvSKl5jGGkKEEEVRMqAAAqAKuUWRUeadDOVly5NmVLBQWIqjereXOVqVYzY3K35Ofwnk1qY3nK4wzq1dl1Mb1qbTF4Z8k22toOkS3DOaUFyz7P40lN8eFS+VYx6NdNvZJv1/3dvyddbed8Y61eadt32TbXx9nM+NvmJLMvP7Wy7rXpxNd8XK/B69PH17Z5zeKm20177+nSfOZvxn2s7Z+Hn2znjp0vstvPX0s8bHLvr+vG5MYm1kWbR18dfGYYvriSGs25vHwlt+a1rpYbafKYFsuuTfqMycYW88Cpt8FuP8mCyXkCcf5T/yMfqWZQTbuJ8teKfJViX4OfsphFJ0Xo+Fx8AJ9GF46EX4Jcak1/VcfCjeeHTS/tjlJmYb14mG4xW9P4x20mY4azjDrpthuM10025xT2aSnfJm/LTLhizYt5dNpO3LbthuBYTtb0DAiooACiAKIAq5ZUHlWXlJFjk23cWMg0iqgCxplYo3nhJ2mSLqY3lPJm1ZBGo3GZhctI0m/SZbkzMKMa1Nv40s8dl7/wAIOOeVrW2uv0vjrfhn+a1rGu+2ut1l4qOnhr9F01+jL+zY41OY63XX6Zus+kvNNXXbiHl9J4fRZYahnbK23CWs+RVAEUAARQERURRFQVRBAAEbi5YlF1G5WvJzlajUpXbXrLpry5yyR0045bjFdJwvDN+1y0yzteHLZvfKeOIlWMxYnyRFTbio1eWalBMiCtJlMmQaTJlYCGVrIOKyFgw2KiiACCiLFFEWKLFygMtZWVlY1BpvXPwxK3rtfhUTfW5zhM4jpdrhjyn0oxnJOF8tZelzr9JqmScr+2pIDNjLV7MIM22JnLVjFiLqVlpm8VBQ7EUAABAEBFARFUQAAAVFEI1KyLCuk2zXfW8PNHfS8OnNYsdtdskc5XTXpphZym/DUY9ijmLtPoZaSot6QolZaqIrItZQXLUrIK1blkAc85Exiqw0ogqKIAqoAqoKNCKIqxlYo1GpWFVHTMsc84p5YQqY1tMzM7SVJcLxRVi9JBQyGImEBmrWUVErScIM4WWLcJ4WglqJyqKFEFAEEARQABUUAAAARY667cOLUrUSu025ddN83DzeTfruOW5WbHqTeZjHnjDVvDbGOf6GG/GXlmosZQoipQTKKliYayAzzBqoioCVBnsIiKAgqiKAqKIqoKKACiAjULUyAs5axwzK1NlRE5KmbgG5cwykoouUtEAqKiKJhTKC+ML+jOUtFSpktTLKhlLUNFyIqKAAAAogCoAKAoEAiK1NqwuVlSx3024xW5eMOGrtLw6SsWOkvGEsyTpVRnxiYawzUol1Twa8vtLsipZGatrPIqUXCIqCpUGMjNWcstAAACixQEFRQFQUURQFQBQBABUWKyGi5MplMmq0lpazlNFyiZMpq4VKAM2o1ZlPGplWEXeTxRLmxNCKkmFFEAFEUAABUAVAAVBRSAI3LhrXbNc41rxWpUsenWtTFjlreGtb8OkrnXT4S65anSxUcLozY6783DF4uEsWM4xEasZsZaES1MooM3a5XKK52GWjDNVmVTgAABVRVQVFAAAABckQBQMguTLIqLlMgABUVMplMplNXGsiZAxQyfKjWszWt7rJidpt7NdZw5zO1zS2eJiTtdtcUkxVvKKztwkWzIgI3NcxnaeNCVFRYKAAAAAAoAAAg1GVWDtrtw1rtiuOta8m5WbHp02lb6rz+q4dfPnFblYsXeZ5c++HTap4fIMWMWN284TCKx4H9eWs4Wbcorlv6/pJHbGcudzLylmErkAy2mBcogAKKsSKIAAoAAAAAAAAACKAnJzU2uF165BJCxflKCFakS9pisi4RAxlf0QBWp0wsqwFnaazlfkHTWRj24wZZ25W+JJ9YlaJCstaCKAAAqAKgAKigAKhKsRYo3N66zbM/Vwb1uGuaxY75y6TlynRNrG9Zsa21xyxK662bTDn442sKRmxnWO10vjlzneEs+q1rGPbrZy663C7SbzBZsNyvEgOToHRQBUFGhIogAAqKAAAAAAAAAACYUAQKALNcrrM1rfaaa4X56lrne8JhNL8tfKetMWcrh0xKm8xDDWMJDa/RGRV7IKFmEXe5kwa/qCLg274IqJYy3WbEqgRUVBQEABRBQAAWAI1HTXFnLllZssqWPRrwOU3rpp1mtys46eu4Xu5c/LnhvW4uL20zY1nDPjLctWJnFKOdt13xW5cHt08pmdxz02zxe08X2PMA5OgAAfKwqiNIogAAACiAKIAoAAAIoAAAgKBLhjaXa8tmC/oSTCgDWuJMue212uPhrnCa6lGcF1w6zWN7aTxP5TXngnMpWWm5jHKXnplvSLPoWYF2ZVAX5S9gx8q1iJhFEUFQBABQEVAUBQIAlajc3uMObcaiV0047Xa5uYxK3ry1GW5tcL6+e3K3Fw6aXFX8s118cPNvPHd6+LHD3ac5i9ROa8YDi7ARQAVUQUQAAAAAFAABUAVAAVFAAAwAAZAAAAakjPs2k4ihmxf7LjDM6VNokxWPG5bkXxnZhrm1rvhbI5/LPi+tZtrVjM4XyWIp2hFFswl6bxnVgVAEVAEBUUBFQBUUADKorUZjUWI1GtbisStRqVLF3/dizt211l0/VxddNmozV13uvFdP5RjbWbTM7X15xitRmvAGV7cXYVFEAEAAAAAAABQAAAAAAABRFAAAAAAAyzjnLQUIBFBQgM7T4ZuuHRLMpmmuYt1wjPiz63rym3Ca3DW1lWBrU2IZVEARUARQAAAAABUBGosrDUWI1GsskaG5WpWI3OViN6bcu0mJl59eK9Ov8W+WK+bhcKOToiggAAAAAKIKAAAAAAAAAAAKgCgAAAAAAAAAKiwAAEvTle3W8sWYSkZWAkaqiC6ioCAAKAAAAAAAALKgI1lcsi6Y3l09blHTXaSNys10xy7ziOHrvy667NxivEA5OgAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAgCWKgMXhYtjPTLSgAAAAAAAAAAAAAAoIoAZayysqxHbSukuK46V0y6SsWOADDQAAAAAAAAAAAAAAKgAAAAAAKIoAAAAAAAACAACAqAAze2jCKyG0EUBMgpLk7QFEUAAAAAAFAAEUABUa1uHSXLjK15NSpYouCwGRUQAAAAAAAABQEUAEVAAAAAAAFQBQAAAAAEVABUAQQVcmQAAELGHSs4SxWb0jdjOExdGvHjLMjXlxgRiVUnbRFDKAKIoAAKIAEFABFFEUR//9k=":"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAggABAQEBAQEBAAAAAAAAAAAAAAECAwQFBgEBAQEBAAAAAAAAAAAAAAAAAAECAxABAQACAQQBAQMICAQHAQAAAAERAgMhMRIEQQVRExRhcbHRIlM0FTJygpKisiNzkaFCYvCBwVLCQzUzEQEBAQEBAQEAAAAAAAAAAAAAARECMSFB/9oADAMBAAIRAxEAPwD9ris+Vjeu0rXjKDOuzXeM+OF7A47cV8suHLpvrtmPbnqXXXbuDzcVtxl6PHMJpJ2bnQHn5fXm8w+d/LLx8t3j7FrO0liD4vNpya9mvS9nbXfx2r6O/DrtOzwbentOXy1B9S+PJx5c9OKy5c+LbbTXFdNeaZw1IlreLjDnvxXD0yyzLPJZNchr53JbpetdOCzbtXk9zmztZHb0OPfGaYa92ureEzhZmitdDGUsWIHjAAAFAAAAAAEIqIKACyrlgtBvyZu0+E7r4gnWp4t4UGJDbXMaysB4t7tx7ZdNOebdLXfk49dp1eXk9Wy51B3mL2quPDNpcV6ZjAMYalLE7A1kwzK0CVFpAErTAKAAEXAIqUgLhQBw1lldpsmISAtoiglhMqQAAAUBiyM2TLdjFBnbSOe3HPh2vVZIupjnr5w5NrdcO2JYl0hqY+Tv6223J5V9D19PHTGHaaa/Y1JPg1cZmrUjWIlFEAAAAAAACplcGAJS0wAigAAgItZBqLKgDSWpkBI0kaBOphTIM3SGK1agM9TLSXUEWVMANd0TKgJe5UsyB5C+JYAqSKCUyWIDcq4YlxXSA5LKvcxhQICAAACUFyuWQGmbqq5Biani2gJFBQIAGaAAAAAACZBpMGTIKJlMgomVyAAAAgGBKCpkwmAaRYuAYyspYSAuTJgknyBkMLgEMrgwBUw1WQLEarICpU6g3DDMq2gVILgFx0YsxWpU26gjWtZjQMS2NZylizsAYqVddooLBMoKBkDBQwCRTAAAoAIAAAAAAACgmFUGcGGkoJgVKAuEi5AwGUBciKgCKosS07IA1lmKgtRKZBcnczCbAvYtZtMguTKAFqS1qariAJhb0ICJhagGDCgIoUCJQAwZMoCrEsSA1YxjFbZ2BYGtWwElKlIDWqoAAKgAAAAAigAAAAAACglUsBDAWgCKAqKAISgplAAFBGkEErNbSwGZK1IswqiYSxUtQIqar3Bc4Z8lrOALcrEwuAVMFzFgLIWEUGMr3WwwDItSAhFsQGrGWspYAADMuK2xhqAuCTAAAKgAAAAAAAKAICooIAAAopQBDAZBMGFXAMrEqSg3hnC5QAFwCKJQUSNYAiUuydwAW9gTyE8asQMUjVTxUS1LSxZOgE7LOiCC25EigplDILKvdhrIFjLWWe4KYMKDMVrxTAM0XCWAYWRIuQLUydTAGSGFwoAAC4QAAQAFAEBUUBAAAUUQAQUEjUrFWUFrFbrIJMtQkKCiRQAUGWmMrkEpmi4AkWdBm3qDfRm3qW9EmAayvlGLmmAazKrMioCLIUEEqwFZrSWARUhQCCwBUJQaygAgoCYXAQDAlpFFBMgqVcs0Gp1LElaBkEBQAAEAAAAAQUFwLAQKgLYkitYBlmtJjIEpeq+J2AkwJkBS1CgzYsirQRnPVpj5BuGEXAJTC4S34BeixmRpAAoLEpkBmkKsBYVYzaCNRBRUVEFEUCKy1ACiUEyuWRRcmcJJSwGpSmpQQXBgEjXwi5BmmSpYDWSRmNyguGVyUEBcIISLgBLEaygArNUBYUEy1LlzpLYDoZZ8gF8kzkwuMAki24TKbARvHRiNygzhcLQGbCRqsgsMhgCUBAAAKZSgDMtqgtRUBciKAqKoAIAsAZajKwFKAJhZqGVFwlLsx5dQbhSVKCmUyk7gtRTAIsiYMguEwZWUDCXKylAXKEQVMqmAIZak6M2AsSxMrlQKZATB4rGgY8TDTNBclrFrWvUCdVusXszaCXoTZL1JrgFuzUZky0C5ZqXKgZWJglwC0BABMguCmTIJiRF7gM2rLlnbusvRUXIxaa7A38rEqZRWlZi5BoQBFgAokVREy1hnAJeqYbwYBnNjUPEAAAUnRroDF6s2OmOpYDEi4OxkFwRMmQKRUQXIiguUqZMqGEaliWASAAKhAWphUyCWEuCpJQatyli4KDM7t2dGcYq3boCXoSp3Aa6JlOtMA1lARFAFHO7yXq3a8XvTk8Ltp8A9ssrnyb4fO9H2+Ta+O718udp0VHTj5ZejtLHz+uvVvXnoPXZlcOenLLMr97KK1iJNeqTbJN+qDa4mEly1IDKW4aseXm5NptiA9OuzTy8e+3y76b5B0ShQFjKxRUW1AUMpkFqRMrKC1nOFtyzYC+RN8JhnaA3N289HKStAtSxqFBkXCYBYuEjU7AyKUGajSyAxi5bNklAsUSgGcJlO4LnKkKAvZJEoNZS1kBb2TFWNTGAYiVqzqSAzMtLiAghkiCgCsckuOjhdsy616bHPfSdweC+t47eWr1cGts/aTe4TTmkuFiOvJxSzo8u/Hdeseq8nRjbbXaKjw8ns7ccb9b25v0qe1weWl2nw8nBxbf0s4/IzfVj7et08cys77a46PHpvtrr42t6b23FXDXSc/jTb3ZqxtxXa9EvqZgPRxe3rv0dLprtcvn/c7ce3R69OT9jr3KO3hrhm/s049rsm8s61FehFQEMlIolpKtjINZS1FwApIoEhhYAM2NJQIUAMmUUDJUUEWUMAZMpSAqypUgN1lpmgGMo0CYVMqCLImFyBamEysBMLhamQS3Bk2iQFFgCAAKigAIDG86Ns2A4bcd26fa8947x7vfZ8uPJx+VyDN08tcuV12ldppvF21uFRjXWWYryb+pt97nXpq9WtsrpkR5567Xhiul3kc99/kHo4tZjq6WR5OPnzcO15cCxnn16Pm+xzbcfSPo7ck2jxe5wXbS7a9z8F9P3J08q9+/Lptpn4fG4eLWSftYv2PXpenhlIPrItQVKsCKFiYaATBhcmQRUyoCWlTGQWAAAAYXCAAABkMAVFwYBAWAsSrEoJlcs0lBrC4SVcglStVASRcL2TIFQMAlo1NSzAEEUAAAAABAAATCoBhnaNAOPhLW7rJCzDny8t10qo4clu22I1OG7fs1y4OXy5Osevl2xPKIseKf6fLh6dpLrmV5uXi22vlO9NeHmx3IL1mzvp47a2Xq4cmu0n5XPi5NpyYvZUZno73mu07PVr6lly9Gu2uGrczog6gCpRWQWVrLMiqJaZFx0BMrGflqAohaAIoAICwIAAAAILBFBCAoVKqAsMJnC5BMCymQSrKUAAAwsRQXyY2quHu/wfPf8As2/QBPa9X99x/wB6frX8X6v77j/v6/rflhB+q/F+r++4/wC/r+s/F+p++4/7+v635fTj35Nppx63fe9tZM1myy4vSzvAfqvxfq/vuP8Av6/rPxfqfvuP+/r+t+VAfr5ZtJdbmXtYPJ9K/gOL+1/mr1gAAJQoJlUjSozs53SbdK3tUkoOenBppbWrtrt+yzy7WRnj21zm9wdtOKfLO88ezX3kkeXl555Yphr0cfFrvOrny+vx69Z3deLeTWW/LPPt06A4cfJrNsbPXr47dnxfZ5Ntbbr3T1ff3lk2B94BFDAAqLlnKiqgCWKACKAkihaAmFAAcvb5/wAN6+/Njy8ZMT8tuAdB4L7nvcGn33s8Ot4vnwv7Wue2cpx+5794vxO/DreCzONbfOa/b1QfQV5PX96b+lfb5pNZrnMn5Lhz19n6ny6ffcXDpOO9dddrfKwHvHk0+o8W3qb+ztLrePpvp8zb7HKe19T+7/EfcafdY8vDN8/EH0Bz9f2NPZ4debj7bfF7y/YvNy6cPFty7/0dJmg2Pn6+z9T5NPvuPg0nHeuum1vnY6a+3y+x633vqaS8s2xvx7/GO/2KPXUjx+r7/Jz+1twb8f3d00ztL3m0smPzOvq+ztzc3sce2sk4dvGWfPfv/wAAenBI823t76+/p6vjPHbTyu3z8/qefb3/AHfxe3racWnlM3TyuPLX4sB9Jx4fZ4ue7zjz/p7eO2ZjrGPX5Pe23x7HFpppjvrc3Ljw+1z82nPeHj1+849/HWdpt170HsnLx7a3bXabTXvi5xhn1+fj9jjnLx58bmTPTs+Z9L25/Dnl1n3d22u22es2x2en6P8AwOn59v0oO/s+7wer4/fWzzzjEz2dpZZLOsvWV8vfin1D3+eXrx8Ol49b/wB1+f8Ajl6fpXNeT1Zpv/T4bePafm7A9jh7v8Hz/wBTb9Du4e9/B8/9Tb9Cj8ud+k7j2+jwXWz2NulnXj/WSW3IluTX1vpP0/8AC8f3vJP9fedf+2f+39bj9X+mfeZ9ngn+pOvJpP8Aqn2z8r3et7WvJpjk2k3nfPTLxfVPa5PT9zg5+Prrtrdd9fjaS5/9Syz0l18EfU+oenx83F/MPT68e3Xk0n/Tfm4/S+Wiv0n0r+A4v7X+avW8n0r+A4v7X+avWAABWLltLAZlXODGC4sVHPfb7Hl/HeHJ4bR6rq4cnq67bTbHUHTe+euY4zpXp11k0w57ceeyxKlvlriPPy8G1/aejSeN6u18dtewPnTl5ZjW9o9E389cXu1vx6157fCgzy+tbLcPJeCzbth9Lj5ptMU34tdp0B7wGWgAEpFAAFAAAAAAARQHk+q/wHL/AGf82r1ufscGvscO3DvbNdsZs79LkHL6h/Ac39U9T+A4v9ufodebh15uHbh2tmu0xbO68fFrx8OvDrbdddfGW98IPj667bfQ7j43zfzeT7HBtrtwce2v9G6zH/Bj1/V4uDg/DzO2lzny+cvN/K/GXTi9jl4+K/8A1y9OoOPrcvDpy+9zckz6/nPjymc34fTm+l45vLPCzMvxjDnxepwcXBfX11/07nyl+c/a838qmPu5z8s4L/8AXnpj7AT6Ln8Nvf8AovJbr+bEd/qPHpyepvryb/d6dLd8eXa/ZHS+txfh762s8eO6+PTvinF6/HxevPX/AKXHJZfL5l+0Hl4/W9y8et4/dzpZPHHHr2+HP6RNvP2rdvOXfHn28r1zXT+VyS6cfscunFe/HL0evg4OP1+OcXFMaz/nftoPHx//ALPL/tT/AOKfTtp+M93T5884/JnZ6562k9rb2pb57a+Nnxj/AMRx2+mcV335dN99OXfa7eetxZnvPzA58n/7XF/tX/5O3vep+I0m2l8efj68e/5fsPW9DTg5Nubbfbl5dpi77/Yxv9Nm292/Ec08rbibdJkG/R9z8RpdOSePPx9OTT/1cfpXf2v92t8H03j4Oec85N995mXysuczHXo3r6OmnHy6acm+v323ndpcWXPwDz/S/wD+Hs/7m36E9HmnB9JvLf8Ap8sfnz0ez1vU4/W4bxaW2bW3ba97a5X6bw31Z6vntOObeWemb/yB5PQ9X6hrwTk4uXXScv7dm2ub+hr1pzep9RvHz7Tb8TM+UmJ5R9TXWa6zXXpNZiT8kcvZ9Tj9i8e21uu3FfLXbXuDs4e9/B8/9Tb9Du4e9/B8/wDU2/Qo/NcM47y6/eXGmer60xiY7fGHxnXh9nk4b066/Ot7NcdZ6x1zr6jX1Li4uX1/V25N/CSWZ/8AKfqceHn4+afs3G3zre71e1623tehwyba6Tj2t3327a6zOa139ksTj5bGfpXH6/FyXXi9mcnnOvD064+XzPqXH6/H7e+vr3OneydtdvmRvl9vi4dL6/o510vTk57/AE+T832R4nJ0fpPpX8Bxf2v81et5PpX8Bxf2v81etQAQAASpexaijPVZMrhqCMb411cpct80tnRx0lNTHSa5rW08NKzxyy9Wua/sqPFvzbSs/wBOLvrrtXbh49fH8qaY8enJOHezf57Ov387ztT2vV+82l+xNeCeOPsJVfWARQAAAABQAABKCwpFoMrEqgAAAAAAAAIACoAoABgATAqWAZKkaBmVrLOOqiK4e9/B8/8AU2/Q7G2uu2t12mddpiy/MoPyI/Sfyr0P3X+Lb9Z/KvQ/df4tv1or83LZcy4s7WO3L7nscvFrw77/AOnr18Z0zfy/a+9/KvQ/df4tv1n8q9D91/i2/Wo/Nj9J/KvQ/df4tv1n8q9D91/i2/WgfSv4Di/tf5q9bPHx6cWk4+OeOmvSSNKACAlVATCYaMCMqlWKJesY8cOmGaDnvv4vPze1rNbPl158XV8n2v2Lm9k0XX28ctl7PZw+zM/nfDt+83/Yb15eTj2k2TVfpsTbTMeXbfx2w8/r/UdfGa7Pbprpz4wqPbUVBQAABQAAABUqpQSNMqACAoAAAAgAAAAAACiAKIoBQBFjNuF1ohRayCioCiKAAKAAAIAAAACVWaCNRMKAzY1WaqOe2kvd5vZ9Oc0w9G+Z1OPeXpTB8nX6d91tbJl5vb4N5c2Yfd3sm2Xk9vWctkwzivlacWt1znq9fq+7eHbxtNvQ8J5SvHzcdlz9hzKlr9YioqgAACgJlQAAWJSLQZUQFCAAACAAAAAAAAAAAAqKAAIljPy2zYCypSFBZVsYlw38AgAKAAAKAIAAAADLSAAAJhUBjbTLn93Zcx3qYUea6b2peC7PViLgHi24rJivDzetttez7W2krjvpMdjWXqRpKjSCKoIoCLEICggKAgAAAAAKCKAgAAAAAAAAKCKAgAAACYFQGbOrUqUgNIqAKgCiKAAigAAACKgCooICAUBRQAKl1yqxEJVSNCsgKAAIKABgQFQAAAAAAUBFBAAAAAAFAAAAAAAQAArMaSwEABQKAZEoKEAURQAEUAARTAEAoJUKAAKKAgohFRoZt6mUVpAAMiKKsRQAKggEAFQAABFQBYgoqKgAACgAAAAAAAAIAAAAjLSWARSRQQoAAoIACiKAAKACBREEUwKqAALEaggYE7AWLImWpcop2RaAM1osUQADICARFgKioAAAACAKKAAACKAAAAAAAAAAAgAAioAqKCUVAFiEBagAAAKgCgAAAgqUBAAjSKBgq/CUVKutRZqgbVItidgaMiAqAoKCDNWFSA0igIAAAAAoAAAAIqAoAAAAAAAAAAAgACCoCoAAAAAAAAACoooigESqlEQhjLQEMdSL8inwi1KCNeTK4QW1J1qYWAUynemMUFABVSKozU+Wqz8oNJlfhAAFAAAAAAAAAAAAAAAAAAAAAAQAAABBUAAAAABYCC1BRUaAAAQAJEWkAhQBUKAlixnLUQLWbWrEwCRfkkamARcGFBAFBj5bZoNQqarQQAAAAAAAAAAAAAAAAAAAAAAAQAAAAABBUAAAVAVQQFEUAAAyM3rUFq46HTBOoJFXCY6gXsQvSJKoNdEhUF6YROoDXRJOphYCWhsmQaElyoCWKlBI0xO7aiAAAgKmQBTKEBRAFAAAAAAAAAAAAAAAAAEAAEUBABQAFRUAAgKKlBMmEndoBe0XCVAT5DUDbqi1lRqKioJSFJQLFz0RAMphcAM5w6TZnxLAbylZigigAAAgAgqWqLCs5awCC4QFyuWVQXJlm0gNAAAKAAAAAACgCBUBQAAAEVAAAURoEwogGTCfK0EpFx0LEGs9Ge6y9GZeoCxWb3A+U+Wr2Zio0sTIil6pg7LM0EmVmtbkXMBnCYM9U22oATsmeoKWiYyBMtIuQQVAQMJlRcdGLG52TawEjcjMalQEw1lMgki4S3CTbILhcYIUAAABQAgArIKQgCgAiNVkFAAAAABBQAACpFSIKKz2oNFEoJ2axgW9QZTYvcvVYhOwvaIDXhiIu1Y65RWqS4JCg15M2sgLFJGoDFuOhGrhAWTAmTKi4Zq5EEjSRQSsVus2KM3aue21dLGfHIia7V08nPxwXIOsuWnLWunlEVLMsyYreYlmQalmBnGFgKAAAAQFFQAAAUABKqUEikABRBFEAAABFCkKRBpKZAChKBL1atZ+SgWZRZeiKGTafMK1J06iFMJMqipU7tVOwF1JCWqAlFBAsIBhcAomDC2s5BTKZEFAUSxMNAM4ZsdMJgHPFMbOmDOEHPGGpVsys0BJmq1jCYADBgAMGAAwuFGVhYSAUVMICgAYAASqCUAFQAAAAFEFgABUAwmVyC4Zrc7M/KiQwoCLAEf/2Q==";var o=new Image;o.src=r,o.onload=function(){var t=new h.Texture(o);t.needsUpdate=!0,e(t)}})).then(function(t){return r=t,e._maxAnisotropy&&(r.anisotropy=e._maxAnisotropy),Promise.resolve(r)});var n}().then(function(t){var r;if(e._useTexture)r=new Rr({map:t});else{var n=e._solidColorTexture;r=new Rr({map:n})}var o=new h.Mesh(w,r);return Promise.resolve(o)}).catch(function(e){console.warn("Loading logo failed.",e);var t=new h.Mesh(w);return Promise.resolve(t)})}}},{key:"initOptionalItems",value:function(){var e=this,t=[];if(this.planet&&(this._items=new h.Object3D,this.sceneNode.add(this._items),this.planet.showOrbitRing))var r=new Promise(function(n,o){for(var i=new h.Object3D,a=1.1*$,s=Math.PI/180,l=new h.LineBasicMaterial({linewidth:.5,color:7329264,transparent:!0,opacity:.4}),u=new h.Geometry,c=0;c<360;c++){var f=a*Math.cos(s*c),p=a*Math.sin(s*c);u.vertices.push(new h.Vector3(.985*f,0,.985*p)),u.vertices.push(new h.Vector3(f,0,p)),c%30==0?(u.vertices.push(new h.Vector3(.935*f,0,.935*p)),u.vertices.push(new h.Vector3(f,0,p)),u.vertices.push(new h.Vector3(.935*f,0,.935*p)),u.vertices.push(new h.Vector3(f,0,p))):c%5==0&&(u.vertices.push(new h.Vector3(.965*f,0,.965*p)),u.vertices.push(new h.Vector3(f,0,p)),u.vertices.push(new h.Vector3(.965*f,0,.965*p)),u.vertices.push(new h.Vector3(f,0,p)))}var d=new h.LineSegments(u,l),v=new h.LineSegments(u,l);v.rotation.x=Math.PI/2,i.add(d),i.add(v),e._items.add(i),n(),t.push(r)});return Promise.all(t)}},{key:"animate",value:function(e){this.updateVisibility(e),Lr.WorldToEarth.value.getInverse(Lr.EarthToWorld.value),ko(Po(t.prototype),"animate",this).call(this,e)}},{key:"updateVisibility",value:function(e){var r=e.camera,n=e.cameraChanging;ko(Po(t.prototype),"updateVisibility",this).call(this,{camera:r}),this._tree&&n&&(this._tree._updateCameraPose({camera:r}),this._tree.updateVisibility())}},{key:"updatePlanetMap",value:function(e){this._tree&&this._tree.updatePlanetMap(e)}},{key:"changeMapMaxLevel",value:function(e){var t=e.level,r=e.name;this._tree&&this._tree.changeMapMaxLevel({level:t,name:r})}},{key:"updatePlanetWireframeVisibility",value:function(){this._tree&&this._tree.updatePlanetWireframeVisibility()}},{key:"updatePlanetGroundCloudVisibility",value:function(){this._tree&&this._tree.updatePlanetGroundCloudVisibility()}},{key:"visible",get:function(){return ko(Po(t.prototype),"visible",this)},set:function(e){!function(e,t,r,n,o){if(!wo(e,"visible",r,n||e))throw new Error("failed to set property")}(Po(t.prototype),0,e,this),this.sceneNode.visible=e}},{key:"treeNode",get:function(){return this._treeNode}}])&&bo(r.prototype,n),t}(),Mo=new h.Scene,To=new h.PerspectiveCamera(90,1,.1,1e4),Eo=[],Co=0;Co<6;++Co){var jo=new h.WebGLRenderTarget(1024,1024,{minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat});jo.setSize(1024,1024),Eo.push(jo)}var Ro=new h.WebGLRenderTarget(1024,1024,{minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat});Ro.setSize(1024,1024);var Lo=new h.WebGLRenderTarget(1024,1024,{minFilter:h.LinearFilter,magFilter:h.LinearFilter,format:h.RGBAFormat}),Io=[-1,-1,-1,1,-1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,-1,1,1,1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,-1],Do=[{t:[1,0,0],u:[0,1,0]},{t:[-1,0,0],u:[0,1,0]},{t:[0,-1,0],u:[0,1,0]},{t:[0,1,0],u:[0,1,0]},{t:[0,0,1],u:[0,1,0]},{t:[0,0,-1],u:[0,1,0]}],zo="\nvarying vec3 pos;\n  \n      void main(){\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n        \n        pos = (modelMatrix * vec4(position, 1.)).xyz;\n      }\n",No="\n\nuniform vec3 uPosition;\n\nvarying vec3 pos;\nvarying vec3 color;\nvarying float falloff;\nvarying vec3 pposition;\n\nvoid main() {\n    vec3 posn = normalize(pos);\n    float d = 1.0 - clamp(dot(posn, normalize(pposition)), 0.0, 1.0);\n    float i = exp(-(d - 0.0) * falloff);\n    float o = clamp(i, 0.0, 1.0);\n    gl_FragColor = vec4(color + i, o);\n\n}\n",Bo="\n\n\nattribute vec3 aColor;\nattribute float aFalloff;\n\nvarying vec3 color;\nvarying float falloff;\nvarying vec3 pos;\nvarying vec3 pposition;\n  \n      void main(){\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n        gl_PointSize = 1.1;\n        pos = (modelMatrix * vec4(position, 1.)).xyz;\n        falloff = aFalloff;\n        pposition = position;\n      }\n",Uo="\nuniform vec3 uColor;\n      uniform vec3 uOffset;\n      uniform float uScale;\n      uniform float uIntensity;\n      uniform float uFalloff;\n\n      varying vec3 pos;\n\n      vec4 mod289(vec4 x)\n      {\n        return x - floor(x * (1.0 / 289.0)) * 289.0;\n      }\n\n      vec4 permute(vec4 x)\n      {\n        return mod289(((x*34.0)+1.0)*x);\n      }\n\n      vec4 taylorInvSqrt(vec4 r)\n      {\n        return 1.79284291400159 - 0.85373472095314 * r;\n      }\n\n      vec4 fade(vec4 t) {\n        return t*t*t*(t*(t*6.0-15.0)+10.0);\n      }\n\n      // Classic Perlin noise\n      float cnoise(vec4 P)\n      {\n        vec4 Pi0 = floor(P); // Integer part for indexing\n        vec4 Pi1 = Pi0 + 1.0; // Integer part + 1\n        Pi0 = mod289(Pi0);\n        Pi1 = mod289(Pi1);\n        vec4 Pf0 = fract(P); // Fractional part for interpolation\n        vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n        vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n        vec4 iy = vec4(Pi0.yy, Pi1.yy);\n        vec4 iz0 = vec4(Pi0.zzzz);\n        vec4 iz1 = vec4(Pi1.zzzz);\n        vec4 iw0 = vec4(Pi0.wwww);\n        vec4 iw1 = vec4(Pi1.wwww);\n\n        vec4 ixy = permute(permute(ix) + iy);\n        vec4 ixy0 = permute(ixy + iz0);\n        vec4 ixy1 = permute(ixy + iz1);\n        vec4 ixy00 = permute(ixy0 + iw0);\n        vec4 ixy01 = permute(ixy0 + iw1);\n        vec4 ixy10 = permute(ixy1 + iw0);\n        vec4 ixy11 = permute(ixy1 + iw1);\n\n        vec4 gx00 = ixy00 * (1.0 / 7.0);\n        vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n        vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n        gx00 = fract(gx00) - 0.5;\n        gy00 = fract(gy00) - 0.5;\n        gz00 = fract(gz00) - 0.5;\n        vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n        vec4 sw00 = step(gw00, vec4(0.0));\n        gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n        gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n        vec4 gx01 = ixy01 * (1.0 / 7.0);\n        vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n        vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n        gx01 = fract(gx01) - 0.5;\n        gy01 = fract(gy01) - 0.5;\n        gz01 = fract(gz01) - 0.5;\n        vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n        vec4 sw01 = step(gw01, vec4(0.0));\n        gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n        gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n        vec4 gx10 = ixy10 * (1.0 / 7.0);\n        vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n        vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n        gx10 = fract(gx10) - 0.5;\n        gy10 = fract(gy10) - 0.5;\n        gz10 = fract(gz10) - 0.5;\n        vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n        vec4 sw10 = step(gw10, vec4(0.0));\n        gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n        gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n        vec4 gx11 = ixy11 * (1.0 / 7.0);\n        vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n        vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n        gx11 = fract(gx11) - 0.5;\n        gy11 = fract(gy11) - 0.5;\n        gz11 = fract(gz11) - 0.5;\n        vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n        vec4 sw11 = step(gw11, vec4(0.0));\n        gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n        gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n        vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n        vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n        vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n        vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n        vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n        vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n        vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n        vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n        vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n        vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n        vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n        vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n        vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n        vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n        vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n        vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n        vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n        g0000 *= norm00.x;\n        g0100 *= norm00.y;\n        g1000 *= norm00.z;\n        g1100 *= norm00.w;\n\n        vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n        g0001 *= norm01.x;\n        g0101 *= norm01.y;\n        g1001 *= norm01.z;\n        g1101 *= norm01.w;\n\n        vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n        g0010 *= norm10.x;\n        g0110 *= norm10.y;\n        g1010 *= norm10.z;\n        g1110 *= norm10.w;\n\n        vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n        g0011 *= norm11.x;\n        g0111 *= norm11.y;\n        g1011 *= norm11.z;\n        g1111 *= norm11.w;\n\n        float n0000 = dot(g0000, Pf0);\n        float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n        float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n        float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n        float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n        float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n        float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n        float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n        float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n        float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n        float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n        float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n        float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n        float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n        float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n        float n1111 = dot(g1111, Pf1);\n\n        vec4 fade_xyzw = fade(Pf0);\n        vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n        vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n        vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n        vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n        float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n        return 2.2 * n_xyzw;\n      }\n\n      // Classic Perlin noise, periodic version\n      float pnoise(vec4 P, vec4 rep)\n      {\n        vec4 Pi0 = mod(floor(P), rep); // Integer part modulo rep\n        vec4 Pi1 = mod(Pi0 + 1.0, rep); // Integer part + 1 mod rep\n        Pi0 = mod289(Pi0);\n        Pi1 = mod289(Pi1);\n        vec4 Pf0 = fract(P); // Fractional part for interpolation\n        vec4 Pf1 = Pf0 - 1.0; // Fractional part - 1.0\n        vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n        vec4 iy = vec4(Pi0.yy, Pi1.yy);\n        vec4 iz0 = vec4(Pi0.zzzz);\n        vec4 iz1 = vec4(Pi1.zzzz);\n        vec4 iw0 = vec4(Pi0.wwww);\n        vec4 iw1 = vec4(Pi1.wwww);\n\n        vec4 ixy = permute(permute(ix) + iy);\n        vec4 ixy0 = permute(ixy + iz0);\n        vec4 ixy1 = permute(ixy + iz1);\n        vec4 ixy00 = permute(ixy0 + iw0);\n        vec4 ixy01 = permute(ixy0 + iw1);\n        vec4 ixy10 = permute(ixy1 + iw0);\n        vec4 ixy11 = permute(ixy1 + iw1);\n\n        vec4 gx00 = ixy00 * (1.0 / 7.0);\n        vec4 gy00 = floor(gx00) * (1.0 / 7.0);\n        vec4 gz00 = floor(gy00) * (1.0 / 6.0);\n        gx00 = fract(gx00) - 0.5;\n        gy00 = fract(gy00) - 0.5;\n        gz00 = fract(gz00) - 0.5;\n        vec4 gw00 = vec4(0.75) - abs(gx00) - abs(gy00) - abs(gz00);\n        vec4 sw00 = step(gw00, vec4(0.0));\n        gx00 -= sw00 * (step(0.0, gx00) - 0.5);\n        gy00 -= sw00 * (step(0.0, gy00) - 0.5);\n\n        vec4 gx01 = ixy01 * (1.0 / 7.0);\n        vec4 gy01 = floor(gx01) * (1.0 / 7.0);\n        vec4 gz01 = floor(gy01) * (1.0 / 6.0);\n        gx01 = fract(gx01) - 0.5;\n        gy01 = fract(gy01) - 0.5;\n        gz01 = fract(gz01) - 0.5;\n        vec4 gw01 = vec4(0.75) - abs(gx01) - abs(gy01) - abs(gz01);\n        vec4 sw01 = step(gw01, vec4(0.0));\n        gx01 -= sw01 * (step(0.0, gx01) - 0.5);\n        gy01 -= sw01 * (step(0.0, gy01) - 0.5);\n\n        vec4 gx10 = ixy10 * (1.0 / 7.0);\n        vec4 gy10 = floor(gx10) * (1.0 / 7.0);\n        vec4 gz10 = floor(gy10) * (1.0 / 6.0);\n        gx10 = fract(gx10) - 0.5;\n        gy10 = fract(gy10) - 0.5;\n        gz10 = fract(gz10) - 0.5;\n        vec4 gw10 = vec4(0.75) - abs(gx10) - abs(gy10) - abs(gz10);\n        vec4 sw10 = step(gw10, vec4(0.0));\n        gx10 -= sw10 * (step(0.0, gx10) - 0.5);\n        gy10 -= sw10 * (step(0.0, gy10) - 0.5);\n\n        vec4 gx11 = ixy11 * (1.0 / 7.0);\n        vec4 gy11 = floor(gx11) * (1.0 / 7.0);\n        vec4 gz11 = floor(gy11) * (1.0 / 6.0);\n        gx11 = fract(gx11) - 0.5;\n        gy11 = fract(gy11) - 0.5;\n        gz11 = fract(gz11) - 0.5;\n        vec4 gw11 = vec4(0.75) - abs(gx11) - abs(gy11) - abs(gz11);\n        vec4 sw11 = step(gw11, vec4(0.0));\n        gx11 -= sw11 * (step(0.0, gx11) - 0.5);\n        gy11 -= sw11 * (step(0.0, gy11) - 0.5);\n\n        vec4 g0000 = vec4(gx00.x,gy00.x,gz00.x,gw00.x);\n        vec4 g1000 = vec4(gx00.y,gy00.y,gz00.y,gw00.y);\n        vec4 g0100 = vec4(gx00.z,gy00.z,gz00.z,gw00.z);\n        vec4 g1100 = vec4(gx00.w,gy00.w,gz00.w,gw00.w);\n        vec4 g0010 = vec4(gx10.x,gy10.x,gz10.x,gw10.x);\n        vec4 g1010 = vec4(gx10.y,gy10.y,gz10.y,gw10.y);\n        vec4 g0110 = vec4(gx10.z,gy10.z,gz10.z,gw10.z);\n        vec4 g1110 = vec4(gx10.w,gy10.w,gz10.w,gw10.w);\n        vec4 g0001 = vec4(gx01.x,gy01.x,gz01.x,gw01.x);\n        vec4 g1001 = vec4(gx01.y,gy01.y,gz01.y,gw01.y);\n        vec4 g0101 = vec4(gx01.z,gy01.z,gz01.z,gw01.z);\n        vec4 g1101 = vec4(gx01.w,gy01.w,gz01.w,gw01.w);\n        vec4 g0011 = vec4(gx11.x,gy11.x,gz11.x,gw11.x);\n        vec4 g1011 = vec4(gx11.y,gy11.y,gz11.y,gw11.y);\n        vec4 g0111 = vec4(gx11.z,gy11.z,gz11.z,gw11.z);\n        vec4 g1111 = vec4(gx11.w,gy11.w,gz11.w,gw11.w);\n\n        vec4 norm00 = taylorInvSqrt(vec4(dot(g0000, g0000), dot(g0100, g0100), dot(g1000, g1000), dot(g1100, g1100)));\n        g0000 *= norm00.x;\n        g0100 *= norm00.y;\n        g1000 *= norm00.z;\n        g1100 *= norm00.w;\n\n        vec4 norm01 = taylorInvSqrt(vec4(dot(g0001, g0001), dot(g0101, g0101), dot(g1001, g1001), dot(g1101, g1101)));\n        g0001 *= norm01.x;\n        g0101 *= norm01.y;\n        g1001 *= norm01.z;\n        g1101 *= norm01.w;\n\n        vec4 norm10 = taylorInvSqrt(vec4(dot(g0010, g0010), dot(g0110, g0110), dot(g1010, g1010), dot(g1110, g1110)));\n        g0010 *= norm10.x;\n        g0110 *= norm10.y;\n        g1010 *= norm10.z;\n        g1110 *= norm10.w;\n\n        vec4 norm11 = taylorInvSqrt(vec4(dot(g0011, g0011), dot(g0111, g0111), dot(g1011, g1011), dot(g1111, g1111)));\n        g0011 *= norm11.x;\n        g0111 *= norm11.y;\n        g1011 *= norm11.z;\n        g1111 *= norm11.w;\n\n        float n0000 = dot(g0000, Pf0);\n        float n1000 = dot(g1000, vec4(Pf1.x, Pf0.yzw));\n        float n0100 = dot(g0100, vec4(Pf0.x, Pf1.y, Pf0.zw));\n        float n1100 = dot(g1100, vec4(Pf1.xy, Pf0.zw));\n        float n0010 = dot(g0010, vec4(Pf0.xy, Pf1.z, Pf0.w));\n        float n1010 = dot(g1010, vec4(Pf1.x, Pf0.y, Pf1.z, Pf0.w));\n        float n0110 = dot(g0110, vec4(Pf0.x, Pf1.yz, Pf0.w));\n        float n1110 = dot(g1110, vec4(Pf1.xyz, Pf0.w));\n        float n0001 = dot(g0001, vec4(Pf0.xyz, Pf1.w));\n        float n1001 = dot(g1001, vec4(Pf1.x, Pf0.yz, Pf1.w));\n        float n0101 = dot(g0101, vec4(Pf0.x, Pf1.y, Pf0.z, Pf1.w));\n        float n1101 = dot(g1101, vec4(Pf1.xy, Pf0.z, Pf1.w));\n        float n0011 = dot(g0011, vec4(Pf0.xy, Pf1.zw));\n        float n1011 = dot(g1011, vec4(Pf1.x, Pf0.y, Pf1.zw));\n        float n0111 = dot(g0111, vec4(Pf0.x, Pf1.yzw));\n        float n1111 = dot(g1111, Pf1);\n\n        vec4 fade_xyzw = fade(Pf0);\n        vec4 n_0w = mix(vec4(n0000, n1000, n0100, n1100), vec4(n0001, n1001, n0101, n1101), fade_xyzw.w);\n        vec4 n_1w = mix(vec4(n0010, n1010, n0110, n1110), vec4(n0011, n1011, n0111, n1111), fade_xyzw.w);\n        vec4 n_zw = mix(n_0w, n_1w, fade_xyzw.z);\n        vec2 n_yzw = mix(n_zw.xy, n_zw.zw, fade_xyzw.y);\n        float n_xyzw = mix(n_yzw.x, n_yzw.y, fade_xyzw.x);\n        return 2.2 * n_xyzw;\n      }\n\n      float noise(vec3 p) {\n        return 0.5 * cnoise(vec4(p, 0)) + 0.5;\n      }\n      \n      float nebula(vec3 p) {\n          const int steps = 6;\n          float scale = pow(2.0, float(steps));\n          vec3 displace;\n          for (int i = 0; i < steps; i++) {\n              displace = vec3(\n                  noise(p.xyz * scale + displace),\n                  noise(p.yzx * scale + displace),\n                  noise(p.zxy * scale + displace)\n              );\n              scale *= 0.5;\n          }\n          return noise(p * scale + displace);\n      }\n      \n      void main() {\n        vec3 posn = normalize(pos) * uScale;\n        float c = min(1.0, nebula(posn + uOffset) * uIntensity);\n        c = pow(c, uFalloff);\n        gl_FragColor = vec4(uColor, c);\n      \n      }\n",Fo="\n\nvarying vec3 color;\n\nvoid main() {\n    gl_FragColor = vec4(color, 1.0);\n}\n",Vo="\n\nattribute vec3 aColor;\n\nvarying vec3 color;\n\nvoid main() {\n    gl_PointSize = 0.7;\n    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n    color = aColor;\n}\n";function Ho(e){return(Ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wo(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Go(e){return(Go=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ko(e,t){return(Ko=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xo=[new h.Vector2(0,0),new h.Vector2(1,0),new h.Vector2(1,1),new h.Vector2(0,1)],Yo=function(e){function t(e){var r,n=e.spaceNode,o=e.spaceOption;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==Ho(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Go(t).call(this,n))).name="SkyBox";var i={u_time:{value:.5},u_resolution:{value:new h.Vector2(window.innerWidth,window.innerHeight)},u_mouse:{value:new h.Vector2(window.innerHeight,window.innerWidth)},uScale:{value:o.nebulaScale},uColor:{value:new h.Color(o.nebulaColor)},uIntensity:{value:o.nebulaOpacity},uFalloff:{value:1.975},uOffset:{value:[578.3161600120366,-34.933149348944426,-287.80164290219545]},uPosition:{value:new h.Vector3(.01*Math.random(),.01*Math.random(),.01*Math.random())},uSize:{value:.15}},a=new h.ShaderMaterial({uniforms:i,vertexShader:zo,fragmentShader:Uo,side:h.DoubleSide}),s=new h.ShaderMaterial({uniforms:i,vertexShader:Bo,fragmentShader:No,side:h.DoubleSide}),l=new h.ShaderMaterial({uniforms:i,vertexShader:Vo,fragmentShader:Fo,side:h.DoubleSide});return o.showCloseStar&&r.addBox({BOXSIZE:7*q,radius:200,NSTARS:o.closeStarNumber,opacity:o.closeStarOpacity,transparent:!0,ifStar:!0,closeStar:!0,texture:"brightStar",shaderMaterial:s}),o.showFarStar&&r.addBox({BOXSIZE:9.5*q,radius:200,NSTARS:o.farStarNumber,opacity:o.farStarOpacity,transparent:!0,ifStar:!0,closeStar:!1,texture:"nebulaStar",shaderMaterial:l}),o.showNebula&&r.addBox({BOXSIZE:10*q,radius:400,NSTARS:2e4,opacity:1,transparent:!1,ifStar:!1,closeStar:!1,texture:"nebula",shaderMaterial:a}),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ko(e,t)}(t,W),r=t,(n=[{key:"addBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.BOXSIZE,r=e.radius,n=e.NSTARS,o=e.transparent,i=void 0===o||o,a=e.opacity,s=(e.ifStar,e.closeStar),l=e.texture,u=e.shaderMaterial;if("nebulaStar"===l||"brightStar"===l){var c=function(){for(var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n.NSTARS,i=n.radius,a=n.transparent,s=n.opacity,l=n.closeStar,u=n.shaderMaterial,c=new h.BufferGeometry,f=new Float32Array(3*o),p=new Float32Array(3*o),d=new Float32Array(o),v=new h.Vector3,m=new h.Color(16777215),y=0;y<o;y++)v.x=(2*Math.random()-1)*i,v.y=(2*Math.random()-1)*i,v.z=(2*Math.random()-1)*i,v.toArray(f,3*y),m.setHSL(.2+y/o*.2,.1,1),m.toArray(p,3*y),r=2e6*Math.random(),d[y]=r;c.addAttribute("position",new h.Float32BufferAttribute(f,3)),c.addAttribute("aColor",new h.Float32BufferAttribute(p,3)),c.addAttribute("aFalloff",new h.Float32BufferAttribute(d,1)),l?(t=new h.Points(c,u),e=Lo):(t=new h.Points(c,u),e=Ro),Mo.add(t);var g=window.__renderer;g.clearColor(0,0,0,a?s:1),g.setRenderTarget(e),g.render(Mo,To,e,!1),g.setRenderTarget(null);var b=e.texture;return Mo.remove(t),b}({NSTARS:n,radius:r,transparent:i,opacity:a,closeStar:s,shaderMaterial:u}),f=new h.MeshBasicMaterial({map:c,opacity:a,transparent:!0,side:h.DoubleSide,depthWrite:!1}),p=new h.BoxBufferGeometry(t,t,t),d=new h.Mesh(p,f);this.sceneNode.add(d)}else{var v=function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.transparent,o=r.opacity,i=r.shaderMaterial,a=new h.BufferGeometry;a.addAttribute("position",new h.Float32BufferAttribute(Io,3)),e=new h.Mesh(a,i),Mo.add(e);for(var s=window.__renderer,l=0;l<6;++l){To.matrixWorldNeedsUpdate=!0;var u=Do[l];t=Eo[l],To.position.set(0,0,0),To.up.set(u.u[0],u.u[1],u.u[2]),To.lookAt(u.t[0],u.t[1],u.t[2]),To.updateProjectionMatrix(),s.clearColor(0,0,0,n?o:1),s.setRenderTarget(t),s.render(Mo,To,t,!1),s.setRenderTarget(null)}var c=Eo.map(function(e){return e.texture});return Mo.remove(e),c}({transparent:i,opacity:a,shaderMaterial:u}).map(function(e,t){return new h.MeshBasicMaterial({side:h.DoubleSide,map:e,transparent:!0,opacity:a,depthWrite:!1})}),m=new h.BoxGeometry(t,t,t);m.uvsNeedUpdate=!0,m.faceVertexUvs[0]=[],m.faceVertexUvs[0][0]=[Xo[1],Xo[2],Xo[0]],m.faceVertexUvs[0][1]=[Xo[2],Xo[3],Xo[0]],m.faceVertexUvs[0][2]=[Xo[1],Xo[2],Xo[0]],m.faceVertexUvs[0][3]=[Xo[2],Xo[3],Xo[0]],m.faceVertexUvs[0][4]=[Xo[3],Xo[0],Xo[2]],m.faceVertexUvs[0][5]=[Xo[0],Xo[1],Xo[2]],m.faceVertexUvs[0][6]=[Xo[3],Xo[0],Xo[2]],m.faceVertexUvs[0][7]=[Xo[0],Xo[1],Xo[2]],m.faceVertexUvs[0][8]=[Xo[1],Xo[2],Xo[0]],m.faceVertexUvs[0][9]=[Xo[2],Xo[3],Xo[0]],m.faceVertexUvs[0][10]=[Xo[1],Xo[2],Xo[0]],m.faceVertexUvs[0][11]=[Xo[2],Xo[3],Xo[0]];var y=new h.Mesh(m,v);this.sceneNode.add(y)}}}])&&Wo(r.prototype,n),t}();function qo(e){return(qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Zo(e){return(Zo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Jo(e,t){return(Jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $o=function(e){function t(e){var r,n=e.node,o=e.option;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==qo(t)&&"function"!=typeof t?Qo(e):t}(this,Zo(t).call(this,n))).box=new Yo({spaceNode:Qo(r),spaceOption:o}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jo(e,t)}(t,W),t}();function ei(e){return(ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ti(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ri(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oi(e,t,r){return(oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ii(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ii(e){return(ii=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ai(e,t){return(ai=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var si=function(e){function t(e,r){var n,o=r.isMobile,i=void 0!==o&&o,a=r.forest,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["isMobile","forest"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==ei(t)&&"function"!=typeof t?ni(e):t}(this,ii(t).call(this,e))).forest=a,n.earthEntityOptions=s,n.earthEntityOptions.planet._skyBoxProperties.showSkyBox&&(n.space=new $o({node:ni(n),option:n.earthEntityOptions.planet._skyBoxProperties})),n.MAX_LEVEL=void 0===n.earthEntityOptions.planet.mapMaxLevel?i?10:18:n.earthEntityOptions.planet.mapMaxLevel,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ai(e,t)}(t,Pt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.forest=null,oi(ii(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){return new So(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){ti(e,t,r[t])})}return e}({name:"PlanetEntity",forest:this.forest,maxLevel:this.MAX_LEVEL,minLevel:0},this.earthEntityOptions)).import(),Promise.resolve()}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t})}}])&&ri(r.prototype,n),t}();function li(e){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ui(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ci(e,t,r){return(ci="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=fi(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function fi(e){return(fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hi(e,t){return(hi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pi=function(e){function t(e,r){var n,o=r.name,i=void 0===o?"LodTreeEntity":o,a=r.forest;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==li(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,fi(t).call(this,e,{name:i}))).name="LodTreeEntity",n._tree=null,n._forest=a,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hi(e,t)}(t,Rt),r=t,(n=[{key:"destruct",value:function(){var e=ci(fi(t.prototype),"destruct",this).call(this);return this.treeNode&&(this.treeNode.parent&&this.treeNode.parent.remove(this.treeNode),this._treeNode=void 0),this.tree&&(e=this.tree.destruct()&&e,this._tree=void 0),this._forest=void 0,e}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"treeNode",get:function(){return this._treeNode}},{key:"tree",get:function(){return this._tree}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}])&&ui(r.prototype,n),t}();function di(e){return(di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mi(e,t,r,n){return(mi="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=gi(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function yi(e,t,r){return(yi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=gi(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function gi(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bi(e)););return e}function bi(e){return(bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _i(e,t){return(_i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wi=function(e){function t(e,r){var n,o=r.name,i=void 0===o?"ProjectEntity":o,a=r.forest,s=r.showBBox,l=r.position;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==di(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,bi(t).call(this,e,{name:i})),void 0===l.alt&&(l.alt=0),n.name="ProjectEntity",n._tree=null,n._forest=a,n.showBBox=s,n._treeNode=new h.Object3D,n._treeNode.add(new h.AxesHelper(1e3)),n.displayHolder=new h.Object3D,n.displayHolder.add(n._treeNode),n.sceneNode.add(n.displayHolder),n.sceneNode.applyMatrix(function(){var e=me.getENUSystem(l.lat,l.lng),t=e.east,r=e.up,n=e.north,o=e.origin;o.add(r.clone().multiplyScalar(l.alt));var i=new h.Matrix4;return i.makeBasis(t,n,r),i.setPosition(o),i}()),n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_i(e,t)}(t,pi),r=t,(n=[{key:"destruct",value:function(){return this.sceneNode.remove(this.displayHolder),this.displayHolder.remove(this._treeNode),this._forest=void 0,yi(bi(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"visible",set:function(e){!function(e,t,r,n,o){if(!mi(e,"visible",r,n||e))throw new Error("failed to set property")}(bi(t.prototype),0,e,this),this._tree&&(this._tree.visible=e)},get:function(){return yi(bi(t.prototype),"visible",this)}},{key:"treeNode",get:function(){return this._treeNode}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}])&&vi(r.prototype,n),t}(),xi={crop_pars_vertex:"uniform vec3 origin;\nuniform vec3 xDir;\nuniform vec3 yDir;\nuniform vec3 zDir;\nuniform vec3 minBound;\nuniform vec3 maxBound;\nvarying vec2 vMaskUv;",crop_vertex:"vec3 vori = position - origin;\nvec3 vViewPosition = vec3(dot(vori, xDir), dot(vori, yDir), dot(vori, zDir));\nvMaskUv = ((vViewPosition - minBound)/(maxBound - minBound)).xy;",crop_pars_fragment:"uniform sampler2D cropMask;\nvarying vec2 vMaskUv;",crop_fragment:"\nfloat os_val = texture2D(cropMask, vMaskUv).y;\nif(os_val < 0.05) {discard;}\n",projector_pars_vertex:"\n#ifdef PROJECTOR\n  // The model-view-projection matrix for the projector\n  // This matrix is used to calculate the texture coordinates for the vertex. \n  struct Projector {\n    mat4 videoProjectionMatrix;\n    mat4 localToVideo;\n    mat3 normalMatrix;\n    float projectorLogDepthBufferFC;\n    bool visible;\n    bool isVideo;\n    float alpha;\n  };\n\n  #ifdef VIDEO\n    uniform sampler2D videoTexture[MAX_COUNT];\n  #endif\n\n  uniform Projector projectors[MAX_COUNT];\n  uniform sampler2D depthTexture[MAX_COUNT];\n  uniform int count;\n\n  varying vec3 projectorUsedPosition;\n  varying vec3 projectorUsedNormal;\n  varying vec4 textureCoordProj[MAX_COUNT];\n\n  mat4 scaleBiasedMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n    0.0, 0.5, 0.0, 0.0,\n    0.0, 0.0, 0.5, 0.0,\n    0.5, 0.5, 0.5, 1.0);\n\n  // #include <logdepthbuf_pars_vertex>\n\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      varying float videoFragDepth[MAX_COUNT];\n    #endif\n  #endif\n#endif\n",projector_vertex:"\n#ifdef PROJECTOR\n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    textureCoordProj[ i ] = projectors[ i ].visible ?\n    scaleBiasedMatrix * projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * vec4(position, 1.0) : textureCoordProj[ i ];\n  }\n  projectorUsedPosition = position;\n  projectorUsedNormal = normal;\n  // #include <logdepthbuf_vertex>\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      #pragma unroll_loop\n      for ( int i = 0; i < MAX_COUNT; i ++ ) {\n        videoFragDepth[ i ] = projectors[ i ].visible ?\n        1.0 + (projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * vec4(position, 1.0)).w : videoFragDepth[ i ];\n      }\n    #endif\n  #endif\n#endif\n",projector_pars_fragment:"\n#ifdef PROJECTOR\n  struct Projector {\n    mat4 videoProjectionMatrix;\n    mat4 localToVideo;\n    mat3 normalMatrix;\n    float projectorLogDepthBufferFC;\n    bool visible;\n    bool isVideo;\n    float alpha;\n  };\n\n  #ifdef VIDEO\n    uniform sampler2D videoTexture[MAX_COUNT];\n  #endif\n  uniform Projector projectors[MAX_COUNT];\n  uniform sampler2D depthTexture[MAX_COUNT];\n  uniform int count;\n\n  varying vec3 projectorUsedPosition;\n  varying vec3 projectorUsedNormal;\n  varying vec4 textureCoordProj[MAX_COUNT];\n\n  // #include <logdepthbuf_pars_fragment>\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      varying float videoFragDepth[MAX_COUNT];\n    #endif\n  #endif\n\n  bool inFustrum (vec4 texCoordProj) {\n    float videoY = texCoordProj.y / texCoordProj.w;\n    float videoX = texCoordProj.x / texCoordProj.w;\n    float videoZ = texCoordProj.z / texCoordProj.w;\n    float a = step(0.0, videoX) - step(1.0, videoX); // want 1.0 (inside range)\n    float b = step(0.0, videoY) - step(1.0, videoY); // want 1.0 (inside range)\n    float c = step(0.0, videoZ) - step(1.0, videoZ);\n\n    return (a == 1.0 && b == 1.0 && c == 1.0);\n  }\n  bool videoEffective (vec4 texCoordProj, sampler2D depthTex, float fragmentDepth) {\n    float depth = texture2DProj(depthTex, texCoordProj).x;\n    // depth = texture2D(depthTex, vec2(0.5, 0.5)).x;\n\n    // scaled slope-based bias + constant bias\n    // float dx = dFdx(depth);\n    // float dy = dFdy(depth);\n    // float bias = max(abs(dx), abs(dy)) * sbias + cbias;\n    float bias = 0.001; // 0.01 previously\n\n    float fragCoordZBiased = depth + bias;\n\n    float d = step(fragmentDepth, fragCoordZBiased);\n    return (d == 1.0);\n  }\n#endif\n",projector_fragment:"\n#ifdef PROJECTOR\n  float fragmentDepth;\n  bool useVideo;\n  bool videoInFustrum;\n  bool isVideo;\n  float projectorDotNL;\n  vec4 mapColor = color;\n  #ifdef VISIBILITY\n    bool notGreen = true;\n    float mixFactorRed = 0.3;\n    float mixFactorGreen = 0.3;\n  #endif\n  #ifdef VIDEO\n    vec4 videoTextureColor;\n  #endif\n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    // For perspective projection effect\n    fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n    #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n      fragmentDepth = projectors[ i ].visible ?\n      log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n    #endif\n    videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n    projectorDotNL = dot(-(projectors[ i ].localToVideo*vec4(projectorUsedPosition, 1.0)).xyz,\n      normalize(projectors[ i ].normalMatrix*projectorUsedNormal));\n    useVideo = videoInFustrum && projectorDotNL >= 0.0 ? videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n    isVideo = projectors[ i ].isVideo;\n\n    #ifdef VISIBILITY\n      // more visible more green, more invisible more red\n      // don't change the color when not in fustrum (or projector invisible)\n      // if in fustrum but can't be seen, and it has been seen by other projector, don't change the color\n      // if in fustrum but can't be seen, and it hasn't been seen by other projector, mix color with red\n      // if in fustrum and can be seen first time, set color to normal (color may has been mix with red), then mix color with green\n      // if in fustrum and can be seen, mix color with green\n      color = !isVideo && notGreen && videoInFustrum ? mix(color, vec4(1.0, 0.0, 0.0, color.a), mixFactorRed) : color;\n      color = !isVideo && notGreen && useVideo ? mapColor : color;\n      color = !isVideo && useVideo ? mix(color, vec4(0.0, 1.0, 0.0, color.a), mixFactorGreen) : color;\n      notGreen = !isVideo && useVideo ? false : notGreen;\n    #endif\n    #ifdef VIDEO\n      useVideo = isVideo && projectors[ i ].visible && useVideo;\n      videoTextureColor = useVideo ? texture2DProj(videoTexture[ i ], textureCoordProj[ i ]) : videoTextureColor;\n      // videoTextureColor.rgb = mix(mapColor.rgb, videoTextureColor.rgb, projectors[ i ].alpha);\n      // videoTextureColor.a = mapColor.a;\n      // for image rgba, also compatible with video\n      videoTextureColor = mix(mapColor, videoTextureColor, projectors[ i ].alpha * videoTextureColor.a * mapColor.a);\n\n      color = useVideo ? videoTextureColor : color;\n    #endif\n  }\n#endif\n",visibility_fragment:"\n// For regular texture mapping\nvec4 mapColor = texture2D(map, textureCoord);\nvec4 color = mapColor;\nfloat mixFactorRed = 0.3;\nfloat mixFactorGreen = 0.3;\n\nfloat fragmentDepth;\nbool useVideo;\nbool videoInFustrum;\nbool notGreen = true;\n\n#pragma unroll_loop\nfor ( int i = 0; i < MAX_COUNT; i ++ ) {\n  // For perspective projection effect\n  fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n  #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    fragmentDepth = projectors[ i ].visible ?\n    log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n  #endif\n  videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n  useVideo = videoInFustrum ? videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n  // more visible more green, more invisible more red\n  // don't change the color when not in fustrum (or projector invisible)\n  // if in fustrum but can't be seen, and it has been seen by other projector, don't change the color\n  // if in fustrum but can't be seen, and it hasn't been seen by other projector, mix color with red\n  // if in fustrum and can be seen first time, set color to normal (color may has been mix with red), then mix color with green\n  // if in fustrum and can be seen, mix color with green\n  color = notGreen && videoInFustrum ? mix(color, vec4(1.0, 0.0, 0.0, 1.0), mixFactorRed) : color;\n  color = notGreen && useVideo ? mapColor : color;\n  color = useVideo ? mix(color, vec4(0.0, 1.0, 0.0, 1.0), mixFactorGreen) : color;\n  notGreen = useVideo ? false : notGreen;\n}\n",video_fragment:"\n// For regular texture mapping\nvec4 color = texture2D(map, textureCoord);\n\nfloat fragmentDepth;\nbool useVideo;\nbool videoInFustrum;\nvec4 videoTextureColor;\n\n#pragma unroll_loop\nfor ( int i = 0; i < MAX_COUNT; i ++ ) {\n  // For perspective projection effect\n  fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n  #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    fragmentDepth = projectors[ i ].visible ?\n    log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n  #endif\n  videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n  useVideo = videoInFustrum ?\n  videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n\n  videoTextureColor = projectors[ i ].visible ?\n  texture2DProj(videoTexture[ i ], textureCoordProj[ i ]) : videoTextureColor;\n\n  color = mix(color, videoTextureColor, float(useVideo));\n}\n",phong2_pars_vertex:"\n#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",phong2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n  vNormal = normalize( transformedNormal );\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\nvViewPosition = - mvPosition.xyz;\n#include <worldpos_vertex>\n#include <envmap_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n",phong2_pars_fragment:"\n#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",phong2_fragment:["\n  #include <clipping_planes_fragment>\n  vec4 diffuseColor = vec4( diffuse, opacity );\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  vec3 totalEmissiveRadiance = emissive;\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n  #include <alphamap_fragment>\n  #include <alphatest_fragment>\n  #include <specularmap_fragment>\n  ","\n#ifdef FLAT_SHADED\n  // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n  vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n  fdx = normalize(fdx);\n  vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n  fdy = normalize(fdy);\n  vec3 normal = normalize( cross( fdx, fdy ) );\n#else\n  vec3 normal = normalize( vNormal );\n  #ifdef DOUBLE_SIDED\n    normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  #endif\n#endif\n","\n  #include <normal_fragment_maps>\n  #include <emissivemap_fragment>\n  #include <lights_phong_fragment>\n  ","\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\nvec3 irradiance;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n  PointLight pointLight;\n  float dotNL;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n    pointLight = pointLights[ i ];\n    getPointDirectLightIrradiance( pointLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n      directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n    #endif\n    #ifdef TOON\n      irradiance = getGradientIrradiance( normal, normalize( pointLight.position + vViewPosition ) ) * directLight.color;\n    #else\n      dotNL = saturate( dot( normal, normalize( pointLight.position + vViewPosition ) ) );\n      irradiance = dotNL * directLight.color;\n    #endif\n    #ifndef PHYSICALLY_CORRECT_LIGHTS\n      irradiance *= PI;\n    #endif\n    reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n    reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n  }\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n  SpotLight spotLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n    spotLight = spotLights[ i ];\n    getSpotDirectLightIrradiance( spotLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n    directLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n    #endif\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n  DirectionalLight directionalLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n    directionalLight = directionalLights[ i ];\n    getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n    #ifdef USE_SHADOWMAP\n    directLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n    #endif\n    RE_Direct( directLight, geometry, material, reflectedLight );\n  }\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n  RectAreaLight rectAreaLight;\n  #pragma unroll_loop\n  for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n    rectAreaLight = rectAreaLights[ i ];\n    RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n  }\n#endif\n#if defined( RE_IndirectDiffuse )\n  irradiance = getAmbientLightIrradiance( ambientLightColor );\n  #if ( NUM_HEMI_LIGHTS > 0 )\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n      irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n    }\n  #endif\n#endif\n#if defined( RE_IndirectSpecular )\n  vec3 radiance = vec3( 0.0 );\n  vec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n","\n  #include <lights_fragment_maps>\n  #include <lights_fragment_end>\n  #include <aomap_fragment>\n  vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n  #include <envmap_fragment>\n  gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n  #include <premultiplied_alpha_fragment>\n  #include <dithering_fragment>  \n  "].join("\n"),basic2_pars_vertex:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",basic2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n#include <skinbase_vertex>\n#ifdef USE_ENVMAP\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#endif\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <worldpos_vertex>\n#include <clipping_planes_vertex>\n#include <envmap_vertex>\n#include <fog_vertex>\n",basic2_pars_fragment:"\nuniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n\n#ifdef USE_ALPHAMAP\n  uniform sampler2D alphaMap;\n  uniform int alphaChannel;\n#endif\n\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",basic2_fragment:"\n#include <clipping_planes_fragment>\nvec4 diffuseColor = vec4( diffuse, opacity );\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n\n#ifdef USE_ALPHAMAP\nvec4 alphaMapColor = texture2D( alphaMap, vUv );\nfloat alphaMapAlpha = alphaMapColor.g;\nalphaMapAlpha = alphaChannel == 0 ? alphaMapColor.r : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 1 ? alphaMapColor.g : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 2 ? alphaMapColor.b : alphaMapAlpha;\nalphaMapAlpha = alphaChannel == 3 ? alphaMapColor.a : alphaMapAlpha;\ndiffuseColor.a *= alphaMapAlpha;\n#endif\n\n#include <alphatest_fragment>\n#include <specularmap_fragment>\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n#ifdef USE_LIGHTMAP\nreflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#else\nreflectedLight.indirectDiffuse += vec3( 1.0 );\n#endif\n#include <aomap_fragment>\nreflectedLight.indirectDiffuse *= diffuseColor.rgb;\nvec3 outgoingLight = reflectedLight.indirectDiffuse;\n#include <envmap_fragment>\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include <premultiplied_alpha_fragment>\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n",physical2_pars_vertex:"\n#define PHYSICAL\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n  varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n",physical2_vertex:"\n#include <uv_vertex>\n#include <uv2_vertex>\n#include <color_vertex>\n\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\nvNormal = normalize( transformedNormal );\n\n#endif\n\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <displacementmap_vertex>\n#include <project_vertex>\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n\nvViewPosition = - mvPosition.xyz;\n\n#include <worldpos_vertex>\n#include <shadowmap_vertex>\n#include <fog_vertex>\n",physical2_pars_fragment:"\n#define PHYSICAL\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifndef STANDARD\n  uniform float clearCoat;\n  uniform float clearCoatRoughness;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n  varying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n",physical2_fragment:"\n#include <clipping_planes_fragment>\n\nvec4 diffuseColor = vec4( diffuse, opacity );\nReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\nvec3 totalEmissiveRadiance = emissive;\n\n#include <logdepthbuf_fragment>\n#include <map_fragment>\n#include <color_fragment>\n#include <alphamap_fragment>\n#include <alphatest_fragment>\n#include <roughnessmap_fragment>\n#include <metalnessmap_fragment>\n#include <normal_fragment_begin>\n#include <normal_fragment_maps>\n#include <emissivemap_fragment>\n\n// accumulation\n#include <lights_physical_fragment>\n#include <lights_fragment_begin>\n#include <lights_fragment_maps>\n#include <lights_fragment_end>\n\n// modulation\n#include <aomap_fragment>\n\nvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n#include <tonemapping_fragment>\n#include <encodings_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n#include <dithering_fragment>\n",hsbc_pars_fragment:"\nuniform vec4 hsbc;\nvec3 applyHue(vec3 aColor, float aHue)\n{\n    float angle = radians(aHue);\n    vec3 k = vec3(0.57735, 0.57735, 0.57735);\n    float cosAngle = cos(angle);\n    //Rodrigues' rotation formula\n    return aColor * cosAngle + cross(k, aColor) * sin(angle) + k * dot(k, aColor) * (1.0 - cosAngle);\n}\nvec4 applyHSBEffect(vec4 startColor, vec4 hsbc)\n{\n    float _Hue = 360.0 * hsbc.r;\n    float _Saturation = hsbc.g * 2.0;\n    float _Brightness = hsbc.b * 2.0 - 1.0;\n    float _Contrast = hsbc.a * 2.0;\n \n    vec4 outputColor = startColor;\n    outputColor.rgb = applyHue(outputColor.rgb, _Hue);\n    outputColor.rgb = (outputColor.rgb - 0.5) * (_Contrast) + 0.5;\n    outputColor.rgb = outputColor.rgb + _Brightness;        \n    vec3 intensity = outputColor.rgb * vec3(0.299,0.587,0.114);\n    outputColor.rgb = mix(intensity, outputColor.rgb, _Saturation);\n \n    return outputColor;\n}\n"},ki=1,Oi=10,Pi=20,Ai=30,Si={uniforms:{test:{type:"float",value:233},cropMask:{type:"t",value:null},origin:{type:"v3",value:new h.Vector3},xDir:{type:"v3",value:new h.Vector3},yDir:{type:"v3",value:new h.Vector3},zDir:{type:"v3",value:new h.Vector3},minBound:{type:"v3",value:new h.Vector3},maxBound:{type:"v3",value:new h.Vector3}}},Mi={uniforms:h.UniformsUtils.merge([{projectors:{value:[]},depthTexture:{value:[]},count:{type:"i",value:0}},{videoTexture:{value:[]}}])},Ti={uniforms:h.ShaderLib.phong.uniforms},Ei={uniforms:h.UniformsUtils.merge([h.ShaderLib.basic.uniforms,{alphaChannel:{type:"i",value:1}}])},Ci={uniforms:h.ShaderLib.physical.uniforms},ji={uniforms:{hsbc:{type:"v4",value:[0,.5,.5,.5]}}},Ri={factory:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ai,o=[],i=[],a=[],s=[],l=[];return e===ki?(o.push(Ei.uniforms),i.push(xi.basic2_pars_vertex),a.push(xi.basic2_vertex),s.push(xi.basic2_pars_fragment),l.push(xi.basic2_fragment)):2===e?(o.push(Ti.uniforms),i.push(xi.phong2_pars_vertex),a.push(xi.phong2_vertex),s.push(xi.phong2_pars_fragment),l.push(xi.phong2_fragment)):3===e?(o.push(Ci.uniforms),i.push(xi.physical2_pars_vertex),a.push(xi.physical2_vertex),s.push(xi.physical2_pars_fragment),l.push(xi.physical2_fragment)):(i.push("varying vec2 textureCoord;"),i.push(h.ShaderChunk.logdepthbuf_pars_vertex),a.push(h.ShaderChunk.begin_vertex),a.push(h.ShaderChunk.project_vertex),a.push("textureCoord = uv;"),a.push(h.ShaderChunk.logdepthbuf_vertex),s.push("uniform sampler2D map;"),s.push("varying vec2 textureCoord;"),s.push(h.ShaderChunk.logdepthbuf_pars_fragment),l.push(h.ShaderChunk.logdepthbuf_fragment),l.push("gl_FragColor = vec4(texture2D(map, textureCoord).xyz, 1.0);")),t===Oi&&(o.push(Si.uniforms),i.push(xi.crop_pars_vertex),a.push(xi.crop_vertex),s.push(xi.crop_pars_fragment),l.push(xi.crop_fragment)),n===Ai&&(o.push(ji.uniforms),s.push(xi.hsbc_pars_fragment),l.push("gl_FragColor = applyHSBEffect(gl_FragColor, hsbc);")),0!==r&&(o.push(Mi.uniforms),i.push(xi.projector_pars_vertex),a.push(xi.projector_vertex),s.push(xi.projector_pars_fragment),l.push("vec4 color = gl_FragColor;"),l.push(xi.projector_fragment),l.push("gl_FragColor = color;")),{uniforms:h.UniformsUtils.merge(o),vertexShader:i.join("\n")+"\nvoid main(){\n"+a.join("\n")+"\n}\n",fragmentShader:s.join("\n")+"\nvoid main(){\n"+l.join("\n")+"\n}\n"}},extra:{uniforms:h.UniformsUtils.merge([Si.uniforms,Mi.uniforms,ji.uniforms])}},Li=Ri.factory(0,Oi,0,Ai),Ii=Ri.factory(0,0,Pi,Ai),Di=Ri.factory(0,Oi,Pi,Ai),zi=Ri.factory(2,0,0,Ai),Ni=Ri.factory(ki,0,0,Ai),Bi=Ri.factory(3,0,0,Ai),Ui=Ri.factory(2,Oi,Pi,Ai),Fi=Ri.factory(ki,Oi,Pi,Ai),Vi={extra:Ri.extra,crop:Li,projector:Ii,visibility:Ii,video:Ii,cropAndVideo:Di,phong2:zi,basic2:Ni,physical2:Bi,pcp:Ui,bcp:Fi};function Hi(e){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wi(e){return(Wi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gi(e,t){return(Gi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ki=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=h.UniformsUtils.merge([{},Vi.phong2.uniforms]);return(r=function(e,t){return!t||"object"!==Hi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Wi(t).call(this,{uniforms:n,vertexShader:Vi.phong2.vertexShader,fragmentShader:Vi.phong2.fragmentShader}))).fog=!0,r.lights=!0,r.isMeshPhongMaterial=!0,r.color=new h.Color(16777215),r.specular=new h.Color(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new h.Color(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=h.TangentSpaceNormalMap,r.normalScale=new h.Vector2(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=h.MultiplyOperation,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.morphNormals=!1,r.setValues(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gi(e,t)}(t,h.ShaderMaterial),t}();function Xi(e){return(Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yi(e){return(Yi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qi(e,t){return(qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Zi=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.transparent,l=void 0!==s&&s,u=a.opacity,c=a.color,f=a.map,h=a.emissive,p=a.emissiveMap,d=a.specular,v=a.specularMap,m=a.shininess,y=a.flatShading,g=void 0!==y&&y;return(e=function(e,t){return!t||"object"!==Xi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Yi(t).call(this,Zt({transparent:l,opacity:u,color:c,map:f,emissive:h,emissiveMap:p,specular:d,specularMap:v,shininess:m,flatShading:g})))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qi(e,t)}(t,Ki),t}();function Qi(e){return(Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ji(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $i(e,t,r){return($i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ea(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ea(e){return(ea=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ta(e,t){return(ta=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ra=function(e){function t(e,r){var n,o=r.sceneGraphRoot,i=r.name,a=void 0===i?"AltizureProjectTree":i,s=r.eventHandlers,l=r.debug,u=r.altizureApi,c=r.projInfo,f=r.countryName,h=r.showBBox,p=r.priorityRank,d=void 0===p?2:p,v=r.TreeMaterialType,m=void 0===v?ir:v,y=r.NodeMaterialType,g=void 0===y?c.model.isImported?Zi:tr:y,b=r.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u||console.warn("AltizureProjectTree altizureApi undefined.");var _=c.model.tiling.maxLevel,w=c.model.tiling.minLevel;(n=function(e,t){return!t||"object"!==Qi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,ea(t).call(this,e,{sceneGraphRoot:o,name:a,eventHandlers:s,debug:l,maxLevel:_,minLevel:w,showBBox:h,priorityRank:d,TreeMaterialType:m,NodeMaterialType:g})))._countryName=f,n._altizureApi=u,n.sharedOptions.maxLevel=_,n.sharedOptions.projInfo=c,n.sharedOptions.dataUrl=n.dataUrl,n.sharedOptions.treeMaterial=n.material,n.sharedOptions.loadWorker=b;var x={parent:null,x:0,y:0,level:0,sharedOptions:n.sharedOptions};return n.root=new n.Node(x),n.numOfNodes++,c.model.isImported&&(n.style.flatShading=!0),n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ta(e,t)}(t,qt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return e=$i(ea(t.prototype),"destruct",this).call(this)&&e,this._altizureApi=void 0,this.sharedOptions=void 0,e}},{key:"updateVisibility",value:function(){return $i(ea(t.prototype),"updateVisibility",this).call(this)}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"countryName",get:function(){return this._countryName}},{key:"basepath",get:function(){return this.projInfo.storage.basePath}},{key:"dataUrl",get:function(){var e=this.basepath;e&&e.length>0&&"/"===e[0]&&(console.warn("unusual url",e),e="https://www.altizure.com"+e);var t=e+"/web/";return Object.defineProperty(this,"dataUrl",{value:t,writable:!1,configurable:!0}),this.dataUrl}}])&&Ji(r.prototype,n),t}();function na(e){return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ia(e,t,r){return(ia="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=aa(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function aa(e){return(aa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sa(e,t){return(sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var la=function(e){function t(e){var r,n=e.key,o=e.value,i=e.weight,a=void 0===i?100:i,s=e.is404,l=void 0!==s&&s,u=e.gpuUsage,c=void 0===u?4096:u,f=e.ramUsage;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==na(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,aa(t).call(this,{key:n,value:o,weight:a,gpuUsage:c,ramUsage:f})))._is404=l,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sa(e,t)}(t,wn),r=t,(n=[{key:"destruct",value:function(){return!!this.is404||(this._value.geometry.dispose(),this._value.material&&(an(this._value.material),this._value.material=null),ia(aa(t.prototype),"destruct",this).call(this))}},{key:"valid",get:function(){return this.is404||this._value&&this._value.geometry}},{key:"is404",get:function(){return this._is404}}])&&oa(r.prototype,n),t}(),ua={position:3,uv:2,color:3,normal:3};function ca(e){return(ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fa(e,t,r){return(fa=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ga(o,r.prototype),o}).apply(null,arguments)}function ha(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function pa(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function da(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){pa(i,n,o,a,s,"next",e)}function s(e){pa(i,n,o,a,s,"throw",e)}a(void 0)})}}function va(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ma(e,t,r){return(ma="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ya(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ya(e){return(ya=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ga(e,t){return(ga=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ba=function(e){function t(e){var r,n=e.parent,o=e.x,i=e.y,a=e.level,s=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==ca(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,ya(t).call(this,{parent:n,x:o,y:i,level:a,sharedOptions:s}))).name=a+"_"+r.xId+"_"+r.yId,r._bbox=null,r._estimatedBBox=null,r.style={map:void 0,color:16777215},r.contentLoaded.then(function(){}),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ga(e,t)}(t,bn),r=t,(n=[{key:"destruct",value:function(){var e=ma(ya(t.prototype),"destruct",this).call(this);return this.style=void 0,e}},{key:"encryptFolderPath",value:function(e,t){var r="";return(Array.isArray(t)?t:[]).reduce(function(t,n){return(t<e.length||t+n<e.length)&&(r+=e.substring(t,t+n)+"/"),t+n},0),r}},{key:"downloading",value:function(){var e=da(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._downloadAndDecode());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=da(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._cookDownload(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=da(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new la({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new h.Object3D;var t;this.geometry=e.value.geometry,this.style=e.value.material,this.geometry.index&&this.geometry.index.count>0?t=new h.Mesh(this.geometry,this.material):(this.geometry.index=null,t=new h.Points(this.geometry,this.material));var r=function(e){for(var t=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;n<o;n+=3)for(var i=0;i<3;i++){var a=e[n+i];a>t[i]&&(t[i]=a),a<r[i]&&(r[i]=a)}return{max:t,min:r}}(this.geometry.attributes.position.array),n=r.max,o=r.min;return this.rangeHeight=new h.Vector2(o[2],n[2]),this.boundingBox=new h.Box3(fa(h.Vector3,ha(o)),fa(h.Vector3,ha(n))),t}},{key:"_prefetch",value:function(e){return function e(t,r){return 0!==r&&(t.isRoot||!t.parent.is404&&t.parent.loaded||e(t.parent,r--))}(this,e)}},{key:"_computeEstimatedBBox",value:function(){var e=this.projInfo.model.tiling,t=(e.maxBound.x-e.minBound.x)/e.xTiles,r=(e.maxBound.y-e.minBound.y)/e.yTiles,n=e.minBound.x+t*this.xId,o=e.minBound.x+t*(this.xId+this.levelBlockSize),i=e.minBound.y+r*this.yId,a=e.minBound.y+r*(this.yId+this.levelBlockSize),s=e.minBound.z,l=e.maxBound.z,u=new h.Box3(new h.Vector3(n,i,s),new h.Vector3(o,a,l)),c=(new h.Matrix4).makeBasis(e.xDir.clone().normalize(),e.yDir.clone().normalize(),e.zDir.clone().normalize()).setPosition(e.origin.clone());u.applyMatrix4(c);var f=this.estimatedRangeHeight;return f.x>u.min.z&&u.min.setZ(f.x),f.y<u.max.z&&u.max.setZ(f.y),u}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,on(e)}return!0}},{key:"_downloadAndDecode",value:function(){return this.loadWorker.load({resourceKey:this.resourceKey,timeout:3e4})}},{key:"_cookDownload",value:function(e){var t=this,r=e.geometry,n=e.images,o=e.materials,i=(e.bbox,[]),a={};for(var s in o)a[s]=i.length,o[s].name=s,i.push(o[s]);o=void 0,i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"standard";return e instanceof Array?e.map(function(e){return tn(e,t)}):tn(e,t)}(i,"phong");var l=new h.BufferGeometry;for(var u in r.attributes)l.addAttribute(u,new h.BufferAttribute(r.attributes[u],ua[u])),r.attributes[u]=void 0;return r.attributes=void 0,r.index&&(l.setIndex(new h.BufferAttribute(r.index,1)),r.index=void 0),r.groups.forEach(function(e){l.addGroup(e.start,e.count,a[e.materialName])}),r.groups=void 0,Vn(n).then(function(e){n=void 0;var r=0;i.forEach(function(t){t.map&&(t.map=e[t.map],1022!==t.map.format&&console.warn("unknown texture format",t.map.format),r+=t.map.image.width*t.map.image.height),t.emissiveMap&&(t.emissiveMap=e[t.emissiveMap]),t.specularMap&&(t.specularMap=e[t.specularMap])});var o=4*(l.attributes.position?l.attributes.position.array.length:0)+4*(l.attributes.normal?l.attributes.normal.array.length:0)+4*(l.attributes.color?l.attributes.color.array.length:0)+4*(l.attributes.uv?l.attributes.uv.array.length:0)+4*(l.index?l.index.array.length:0)+4*r;"PTLOD"===t.modelType&&(o*=4);var a={geometry:l,material:i,matrix:(new h.Matrix4).identity()},s={key:t.resourceKey,value:a,weight:1,gpuUsage:o};return Promise.resolve(new la(s))})}},{key:"resourceKey",get:function(){var e=this.encryptName,t="",r=this.projInfo.model.meshlodOption;r&&"ENCRYPTEDFOLDER"===r.pathType&&(t=this.encryptFolderPath(e,r.folderPattern));var n=this.dataUrl+t+e+".ab";return Object.defineProperty(this,"resourceKey",{value:n,writable:!1,configurable:!0}),this.resourceKey}},{key:"expandable",get:function(){return ma(ya(t.prototype),"expandable",this)&&this.level<this.maxDisplayLevel&&this._prefetch(2)&&!this.wholeCropped}},{key:"wholeCropped",get:function(){if(this._level<=2)return!1;var e=this.sharedOptions.treeMaterial._cropMask;if(!e)return!1;var t=this.sharedOptions.projInfo.model.orthoInfo,r=t.origin,n=t.xDir,o=t.yDir,i=t.zDir,a=t.minBound,s=t.maxBound,l=this.estimatedBBox.min.clone(),u=this.estimatedBBox.max.clone(),c=l.clone().sub(r),f=u.clone().sub(r),p=[new h.Vector3(c.x,c.y,c.z),new h.Vector3(c.x,c.y,f.z),new h.Vector3(c.x,f.y,f.z),new h.Vector3(c.x,f.y,c.z),new h.Vector3(f.x,c.y,c.z),new h.Vector3(f.x,c.y,f.z),new h.Vector3(f.x,f.y,f.z),new h.Vector3(f.x,f.y,c.z)].map(function(e){return new h.Vector3(e.clone().dot(n),e.clone().dot(o),e.clone().dot(i))}),d=new h.Vector3(1/0,1/0,1/0),v=new h.Vector3(-1/0,-1/0,-1/0);p.map(function(e){e.x<d.x&&(d.x=e.x),e.x>v.x&&(v.x=e.x),e.y<d.y&&(d.y=e.y),e.y>v.y&&(v.y=e.y),e.z<d.z&&(d.z=e.z),e.z>v.z&&(v.z=e.z)});for(var m=d.clone().sub(a).divide(s.clone().sub(a)),y=v.clone().sub(a).divide(s.clone().sub(a)),g=e.canvas.getContext("2d"),b=Math.floor(m.x*e.maskSize),_=Math.floor(m.y*e.maskSize),w=Math.ceil((y.x-m.x)*e.maskSize),x=Math.ceil((y.y-m.y)*e.maskSize),k=g.getImageData(b,_,w,x).data,O=1;O<k.length;O+=4)if(0!==k[O])return!1;return!0}},{key:"estimationCoefficient",get:function(){return 1.1}},{key:"rangeHeight",get:function(){return this._rangeHeight},set:function(e){!e||isNaN(e.x)||isNaN(e.y)?console.warn("Invalid rangeHeight",e):this._rangeHeight=(new h.Vector2).copy(e)}},{key:"estimatedRangeHeight",get:function(){if(this.rangeHeight)return this.rangeHeight;var e,t,r,n,o;return this.isRoot?(t=(e=this.projInfo.model.tiling).zDir.clone().multiplyScalar(e.minBound.z).add(e.origin).z,r=e.zDir.clone().multiplyScalar(e.maxBound.z).add(e.origin).z,n=Math.min(t,r),o=Math.max(t,r),new h.Vector2(n,o)):this.parent.estimatedRangeHeight}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"maxDisplayLevel",get:function(){return this.sharedOptions.projInfo.model.tiling.maxDisplayLevel}},{key:"modelType",get:function(){return this.sharedOptions&&this.projInfo&&this.projInfo.model.modelType?this.projInfo.model.modelType:"MESHLOD"}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"dataUrl",get:function(){return this.sharedOptions.dataUrl}},{key:"levelBlockSize",get:function(){return Object.defineProperty(this,"levelBlockSize",{value:Math.pow(2,this.maxLevel-this.level),writable:!1,configurable:!0}),this.levelBlockSize}},{key:"xId",get:function(){return Object.defineProperty(this,"xId",{value:this.x*this.levelBlockSize,writable:!1,configurable:!0}),this.xId}},{key:"yId",get:function(){return Object.defineProperty(this,"yId",{value:this.y*this.levelBlockSize,writable:!1,configurable:!0}),this.yId}},{key:"versionControl",get:function(){return this.projInfo.storage.versionControl}},{key:"encryptName",get:function(){var e=this.versionControl,t=A()(this.name+e).toString(M.a);return Object.defineProperty(this,"encryptName",{value:t,writable:!1,configurable:!0}),this.encryptName}},{key:"material",get:function(){var e=this;if(!this._material)if(this.style instanceof Array){this._material=[];var t={},r=this;this.style.forEach(function(n){var o={style:n,tree:{style:t},geometry:r.geometry},i=e.sharedOptions.treeMaterial.generateTileMaterial(o);i.needsUpdate=!0,e._material.push(i)})}else this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this),this._material.needsUpdate=!0;return this._material}}])&&va(r.prototype,n),t}();ba.stat={download:{time:0,count:0},processing:{time:0,count:0},cook:{time:0,count:0}};var _a=ba,wa=function e(t,r,n,o,i,a,s,l,u){var c,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=t,this.id=r,this.name=n,this.owner=o,this.views=i,this.date=a,this.storage=s,this.model=l,this.render=u,(f="valid")in(c=this)?Object.defineProperty(c,f,{value:!1,enumerable:!0,configurable:!0,writable:!0}):c[f]=!1,this.valid=!0};function xa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ka,Oa=function(){function e(t,r){var n,o,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.versionControl=t,this.cloudPath=r,i=void 0,(o="basePath")in(n=this)?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i;var a=U.countryName;this.preferServer(a)}var t,r;return t=e,(r=[{key:"preferServer",value:function(e){var t=[];"China"===e?(t[0]="oss_sz",t[1]="s3",t[2]="oss_usw",t[3]="local"):(t[0]="s3",t[1]="oss_usw",t[2]="oss_sz",t[3]="local");for(var r,n=this.cloudPath,o=0;o<t.length;o++){for(var i=0;i<n.length;i++)if(n[i].key===t[o]){r=n[i].dataUrl;break}if(r)break}return r?this.basePath=r:console.error("preferredPath error",n,t),this}}])&&xa(t.prototype,r),e}();function Pa(e){return(Pa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Aa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sa(e){return(Sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ma(e,t){return(Ma=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ta(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ea(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.GEOCENTER=1]="GEOCENTER",e[e.SRS_ENU=2]="SRS_ENU"}(ka||(ka={}));var Ca=function e(t,r,n,o,i,a,s){Ta(this,e),this.mercatorTransform=t,Ea(this,"min",void 0),Ea(this,"max",void 0),Ea(this,"position",void 0),Ea(this,"positionMode",void 0),this.position={lng:n,lat:r,alt:0},this.positionMode=ka.GEOCENTER,this.min={lng:i,lat:o},this.max={lng:s,lat:a}},ja=function(e){function t(e,r,n,o,i,a,s,l){var u;Ta(this,t),(u=function(e,t){return!t||"object"!==Pa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Sa(t).call(this,r,n,o,i,a,s,l))).srs=e;var c=u.srsParserENU();return c&&(u.position=c,u.positionMode=ka.SRS_ENU),u}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ma(e,t)}(t,Ca),r=t,(n=[{key:"srsParserENU",value:function(){var e=this.srs;if("ENU:"===e.substring(0,4)){var t,r=e.indexOf(":")+1,n=e.indexOf(","),o=e.substring(r,n),i=n+1,a=e.indexOf(",",i),s="0";-1===a?t=e.substring(i):(t=e.substring(i,a),s=e.substring(a+1));var l={lng:Number(t),lat:Number(o),alt:Number(s)};if(!isNaN(l.lat)&&!isNaN(l.lng))return l;console.error("wrong srs",e)}console.warn("unknown srs",e)}}])&&Aa(r.prototype,n),t}();function Ra(e){return(Ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function La(e,t){return!t||"object"!==Ra(t)&&"function"!=typeof t?Da(e):t}function Ia(e){return(Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Da(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function za(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&function(e,t){(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(e,t)}function Na(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ba(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ua(e,t,r){return t&&Ba(e.prototype,t),r&&Ba(e,r),e}function Fa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Va=function(){function e(t,r){Na(this,e),this.onLoadTrans=r,Fa(this,"tiling",void 0),Fa(this,"tileprofileToObj",void 0),Fa(this,"objToOldDisplay",void 0),Fa(this,"_objToInitCam",void 0),this.tiling=t,this.tileprofileToObj=this._tileprofileToObj();var n=this.tiling.origin.clone();this.objToOldDisplay=this._objToOldDisplay(this.onLoadTrans,n),this._objToInitCam=this.objToOldDisplay.clone()}return Ua(e,[{key:"_tileprofileToObj",value:function(){var e=this.tiling;return(new h.Matrix4).makeBasis(e.xDir,e.yDir,e.zDir).setPosition(e.origin)}},{key:"_objToDisplay",value:function(e,t){var r=(new h.Euler).setFromRotationMatrix(e);return r.x-=1.5*Math.PI,(new h.Matrix4).multiply((new h.Matrix4).makeRotationFromEuler(r)).multiply((new h.Matrix4).makeTranslation(-t.x,-t.y,-t.z))}},{key:"_objToOldDisplay",value:function(e,t){var r=e.clone(),n=(new h.Matrix4).makeTranslation(-t.x,-t.y,-t.z);return r.multiply(n)}},{key:"objToInitCam",get:function(){return this._objToInitCam.clone()}}]),e}(),Ha=function(e){function t(e,r,n,o,i){var a;Na(this,t),(a=La(this,Ia(t).call(this,n,i))).modelType=e,a.isImported=r,a.gis=o,a.onLoadTrans=i,Fa(Da(a),"objToModel",void 0),Fa(Da(a),"modelToObj",void 0),Fa(Da(a),"modelToENU",void 0),Fa(Da(a),"waterToENU",void 0),Fa(Da(a),"orthoInfo",void 0);var s=a.tiling.origin.clone();return a.orthoInfo=a._orthoInfo(a.objToOldDisplay.clone()),a.objToModel=a._objToDisplay(a.objToOldDisplay.clone(),s),a.modelToObj=(new h.Matrix4).getInverse(a.objToModel),a.modelToENU=a._modelToShape(n.minBound.z),a.waterToENU=a.modelToENU.clone(),a}return za(t,Va),Ua(t,[{key:"_orthoInfo",value:function(e){var t=function(t){var r=t.minBound,n=t.maxBound,o=t.origin,a=t.xDir,s=t.yDir,l=t.zDir,u=new Array(8);u[0]=r.clone(),u[1]=new h.Vector3(r.x,n.y,r.z),u[2]=new h.Vector3(n.x,r.y,r.z),u[3]=new h.Vector3(n.x,n.y,r.z);for(var c=0;c<4;++c)u[c+4]=u[c].clone().setZ(n.z);for(var f=new Array(2),p=0;p<8;++p){var d=i(o,a,s,l,u[p]);d.applyMatrix4(e),0===p?(f[0]=d.clone(),f[1]=d.clone()):(f[0].x=Math.min(f[0].x,d.x),f[0].y=Math.min(f[0].y,d.y),f[0].z=Math.min(f[0].z,d.z),f[1].x=Math.max(f[1].x,d.x),f[1].y=Math.max(f[1].y,d.y),f[1].z=Math.max(f[1].z,d.z))}return f}(this.tiling),r=(new h.Matrix4).extractRotation(e).transpose(),n=new h.Vector3(t[0].x,t[0].z,t[0].y),o=new h.Vector3(t[1].x,t[1].z,t[1].y);return{origin:this.tiling.origin.clone(),xDir:new h.Vector3(1,0,0).applyMatrix4(r),yDir:new h.Vector3(0,0,1).applyMatrix4(r),zDir:new h.Vector3(0,1,0).applyMatrix4(r),minBound:n,maxBound:o,width:t[1].x-t[0].x,height:t[1].y-t[0].y,area:(t[1].x-t[0].x)*(t[1].y-t[0].y)};function i(e,t,r,n,o){var i=t.clone().multiplyScalar(o.x),a=r.clone().multiplyScalar(o.y),s=n.clone().multiplyScalar(o.z);return e.clone().add(i).add(a).add(s)}}},{key:"_modelToShape",value:function(e){return(new h.Matrix4).setPosition(new h.Vector3(0,0,-e))}},{key:"objToENU",get:function(){return this.modelToENU.clone().multiply(this.objToModel)}}]),t}(),Wa=function(e){function t(e,r,n,o,i,a,s){var l;Na(this,t),(l=La(this,Ia(t).call(this,n,a))).modelType=e,l.isImported=r,l.gis=o,l.model_transform=i,l.onLoadTrans=a,l.meshlodOption=s,Fa(Da(l),"objToModel",void 0),Fa(Da(l),"modelToObj",void 0),Fa(Da(l),"modelToENU",void 0),Fa(Da(l),"waterToENU",void 0),Fa(Da(l),"orthoInfo",void 0),o.positionMode===ka.SRS_ENU?l.objToModel=i.clone():l.objToModel=(new h.Matrix4).identity(),l.modelToObj=(new h.Matrix4).getInverse(l.objToModel),l.modelToENU=l._modelToShape(l.onLoadTrans),l.orthoInfo=l._orthoInfo();var u=l.orthoInfo.minBound.z;return l.waterToENU=(new h.Matrix4).setPosition(new h.Vector3(0,0,u)),l}return za(t,Va),Ua(t,[{key:"_modelToShape",value:function(e){var t=(new h.Euler).setFromRotationMatrix((new h.Matrix4).extractRotation(e));return t.x-=1.5*Math.PI,(new h.Matrix4).makeRotationFromEuler(t)}},{key:"_tileprofileToENU",value:function(){var e=this._tileprofileToObj();return this.modelToENU.clone().multiply(this.objToModel).multiply(e)}},{key:"_orthoInfo",value:function(){var e=this.objToENU,t=((new h.Matrix4).getInverse(e),this._tileprofileToENU()),r=new h.Box3(this.tiling.minBound,this.tiling.maxBound);r.applyMatrix4(t);var n=r.min.y,o=r.max.y,i=(new h.Matrix4).set(1,0,0,0,0,-1,0,n+o,0,0,1,0,0,0,0,1).clone().multiply(e),a=new h.Vector3,s=new h.Vector3,l=new h.Vector3;i.clone().transpose().extractBasis(a,s,l);var u=(new h.Vector3).setFromMatrixPosition(i);return{origin:a.clone().multiplyScalar(-u.x).add(s.clone().multiplyScalar(-u.y)).add(l.clone().multiplyScalar(-u.z)),xDir:a,yDir:s,zDir:l,minBound:r.min,maxBound:r.max}}},{key:"objToENU",get:function(){return this.modelToENU.clone().multiply(this.objToModel)}}]),t}();function Ga(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ka(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Xa=function(){function e(t,r,n,o,i,a,s,l,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.xTiles=t,this.yTiles=r,this.zTiles=n,this.origin=o,this.xDir=i,this.yDir=a,this.zDir=s,Ka(this,"maxLevel",void 0),Ka(this,"minLevel",void 0),Ka(this,"maxDisplayLevel",void 0),Ka(this,"minDisplayLevel",void 0),Ka(this,"_maxBound",void 0),Ka(this,"_minBound",void 0),this.minLevel=0,this.maxLevel=this.getMaxLevel(this.xTiles,this.yTiles),this.minDisplayLevel=this.minLevel,this.maxDisplayLevel=this.maxLevel,this._maxBound=l,this._minBound=u}var t,r;return t=e,(r=[{key:"getMaxLevel",value:function(e,t){for(var r=Math.max(e,t),n=0;r>1;)r/=2,n++;return n}},{key:"maxBound",get:function(){return this._maxBound.clone()}},{key:"minBound",get:function(){return this._minBound.clone()}}])&&Ga(t.prototype,r),e}(),Ya=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.annotations=t,this.initialCamPos=r};function qa(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Za=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.major=t,this.minor=r,this.patch=n}var t,r;return t=e,(r=[{key:"compatibleWith",value:function(e){return this.major===e.major&&!(this.minor<e.minor)}}])&&qa(t.prototype,r),e}();function Qa(e){var t=e.split(".").map(function(t){var r=Number(t);if(isNaN(r))throw console.error("Invalid Version",e),Error("Invalid Version");return r});return new Za(t[0],t[1],t[2])}function Ja(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function $a(e){return function(){var e;return e=regeneratorRuntime.mark(function e(t){var r,n=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:3e4,e.abrupt("return",b()({method:"get",url:t,timeout:r,responseType:"json"}).then(function(e){if(e.data.spec_version){var t,r=e.data,n=r.spec_version,o=r.model_transform,i=r.srs,a=r.model_type,s=(new h.Matrix4).set(o[0][0],o[0][1],o[0][2],o[0][3],o[1][0],o[1][1],o[1][2],o[1][3],o[2][0],o[2][1],o[2][2],o[2][3],o[3][0],o[3][1],o[3][2],o[3][3]);"MESHLOD"===a&&(t=e.data.meshlod_option)&&(t.pathType=t.path_type,t.folderPattern=t.folder_pattern,delete t.path_type,delete t.folder_pattern);var l={specVersion:n,objToModel:s,srs:i,meshlodOption:t};return Promise.resolve(l)}return Promise.resolve(void 0)}).catch(function(e){return console.warn(e),Promise.resolve(void 0)}));case 2:case"end":return e.stop()}},e)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Ja(i,n,o,a,s,"next",e)}function s(e){Ja(i,n,o,a,s,"throw",e)}a(void 0)})}.apply(this,arguments)}.apply(this,arguments)}function es(e){return(es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ts(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function rs(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ts(i,n,o,a,s,"next",e)}function s(e){ts(i,n,o,a,s,"throw",e)}a(void 0)})}}function ns(e){return e instanceof Array&&3===e.length?new h.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new h.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}function os(e,t){return function(){return rs(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.project({pid:r});case 2:return n=e.sent,e.abrupt("return",is(n));case 4:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function is(e){return function(){return rs(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,l,u,c,f,h,p,d,v,m,y,g,b,_,w,x,k,O,P,A,S,M,T,E,C,j,R,L,I,D,z,N,B,U,F,V,H,W,G;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id,n=t.name,o=t.owner,i=t.isImported,a=t.modelType,s=t.views,l=t.date,u=t.versionControl,c=t.cloudPath,f=t.geoInfo,h=t.annotations,p=t.modelTransform,"string"!=typeof u&&(u=""),f||(f={mercatorTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],minLat:-.01,minLong:89.99,maxLat:.01,maxLong:90.01,centerLat:0,centerLong:90}),v=(d=f).mercatorTransform,m=d.minLat,y=d.minLong,g=d.maxLat,b=d.maxLong,_=d.centerLat,w=d.centerLong,x=p.origin,k=p.xDir,O=p.yDir,P=p.zDir,A=p.minBound,S=p.maxBound,M=p.xTiles,T=p.yTiles,E=p.zTiles,C=p.onLoadTrans,j=p.initialCamPos,C=ss(C),R=new Oa(u,c),L=new Ya(h,j),I=new Xa(M,T,E,ns(x),ns(k),ns(O),ns(P),ns(S),ns(A)),N=R.basePath,e.next=12,$a(N+"/web/info.txt");case 12:return(B=e.sent)?(F=B.specVersion,V=B.srs,H=B.objToModel,W=B.meshlodOption,U=Qa(F),z=new ja(V,v,_,w,m,y,g,b),D=new Wa(a,i,I,z,H,C,W)):(U=new Za(0,0,0),z=new Ca(v,_,w,m,y,g,b),D=new Ha(a,i,I,z,C)),G=new wa(U,r,n,o,s,l,R,D,L),e.abrupt("return",Promise.resolve(G));case 16:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function as(e){return function(){return rs(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new C({apiUrl:"https://api.altizure.com/graphql",key:"7MkQf8UggsPaadvrlKALspJWZejZAJOLHn3cnIy"}),e.abrupt("return",os(r,t));case 2:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function ss(e){var t=new h.Matrix4;return e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new h.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new h.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureProjectInfo unrecognized onLoadTrans",e):"object"===es(e)&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new h.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new h.Matrix4).makeRotationZ(Math.PI*e.z)),t}function ls(e){return(ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function us(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function cs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fs(e,t,r){return(fs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hs(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function hs(e){return(hs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ps(e,t){return(ps=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ds=function(e){function t(e,r){var n,o=r.name,i=r.forest,a=r.altizureApi,s=r.countryName,l=r.loadWorker,u=r.onTileDownloaded,c=r.pid,f=r.showBBox,h=r.position,p=void 0===h?{lng:114,lat:22.25,alt:0}:h;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==ls(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,hs(t).call(this,e,{name:o,forest:i,showBBox:f,position:p})))._altizureApi=a,n._countryName=s,n._loadWorker=l,n.onTileDownloaded=u,n._pid=c,n._projInfo={},n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ps(e,t)}(t,wi),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest.remove(this._tree),e=this.tree.destruct()&&e,this._tree=void 0),fs(hs(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,n=t){e.next=7;break}return e.next=5,os(this.altizureApi,this.pid);case 5:n=e.sent,console.log(n);case 7:return r._projInfo=n,r.name=r._projInfo.name,e.abrupt("return",r._createTree(r._projInfo));case 10:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){us(i,n,o,a,s,"next",e)}function s(e){us(i,n,o,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"_createTree",value:function(e){var t=this;if(!e||!e.valid)return Promise.reject(new Error("Invalid projInfo."));var r=this,n=this._treeNode,o=e.name,i=this.altizureApi,a=this._countryName,s=this.showBBox;return new Promise(function(l,u){r._tree=new ra(_a,{sceneGraphRoot:n,name:o,eventHandlers:{onTileDownloaded:r.onTileDownloaded,onContentInitialized:function(){console.log(o+"initialized.",r),l(r)}},debug:!1,altizureApi:i,projInfo:e,countryName:a,showBBox:s,loadWorker:r._loadWorker}),r._tree.visible=r.visible,t._forest.add(r._tree)})}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"pid",get:function(){return this._pid}},{key:"projInfo",get:function(){return this._projInfo}}])&&cs(r.prototype,n),t}(),vs=r(6),ms=r.n(vs);function ys(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var gs=function(){function e(){var t=this,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).workerSize,n=void 0===r?2:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.workerSize=n,this.listeners=new Map,this.workers=[],this.jobs=[];for(var o=function(e){t.workers.push(new ms.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.resourceKey,o=r.data.status,i=r.data.payload;if(window.DEBUGING&&(void 0===window.totalWorkerTime&&(window.totalWorkerTime=0),window.totalWorkerTime+=i.consumeTime,void 0===window.totalParseTime&&(window.totalParseTime=0),window.totalParseTime+=i.parseTime),t.listeners.has(n)){var a=t.listeners.get(n);t.listeners.delete(n),a.forEach(function(e){var t=e.resolve,r=e.reject;200===o?t(i):r(i)})}else console.error("AltizureLoader",n);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("AltizureLoader",e)}},i=0;i<this.workerSize;i++)o(i)}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("AltizureLoader terminate failed",e),!1}return e}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,o=void 0===n?3e4:n;return new Promise(function(e,n){var i={resolve:e,reject:n};if(t.listeners.has(r))t.listeners.get(r).push(i);else{t.listeners.set(r,[i]);var a={resourceKey:r,timeout:o,modelType:"AltizureBinary"},s=t.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);t.jobs[s]++,t.workers[s].postMessage(a)}})}},{key:"numOfTasks",get:function(){return this.listeners.size}}])&&ys(t.prototype,r),e}();function bs(e){return(bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ws(e,t,r){return(ws="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=xs(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function xs(e){return(xs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ks(e,t){return(ks=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Os=function(e){function t(e){var r,n=e.key,o=e.value,i=e.weight,a=void 0===i?100:i,s=e.gpuUsage,l=e.ramUsage,u=e.is404,c=void 0!==u&&u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==bs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,xs(t).call(this,{key:n,value:o,weight:a,gpuUsage:s,ramUsage:l})))._is404=c,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ks(e,t)}(t,wn),r=t,(n=[{key:"destruct",value:function(){return this.is404||(this._value.geometry.dispose(),this._value.material&&(an(this._value.material),this._value.material=null),this._value.nextLevelParams=null,this._value.subtree=null),ws(xs(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this.is404||this._value}},{key:"is404",get:function(){return this._is404}}])&&_s(r.prototype,n),t}(),Ps=r(14),As=r.n(Ps);function Ss(e){return(Ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ms(e,t,r){return(Ms=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&Is(o,r.prototype),o}).apply(null,arguments)}function Ts(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Es(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Cs(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Es(i,n,o,a,s,"next",e)}function s(e){Es(i,n,o,a,s,"throw",e)}a(void 0)})}}function js(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Rs(e,t,r){return(Rs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ls(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Ls(e){return(Ls=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Is(e,t){return(Is=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ds(e){return e.children&&0!==e.children.length?e.children.length>1?e:1===e.children.length?Ds(e.children[0]):void 0:e}function zs(e){var t=e.osgGeometry,r=e.groups,n=new h.BufferGeometry;return n.addAttribute("position",new h.BufferAttribute(t.Vertex,3)),n.setIndex(new h.BufferAttribute(t.Indices,1)),n.addAttribute("uv",new h.BufferAttribute(t.TexCoord0,2)),r.length>1&&r.forEach(function(e){n.addGroup(e.start,e.count,e.materialIndex)}),n}function Ns(e,t){return e.length>1?e.map(function(e){return r(e)}):r(e[0]);function r(e){var r=e.map_Kd;return!t[r]&&t[r+".jpg"]&&(r+=".jpg"),{map:t[r],color:16777215}}}var Bs=function(e){function t(e){var r,n=e.parent,o=e.name,i=e.fileDirectory,a=void 0===i?null:i,s=e.fileName,l=e.depth,u=e.estimatedBBox,c=e.subtree,f=void 0===c?null:c,p=e.sharedOptions;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==Ss(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Ls(t).call(this,{parent:n,name:o,sharedOptions:p})))._fileDirectory=a,r.fileName=s,u||console.warn(s," has no estBBox"),r._estimatedBBox=u,r._nextLevelParams=null,r._subtree=f,r.subtree){var d=Ds(r.subtree);d.children&&d.children.length>0?r._nextLevelParams=d.children.map(function(e){e=Ds(e);var t=r.completeUrl(e.url).fileName;return{fileDirectory:a,fileName:t,subtree:e,estimatedBBox:new h.Box3((new h.Vector3).copy(e.bbox.minBound),(new h.Vector3).copy(e.bbox.maxBound))}}):r._nextLevelParams=[]}else r.isRoot||console.warn("No OSG meta");return r._depth=l,r.style={map:void 0,color:16777215},r.contentLoaded.then(function(){}),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Is(e,t)}(t,pn),r=t,(n=[{key:"destruct",value:function(){var e=Rs(Ls(t.prototype),"destruct",this).call(this);return this._subtree=void 0,this._nextLevelParams=void 0,e}},{key:"downloading",value:function(){var e=Cs(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("download"),t=this.resourceKey,r=this.TILE_DOWNLOAD_TIMEOUT,e.abrupt("return",this.loadWorker.load({resourceKey:t,timeout:r}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=Cs(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,l,u,c,f,p,d,v,m,y,g,b,_,w=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(c in r=0,n=t.osgGeometry,o=t.groups,i=t.materials,a=t.meta,s=t.images,l=t.bbox,u=0,s)u+=2*s[c].length;return f=zs({osgGeometry:n,groups:o}),e.next=12,Vn(s);case 12:return p=e.sent,d=Ns(i,p),v=lr(f),m=sn(d),r+=v+m,u+=v,y=new h.Box3(Ms(h.Vector3,Ts(l.min)),Ms(h.Vector3,Ts(l.max))),g=t.nextLevelParams.map(function(e){var t=w.completeUrl(e.fileName);return{fileDirectory:t.fileDirectory,fileName:t.fileName,estimatedBBox:new h.Box3(Ms(h.Vector3,Ts(e.estimatedBBox.min)),Ms(h.Vector3,Ts(e.estimatedBBox.max)))}}),b=null,a&&(b=a.tree.root),_={key:this.resourceKey,value:{geometry:f,material:d,nextLevelParams:g,subtree:b,bbox:y},weight:1,gpuUsage:r,ramUsage:u},e.abrupt("return",Promise.resolve(new Os(_)));case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Cs(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Os({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,ramUsage:1024,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){var t=this;if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new h.Object3D;if(this.geometry=e.value.geometry,this.style=e.value.material,this.boundingBox=e.value.bbox,e.value.subtree){this._subtree=e.value.subtree;var r=Ds(this.subtree);this._nextLevelParams=r.children.map(function(e){var r=Ds(e);r.children&&0!==r.children.length||(e=r);var n=t.completeUrl(e.url);return{fileDirectory:n.fileDirectory,fileName:n.fileName,subtree:e,estimatedBBox:new h.Box3((new h.Vector3).copy(e.bbox.minBound),(new h.Vector3).copy(e.bbox.maxBound))}})}else this._nextLevelParams||(this._nextLevelParams=e.value.nextLevelParams);return new h.Mesh(this.geometry,this.material)}},{key:"_computeEstimatedBBox",value:function(){return this._estimatedBBox}},{key:"spawn",value:function(){var e=this,r=this.depth+1;return this._nextLevelParams.forEach(function(n,o){var i={parent:e,name:n.fileName,fileDirectory:n.fileDirectory,fileName:n.fileName,depth:r,estimatedBBox:n.estimatedBBox,subtree:n.subtree,sharedOptions:e.sharedOptions};e.nodes[o]=new t(i)}),!0}},{key:"completeUrl",value:function(e){var t=this.resourceDirectory,r=As()(e),n=r.match(/(.*)[\/\\]/);return{fileDirectory:n?t+n[0]:t,fileName:r.replace(/^.*[\\\/]/,"")}}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,on(e)}return!0}},{key:"resourceKey",get:function(){var e;if(window.ActiveXObject||"ActiveXObject"in window)e=(this.resourceDirectory+this.fileName).split("/").reduce(function(e,t,r){return e+(0===r?encodeURIComponent(t):r<3||t.length>0&&"."!==t?"/"+encodeURIComponent(t):"")});else{var t=new URL(this.resourceDirectory+this.fileName);e=t.origin+t.pathname.split("/").reduce(function(e,t){return e+(t.length>0?"/"+encodeURIComponent(t):"")},"")}return e}},{key:"resourceDirectory",get:function(){return this._fileDirectory?this._fileDirectory:this.sharedOptions.dataUrl}},{key:"tileName",get:function(){var e=this.fileName;return e.replace(/\.[^\/.]+$/,"")}},{key:"expandable",get:function(){return Rs(Ls(t.prototype),"expandable",this)&&this.loaded&&null!==this._nextLevelParams&&this._nextLevelParams.length>0}},{key:"estimationCoefficient",get:function(){return 16}},{key:"maxGpuUsage",get:function(){return 17240734}},{key:"depth",get:function(){return this._depth}},{key:"level",get:function(){return this.depth}},{key:"spec",get:function(){return this.sharedOptions.spec}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"TILE_DOWNLOAD_TIMEOUT",get:function(){return this.sharedOptions.TILE_DOWNLOAD_TIMEOUT}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"subtree",get:function(){return this._subtree}},{key:"material",get:function(){var e=this;if(!this._material)if(this.style instanceof Array){this._material=[];var t={},r=this;this.style.forEach(function(n){var o={style:n,tree:{style:t},geometry:r.geometry},i=e.sharedOptions.treeMaterial.generateTileMaterial(o);i.needsUpdate=!0,e._material.push(i)})}else this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this),this._material.needsUpdate=!0;return this._material}}])&&js(r.prototype,n),t}();function Us(e){return(Us="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vs(e,t,r){return(Vs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hs(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Hs(e){return(Hs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ws(e,t){return(Ws=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gs=function(e){function t(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bs,o=arguments.length>1?arguments[1]:void 0,i=o.name,a=o.sceneGraphRoot,s=o.eventHandlers,l=o.maxLevel,u=void 0===l?24:l,c=o.minLevel,f=o.priorityRank,p=void 0===f?2:f,d=o.showBBox,v=o.debug,m=o.altizureApi,y=o.spec,g=o.projInfo,b=o.TreeMaterialType,_=void 0===b?ir:b,w=o.NodeMaterialType,x=void 0===w?tr:w,k=o.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y=y||g,(e=function(e,t){return!t||"object"!==Us(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Hs(t).call(this,n,{name:i,sceneGraphRoot:a,eventHandlers:s,maxLevel:u,minLevel:c,priorityRank:p,showBBox:d,TreeMaterialType:_,NodeMaterialType:x,debug:v}))).spec=y,e._altizureApi=m,e.sharedOptions.spec=y,e.sharedOptions.TILE_DOWNLOAD_TIMEOUT=3e4,e.sharedOptions.loadWorker=k,e.sharedOptions.dataUrl=e.dataUrl,e.sharedOptions.treeMaterial=e.material,r=y.modelTransform&&y.modelTransform.bbox?new h.Box3(y.modelTransform.bbox.min,y.modelTransform.bbox.max):new h.Box3(y.model.orthoInfo.origin.clone().add(y.model.orthoInfo.minBound),y.model.orthoInfo.origin.clone().add(y.model.orthoInfo.maxBound));var O={parent:null,name:"root",fileName:"root.ab",sharedOptions:e.sharedOptions,depth:0,estimatedBBox:r};return e.root=new e.Node(O),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ws(e,t)}(t,Ft),r=t,(n=[{key:"destruct",value:function(){var e=!0;return e=Vs(Hs(t.prototype),"destruct",this).call(this)&&e,this._altizureApi=void 0,this.spec=void 0,this.sharedOptions.spec=void 0,this.sharedOptions=void 0,e}},{key:"expand",value:function(e){return e.level>this.maxLevel?(console.warn("exceed max level",e.level,this.maxLevel),!1):e.nodes.length>0?(console.warn(e,"children exist"),!1):0!==e.nodes.length||e.spawn()}},{key:"basepath",get:function(){if(this.spec.cloudPath){var e=[];"China"===this.countryName?(e[0]="oss_sz",e[1]="s3",e[2]="oss_usw",e[3]="local"):(e[0]="s3",e[1]="oss_usw",e[2]="oss_sz",e[3]="local");for(var t,r=e,n=this.spec.cloudPath,o=0;o<r.length;o++){for(var i=0;i<n.length;i++)if(n[i].key===r[o]){t=n[i].dataUrl;break}if(t)break}return t||console.error("preferredPath error",this.name,n,r),Object.defineProperty(this,"basepath",{value:t,writable:!1,configurable:!0}),this.basepath}return this.spec.storage.basePath}},{key:"dataUrl",get:function(){var e=this.basepath+"/web/";return Object.defineProperty(this,"dataUrl",{value:e,writable:!1,configurable:!0}),this.dataUrl}},{key:"projInfo",get:function(){return this.spec}},{key:"altizureApi",get:function(){return this._altizureApi}}])&&Fs(r.prototype,n),t}();function Ks(e){return(Ks="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xs(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ys(e,t,r){return(Ys="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qs(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function qs(e){return(qs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zs(e,t){return(Zs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qs=function(e){function t(e,r){var n,o=r.name,i=r.forest,a=r.position,s=void 0===a?{lng:114,lat:22.25}:a,l=r.showBBox,u=r.spec,c=r.loadWorker,f=r.onTileDownloaded;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Ks(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,qs(t).call(this,e,{name:o,forest:i,position:s,showBBox:l}))).spec=u,n.loadWorker=c,n.onTileDownloaded=f;var h=u.modelTransform,p=h.position,d=h.quaternion,v=h.scale;return n.displayHolder.position.copy(p),n.displayHolder.quaternion.copy(d),n.displayHolder.scale.copy(v),n.displayHolder.updateMatrix(),n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zs(e,t)}(t,wi),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest.remove(this._tree),e=this.tree.destruct()&&e,this._tree=void 0),Ys(qs(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e=this.spec;return this._createTree(e)}},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid spec."));var t=this._treeNode,r=e.name,n=e.maxLevel,o=e.minLevel,i=this.showBBox,a={onTileDownloaded:this.onTileDownloaded};return this._tree=new Gs(Bs,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:o,showBBox:i,debug:!1,eventHandlers:a,spec:e,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this._forest.add(this._tree),this._tree.initialized}},{key:"pid",get:function(){return this.spec.id}},{key:"projInfo",get:function(){return this.spec}}])&&Xs(r.prototype,n),t}();function Js(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var $s=function(){function e(){var t=this,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).workerSize,n=void 0===r?6:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=new Map,this.workerSize=n,this.workers=[],this.jobs=[];for(var o=function(e){t.workers.push(new ms.a),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.resourceKey,o=r.data.status,i=r.data.payload;if(t.listeners.has(n)){var a=t.listeners.get(n);t.listeners.delete(n),a.forEach(function(e){var t=e.resolve,r=e.reject;if(0===o)r(new Error(i));else if(1===o)t(i);else{var n="uknown worker status";console.error(n,o),r(new Error(n))}})}else console.error("Worker cannot find callback for tile",n);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("OSGLoader",e)}},i=0;i<this.workerSize;i++)o(i)}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,o=void 0===n?3e4:n;return new Promise(function(e,n){var i={resolve:e,reject:n};if(t.listeners.has(r))t.listeners.get(r).push(i);else{t.listeners.set(r,[i]);var a={resourceKey:r,timeout:o,modelType:"OSG"},s=t.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);t.jobs[s]++,t.workers[s].postMessage(a)}})}}])&&Js(t.prototype,r),e}();function el(e){return(el="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rl(e,t,r){return(rl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nl(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function nl(e){return(nl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ol(e,t){return(ol=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var il=function(e){function t(e,r){var n,o=r.sceneGraphRoot,i=r.name,a=void 0===i?"DEMTree":i,s=r.eventHandlers,l=r.priorityRank,u=void 0===l?20:l,c=r.showBBox,f=r.debug,h=r.spec,p=(r.countryName,r.TreeMaterialType),d=void 0===p?ir:p,v=r.NodeMaterialType,m=void 0===v?tr:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==el(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,nl(t).call(this,e,{sceneGraphRoot:o,name:a,eventHandlers:s,debug:f,maxLevel:h.maxLevel,minLevel:h.minLevel,priorityRank:u,showBBox:c,TreeMaterialType:d,NodeMaterialType:m}))).sharedOptions.maxLevel=h.maxLevel,n.sharedOptions.spec=h,n.sharedOptions.treeMaterial=n.material,n.sharedOptions.rootSizeInMeter=n._computeDEMSize();var y={parent:null,x:h.rootNode.x,y:h.rootNode.y,level:h.rootNode.level,maxHeight:h.maxHeight,minHeight:h.minHeight,sharedOptions:n.sharedOptions};return n.root=new n.Node(y),n.numOfNodes++,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ol(e,t)}(t,qt),r=t,(n=[{key:"destruct",value:function(){var e=!0;return rl(nl(t.prototype),"destruct",this).call(this)&&e}},{key:"_computeDEMSize",value:function(){for(var e=this.sharedOptions.spec.rootNode,t=ur({level:e.level,x:e.x,y:e.y}),r=0,n=0;n<4;n++)r+=new h.Vector3(t[n].x,t[n].y,t[n].z).distanceTo(t[(n+1)%4]);return r/4}},{key:"_computeDEMPosition",value:function(){var e=this.sharedOptions.spec.rootNode,t=le(e.level,e.x,e.y),r=t.minX,n=t.minY,o=t.maxX,i=t.maxY,a=me.webMercator2Wgs84(r,n),s=a.latitude,l=a.longitude,u=me.webMercator2Wgs84(o,i),c=u.latitude;return{lng:(l+u.longitude)/2,lat:(s+c)/2}}}])&&tl(r.prototype,n),t}();function al(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function sl(e){return function(){return function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){al(i,n,o,a,s,"next",e)}function s(e){al(i,n,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){var r,n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.demUrl,n=t.domUrl,o=Fn({textureUrl:r},15e3).catch(function(){return Promise.reject(new Error("404"))}),i=Fn({textureUrl:n},15e3).catch(function(){return Promise.resolve(lo(0,0,0))}),e.abrupt("return",Promise.all([o,i]).catch(function(){return Promise.reject(new Error("404"))}));case 4:case"end":return e.stop()}},e)})).apply(this,arguments)}.apply(this,arguments)}function ll(e,t,r){return 6553.6*e+25.6*t+.1*r-1e4}function ul(e){return function(e){for(var t=[0,0,0],r=[255,255,255],n=e.data,o=0,i=0,a=0,s=0;s<e.width*e.height*4;s+=4)o=n[s],i=n[s+1],a=n[s+2],0===o&&0===i&&0===a||(o>t[0]?(t[0]=o,t[1]=i,t[2]=a):o===t[0]&&i>t[1]?(t[1]=i,t[2]=a):o===t[0]&&i===t[1]&&a>t[2]&&(t[2]=a),o<r[0]?(r[0]=o,r[1]=i,r[2]=a):o===r[0]&&i<r[1]?(r[1]=i,r[2]=a):o===r[0]&&i===r[1]&&a<r[2]&&(r[2]=a));return{max:t,min:r}}(function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var r=t.getContext("2d");return r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height)}(e.image))}function cl(e){return(cl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fl(e){return(fl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function hl(e,t){return(hl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pl="\n#include <common>\nvarying vec2 vUv;\n// uniform mat3 uvTransform;\nuniform sampler2D displacementMap;\nuniform sampler2D map;\n\n#include <logdepthbuf_pars_vertex>\n\nvoid main() {\n  vUv = uv;\n  // vUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n  vec3 objectNormal = vec3( normal );\n\n  vec3 transformed = vec3( position );\n  // vec4 terrianRGB = texture2D( map, vUv );\n  vec4 terrianRGB = texture2D( displacementMap, vUv );\n  float height = (terrianRGB.r * 256.0 * 256.0 + terrianRGB.g * 256.0 + terrianRGB.b) * 25.5 - 10000.0;\n  transformed += normalize( objectNormal ) * height;\n\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n  \n  #include <logdepthbuf_vertex>\n}\n",dl="\nuniform vec3 diffuse;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n\nvarying vec2 vUv;\nuniform sampler2D map;\n\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\n  #include <logdepthbuf_fragment>\n  vec4 texelColor = texture2D( map, vUv );\n  // texelColor = mapTexelToLinear( texelColor );\n\n  gl_FragColor = texelColor;\n  #include <dithering_fragment>\n}\n",vl=function(e){function t(e){var r,n=e.map,o=e.displacementMap;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==cl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,fl(t).call(this))).uniforms={map:{type:"t",value:n},displacementMap:{type:"t",value:o}},r.vertexShader=pl,r.fragmentShader=dl,r.isTerrianMaterial=!0,r.color=new h.Color(16777215),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hl(e,t)}(t,h.ShaderMaterial),t}();function ml(e){return(ml="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gl(e,t,r){return(gl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=bl(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function bl(e){return(bl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _l(e,t){return(_l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var wl,xl=function(e){function t(e){var r,n=e.key,o=e.value,i=e.weight,a=void 0===i?100:i,s=e.gpuUsage,l=e.is404,u=void 0!==l&&l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==ml(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,bl(t).call(this,{key:n,value:o,weight:a,gpuUsage:s})))._is404=u,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_l(e,t)}(t,wn),r=t,(n=[{key:"destruct",value:function(){return this.is404||(this._value.dem&&this._value.dem.dispose(),this._value.dom&&this._value.dom.dispose()),gl(bl(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this.is404||this._value}},{key:"is404",get:function(){return this._is404}}])&&yl(r.prototype,n),t}();function kl(e){return(kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ol(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Pl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Al(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Sl(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Al(i,n,o,a,s,"next",e)}function s(e){Al(i,n,o,a,s,"throw",e)}a(void 0)})}}function Ml(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Tl(e,t,r){return(Tl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=El(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function El(e){return(El=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Cl(e,t){return(Cl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var jl=(function(e,t,r,n,o){var i={};Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((wl=function(e){function t(e){var r,n=e.parent,o=e.x,i=e.y,a=e.level,s=e.maxHeight,l=e.minHeight,u=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==kl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,El(t).call(this,{parent:n,x:o,y:i,level:a,sharedOptions:u}))).name=a+"_"+r.x+"_"+r.y,!r.isRoot||isNaN(s)||isNaN(l)||(r.rangeHeight=new h.Vector2(l,s));var c=r.sizeInMeter/t.GEOMETREY_SIZE;r.contentHolder.applyMatrix((new h.Matrix4).makeScale(c,c,1));var f=new h.Vector2;r.rangeXY.getCenter(f);var p=(new h.Matrix4).makeTranslation(f.x,f.y,0);return r.shapeHolder.applyMatrix(p),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Cl(e,t)}(t,bn),r=t,(n=[{key:"destruct",value:function(){var e=Tl(El(t.prototype),"destruct",this).call(this);return this.style=void 0,this._material&&(on(this._material),this._material=void 0),e}},{key:"downloading",value:function(){var e=Sl(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.demImageUrl,n=this.domImageUrl,e.abrupt("return",sl({demUrl:r,domUrl:n}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=Sl(regeneratorRuntime.mark(function e(t){var r,n,o,i,a,s,l,u,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pl(t,2),n=r[0],o=r[1],i=ul(n),a=i.max,s=i.min,l=ll.apply(void 0,Ol(s)),u=ll.apply(void 0,Ol(a)),c=4*(n.image.height*n.image.width+o.image.height*n.image.width),e.abrupt("return",Promise.resolve(new xl({key:this.resourceKey,value:{dem:n,dom:o,minHeight:l,maxHeight:u},gpuUsage:c,weight:1})));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=Sl(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new xl({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,gpuUsage:10,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(this.gpuUsage=e.gpuUsage,e.is404)return this.is404=e.is404,new h.Object3D;var r=e.value.dem,n=e.value.dom,o=e.value.minHeight,i=e.value.maxHeight;this.rangeHeight=new h.Vector2(o,i);var a=this.level,s=this.x,l=this.y;this._material=new vl({displacementMap:r,map:n,level:a,x:s,y:l,flatShading:!1});var u=new h.Mesh(t.tileGeometry,this._material);return u.matrixAutoUpdate=!1,u}},{key:"_computeEstimatedBBox",value:function(){var e=this.rangeXY,t=this.estimatedRangeHeight;return new h.Box3(new h.Vector3(e.min.x,e.min.y,t.x),new h.Vector3(e.max.x,e.max.y,t.y))}},{key:"levelSizeInMeter",value:function(e){}},{key:"resourceKey",get:function(){var e=this.demImageUrl;return Object.defineProperty(this,"resourceKey",{value:e,writable:!1,configurable:!0}),this.resourceKey}},{key:"estimationCoefficient",get:function(){return 1.2}},{key:"estimatedRootGpuUsage",get:function(){return 524288}},{key:"sizeInMeter",get:function(){return this.rootSizeInMeter/Math.pow(2,this.level-this.sharedOptions.spec.rootNode.level)}},{key:"rootSizeInMeter",get:function(){return this.sharedOptions.rootSizeInMeter}},{key:"rangeXY",get:function(){var e=this.sizeInMeter,t=this.sharedOptions.spec.rootNode,r=this.rootSizeInMeter,n=t.x*r,o=(Math.pow(2,t.level)-t.y-1)*r,i=e,a=this.x*i,s=(Math.pow(2,this.level)-this.y-1)*i;return new h.Box2(new h.Vector2(-r/2-n+a,-r/2-o+s),new h.Vector2(i-r/2-n+a,i-r/2-o+s))}},{key:"rangeHeight",get:function(){return this._rangeHeight},set:function(e){if(!e||isNaN(e.x)||isNaN(e.y))console.warn("Invalid rangeHeight",e);else{this._rangeHeight=(new h.Vector2).copy(e);var t=this.rangeXY;this.boundingBox=new h.Box3(new h.Vector3(t.min.x,t.min.y,e.x),new h.Vector3(t.max.x,t.max.y,e.y))}}},{key:"estimatedRangeHeight",get:function(){return this.rangeHeight?this.rangeHeight:this.parent.estimatedRangeHeight}},{key:"demImageUrl",get:function(){var e="";return"function"==typeof this.sharedOptions.spec.demWmtsUrl?e=this.sharedOptions.spec.demWmtsUrl(this.level,this.x,this.y):"string"==typeof this.sharedOptions.spec.demWmtsUrl&&(e=this.sharedOptions.spec.demWmtsUrl.replace("{z}",this.level).replace("{x}",this.x).replace("{y}",this.y)),Object.defineProperty(this,"demImageUrl",{value:e,writable:!1,configurable:!0}),this.demImageUrl}},{key:"domImageUrl",get:function(){var e="";return"function"==typeof this.sharedOptions.spec.domWmtsUrl?e=this.sharedOptions.spec.domWmtsUrl(this.level,this.x,this.y):"string"==typeof this.sharedOptions.spec.domWmtsUrl&&(e=this.sharedOptions.spec.domWmtsUrl.replace("{z}",this.level).replace("{x}",this.x).replace("{y}",this.y)),Object.defineProperty(this,"domImageUrl",{value:e,writable:!1,configurable:!0}),this.domImageUrl}}])&&Ml(r.prototype,n),t}()).prototype,"levelSizeInMeter",[ge],Object.getOwnPropertyDescriptor(wl.prototype,"levelSizeInMeter"),wl.prototype),wl);jl.GEOMETREY_SIZE=100,jl.tileGeometry=new h.PlaneBufferGeometry(jl.GEOMETREY_SIZE,jl.GEOMETREY_SIZE,256,256);var Rl=jl;function Ll(e){return(Ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Il(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Dl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zl(e,t,r){return(zl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nl(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Nl(e){return(Nl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bl(e,t){return(Bl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ul=function(e){function t(e,r){var n,o=r.name,i=r.forest,a=r.position,s=void 0===a?{lng:114,lat:22.25}:a,l=r.showBBox,u=r.spec,c=r.loadWorker,f=r.onTileDownloaded;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Ll(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Nl(t).call(this,e,{name:o,forest:i,position:s,showBBox:l}))).spec=u,n.loadWorker=c,n.onTileDownloaded=f,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bl(e,t)}(t,wi),r=t,(n=[{key:"destruct",value:function(){return zl(Nl(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._createTree(this.spec));case 1:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Il(i,n,o,a,s,"next",e)}function s(e){Il(i,n,o,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid spec."));var t=this._treeNode,r=e.name,n=e.maxLevel,o=e.minLevel,i=this.showBBox,a={onTileDownloaded:this.onTileDownloaded};return this._tree=new il(Rl,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:o,showBBox:i,debug:!1,eventHandlers:a,spec:e,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this._forest.add(this._tree),this._tree.initialized}}])&&Dl(r.prototype,n),t}();function Fl(e){return(Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vl(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hl(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Wl(e,t,r){return(Wl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gl(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Gl(e){return(Gl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kl(e,t){return(Kl=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xl=function(e){function t(e,r){r.isMobile;var n,o=r.forest,i=r.countryName,a=r.altizureApi,s=r.onTileDownloaded;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==Fl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Gl(t).call(this,e))).name="ProjectLayer",n.forest=o,n._countryName=i,n._altizureApi=a,n.onTileDownloaded=s,n}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kl(e,t)}(t,Pt),r=t,(n=[{key:"destruct",value:function(){var e=Wl(Gl(t.prototype),"destruct",this).call(this);return this._altizureBundleLoader&&(this._altizureBundleLoader.terminate(),this._altizureBundleLoader=null),this._osgBundleLoader&&(this._osgBundleLoader.terminate(),this._osgBundleLoader=null),e}},{key:"addEntity",value:function(e){return new wi(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Vl(e,t,r[t])})}return e}({forest:this.forest},e)).import()}},{key:"addAltizure",value:function(e){var t=e.pid,r=e.projInfo,n=e.position,o=e.showBBox;return new ds(this,{forest:this.forest,pid:t,position:n,showBBox:o,altizureApi:this._altizureApi,countryName:this._countryName,loadWorker:this.altizureBundleLoader,onTileDownloaded:this.onTileDownloaded}).import(r)}},{key:"addOSG",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return new Qs(this,{forest:this.forest,spec:t,position:r,showBBox:n,loadWorker:this.osgBundleLoader,onTileDownloaded:this.onTileDownloaded}).import()}},{key:"addDEM",value:function(e){var t=e.spec,r=e.position,n=e.showBBox,o=new Ul(this,{forest:this.forest,spec:t,position:r,showBBox:n,loadWorker:this.osgBundleLoader,onTileDownloaded:this.onTileDownloaded});return o.import().then(function(){return o})}},{key:"remove",value:function(){}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t})}},{key:"countryname",get:function(){return this._countryName}},{key:"altizureBundleLoader",get:function(){var e=new gs;return this._altizureBundleLoader=e,Object.defineProperty(this,"altizureBundleLoader",{value:e,writable:!1,configurable:!0}),this.altizureBundleLoader}},{key:"osgBundleLoader",get:function(){var e=new $s;return this._osgBundleLoader=e,Object.defineProperty(this,"osgBundleLoader",{value:e,writable:!1,configurable:!0}),this.osgBundleLoader}}])&&Hl(r.prototype,n),t}(),Yl=function(e){this.minNode=void 0,this.nodeCount=0,e&&(this.compare=e)};Yl.prototype.clear=function(){this.minNode=void 0,this.nodeCount=0},Yl.prototype.decreaseKey=function(e,t){if(void 0===e)throw new Error("Cannot decrease key of non-existent node");if(this.compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key");e.key=t;var r=e.parent;r&&this.compare(e,r)<0&&(Zl(e,r,this.minNode,this.compare),Ql(r,this.minNode,this.compare)),this.compare(e,this.minNode)<0&&(this.minNode=e)},Yl.prototype.delete=function(e){var t=e.parent;t&&(Zl(e,t,this.minNode,this.compare),Ql(t,this.minNode,this.compare)),this.minNode=e,this.extractMinimum()},Yl.prototype.extractMinimum=function(){var e=this.minNode;if(e){if(e.child){var t=e.child;do{t.parent=void 0,t=t.next}while(t!==e.child)}var r;e.next!==e&&(r=e.next),Jl(e),this.nodeCount--,this.minNode=eu(r,e.child,this.compare),r&&(this.minNode=r,this.minNode=function(e,t){for(var r=[],n=new ql(e);n.hasNext();){for(var o=n.next();r[o.degree];){if(t(o,r[o.degree])>0){var i=o;r[(o=r[o.degree]).degree]=i}$l(r[o.degree],o,t),r[o.degree]=void 0,o.degree++}r[o.degree]=o}e=void 0;for(var a=0;a<r.length;a++)r[a]&&(r[a].next=r[a],r[a].prev=r[a],e=eu(e,r[a],t));return e}(this.minNode,this.compare))}return e},Yl.prototype.findMinimum=function(){return this.minNode},Yl.prototype.insert=function(e,t){var r=new function(e,t){this.key=e,this.value=t,this.prev=this,this.next=this,this.degree=0,this.parent=void 0,this.child=void 0,this.isMarked=void 0}(e,t);return this.minNode=eu(this.minNode,r,this.compare),this.nodeCount++,r},Yl.prototype.isEmpty=function(){return void 0===this.minNode},Yl.prototype.size=function(){return this.isEmpty()?0:function e(t){var r=0,n=t;do{r++,n.child&&(r+=e(n.child)),n=n.next}while(n!==t);return r}(this.minNode)},Yl.prototype.union=function(e){this.minNode=eu(this.minNode,e.minNode,this.compare),this.nodeCount+=e.nodeCount},Yl.prototype.compare=function(e,t){return e.key>t.key?1:e.key<t.key?-1:0};var ql=function(e){this.items=[];var t=e;do{this.items.push(t),t=t.next}while(e!==t)};function Zl(e,t,r,n){return t.degree--,e.next===e?t.child=void 0:t.child=e.next,Jl(e),r=eu(r,e,n),e.isMarked=!1,r}function Ql(e,t,r){var n=e.parent;return n&&(e.isMarked?t=Ql(n,t=Zl(e,n,t,r),r):e.isMarked=!0),t}function Jl(e){var t=e.prev,r=e.next;t.next=r,r.prev=t,e.next=e,e.prev=e}function $l(e,t,r){Jl(e),t.child=eu(e,t.child,r),e.parent=t,e.isMarked=!1}function eu(e,t,r){if(e||t){if(!e)return t;if(!t)return e;var n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,r(e,t)<0?e:t}}ql.prototype.hasNext=function(){return this.items.length>0},ql.prototype.next=function(){return this.items.shift()};var tu=Yl,ru=function(e){this.heap=new tu(e)};ru.prototype.constructor=ru,ru.prototype.enqueue=function(e,t){return this.heap.insert(e,t)},ru.prototype.dequeue=function(){return this.heap.extractMinimum()},ru.prototype.clear=function(){this.heap.clear()},ru.prototype.isEmpty=function(){return this.heap.isEmpty()};var nu=ru;function ou(e){return(ou="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function iu(e){this.size=0,this.limit=e,this._keymap={}}iu.prototype.put=function(e,t){var r={key:e,value:t};if(this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},iu.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},iu.prototype.get=function(e,t){var r=this._keymap[e];if(void 0!==r)return r===this.tail?t?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,t?r:r.value)},iu.prototype.find=function(e){return this._keymap[e]},iu.prototype.set=function(e,t){var r,n=this.get(e,!0);return n?(r=n.value,n.value=t):(r=this.put(e,t))&&(r=r.value),r},iu.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},iu.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?iu.prototype.keys=function(){return Object.keys(this._keymap)}:iu.prototype.keys=function(){var e=[];for(var t in this._keymap)e.push(t);return e},iu.prototype.forEach=function(e,t,r){var n;if(!0===t?(r=!0,t=void 0):"object"!==ou(t)&&(t=this),r)for(n=this.tail;n;)e.call(t,n.key,n.value,this),n=n.older;else for(n=this.head;n;)e.call(t,n.key,n.value,this),n=n.newer},iu.prototype.toJSON=function(){for(var e=[],t=this.head;t;)e.push({key:t.key.toJSON(),value:t.value.toJSON()}),t=t.newer;return e},iu.prototype.toString=function(){for(var e="",t=this.head;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e};var au=iu;function su(e){return(su="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function uu(e,t,r){return(uu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cu(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function cu(e){return(cu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fu(e,t){return(fu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hu=function(e){function t(e){var r,n=e.capacity,o=e.cacheGpuLimit,i=e.debug,a=void 0!==i&&i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==su(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,cu(t).call(this,n))).capacity=n,r.cacheGpuLimit=o,r.currentCacheGpu=0,r.debug=a,r._stat={hit:0,miss:0},r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fu(e,t)}(t,au),r=t,(n=[{key:"destruct",value:function(){var e=this.clear();return this.capacity=0,e}},{key:"clear",value:function(){var e=!0;return(e=this.removeAll()&&e)||console.warn("ForestNodeCache clear failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"getTile",value:function(e){var t=e.resourceKey,r=this.get(t);if(void 0===r)this.debug&&console.log("miss"),this._stat.miss++;else{if(this.debug&&console.log("hit"),!r.valid)return console.error("ForestNodeCache provides invalid mesh",r),this.remove(t),void r.destruct();this._stat.hit++}return this.debug&&console.log("get",e.name,JSON.stringify(this.stat)),r}},{key:"putTile",value:function(e,t){if(t.valid){var r=e.resourceKey;if(this.get(r))return!1;for(this.put(r,t),this.currentCacheGpu+=t.gpuUsage,this.debug&&console.log("put",e.name,this.currentCacheGpu);this.currentCacheGpu>this.cacheGpuLimit;)this.shift();return!0}return console.warn("[ForestNodeCache] receives invalid tile."),!1}},{key:"shift",value:function(){var e=uu(cu(t.prototype),"shift",this).call(this);return this.currentCacheGpu-=e.value.gpuUsage,e.value.destruct(),this.debug&&console.log("shift",e,this.currentCacheGpu),e}},{key:"removeAll",value:function(){for(var e=this.capacity+1;this.head&&e>=0;)this.shift(),e--;return uu(cu(t.prototype),"removeAll",this).call(this),e>=0||(console.warn("cache removeAll error"),!1)}},{key:"_validateMesh",value:function(e){console.warn("deprecated.")}},{key:"stat",get:function(){return this._stat}},{key:"info",get:function(){return{stat:this.stat,size:this.size}}}])&&lu(r.prototype,n),t}();function pu(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function du(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){pu(i,n,o,a,s,"next",e)}function s(e){pu(i,n,o,a,s,"throw",e)}a(void 0)})}}function vu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var mu=function(){function e(t){var r=t.capacity,n=t.debug,o=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capacity=r,this.debug=o,this._size=0,this.waitQueue=new zr,this._taskMap=new Map,this.status="live"}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.waitQueue.clear(),this.waitQueue=null,this._capacity=0,this._size=0,this._taskMap.clear(),this._taskMap=null,this.status="dead",!0}},{key:"clear",value:function(){this.waitQueue.clear(),this._size=0,this._taskMap.clear()}},{key:"abortPending",value:function(){var e=du(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[];!this.waitQueue.isEmpty();)r=this.waitQueue.dequeue(),n=r.reject(new Error("[Dock] abortPending")),t.push(n);return e.abrupt("return",Promise.all(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){console.error("Dock.add",e)}),r=this.capacity-this.size}}},{key:"act",value:function(){var e=du(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.resolve,o=t.reject,e.abrupt("return",K(r(),12e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return o(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=e.resourceKey,n=null;if(this._taskMap.has(r)){var o=this._taskMap.get(r);o.tiles.add(e),n=o.task}else{var i=new Set;i.add(e);var a=new Promise(function(e,n){t.waitQueue.enqueue({func:l,resolve:function(n){return"live"===t.status&&t._taskMap.delete(r),e(n)},reject:function(e){return"live"===t.status&&t._taskMap.delete(r),n(e)}})});n=a;var s={task:a,tiles:i};this._taskMap.set(r,s),this.fill()}return n;function l(){var e=null,n=t._taskMap.get(r).tiles;return n.forEach(function(t){t.expired||(e=t)}),n.clear(),null===e?Promise.reject(new Error("[Dock] No active node")):t._downloadTask(e).then(function(t){return e.cook(t)})}}},{key:"_downloadTask",value:function(e,t){return this.debug&&console.log("_download",e.resourceKey),e.download()}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}])&&vu(t.prototype,r),e}();function yu(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function gu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var bu=function(){function e(t){var r=t.cacheCapacity,n=t.cacheGpuLimit,o=t.dockCapacity,i=t.debug,a=void 0!==i&&i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=a,this.cache=new hu({capacity:r,cacheGpuLimit:n,debug:a}),this.dock=new mu({capacity:o,debug:a}),this.status="working"}var t,r;return t=e,(r=[{key:"destruct",value:function(){this.status="destructing";var e=!0;return e=this.dock.destruct()&&e,(e=this.cache.destruct()&&e)||console.warn("ForestNodeRetriever destruct failed."),this.status="destructed",e}},{key:"abortPending",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dock.abortPending());case 1:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){yu(i,n,o,a,s,"next",e)}function s(e){yu(i,n,o,a,s,"throw",e)}a(void 0)})});return function(){return t.apply(this,arguments)}}()},{key:"clear",value:function(){var e=!0;return e=this.dock.clear()&&e,(e=this.cache.clear()&&e)||console.warn("ForestNodeRetriever clear failed."),e}},{key:"request",value:function(e){if("working"!==this.status)return console.warn("ForestNodeRetriever destructing",e.info,"request failed"),!1;var t=this,r=this.cache.getTile(e);return r?Promise.resolve(r):this.dock.queue(e).catch(function(t){return e.expired?Promise.resolve(void 0):"[Dock] abortPending"===t.message?Promise.reject(t):"404"===t.message?(e.is404=!0,e.defaultCooked()):"timeout"===t.message?Promise.reject(new Error("timeout")):"expired"===t.message?Promise.reject(t):(console.warn("unknown load error",t),Promise.reject(t))}).then(function(r){return void 0!==r&&t.cache.putTile(e,r),Promise.resolve(r)})}},{key:"info",get:function(){return{cache:this.cache.info,dock:this.dock.info}}}])&&gu(t.prototype,r),e}();function _u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var wu=function(){function e(t){var r=t.FOREST_CAPACITY,n=t.CACHE_CAPACITY,o=t.FOREST_GPU_RAM_LIMIT,i=void 0===o?751619276.8:o,a=t.CACHE_GPU_RAM_LIMIT,s=void 0===a?1073741824:a,l=t.FOREST_RAM_LIMIT,u=void 0===l?1073741824:l,c=t.MAX_DOWNLOAD_CONCURRENCY,f=t.MIN_AREA,h=t.MAX_LEVEL,p=t.trees,d=void 0===p?[]:p,v=t.name,m=void 0===v?"LodForest":v,y=t.debug,g=void 0!==y&&y;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=m,this.FOREST_CAPACITY=r,this.MAX_DOWNLOAD_CONCURRENCY=c,this.MIN_AREA=f,this.MAX_LEVEL=h,this.trees=d,this._numOfNodes=0,this.CACHE_CAPACITY=n,this.CACHE_CAPACITY<this.FOREST_CAPACITY+10&&(this.CACHE_CAPACITY=this.FOREST_CAPACITY+Math.min(100,Math.max(.4*this.FOREST_CAPACITY,10)),console.warn("Cache is too small. Resized to",this.CACHE_CAPACITY)),this.CACHE_GPU_RAM_LIMIT=Math.max(s,314572800),this.FOREST_GPU_RAM_LIMIT=Math.max(i,104857600),this.CACHE_GPU_RAM_LIMIT<this.FOREST_GPU_RAM_LIMIT+209715200&&(this.CACHE_GPU_RAM_LIMIT=(this.CACHE_GPU_RAM_LIMIT+this.FOREST_GPU_RAM_LIMIT)/2+104857600,this.FOREST_GPU_RAM_LIMIT=this.CACHE_GPU_RAM_LIMIT-209715200,console.warn("CACHE_GPU_RAM_LIMIT is too small, resized to",this.CACHE_GPU_RAM_LIMIT)),this.FOREST_RAM_LIMIT=u,this.retriever=new bu({cacheCapacity:this.CACHE_CAPACITY,cacheGpuLimit:this.CACHE_GPU_RAM_LIMIT,dockCapacity:c,debug:g})}var t,r;return t=e,(r=[{key:"destruct",value:function(){var e=!0;return this.trees=[],e=e&&this.retriever.destruct(),this.retriever=null,e}},{key:"clear",value:function(){this.trees=[],this.retriever.clear()}},{key:"add",value:function(e){var t=this._indexOf(e);return-1===t?(this.trees.push(e),!0):(console.warn("tree already exists",e,t),!1)}},{key:"remove",value:function(e){var t=this._indexOf(e);return-1!==t&&(this.trees.splice(t,1),!0)}},{key:"applyToVisibleTrees",value:function(e,t){for(var r=!0,n=0;n<this.trees.length;n++)this.trees[n].visible&&(r=e(this.trees[n],t)&&r);return r}},{key:"freeze",value:function(){this._userFreezeTouched=!0,this.__freeze=!0}},{key:"unfreeze",value:function(){this._userFreezeTouched=!0,this.__freeze=!1}},{key:"throttleFreeze",value:function(){this._userFreezeTouched||(this.__freeze=!0)}},{key:"throttleUnFreeze",value:function(){this._userFreezeTouched||(this.__freeze=!1)}},{key:"sceneUpdated",value:function(e){var t=e.camera;if(!this.__freeze){if(0===this.trees.length)return!0;var r=this;return this._preUpdateTree({camera:t}).then(G(10)).then(function(){return r._updateTree({camera:t})}).then(G(10)).then(function(){return r._retrieveTiles()}).catch(function(e){return console.error(e),Promise.resolve()})}}},{key:"_preUpdateTree",value:function(e){var t=this,r=e.camera;return new Promise(function(e,n){var o=t.applyToVisibleTrees(function(e){return!e.preSceneUpdate||e.preSceneUpdate({camera:r})});o?e(o):n(o)})}},{key:"_updateTree",value:function(e){var t=e.camera,r=this;return new Promise(function(e,n){r.__updateTree({camera:t})?e():n(new Error("LodForest::_updateTree"))})}},{key:"__updateTree",value:function(e){e.camera;var t=!0,r=new nu(function(e,t){return t.key-e.key}),n=0,o=0,i=this.FOREST_GPU_RAM_LIMIT,a=0;this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(e){return e.needsPrune=!0,!0})&&t;var n=e.root,o=d(n),i={node:n,tree:e};r.enqueue(o,i),a++,v(n)});do{if(a>=this.FOREST_CAPACITY)break;if(o>=i||n>.9*i)break;var s=r.dequeue();if(void 0===s)break;var l=s.key,u=s.value.node,c=s.value.tree;if(l<this.MIN_AREA)break;if(u.needsPrune=!1,u.level<this.MAX_LEVEL&&u.level<c.maxLevel&&u.expandable){0===u.nodes.length&&(t=c.expand(u)&&t);for(var f=0;f<u.nodes.length;f++){var h=u.nodes[f];h.needsPrune=!0,v(h);var p=d(h);p>=this.MIN_AREA&&r.enqueue(p,{tree:c,node:h})}a+=u.nodes.length,this._numOfNodes=a}}while(!r.isEmpty());return r.clear(),r=void 0,this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(t){return!t.needsPrune||e.prune(t)})&&t}),t;function d(e){var t=e.screenArea;return e.ssArea=t,t}function v(e){var t=e.estimatedGpuUsage;isNaN(t)?console.warn("gpuUsage",t):(o+=t,e.isInScene&&(n+=t))}}},{key:"_retrieveTiles",value:function(){var e=this.retriever.abortPending(),t=this,r=new nu(function(e,t){return t.key-e.key}),n=new nu(function(e,t){return t.key-e.key});this.applyToVisibleTrees(function(e){var t=e.root.ssArea,o={tree:e,node:e.root};r.enqueue(t,o),n.enqueue(t,o)});for(var o=[];!r.isEmpty();){var i=r.dequeue(),a=p(i.value.tree,i.value.node);o.push(a)}for(;!n.isEmpty();)for(var s=n.dequeue(),l=s.value.tree,u=s.value.node.nodes,c=0;c<u.length;c++){var f=u[c],h=p(l,f);o.push(h),n.enqueue(f.ssArea,{tree:l,node:f})}return e.then(function(){return Promise.all(o)});function p(e,r){return t.retriever.request(r).then(function(t){if(!r.expired){if(!r.loaded){var n=r.digest(t);r.onContentLoaded(n),r.displayByload(),e.flags.modelInitialized||e._onContentInitialized()}return Promise.resolve()}return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"timeout"===e.message||"expired"===e.message||console.warn("[Network unstable] LodForest._retrieveTiles",e),Promise.resolve()})}}},{key:"_indexOf",value:function(e){return(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this.trees,e)}},{key:"size",get:function(){return this._numOfNodes}},{key:"gpuMaxUsage",get:function(){for(var e=0,t=0;t<this.trees.length;t++)e+=this.trees[t].gpuMaxUsage;return e}}])&&_u(t.prototype,r),e}();function xu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ku(e,t){return t.toString(e)}var Ou=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"getBlueMarbleCNImageUrl",value:function(e,t,r){return"https://cdn-china.altizure.cn/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getBlueMarbleImageUrl",value:function(e,t,r){return"https://cloudfront.altizure.com/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getOSMImageUrl",value:function(e,t,r){return"http://"+["a","b","c"][(e+r+t)%3]+".tile.openstreetmap.org/"+e+"/"+t+"/"+r+".png"}},{key:"getBingImageUrl",value:function(e,t,r){var n,o=r,i=ku(2,t),a=ku(2,o),s=i.length-a.length;if(s>0)for(n=0;n<s;n++)a="0"+a;else if(s<0)for(s=-s,n=0;n<s;n++)i="0"+i;var l="";for(n=0;n<a.length;n++)l+=a[n]+i[n];var u=function(e,t,r){return ku(t,parseInt(r,e))}(2,4,l);if(u.length<e)for(s=e-u.length,n=0;n<s;n++)u="0"+u;return"//ecn.t"+(e+r+t)%8+".tiles.virtualearth.net/tiles/h"+u+".jpeg?g=1239&mkt=en-us"}},{key:"getCartoImageUrl",value:function(e,t,r){return"http://cartodb-basemaps-c.global.ssl.fastly.net/light_all/"+e+"/"+t+"/"+r+".png"}},{key:"getCartoDarkImageUrl",value:function(e,t,r){return"https://"+["1","2","3","4","5","6","7","8","9","0"][(e+r+t+2)%10]+".basemaps.cartocdn.com/dark_all/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleCNImageUrl",value:function(e,t,r){return"http://mt"+["0","1","2","3"][(e+r+t)%4]+".google.cn/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleTerrainImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=p&x="+t+"&y="+r+"&z="+e}},{key:"getGaodeImageUrl",value:function(e,t,r){return"https://wprd0"+["1","2","3","4"][(e+r+t)%4]+".is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x="+t+"&y="+r+"&z="+e}},{key:"getTencentImageUrl",value:function(e,t,r){var n=["0","1","2","3"][(e+r+t)%4],o=t,i=Math.pow(2,e)-1-r;return"http://p"+n+".map.gtimg.com/sateTiles/"+e+"/"+Math.floor(o/16)+"/"+Math.floor(i/16)+"/"+o+"_"+i+".jpg?version=117"}},{key:"getOpenCycleImageUrl",value:function(e,t,r){return"https://"+["a","b","c"][(e+r+t)%3]+".tile.opencyclemap.org/cycle/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleMoonImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/"+e+"/"+t+"/"+r+".jpg"}},{key:"getGoogleMoonApolloImageUrl",value:function(e,t,r){return"https://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/apollo/"+e+"/"+t+"/"+r+".jpg"}},{key:"getHiriseMarsVisibleImageUrl",value:function(e,t,r){return r=Math.pow(2,e)-1-r,"https://crossorigin.me/http://gmaps-bkup.uahirise.org/mars/visible/".concat(e,"/").concat(t,"/").concat(r,".jpg")}},{key:"getNasaMarsTrekImageUrl",value:function(e,t,r){return"https://trektiles.jpl.nasa.gov/trektiles/Mars/EQ/Mars_Viking_MDIM21_ClrMosaic_global_232m/1.0.0//default/default028mm/".concat(e,"/").concat(r,"/").concat(t,".png")}},{key:"getNasaMoonTrekImageUrl",value:function(e,t,r){return"https://moontrek.jpl.nasa.gov/trektiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0//default/default028mm/".concat(e,"/").concat(r,"/").concat(t,".jpg?api_key=29i0fx486NeK5hQx7Z3AIiNBwEcJV2fJypTet3WW")}},{key:"getEsriLunarImageUrl",value:function(e,t,r){return"https://crossorigin.me/https://webgis2.wr.usgs.gov/Lunar_Global_GIS/ESRI.ArcGIS.ADF.Web.DataSources.ArcGISServer.TileHandler.ashx?tile=c2d7c76d558f4dfb8ffde861c9229b2e&level=".concat(e,"&column=").concat(t,"&row=").concat(r)}},{key:"getEsriTerrainImageUrl",value:function(e,t,r){return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/".concat(e,"/").concat(r,"/").concat(t)}}],null&&xu(t.prototype,null),r&&xu(t,r),e}();function Pu(e){return(Pu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Au(e){return(Au=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Su(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mu(e,t){return(Mu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Tu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Eu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Cu(e,t,r){return t&&Eu(e.prototype,t),r&&Eu(e,r),e}function ju(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ru=function(){function e(t,r,n){Tu(this,e),ju(this,"_URLGenerator",void 0),ju(this,"mapName",void 0),ju(this,"imageFormat",void 0);var o=e.maps.get(t);if(o)return console.warn("Re-definition of map ".concat(t,".")),o;this.mapName=t,"string"==typeof r?this._URLGenerator=this._predefinedURL(r):"function"==typeof r?this._URLGenerator=r:"boolean"==typeof r?this._URLGenerator=this._predefinedURL("earth"):console.error("Uknown uri",r),void 0===n&&(n=function(e){var t=e.split(".").pop();if(!t||t.length<=0)return jn.UNKNOWN;switch(t.toUpperCase()){case"JPG":case"JPENG":return jn.JPEG;case"PNG":return jn.PNG;case"BIL":return jn.BIL;default:return jn.UNKNOWN}}(this.url(0,0,0))),this.imageFormat=n,e.maps.set(this.mapName,this)}return Cu(e,[{key:"url",value:function(e,t,r){return this._URLGenerator(e,t,r)}},{key:"_predefinedURL",value:function(e){return"earth"===e||"default"===e?function(e,t,r){return"China"===U.countryName?e<=8?Ou.getBlueMarbleCNImageUrl(e,t,r):Ou.getGoogleCNImageUrl(e,t,r):e<=8?Ou.getBlueMarbleImageUrl(e,t,r):Ou.getGoogleImageUrl(e,t,r)}:"terrain-rgb"===e?function(e,t,r){return e<=12?"China"===U.countryName?"https://cdn-china.altizure.cn/public/bluemarble/dem20190819/".concat(e,"/").concat(t,"/").concat(r,".png"):"https://cloudfront.altizure.com/bluemarble/dem20190819/".concat(e,"/").concat(t,"/").concat(r,".png"):void 0}:"Carto"===e?Ou.getCartoImageUrl:"Carto-Dark"===e?Ou.getCartoDarkImageUrl:"Google-Terrain"===e?Ou.getGoogleTerrainImageUrl:(console.error("unknow uri",e),function(){return""})}}]),e}();ju(Ru,"maps",new Map);var Lu=function(e){function t(e,r,n,o){var i;return Tu(this,t),n!==jn.PNG&&n!==jn.BIL&&(console.error("Unknown Dem ImageFormat",n),n=jn.PNG),ju(Su(i=function(e,t){return!t||"object"!==Pu(t)&&"function"!=typeof t?Su(e):t}(this,Au(t).call(this,e,r,n))),"demEncoding",void 0),o in or?i.demEncoding=o:(console.error("Unknown DemEncoding",o),i.demEncoding=or.TERRAIN_RGB),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mu(e,t)}(t,Ru),Cu(t,[{key:"destruct",value:function(){return!0}}]),t}();function Iu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Du(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zu=U.ISMOBILE?10:18,Nu=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:zu,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],c=arguments.length>9?arguments[9]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.showPlanetTexture=r,this.showOrbitRing=n,Du(this,"_entity",void 0),Du(this,"_wmtsTileURL",void 0),Du(this,"_demWmtsTileURL",void 0),Du(this,"_mapMaxLevel",void 0),Du(this,"_visible",void 0),Du(this,"_showDem",void 0),Du(this,"_showPlanetWireframe",void 0),Du(this,"_showGroundCloud",void 0),Du(this,"_skyBoxProperties",void 0),this._wmtsTileURL=o,this._demWmtsTileURL=i,this._mapMaxLevel=a,this._visible=t,this._showDem=s,this._showPlanetWireframe=l,this._showGroundCloud=u,this._skyBoxProperties=c}var t,r;return t=e,(r=[{key:"entity",set:function(e){this._entity=e,this.visible=this.visible,this.mapMaxLevel=this.mapMaxLevel},get:function(){return this._entity}},{key:"wmtsTileURL",get:function(){return this._wmtsTileURL},set:function(e){e.mapName!==this.wmtsTileURL.mapName&&(this._wmtsTileURL=e,this.entity&&this.entity.updatePlanetMap())}},{key:"demWmtsTileURL",get:function(){return this._demWmtsTileURL},set:function(e){console.warn("demWmtsTileURL is not allowed for changing.")}},{key:"basemapName",get:function(){return this.wmtsTileURL.mapName}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this.entity&&(this.entity.visible=e)}},{key:"mapMaxLevel",get:function(){return this._mapMaxLevel},set:function(e){this._mapMaxLevel=e,this.entity&&this.entity.changeMapMaxLevel({level:e,name:this.basemapName})}},{key:"showDem",get:function(){return this._showDem},set:function(e){console.warn("Under development.")}},{key:"showPlanetWireframe",get:function(){return this._showPlanetWireframe},set:function(e){this._showPlanetWireframe=e,this.entity&&this.entity.updatePlanetWireframeVisibility()}},{key:"showGroundCloud",get:function(){return this._showGroundCloud},set:function(e){this._showGroundCloud=e,this.entity&&this.entity.updatePlanetGroundCloudVisibility()}},{key:"skyBoxProperties",get:function(){return this._skyBoxProperties},set:function(e){this._skyBoxProperties=e}}])&&Iu(t.prototype,r),e}();function Bu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Uu=function e(t,r,n,o,i,a,s,l,u,c,f){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Bu(this,"showSkyBox",void 0),Bu(this,"showNebula",void 0),Bu(this,"nebulaColor",void 0),Bu(this,"nebulaScale",void 0),Bu(this,"nebulaOpacity",void 0),Bu(this,"showFarStar",void 0),Bu(this,"farStarNumber",void 0),Bu(this,"farStarOpacity",void 0),Bu(this,"showCloseStar",void 0),Bu(this,"closeStarNumber",void 0),Bu(this,"closeStarOpacity",void 0),this.showSkyBox=null!=t&&t,this.showNebula=null==r||r,this.nebulaColor=null==n?679329:n,this.nebulaScale=null==o?.7344317968236282:o,this.nebulaOpacity=null==i?.9505245321895928:i,this.showFarStar=null==a||a,this.farStarNumber=null==s?200:s,this.farStarOpacity=null==l?.7:l,this.showCloseStar=null==u||u,this.closeStarNumber=null==c?100:c,this.closeStarOpacity=null==f?.9:f};function Fu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Hu(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Wu,Gu=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.transparent,o=void 0!==n&&n,i=r.opacity,a=void 0===i?.8:i,s=r.color,l=void 0===s?2565927:s,u=r.image;Fu(this,e),Hu(this,"_renderer",void 0),Hu(this,"_transparent",void 0),Hu(this,"_opacity",void 0),Hu(this,"_color",void 0),Hu(this,"_image",void 0),this._renderer=t,this._transparent=o,this._opacity=a,this._color=l,this._image=u}var t,r;return t=e,(r=[{key:"transparent",get:function(){return this._transparent}},{key:"opacity",get:function(){return this._opacity}},{key:"color",get:function(){return this._color}},{key:"image",get:function(){return this._image}}])&&Vu(t.prototype,r),e}(),Ku=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.planet,n=t.quality,o=void 0===n?60:n,i=t.background,a=t.earth,s=t.tileBox,l=void 0!==s&&s;Fu(this,e),Hu(this,"planet",void 0),Hu(this,"quality",void 0),Hu(this,"background",void 0),this.background=new Gu(i);var u=r&&r.wmtsTileURL?r.wmtsTileURL:new Ru("engine-init-map","default"),c=r&&r.demWmtsTileURL?r.demWmtsTileURL:new Lu("RESERVER-ALTIZURE-DEM","terrain-rgb",jn.PNG,or.TERRAIN_RGB),f=r&&r.skyBoxProperties?new Uu(r.skyBoxProperties.showSkyBox,r.skyBoxProperties.showNebula,r.skyBoxProperties.nebulaColor,r.skyBoxProperties.nebulaScale,r.skyBoxProperties.nebulaOpacity,r.skyBoxProperties.showFarStar,r.skyBoxProperties.farStarNumber,r.skyBoxProperties.farStarOpacity,r.skyBoxProperties.showCloseStar,r.skyBoxProperties.closeStarNumber,r.skyBoxProperties.closeStarOpacity):new Uu(!1,!0,679329,.7344317968236282,.9505245321895928,!0,200,.7,!0,100,.9);this.planet=r?new Nu(r.visible,r.showPlanetTexture,r.showOrbitRing,u,c,r.mapMaxLevel,r.showDem,r.showPlanetWireframe,r.showGroundCloud,f):new Nu(!0,!0,!0,u,c),this.quality=Math.max(1,o),l&&console.warn("tileBox deprecated."),void 0!==a&&console.warn("earth deprecated.")};function Xu(e){return(Xu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Yu(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function qu(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Zu(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qu(e,t,r){return(Qu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ju(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Ju(e){return(Ju=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $u(e,t){return($u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ec(e,t,r,n,o){var i={};return Object.keys(n).forEach(function(e){i[e]=n[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce(function(r,n){return n(e,t,r)||r},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var tc=(ec((Wu=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.HOST,i=n.api,a=n.camera,s=void 0===a?{poseTo:{lat:22.335836,lng:114.263885,alt:1e7,north:6.6,tilt:60,up:0}}:a,l=n.renderItems,u=void 0===l?{}:l,c=n.eventHandlers,f=void 0===c?{}:c,p=(n.develop,n.debug),d=void 0!==p&&p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var v=u.background,m=Zu(r=function(e,t){return!t||"object"!==Xu(t)&&"function"!=typeof t?Zu(e):t}(this,Ju(t).call(this,e,{HOST:o,api:i,background:v,debug:d})));return r._renderItems=new Ku(u),r._type="EarthViewer",window.viewer=Zu(r),r.ecefNode=new W(null),r.ecefNode.sceneNode.name="ecefNode",r.ecefNode.sceneNode.matrixAutoUpdate=!1,r.initialized=function(){m.scene.add(m.ecefNode.sceneNode),m._welcomeMesh=new h.Mesh(new h.SphereBufferGeometry(1,32,32),new h.MeshBasicMaterial({wireframe:!0})),m._welcomeMesh.name="welcomeMesh",m.ecefNode.sceneNode.add(m._welcomeMesh);var e=m.ecefNode,t=U.ISMOBILE,r=Math.max(m.renderItems.quality/60,.1),n={FOREST_CAPACITY:(t?280:400)*r,CACHE_CAPACITY:(t?420:500)*r,FOREST_GPU_RAM_LIMIT:(t?268435456:858993459.2)*r,CACHE_GPU_RAM_LIMIT:(t?322122547.2:1288490188.8)*r,MAX_DOWNLOAD_CONCURRENCY:t?3:7,MIN_AREA:(t?.011:.007)/r,MAX_LEVEL:void 0===m._renderItems.planet.mapMaxLevel?t?12:19:m._renderItems.planet.mapMaxLevel,trees:[],name:"EarthViewer Forest",debug:!1};return m.forest=new wu(n),m.countryName.then(function(e){return Promise.all([o({countryName:e}),i({countryName:e})])}).then(function(){return Promise.resolve(m)});function o(r){var n=r.countryName;return m.layers.planet=new si(e,{isMobile:t,forest:m.forest,eventHandlers:{onContentInitialized:function(){f.onContentInitialized&&f.onContentInitialized(),m.ecefNode.sceneNode.remove(m._welcomeMesh)}},planet:m.renderItems.planet,maxAnisotropy:m.renderer.capabilities.getMaxAnisotropy(),fullScene:!0,countryName:n}),m.layers.planet.import()}function i(r){var n=r.countryName;return m.layers.project=new Xl(e,{isMobile:t,forest:m.forest,countryName:n,altizureApi:m.altizureApi,onTileDownloaded:function(){m.updateScene()}}),Promise.resolve()}}(),m.__updateSceneTimed=X(m._updateScene,1500),m.__cameraChangingDebounce=Y(function(){m._cameraChanging=!1},1e3),r.openning=(m.control=new _t({camera:m.camera,openning:{poseTo:s.poseTo},handlers:void 0,ecefNode:m.ecefNode,layers:m.layers,domElement:m.renderer.domElement,showAnchor:!1}),m.control._putAnchor(),m.control._updateNearFar(),m.updateScene(),m.control.addEventListener("onCameraChange",function(){m._cameraChanging=!0,m.updateScene(),m.__cameraChangingDebounce()}),window.addEventListener("resize",function(){m.resize()},!1),s.flyTo?m.initialized.then(function(){return m.control.flyToPose(s.flyTo,s.time)}):m.initialized),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$u(e,t)}(t,V),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.control&&(this.control.destruct(),this.control=void 0),e=this.ecefNode.destruct()&&e,this.forest&&(e=this.forest.destruct()&&e),e=Qu(Ju(t.prototype),"destruct",this).call(this)&&e,v.disposeMesh(this._welcomeMesh),this._welcomeMesh=void 0,this._renderItems=void 0,window.viewer=void 0,this.ecefNode=void 0,this.initialized=void 0,this.openning=void 0,this.__updateScene=void 0,this._spotLights=void 0,e}},{key:"animate",value:function(){var e=Date.now()/1e3,r={camera:this.camera,currentTime:e,cameraChanging:this._cameraChanging};this.ecefNode&&this.ecefNode.animate(r),Qu(Ju(t.prototype),"animate",this).call(this)}},{key:"updateVisibility",value:function(){return this.updateScene()}},{key:"updateScene",value:function(e){if(!function(e){var t=e.camera;return!isNaN(t.far)&&!isNaN(t.near)}({camera:this.camera}))return!1;e?this._updateScene():this.__updateSceneTimed()}},{key:"_updateScene",value:function(){for(var e in this.layers)this.layers[e]&&this.layers[e].sceneUpdated({camera:this.camera});this.forest.sceneUpdated({camera:this.camera})}},{key:"_updateFrustum",value:function(e){}},{key:"addAltizureProject",value:function(){var e,t=(e=regeneratorRuntime.mark(function e(t){var r,n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.projInfo,n=t.pid,o=t.position,i=t.showBBox,e.abrupt("return",this.initialized.then(function(e){return e.layers.project.addAltizure({pid:n,projInfo:r,position:o,showBBox:i})}).catch(function(e){return console.warn("Failed to add Altizure project",n,e),Promise.resolve()}));case 2:case"end":return e.stop()}},e,this)}),function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Yu(i,n,o,a,s,"next",e)}function s(e){Yu(i,n,o,a,s,"throw",e)}a(void 0)})});return function(e){return t.apply(this,arguments)}}()},{key:"addOSGProject",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return this.initialized.then(function(e){return e.layers.project.addOSG({spec:t,position:r,showBBox:n})}).catch(function(e){return console.warn("Failed to add OSG project",e),Promise.resolve()})}},{key:"addDEMProject",value:function(e){var t=e.spec,r=e.position,n=e.showBBox;return this.initialized.then(function(e){return e.layers.project.addDEM({spec:t,position:r,showBBox:n})}).catch(function(e){return console.warn("Failed to add DEM project",e),Promise.resolve()})}},{key:"scale",get:function(){return 1}},{key:"resolution",get:function(){return 1}},{key:"earthNode",get:function(){return this.ecefNode}},{key:"renderItems",get:function(){return this._renderItems}},{key:"spotLights",get:function(){return this._spotLights}}])&&qu(r.prototype,n),t}()).prototype,"scale",[ye],Object.getOwnPropertyDescriptor(Wu.prototype,"scale"),Wu.prototype),ec(Wu.prototype,"resolution",[ye],Object.getOwnPropertyDescriptor(Wu.prototype,"resolution"),Wu.prototype),ec(Wu.prototype,"earthNode",[ye],Object.getOwnPropertyDescriptor(Wu.prototype,"earthNode"),Wu.prototype),Wu);function rc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var nc=function(){function e(t){var r,n,o,i,a,s=t.id,l=t.cloudPath,u=t.name,c=void 0===u?"unknown":u,f=t.owner,p=void 0===f?"unknown":f,d=t.version,v=void 0===d?{major:0,minor:0,patch:0}:d,m=t.salt,y=void 0===m?"":m,g=t.maxLevel,b=void 0===g?20:g,_=t.minLevel,w=void 0===_?0:_,x=t.geoInfo,k=t.modelTransform;function O(e){var t=e.x,r=e.y,n=e.z;return new h.Vector3(t,r,n)}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=s,this.cloudPath=l,this.name=c,this.owner=p,this.version=v,this.salt=y,this.maxLevel=b,this.minLevel=w,x=Qt({center:{geo:{lng:0,lat:0,alt:0},xyz:{x:0,y:0,z:0},epsg:"unknown"}},x),this.geoInfo={center:{geo:x.center.geo,xyz:O(x.center.xyz),epsg:x.center.epsg}},k=Qt({bbox:{max:{x:1,y:1,z:1},min:{x:-1,y:-1,z:-1}},scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1}},k),this.modelTransform={bbox:{max:O(k.bbox.max),min:O(k.bbox.min)},scale:O(k.scale),position:O(k.position),quaternion:(r=k.quaternion,n=r.x,o=r.y,i=r.z,a=r.w,new h.Quaternion(n,o,i,a))}}var t,r;return t=e,(r=[{key:"destruct",value:function(){return!0}},{key:"validate",value:function(){return!!this.id&&!!this.cloudPath}},{key:"valid",get:function(){return this.validate()}},{key:"dataPath",get:function(){console.error("deprecated")}},{key:"rootFileName",get:function(){console.error("deprecated")}}])&&rc(t.prototype,r),e}();function oc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ic=function(){function e(t){var r=t.name,n=void 0===r?"unknown":r,o=t.maxLevel,i=void 0===o?10:o,a=t.minLevel,s=void 0===a?0:a,l=t.demWmtsUrl,u=t.domWmtsUrl,c=t.maxHeight,f=t.minHeight,h=t.rootNode;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=n,this.maxLevel=i,this.minLevel=s,this.demWmtsUrl=l,this.domWmtsUrl=u,this.maxHeight=c,this.minHeight=f,this.rootNode=h}var t,r;return t=e,(r=[{key:"valid",get:function(){return!("function"!=typeof this.demWmtsUrl&&"string"!=typeof this.demWmtsUrl||isNaN(this.maxHeight)||isNaN(this.minHeight))}}])&&oc(t.prototype,r),e}();function ac(e){return(ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function uc(e){return(uc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cc(e,t){return(cc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var fc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?Zi:o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==ac(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,uc(t).call(this,n,i)))._tree=n,e._Type=i,e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cc(e,t)}(t,ir),r=t,(n=[{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){sc(e,t,r[t])})}return e}({},e.style,this.tree.style);return e.geometry.computeVertexNormals(),new this.Type(t)}}])&&lc(r.prototype,n),t}();function hc(e){return(hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pc(e){return(pc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dc(e,t){return(dc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var vc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=Object.assign({},a,{emissive:new h.Color(.6,.6,.6),metalness:.5,emissiveIntensity:1}),(e=function(e,t){return!t||"object"!==hc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,pc(t).call(this,a))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dc(e,t)}(t,h.MeshPhysicalMaterial),t}();function mc(e){return(mc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function yc(e){return(yc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gc(e,t){return(gc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.map,l=a.size;void 0===l&&(l=2);var u=h.VertexColors;return(e=function(e,t){return!t||"object"!==mc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,yc(t).call(this,Zt({map:s,size:l,sizeAttenuation:!1,vertexColors:u})))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gc(e,t)}(t,h.PointsMaterial),t}();function _c(e){return(_c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wc(e){return(wc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function xc(e,t){return(xc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var kc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y;return function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}}(r,["level","x","y"]),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==_c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,wc(t).call(this,{color:8947848,specular:6710886,shininess:30,flatShading:!0}))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xc(e,t)}(t,Ki),t}();function Oc(e){return(Oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Pc(e){return(Pc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ac(e,t){return(Ac=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Sc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y;return function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}}(r,["level","x","y"]),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Oc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Pc(t).call(this,{color:12303291,wireframe:!0}))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ac(e,t)}(t,h.MeshBasicMaterial),t}();function Mc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Tc=function(){function e(t){var r=t.camera,n=t.target,o=t.parent,i=t.sceneGraphRoot,a=t.offlineRenderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=r,this.parent=o,this.sceneGraphRoot=i,this.offlineRenderer=a,this._target=n,this.ID=this.camera.uuid,this.sceneGraphRoot.add(this.camera),this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.depthTexture=new h.DataTexture(new Float32Array([0,0,0]),1,1,h.RGBFormat,h.FloatType,h.UVMapping),this.localToVideo=(new h.Matrix4).getInverse(this.camera.matrix),this.normalMatrix=(new h.Matrix3).getNormalMatrix(this.localToVideo),this.videoProjectionMatrix=this.camera.projectionMatrix,this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2),this.visible=!0}var t,r;return t=e,(r=[{key:"updateDepthTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld();var r=this.offlineRenderer.renderDepthSnapshot(this.camera,[this.sceneGraphRoot],e,t,{side:h.DoubleSide});this.depthTexture&&this.depthTexture.dispose&&this.depthTexture.dispose();for(var n=new Float32Array(3*e*t),o=0;o<r.length;++o){var i=3*o,a=r[o];n[i]=a,n[i+1]=a,n[i+2]=a}this.depthTexture.image={data:n,width:e,height:t},this.depthTexture.needsUpdate=!0}},{key:"destruct",value:function(){return this.sceneGraphRoot.remove(this.camera),this.depthTexture&&this.depthTexture.dispose&&(this.depthTexture.dispose(),this.depthTexture=null),this.camera=null,this.parent=null,this.sceneGraphRoot=null,!0}},{key:"lookAt",value:function(e,t,r){e&&this.camera.position.set(e.x,e.y,e.z),t&&this.camera.up.set(t.x,t.y,t.z),r&&(this._target=r,this.camera.matrix.setPosition(this.camera.position).lookAt(this.camera.position,new h.Vector3(r.x,r.y,r.z),this.camera.up)),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.localToVideo.copy((new h.Matrix4).getInverse(this.camera.matrix)),this.normalMatrix=(new h.Matrix3).getNormalMatrix(this.localToVideo)}},{key:"near",get:function(){return this.camera.near},set:function(e){this.camera.near=e,this.camera.updateProjectionMatrix()}},{key:"far",get:function(){return this.camera.far},set:function(e){this.camera.far=e,this.camera.updateProjectionMatrix(),this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2)}},{key:"position",get:function(){return this.camera.position.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(new h.Vector3(t,r,n),this.up,this.target)}},{key:"up",get:function(){return this.camera.up.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(this.position,new h.Vector3(t,r,n),this.target)}},{key:"target",get:function(){return this._target},set:function(e){this.lookAt(void 0,void 0,e)}}])&&Mc(t.prototype,r),e}();function Ec(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Cc=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.normalTarget=new h.WebGLRenderTarget,this.normalTarget.texture.format=h.RGBAFormat,this.normalTarget.texture.minFilter=h.NearestFilter,this.normalTarget.texture.magFilter=h.NearestFilter,this.normalTarget.texture.generateMipmaps=!1,this.scene=new h.Scene,this.depthShaderMaterial=new h.ShaderMaterial({uniforms:{logDepthBufFC:{type:"f",value:1}},vertexShader:"\n      #ifdef USE_LOGDEPTHBUF\n        #ifdef USE_LOGDEPTHBUF_EXT\n          varying float vFragDepth;\n        #else\n          uniform float logDepthBufFC;\n        #endif\n      #endif\n      void main() {\n        vec3 transformed = vec3( position );\n        vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n        #ifdef USE_LOGDEPTHBUF\n          #ifdef USE_LOGDEPTHBUF_EXT\n            vFragDepth = 1.0 + gl_Position.w;\n          #else\n            gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n            gl_Position.z *= gl_Position.w;\n          #endif\n        #endif\n      }",fragmentShader:"\n      float shift_right(float v, float amt) {\n        v = floor(v) + 0.5;\n        return floor(v / exp2(amt));\n      }\n      float shift_left(float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n      }\n      float mask_last(float v, float bits) {\n        return mod(v, shift_left(1.0, bits));\n      }\n      float extract_bits(float num, float from, float to) {\n        from = floor(from + 0.5);\n        to = floor(to + 0.5);\n        return mask_last(shift_right(num, from), to - from);\n      }\n      vec4 encode_float(float val) {\n        if (val == 0.0)\n          return vec4(0, 0, 0, 0);\n        float sign = val > 0.0 ? 0.0 : 1.0;\n        val = abs(val);\n        float exponent = floor(log2(val));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;\n        \n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        \n        float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return vec4(byte4, byte3, byte2, byte1);\n      }\n      #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n        uniform float logDepthBufFC;\n        varying float vFragDepth;\n      #endif\n      void main() {\n        #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n          float depth = log2( vFragDepth ) * logDepthBufFC * 0.5;\n          gl_FragDepthEXT = depth;\n          gl_FragColor = encode_float(depth);\n        #else\n          gl_FragColor = encode_float(gl_FragCoord.z);\n        #endif\n      }"})}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.normalTarget.texture.dispose(),this.normalTarget.dispose(),this.depthShaderMaterial.dispose(),this.normalTarget.texture=null,this.normalTarget=null,this.scene=null,this.depthShaderMaterial=null,!0}},{key:"renderColorSnapshot",value:function(e,t,r,n){this.scene.overrideMaterial=void 0,this.normalTarget.setSize(r,n),this.scene.children=t;var o=this.renderer.getClearColor(),i=this.renderer.getClearAlpha();this.renderer.setClearColor(16777215,0),this.renderer.render(this.scene,e,this.normalTarget,!0),this.renderer.setClearColor(o,i);var a=new Uint8Array(4*r*n);return this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,a),this.scene.children=[],v.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,e)),a}},{key:"renderDepthSnapshot",value:function(e,t,r,n,o){var i={side:this.depthShaderMaterial.side};o&&void 0!==o.side&&(this.depthShaderMaterial.side=o.side),this.scene.overrideMaterial=this.depthShaderMaterial,this.scene.overrideMaterial.uniforms.logDepthBufFC.value=2/(Math.log(e.far+1)/Math.LN2),this.normalTarget.setSize(r,n),this.scene.children=t;var a=this.renderer.getClearColor(),s=this.renderer.getClearAlpha();this.renderer.setClearColor(new h.Color(0,0,128/255),63/255),this.renderer.render(this.scene,e,this.normalTarget),this.renderer.setClearColor(a,s);var l=new Uint8Array(4*r*n);this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,l);var u=new Float32Array(l.buffer);return this.scene.children=[],this.depthShaderMaterial.side=i.side,v.clearRenderListRenferenceToMesh(this.renderer.renderLists.get(this.scene,e)),u}}])&&Ec(t.prototype,r),e}();function jc(e){return(jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rc(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ic(e,t,r){return(Ic="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dc(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Dc(e){return(Dc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function zc(e,t){return(zc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Nc=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==jc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Dc(t).call(this,{tree:n,Type:o}));var i=h.UniformsUtils.merge([{},Vi.visibility.uniforms]);return e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Rc(e,t,r[t])})}return e}({},e._sharedUniforms,i),t.offlineRenderer?(e.renderer=t.offlineRenderer.renderer,e.offlineRenderer=t.offlineRenderer):(e.renderer=new h.WebGLRenderer({antialias:!0,premultipliedAlpha:!1,alpha:!1,logarithmicDepthBuffer:!1}),e.renderer.setClearColor(new h.Color(.15294117647058825,.15294117647058825,.15294117647058825),void 0),e.renderer.setPixelRatio(1),e.renderer.setSize(1024,1024),e.renderer.context.getExtension("OES_standard_derivatives"),e.renderer.name="Projector renderer",e.offlineRenderer=new Cc(e.renderer),t.offlineRenderer=e.offlineRenderer),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&zc(e,t)}(t,ir),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),this.offlineRenderer=null,this.renderer=null,Ic(Dc(t.prototype),"destruct",this).call(this)&&e}},{key:"generateTileMaterial",value:function(e){e.geometry.computeVertexNormals();var t={map:e.style.map,sharedUniforms:this._sharedUniforms};return new this.Type(t)}},{key:"addProjector",value:function(e){var t=e.options,r=e.ProjectorType,n=new(void 0===r?Tc:r)(t),o=this;return void 0!==n.vdom&&n.vdom.readyState<2&&(n.visible=!1,n.vdom.addEventListener("loadeddata",function(){n.vdom.readyState>=2&&(n.visible=!0)})),o._sharedUniforms.projectors.value.push(n),o._sharedUniforms.depthTexture.value.push(n.depthTexture),o._sharedUniforms.count.value+=1,n}},{key:"getProjectorIndex",value:function(e){if(!e)return-1;for(var t=-1,r=0;r<this.projectors.length;++r)if(this.projectors[r].ID===e.ID){t=r;break}return t}},{key:"clearProjectors",value:function(){this._sharedUniforms.count.value=0;var e=this._sharedUniforms.projectors.value.map(function(e){return e});this._sharedUniforms.projectors.value.splice(0,this._sharedUniforms.projectors.value.length),this._sharedUniforms.depthTexture.value.splice(0,this._sharedUniforms.depthTexture.value.length),this._sharedUniforms.videoTexture.value.splice(0,this._sharedUniforms.videoTexture.value.length),e.map(function(e){e.destruct()})}},{key:"removeProjectorByIndex",value:function(e){var t=this._sharedUniforms.projectors.value[e];t&&(this._sharedUniforms.count.value-=1,this._sharedUniforms.projectors.value.splice(e,1),this._sharedUniforms.depthTexture.value.splice(e,1),t.destruct())}},{key:"_updateMaterials",value:function(){this.tree.traverse(this.tree.root,function(e){if(e&&e.content&&e.content.material){var t=e.content.material;if(Array.isArray(t))for(var r=0;r<t.length;++r)t[r].update&&t[r].update();else t.update&&t.update()}})}},{key:"projectors",get:function(){return this._sharedUniforms.projectors.value}}])&&Lc(r.prototype,n),t}();Nc.offlineRenderer=null;var Bc=Nc;function Uc(e){return(Uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Fc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Vc(e,t,r){return(Vc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Hc(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Hc(e){return(Hc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wc(e,t){return(Wc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Gc=function(e){function t(e){var r,n=e.fov,o=e.aspect,i=e.near,a=e.far,s=e.position,l=e.up,u=e.target,c=e.projectorTreeMaterial,f=e.offlineRenderer,p=e.sceneGraphRoot,d=e.videoSrcUrl,v=e.type,m=e.videoDom;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var y=new h.PerspectiveCamera(n,o,i,a);return y.position.set(s.x,s.y,s.z),y.up.set(l.x,l.y,l.z),y.lookAt(new h.Vector3(u.x,u.y,u.z)),y.updateProjectionMatrix(),y.updateMatrix(),y.updateMatrixWorld(),(r=function(e,t){return!t||"object"!==Uc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Hc(t).call(this,{camera:y,parent:c,sceneGraphRoot:p,offlineRenderer:f})))._target=u,d?(r.vdom=document.createElement("video"),r.vdom.id=d,r.vdom.loop="true",r.vdom.autoplay="true",r.vdom.muted="true",r.vdom.preload="metadata",r.vdom.crossOrigin="anonymous",r.vdom.style="display:none",r.vsrc=document.createElement("source"),r.vsrc.src=d,r.vsrc.type=v,r.vdom.appendChild(r.vsrc),r.vdom.load(),r.vdom.play(),r._videoPath=d,r._videoType=v):m&&(r.vdom=m,m.hasChildNodes()&&"SOURCE"===m.children[0].tagName&&(r.vsrc=m.children[0]),console.log("video",r.vdom)),r.videoTexture=new h.VideoTexture(r.vdom),r.videoTexture.minFilter=r.videoTexture.magFilter=h.LinearFilter,r.videoTexture.format=h.RGBFormat,r.isVideo=!0,r.alpha=1,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Wc(e,t)}(t,Tc),r=t,(n=[{key:"destruct",value:function(){return this.videoTexture.dispose(),this.videoTexture=null,this.vdom.pause(),this.vdom.removeAttribute("src"),this.vsrc&&(this.vdom.removeChild(this.vsrc),this.vsrc.removeAttribute("src")),this.vdom.load(),this.vdom=null,this.vsrc=null,Vc(Hc(t.prototype),"destruct",this).call(this)}},{key:"playVideo",value:function(){return this.vdom.play()}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.camera.fov=e,this.camera.updateProjectionMatrix()}},{key:"aspect",get:function(){return this.camera.aspect},set:function(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}}])&&Fc(r.prototype,n),t}();function Kc(e){return(Kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xc(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Yc(e,t,r){return(Yc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qc(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function qc(e){return(qc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zc(e,t){return(Zc=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qc=function(e){function t(e){var r,n=e.fov,o=e.aspect,i=e.near,a=e.far,s=e.position,l=e.up,u=e.target,c=e.projectorTreeMaterial,f=e.offlineRenderer,p=e.sceneGraphRoot,d=e.texture;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var v=new h.PerspectiveCamera(n,o,i,a);return v.position.set(s.x,s.y,s.z),v.up.set(l.x,l.y,l.z),v.lookAt(new h.Vector3(u.x,u.y,u.z)),v.updateProjectionMatrix(),v.updateMatrix(),v.updateMatrixWorld(),(r=function(e,t){return!t||"object"!==Kc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,qc(t).call(this,{camera:v,parent:c,sceneGraphRoot:p,offlineRenderer:f}))).isVideo=!0,r.alpha=1,r.videoTexture=d,r._target=u,r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zc(e,t)}(t,Tc),r=t,(n=[{key:"destruct",value:function(){return this.videoTexture&&(this.videoTexture.dispose(),this.videoTexture=null),Yc(qc(t.prototype),"destruct",this).call(this)}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.camera.fov=e,this.camera.updateProjectionMatrix()}},{key:"aspect",get:function(){return this.camera.aspect},set:function(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}}])&&Xc(r.prototype,n),t}();function Jc(e){return(Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ef(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tf(e){return(tf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rf(e,t){return(rf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.sharedUniforms,s=r.map,l=(r.color,r.transparent),u=void 0!==l&&l,c=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","sharedUniforms","map","color","transparent"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Jc(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,tf(t).call(this,c))).level=n,e.x=o,e.y=i,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){$c(e,t,r[t])})}return e}({map:{type:"t",value:s}},a),e.update(),e.transparent=u,e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rf(e,t)}(t,h.ShaderMaterial),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Vi.video.vertexShader.slice(),r=Vi.video.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&ef(r.prototype,n),t}();function of(e){return(of="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function af(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function lf(e,t,r){return(lf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=uf(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function uf(e){return(uf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cf(e,t){return(cf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ff=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?nf:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=function(e,t){return!t||"object"!==of(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,uf(t).call(this,{tree:n,Type:i}));var a=h.UniformsUtils.merge([{},Vi.video.uniforms]);return e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){af(e,t,r[t])})}return e}({},e._sharedUniforms,a),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cf(e,t)}(t,Bc),r=t,(n=[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),lf(uf(t.prototype),"destruct",this).call(this)&&e}},{key:"addVideoProjector",value:function(e){var r=e.fov,n=e.aspect,o=e.near,i=e.far,a=e.position,s=e.up,l=e.target,u=e.videoSrcUrl,c=e.type,f=e.videoDom,h=lf(uf(t.prototype),"addProjector",this).call(this,{options:{fov:r,aspect:n,near:o,far:i,position:a,up:s,target:l,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,videoSrcUrl:u,type:c,videoDom:f,projectorTreeMaterial:this},ProjectorType:Gc});return this._sharedUniforms.videoTexture.value.push(h.videoTexture),this._updateMaterials(),h}},{key:"addImageProjector",value:function(e){var t=e.fov,r=e.aspect,n=e.near,o=e.far,i=e.position,a=e.up,s=e.target,l=e.texture,u=new Qc({fov:t,aspect:r,near:n,far:o,position:i,up:a,target:s,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,texture:l,projectorTreeMaterial:this});return this._sharedUniforms.projectors.value.push(u),this._sharedUniforms.depthTexture.value.push(u.depthTexture),this._sharedUniforms.count.value+=1,this._sharedUniforms.videoTexture.value.push(u.videoTexture),this._updateMaterials(),u}},{key:"addVisibility",value:function(e){var r=e.fov,n=e.aspect,o=e.near,i=e.far,a=e.position,s=e.up,l=e.target,u=new h.PerspectiveCamera(r,n,o,i);u.position.set(a.x,a.y,a.z),u.up.set(s.x,s.y,s.z),u.lookAt(new h.Vector3(l.x,l.y,l.z));var c=lf(uf(t.prototype),"addProjector",this).call(this,{options:{target:l,camera:u,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,parent:this}});return this._sharedUniforms.videoTexture.value.push(c.videoTexture),this._updateMaterials(),c}},{key:"removeProjectorByIndex",value:function(e){var t=this._sharedUniforms.projectors.value[e];t&&(this._sharedUniforms.count.value-=1,this._sharedUniforms.projectors.value.splice(e,1),this._sharedUniforms.depthTexture.value.splice(e,1),this._sharedUniforms.videoTexture.value.splice(e,1),t.destruct(),this._updateMaterials())}},{key:"clearProjectors",value:function(){lf(uf(t.prototype),"clearProjectors",this).call(this),this._sharedUniforms.videoTexture.value.splice(0,this._sharedUniforms.videoTexture.value.length),this._updateMaterials()}}])&&sf(r.prototype,n),t}();function hf(e){return(hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function df(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vf(e){return(vf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mf(e,t){return(mf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.map,s=r.sharedUniforms,l=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==hf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,vf(t).call(this,l))).level=n,e.x=o,e.y=i,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){pf(e,t,r[t])})}return e}({map:{ype:"t",value:a}},s),e.vertexShader=Vi.crop.vertexShader,e.fragmentShader=Vi.crop.fragmentShader,e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mf(e,t)}(t,h.ShaderMaterial),r=t,(n=[{key:"update",value:function(){this.needsUpdate=!0}}])&&df(r.prototype,n),t}(),gf=r(4),bf=r.n(gf),_f=3e4;function wf(e){var t=e.api,r=e.pid,n=e.type,o=e.debug,i=void 0!==o&&o;switch(n){case"crop":return function(e){var t=e.api,r=e.pid,n=e.debug;return t?t.cropMask({pid:r,timeout:_f}).then(function(e){var t=0;n&&(t=Date.now());var r=bf.a.unpackToImage(e.maskInfos[0]),o=e.maskInfos[0].height;return n&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve({image:r,maskSize:o})}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:i});case"water":return function(e){var t=e.api,r=e.pid,n=e.debug;return t?t.waterMask({pid:r,timeout:_f}).then(function(e){if(null===e)return Promise.reject(new Error("No water exists."));var t=0;n&&(t=Date.now());var r=e.maskInfos.map(function(e){var t=e.level,r=e.alpha,n=e.wave,o=e.speed,i=void 0===o?.5:o,a=e.color,s=e.polyNum,l=e.width,u=e.height;return{image:bf.a.unpackToImage(e),level:t,alpha:r,wave:n,speed:i,color:a,polyNum:s,width:l,height:u}});return n&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve(r)}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:i});default:var a="Uknown mask type"+n;return console.warn(a),Promise.reject(new Error(a))}}function xf(e){var t=e.apiInfo,r=e.type;switch(r){case"crop":return function(e){var t=e.apiInfo,r=bf.a.unpackToImage(t.maskInfos[0]),n=t.maskInfos[0].height;return t=void 0,Promise.resolve({image:r,maskSize:n})}({apiInfo:t});case"water":return function(e){var t=e.apiInfo;if(null===t)return Promise.reject(new Error("No water exists."));var r=t.maskInfos.map(function(e){var t=e.level,r=e.alpha,n=e.wave,o=e.speed,i=void 0===o?.5:o,a=e.color,s=e.polyNum,l=e.width,u=e.height;return{image:bf.a.unpackToImage(e),level:t,alpha:r,wave:n,speed:i,color:a,polyNum:s,width:l,height:u}});return t=void 0,Promise.resolve(r)}({apiInfo:t});default:var n="Uknown mask type"+r;return console.warn(n),Promise.reject(new Error(n))}}function kf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Of=function(){function e(t){var r=t.maskSize,n=void 0===r?4:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._maskSize=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.maskSize,this.canvas.height=this.maskSize,this.canvas.id="ProjectBooleanMask";var o=this.canvas.getContext("2d");o.fillStyle="#fff",o.fillRect(0,0,n,n),this.needsUpdate=!0}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.canvas=void 0,!0}},{key:"paintPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.canvas.getContext("2d"),o=e.length;if(!(o<3)){n.fillStyle=t,n.strokeStyle="#0f0",n.beginPath();var i=this.maskSize;r||(n.moveTo(0,0),n.lineTo(0,i),n.lineTo(i,i),n.lineTo(i,0),n.closePath());var a=e.map(function(e){var t=e.u,r=e.v;return{x:Math.floor(t*i),y:i-Math.floor(r*i)}}),s=a[--o];for(n.moveTo(s.x,s.y);o--;)n.lineTo(a[o].x,a[o].y);return n.closePath(),r?n.fill():n.fill("evenodd"),this.needsUpdate=!0,!0}}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#0f0";return this.paintPolygon([{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}],e)}},{key:"packMask",value:function(){for(var e=this.maskSize,t=this.imageData,r=e,n=e,o=[],i=!0,a=0,s=1;s<t.length;)i===t[s]<12.75?(a+=1,s+=4):(o.push(a),a=0,i=!i);return a>0&&o.push(a),{width:r,height:n,data:o}}},{key:"maskSize",get:function(){return this._maskSize},set:function(e){e!==this.maskSize&&(this.canvas.width=e,this.canvas.height=e,this._maskSize=e)}},{key:"imageData",get:function(){return this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data},set:function(e){var t=e.uint8,r=e.maskSize;this.maskSize=r;var n=new ImageData(t,r,r);this.canvas.getContext("2d").putImageData(n,0,0),this.needsUpdate=!0}},{key:"texture",get:function(){if(this.needsUpdate){this._texture&&this._texture.dispose();var e=new Uint8Array(this.imageData,1);this._texture=new h.DataTexture(e,this.maskSize,this.maskSize,h.RGBAFormat,h.UnsignedByteType),this._texture.needsUpdate=!0}return this.needsUpdate=!1,this._texture}}])&&kf(t.prototype,r),e}();function Pf(e){return(Pf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Af(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function Sf(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){Af(i,n,o,a,s,"next",e)}function s(e){Af(i,n,o,a,s,"throw",e)}a(void 0)})}}function Mf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ef(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cf(e,t,r){return(Cf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=jf(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function jf(e){return(jf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rf(e,t){return(Rf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?yf:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Pf(t)&&"function"!=typeof t?Ef(e):t}(this,jf(t).call(this,{tree:n,Type:i})))._cropMask=new Of({maskSize:1024});var a=h.UniformsUtils.merge([{},Vi.crop.uniforms]);e._sharedUniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Mf(e,t,r[t])})}return e}({},e._sharedUniforms,a),e._sharedUniforms.cropMask.value=e._cropMask.texture;var s=Ef(e);return e.initialized=new Promise(function(e,t){s._onInitSuccess=e,s._onInitFail=t}),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rf(e,t)}(t,ir),r=t,(n=[{key:"destruct",value:function(){return this._cropMask.destruct(),Cf(jf(t.prototype),"destruct",this).call(this)}},{key:"loadCropMask",value:function(){var e=Sf(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",wf({api:this.altizureApi,pid:this.PID,type:"crop"}).then(function(e){return t._onInitSuccess(t),t._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),t._updateOrthoInfo(),Promise.resolve(t)}).catch(function(e){return t._onInitFail(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadCropMaskLocal",value:function(){var e=Sf(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.apiInfo,n=this,e.abrupt("return",xf({apiInfo:r,type:"crop"}).then(function(e){return n._onInitSuccess(n),n._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),n._updateOrthoInfo(),Promise.resolve(n)}).catch(function(e){return n._onInitFail(e),Promise.reject(e)}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCropMask",value:function(e){var t=e.uint8,r=e.maskSize;return this._cropMask.imageData={uint8:t,maskSize:r},this._sharedUniforms.cropMask.value&&this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture,!0}},{key:"refreshMask",value:function(){return this._updateOrthoInfo(),this._sharedUniforms.cropMask.value!==this._cropMask.texture&&(this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture),!0}},{key:"generateTileMaterial",value:function(e){var t=e.style,r={level:t.level,x:t.x,y:t.y,map:t.map,sharedUniforms:this._sharedUniforms};return new this.Type(r)}},{key:"_updateOrthoInfo",value:function(){var e=this.tree.projInfo.model.orthoInfo;return this._sharedUniforms.origin.value=e.origin,this._sharedUniforms.xDir.value=e.xDir,this._sharedUniforms.yDir.value=e.yDir,this._sharedUniforms.zDir.value=e.zDir,this._sharedUniforms.minBound.value=e.minBound,this._sharedUniforms.maxBound.value=e.maxBound,!0}},{key:"altizureApi",get:function(){return this.tree.altizureApi}},{key:"PID",get:function(){return this.tree.projInfo.id}}])&&Tf(r.prototype,n),t}();function If(e){return(If="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Df(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Nf(e){return(Nf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bf(e,t){return(Bf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Uf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.sharedUniforms,s=r.transparent,l=void 0!==s&&s,u=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","sharedUniforms","transparent"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var c=u.map;return c||console.warn("no map"),(e=function(e,t){return!t||"object"!==If(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Nf(t).call(this))).level=n,e.x=o,e.y=i,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Df(e,t,r[t])})}return e}({map:{value:c}},a),e.update(),e.transparent=l,e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Bf(e,t)}(t,h.ShaderMaterial),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Vi.visibility.vertexShader.slice(),r=Vi.visibility.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&zf(r.prototype,n),t}();function Ff(e){return(Ff="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Vf(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hf(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Wf(e,t,r){return(Wf="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Gf(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Gf(e){return(Gf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kf(e,t){return(Kf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?Uf:o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Ff(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Gf(t).call(this,n,i)))._tree=n,e._Type=i,e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kf(e,t)}(t,Bc),r=t,(n=[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Vf(e,t,r[t])})}return e}({sharedUniforms:this._sharedUniforms},e.style,this.tree.style);return e.geometry.computeVertexNormals(),new this.Type(t)}},{key:"addProjector",value:function(e){var r=e.fov,n=e.aspect,o=e.near,i=e.far,a=e.position,s=e.up,l=e.target,u=new h.PerspectiveCamera(r,n,o,i);u.position.set(a.x,a.y,a.z),u.up.set(s.x,s.y,s.z),u.lookAt(new h.Vector3(l.x,l.y,l.z));var c=Wf(Gf(t.prototype),"addProjector",this).call(this,{options:{target:l,camera:u,offlineRenderer:this.offlineRenderer,sceneGraphRoot:this.tree.sceneGraphRoot,parent:this}});return this._updateMaterials(),c}},{key:"removeProjectorByIndex",value:function(e){Wf(Gf(t.prototype),"removeProjectorByIndex",this).call(this,e),this._updateMaterials()}},{key:"clearProjectors",value:function(){Wf(Gf(t.prototype),"clearProjectors",this).call(this),this._updateMaterials()}}])&&Hf(r.prototype,n),t}();function Yf(e){return(Yf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qf(e){return(qf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zf(e,t){return(Zf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Qf=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.map;return s||console.warn("no map"),(e=function(e,t){return!t||"object"!==Yf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,qf(t).call(this,{map:s,color:new h.Color(1,1,1),lights:!0,shininess:0,specular:new h.Color(0,0,0)}))).level=n,e.x=o,e.y=i,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zf(e,t)}(t,Ki),t}();function Jf(e){return(Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function th(e){return(th=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rh(e,t){return(rh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var nh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.map,s=r.sharedUniforms,l=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Jf(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,th(t).call(this,l))).level=n,e.x=o,e.y=i,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){$f(e,t,r[t])})}return e}({map:{type:"t",value:a}},s),e.update(),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rh(e,t)}(t,h.ShaderMaterial),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Vi.cropAndVideo.vertexShader.slice(),r=Vi.cropAndVideo.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&eh(r.prototype,n),t}();function oh(e){return(oh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ih(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function ah(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){ih(i,n,o,a,s,"next",e)}function s(e){ih(i,n,o,a,s,"throw",e)}a(void 0)})}}function sh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){lh(e,t,r[t])})}return e}function lh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uh(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ch(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fh(e,t,r){return(fh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=hh(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function hh(e){return(hh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ph(e,t){return(ph=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var dh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?nh:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==oh(t)&&"function"!=typeof t?ch(e):t}(this,hh(t).call(this,{tree:n,Type:i})))._cropMask=new Of({maskSize:1024});var a=h.UniformsUtils.merge([{},Vi.crop.uniforms]);a.cropMask.value=e._cropMask.texture,e._sharedUniforms=sh({},e._sharedUniforms,a);var s=ch(e);return e.initialized=new Promise(function(e,t){s._onInitSuccess=e,s._onInitFail=t}),e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ph(e,t)}(t,ff),r=t,(n=[{key:"destruct",value:function(){return this._cropMask.destruct(),fh(hh(t.prototype),"destruct",this).call(this)}},{key:"generateTileMaterial",value:function(e){e.geometry.computeVertexNormals();var t=e.style,r={level:t.level,x:t.x,y:t.y,map:t.map,sharedUniforms:sh({},this._sharedUniforms,this._projectorUniforms)};return new this.Type(r)}},{key:"loadCropMask",value:function(){var e=ah(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",wf({api:this.altizureApi,pid:this.PID,type:"crop"}).then(function(e){return t._onInitSuccess(t),t._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),t._updateOrthoInfo(),Promise.resolve(t)}).catch(function(e){return t._onInitFail(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadCropMaskLocal",value:function(){var e=ah(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.apiInfo,n=this,e.abrupt("return",xf({apiInfo:r,type:"crop"}).then(function(e){return n._onInitSuccess(n),n._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),n._updateOrthoInfo(),Promise.resolve(n)}).catch(function(e){return n._onInitFail(e),Promise.reject(e)}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_updateCropMask",value:function(e){var t=e.uint8,r=e.maskSize;return this._cropMask.imageData={uint8:t,maskSize:r},this._sharedUniforms.cropMask.value&&this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture,!0}},{key:"refreshMask",value:function(){return this._updateOrthoInfo(),this._sharedUniforms.cropMask.value!==this._cropMask.texture&&(this._sharedUniforms.cropMask.value.dispose(),this._sharedUniforms.cropMask.value=this._cropMask.texture),!0}},{key:"_updateOrthoInfo",value:function(){var e=this.tree.projInfo.model.orthoInfo;return this._sharedUniforms.origin.value=e.origin,this._sharedUniforms.xDir.value=e.xDir,this._sharedUniforms.yDir.value=e.yDir,this._sharedUniforms.zDir.value=e.zDir,this._sharedUniforms.minBound.value=e.minBound,this._sharedUniforms.maxBound.value=e.maxBound,!0}},{key:"altizureApi",get:function(){return this.tree.altizureApi}},{key:"PID",get:function(){return this.tree.projInfo.id}}])&&uh(r.prototype,n),t}();function vh(e){return(vh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yh(e){return(yh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function gh(e,t){return(gh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var bh=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,o=r.x,i=r.y,a=r.map,s=(r.color,r.emissive,r.shininess,r.specular,r.specularMap,r.contourLineUniforms),l=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","map","color","emissive","shininess","specular","specularMap","contourLineUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==vh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,yh(t).call(this,l))).level=n,e.x=o,e.y=i,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){mh(e,t,r[t])})}return e}({map:{value:a}},s),e.transparent=!0,e.vertexShader=_h,e.fragmentShader=wh,e.extensions.derivatives=!0,e.depthWrite=!0,e.side=h.DoubleSide,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gh(e,t)}(t,h.ShaderMaterial),t}(),_h=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","#include <logdepthbuf_pars_vertex>","void main() {","vUv = uv;","localPosition = position;","slope = abs(normalize(normal).z);","vec4 inPosition = vec4(position, 1.0);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vPosition = (modelViewMatrix * inPosition).xyz;","#include <logdepthbuf_vertex>","}"].join("\n"),wh=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","uniform vec3 color;","uniform float heightInterval;","uniform float lineWidth;","uniform float mapAlpha;","uniform float distanceLimit;","uniform float worldToMeters;","uniform sampler2D map;","#include <logdepthbuf_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","float distanceInMeters = worldToMeters * length(cameraPosition - vPosition);","float multiply = distanceInMeters / distanceLimit + 1.0;","multiply = multiply > 3.0 ? clamp(6.0 - multiply, 0.0, 3.0) : multiply;","float adaptedHeightInterval = heightInterval;","float adaptedLineWidth = min(lineWidth * multiply, heightInterval);","float f = abs(2.0 * fract(localPosition.z / adaptedHeightInterval) - 1.0);","float df = fwidth(localPosition.z / adaptedHeightInterval);","float fLimit0 = adaptedLineWidth * (1.0 + slope);","float fLimit1 = df * min(adaptedLineWidth, 10.0);","float fLimit = min(fLimit0, fLimit1);","float lineMix = f < fLimit ? f / fLimit : 1.0;","vec4 lineColor = vec4(color, 1.0);","vec4 mapColor = texture2D(map, vUv);","mapColor.a = mapAlpha;","gl_FragColor = mix(lineColor, mapColor, lineMix);","}"].join("\n"),xh=bh;function kh(e){return(kh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ph(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ah(e,t,r){return(Ah="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Sh(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function Sh(e){return(Sh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mh(e,t){return(Mh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Th=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.tree,o=r.Type,i=void 0===o?xh:o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==kh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Sh(t).call(this,{tree:n,Type:i})))._contourLineUniforms={heightInterval:{type:"f",value:20},color:{type:"v3",value:new h.Color(16777215)},lineWidth:{type:"f",value:2},mapAlpha:{type:"f",value:.4},distanceLimit:{type:"f",value:3200},worldToMeters:{type:"f",value:1}},e}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mh(e,t)}(t,ir),r=t,(n=[{key:"generateTileMaterial",value:function(e){e.geometry.computeVertexNormals();var t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Oh(e,t,r[t])})}return e}({contourLineUniforms:this._contourLineUniforms},e.style);return new this.Type(t)}},{key:"destruct",value:function(){return Ah(Sh(t.prototype),"destruct",this).call(this)}},{key:"color",set:function(e){this._contourLineUniforms.color.value=new h.Color(e)},get:function(){return this._contourLineUniforms.color.value}},{key:"heightInterval",set:function(e){this._contourLineUniforms.heightInterval.value=e},get:function(){return this._contourLineUniforms.heightInterval.value}},{key:"lineWidth",set:function(e){this._contourLineUniforms.lineWidth.value=e},get:function(){return this._contourLineUniforms.lineWidth.value}},{key:"mapAlpha",set:function(e){this._contourLineUniforms.mapAlpha.value=e},get:function(){return this._contourLineUniforms.mapAlpha.value}}])&&Ph(r.prototype,n),t}();function Eh(e){return(Eh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ch(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jh(e){return(jh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rh(e,t){return(Rh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Lh=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=h.UniformsUtils.merge([{},Vi.basic2.uniforms]);return void 0!==e.alphaChannel&&(n.alphaChannel.value=e.alphaChannel),(r=function(e,t){return!t||"object"!==Eh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,jh(t).call(this,{uniforms:n,vertexShader:Ih,fragmentShader:Dh}))).isMeshBasicMaterial=!0,r.color=new h.Color(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=h.MultiplyOperation,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.lights=!1,r._useGeometryInstance=!1,r.setValues(e),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Rh(e,t)}(t,h.ShaderMaterial),r=t,(n=[{key:"alphaChannel",set:function(e){0===e||1===e||2===e||3===e?this.uniforms.alphaChannel.value=e:console.warn("only 0, 1, 2, 3 are valid values")},get:function(){return this.uniforms.alphaChannel.value}}])&&Ch(r.prototype,n),t}(),Ih=Vi.basic2.vertexShader,Dh=Vi.basic2.fragmentShader,zh=Lh;function Nh(e){return(Nh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bh(e){return(Bh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Uh(e,t){return(Uh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Fh=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=h.UniformsUtils.merge([{},Vi.physical2.uniforms]);return(r=function(e,t){return!t||"object"!==Nh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Bh(t).call(this,{uniforms:n,vertexShader:Vh,fragmentShader:Hh}))).defines={PHYSICAL:""},r.isMeshStandardMaterial=!0,r.isMeshPhysicalMaterial=!0,r.reflectivity=.5,r.clearCoat=0,r.clearCoatRoughness=0,r.color=new h.Color(16777215),r.roughness=.5,r.metalness=.5,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new h.Color(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=h.TangentSpaceNormalMap,r.normalScale=new h.Vector2(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.roughnessMap=null,r.metalnessMap=null,r.alphaMap=null,r.envMap=null,r.envMapIntensity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.morphNormals=!1,r.setValues(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Uh(e,t)}(t,h.ShaderMaterial),t}(),Vh=Vi.physical2.vertexShader,Hh=Vi.physical2.fragmentShader,Wh=Fh;function Gh(e){return(Gh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xh(e){return(Xh=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Yh(e,t){return(Yh=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qh={factory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=Ri.factory(e,t,r,n),i=function(e){return e===ki?zh:2===e?Ki:3===e?Wh:h.ShaderMaterial}(e),a=2===e||3===e,s=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.level,i=r.x,s=r.y,l=r.map,u=r.sharedUniforms,c=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(r,["level","x","y","map","sharedUniforms"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==Gh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,Xh(t).call(this,c))).level=n,e.x=i,e.y=s,e.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Kh(e,t,r[t])})}return e}({},e.uniforms,u,{map:{type:"t",value:l}}),e.map=l,e.vertexShader=o.vertexShader,e.fragmentShader=o.fragmentShader,e.lights=a,e.needsUpdate=!0,e.update&&e.update(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yh(e,t)}(t,i),t}();return 0!==r&&(s.prototype.update=function(){var e=this.uniforms.count.value,t=o.vertexShader.slice(),r=o.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}),s}};function Zh(e){return(Zh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Jh(e,t,r[t])})}return e}function Jh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ep(e,t,r){return(ep="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tp(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function tp(e){return(tp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function rp(e,t){return(rp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var np=[ki,2,3,40,41];function op(e){return np.includes(e)}function ip(e){return qh.factory(e,Oi,Pi,Ai)}var ap=function(e){function t(e){var r,n=e.renderMode,o=void 0===n?ki:n,i=e.tree;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=ip(o=op(o)?o:ki);return(r=function(e,t){return!t||"object"!==Zh(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,tp(t).call(this,{tree:i,Type:a})))._sharedUniforms=Qh({},h.UniformsUtils.merge([Vi.extra.uniforms]),r._sharedUniforms),r._renderMode=o,r._values={},r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rp(e,t)}(t,dh),r=t,(n=[{key:"generateTileMaterial",value:function(e){var r=ep(tp(t.prototype),"generateTileMaterial",this).call(this,e),n=Qh({},e.style,this.tree.style,this._values);return n.color=new h.Color(n.color),function(e,t){for(var r in t)r in e&&(e[r]=t[r])}(r,n),r.needsUpdate=!0,r}},{key:"setValues",value:function(e){var t={},r=!1;for(var n in e)n in this._sharedUniforms?this._sharedUniforms[n].value=e[n]:(t[n]=e[n],this._values[n]=e[n],r=!0);function o(e,t){for(var r in t)r in e&&(e[r]=t[r],e.needsUpdate=!0)}r&&this.tree.traverse(this.tree.root,function(e){e&&e.content&&e.content.material&&(Array.isArray(e.content.material)?e.content.material.map(function(e){o(e,t)}):o(e.content.material,t))})}},{key:"renderMode",set:function(e){if(op(e)){if(this._renderMode!==e)if(this._renderMode=e,40!==e&&41!==e){this._values={},this.setValues({wireframe:!1});var t=ip(e);this.Type=t}else if(40===e){this._values={},this.setValues({wireframe:!0});var r=ip(ki);this.Type=r}else if(41===e){this._values={},this.setValues({map:null,wireframe:!1,color:new h.Color(10066329),emissive:new h.Color(0),flatShading:!0,metalness:0,roughness:1});var n=ip(3);this.Type=n}}else console.warn("[AltizureTreeMaterial] invalid input renderMode",e)},get:function(){return this._renderMode}}])&&$h(r.prototype,n),t}();function sp(e){return(sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function up(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cp(e){return(cp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fp(e,t){return(fp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var hp=function(e){function t(e){var r,n=e.sharedUniforms,o=e.level,i=e.x,a=e.y,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,["sharedUniforms","level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==sp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,cp(t).call(this,s))).level=o,r.x=i,r.y=a,r.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){lp(e,t,r[t])})}return e}({},r.uniforms,n),r.update(),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fp(e,t)}(t,Ki),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Vi.pcp.vertexShader.slice(),r=Vi.pcp.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&up(r.prototype,n),t}();function pp(e){return(pp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function dp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function mp(e){return(mp=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yp(e,t){return(yp=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var gp=function(e){function t(e){var r,n=e.sharedUniforms,o=e.level,i=e.x,a=e.y,s=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,["sharedUniforms","level","x","y"]);return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==pp(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,mp(t).call(this,s))).level=o,r.x=i,r.y=a,r.uniforms=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){dp(e,t,r[t])})}return e}({},r.uniforms,n),r.update(),r}var r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&yp(e,t)}(t,zh),r=t,(n=[{key:"update",value:function(){var e=this.uniforms.count.value,t=Vi.bcp.vertexShader.slice(),r=Vi.bcp.fragmentShader.slice();e>=1&&(t="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(t=t.replace(/MAX_COUNT/g,e)),r="#define PROJECTOR\n#define VIDEO\n#define VISIBILITY\n"+(r=r.replace(/MAX_COUNT/g,e))),this.vertexShader=t,this.fragmentShader=r,this.needsUpdate=!0}}])&&vp(r.prototype,n),t}();function bp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _p(e){return(_p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var xp=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.spec_version=new Za(0,0,0),this.id=null,this.name=null,this.owner={},this.owner.id=null,this.owner.name=null,this.isImported=null,this.modelType=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo={},this.modelTransform={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.initialCamPos=null,t&&(this.processProjectInfo(t),this.validate()),r&&(this.processInfoTxt(r),this.validate())}var t,r;return t=e,(r=[{key:"destruct",value:function(){return this.id=null,this.name=null,this.owner.id=null,this.owner.name=null,this.owner={},this.isImported=null,this.modelType=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo.autoAligned=null,this.geoInfo.minLat=null,this.geoInfo.minLong=null,this.geoInfo.maxLat=null,this.geoInfo.maxLong=null,this.geoInfo.centerLat=null,this.geoInfo.centerLong=null,this.geoInfo={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.lengthUnitToMeter=null,this.modelTransform.initialCamPos=null,this.modelTransform={},!0}},{key:"validate",value:function(){for(var e=["id","name","owner","isImported","views","date","versionControl","cloudPath","geoInfo","modelTransform"],t=0;t<e.length;t++)if(null===this[e[t]]||void 0===this[e[t]])return console.error("invalid info[",e[t],"]=",this[e[t]]),!1;e=Object.keys(this.owner);for(var r=0;r<e.length;r++)if(null===this.owner[e[r]]||void 0===this.owner[e[r]])return console.error("invalid info.owner[",e[r],"]=",this[e[r]]),!1;e=Object.keys(this.modelTransform);for(var n=0;n<e.length;n++)if(null===this.modelTransform[e[n]]||void 0===this.modelTransform[e[n]])return console.error("invalid info.modelTransform[",e[n],"]=",this[e[n]]),!1;if(this.cloudPath.length<=0)return console.error("Invalid cloudPath",this.cloudPath),!1;if(this.geoInfo&&!isNaN(this.geoInfo.maxLat)&&!isNaN(this.geoInfo.minLat)&&!isNaN(this.geoInfo.maxLong)&&!isNaN(this.geoInfo.minLong)){var o=Math.max(Math.abs(this.geoInfo.maxLat-this.geoInfo.minLat),Math.abs(this.geoInfo.maxLong-this.geoInfo.minLong));if(o>2)return console.warn("Unusual large(",o,") project ",this.name,this.id),!1}return!0}},{key:"processProjectInfo",value:function(e){this.id=e.id,this.name=e.name,this.owner=e.owner,this.isImported=e.isImported,this.modelType=e.modelType||"MESHLOD",this.views=e.views,this.date=e.date,this.versionControl=null===e.versionControl?"":e.versionControl,this.cloudPath=e.cloudPath,this.basepath=this._computePreferredPath();var t=e.modelTransform;t.lengthUnitToMeter=1,this.modelTransform={origin:n(t.origin),xDir:n(t.xDir),yDir:n(t.yDir),zDir:n(t.zDir),maxBound:n(t.maxBound),minBound:n(t.minBound),xTiles:t.xTiles,yTiles:t.yTiles,zTiles:t.zTiles,lengthUnitToMeter:"undefined"===t.lengthUnitToMeter?1:t.lengthUnitToMeter,objToOldDisplay:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(isNaN(r)||r<=0)&&(console.warn("lengthUnitToMeter",r),r=1);var n=function(e){var t=new h.Matrix4;return e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new h.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new h.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureProjectInfo unrecognized onLoadTrans",e):"object"===_p(e)&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new h.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new h.Matrix4).makeRotationZ(Math.PI*e.z)),t}(e),o=(new h.Matrix4).makeTranslation(-t[0],-t[1],-t[2]),i=(new h.Matrix4).makeScale(r,r,r);return n.multiply(o).multiply(i)}(t.onLoadTrans,t.origin,t.lengthUnitToMeter),initialCamPos:{cameraPos:n(t.initialCamPos.cameraPos),centerPos:n(t.initialCamPos.centerPos)}},this.modelTransform.objToDisplay=function(e,t,r){var n=(new h.Euler).setFromRotationMatrix(e);return n.x-=1.5*Math.PI,(new h.Matrix4).multiply((new h.Matrix4).makeRotationFromEuler(n)).multiply((new h.Matrix4).makeTranslation(-t.x*r,-t.y*r,-t.z*r)).multiply((new h.Matrix4).makeScale(r,r,r))}(this.modelTransform.objToOldDisplay,this.modelTransform.origin,this.modelTransform.lengthUnitToMeter),this.modelTransform.bbox={min:this.modelTransform.minBound.clone().add(this.modelTransform.origin),max:this.modelTransform.maxBound.clone().add(this.modelTransform.origin)};var r=e.geoInfo;return r instanceof Object?this.geoInfo={autoAligned:r.autoAligned,manualAligned:r.manualAligned,centerLat:r.centerLat,centerLong:r.centerLong,maxLat:r.maxLat,minLat:r.minLat,maxLong:r.maxLong,minLong:r.minLong,transformed:r.transformed}:this.geoInfo={},null!==this.geoInfo.centerLat&&void 0!==this.geoInfo.centerLat||(this.geoInfo.centerLat=2.8125),null!==this.geoInfo.centerLong&&void 0!==this.geoInfo.centerLong||(this.geoInfo.centerLong=2.8125),this.minLevel=0,this.maxLevel=function(e,t){for(var r=Math.max(e,t),n=0;r>1;)r/=2,n++;return n}(t.xTiles,t.yTiles),this.minDisplayLevel=0,this.maxDisplayLevel=this.maxLevel,this;function n(e){return e instanceof Array&&3===e.length?new h.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new h.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}}},{key:"processInfoTxt",value:function(e){this.modelType=e.model_type,this.spec_version=e.spec_version,this.srs=e.srs,this.modelType.objToDisplay=e.model_transform.clone()}},{key:"orthoInfo",value:function(e){var t=function(t){var r=t.minBound,o=t.maxBound,i=t.origin,a=t.xDir,s=t.yDir,l=t.zDir,u=new Array(8);u[0]=r.clone(),u[1]=new h.Vector3(r.x,o.y,r.z),u[2]=new h.Vector3(o.x,r.y,r.z),u[3]=new h.Vector3(o.x,o.y,r.z);for(var c=0;c<4;++c)u[c+4]=u[c].clone().setZ(o.z);for(var f=new Array(2),p=0;p<8;++p){var d=n(i,a,s,l,u[p]);d.applyMatrix4(e),0===p?(f[0]=d.clone(),f[1]=d.clone()):(f[0].x=Math.min(f[0].x,d.x),f[0].y=Math.min(f[0].y,d.y),f[0].z=Math.min(f[0].z,d.z),f[1].x=Math.max(f[1].x,d.x),f[1].y=Math.max(f[1].y,d.y),f[1].z=Math.max(f[1].z,d.z))}return f}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){bp(e,t,r[t])})}return e}({},this.modelTransform)),r=(new h.Matrix4).extractRotation(e).transpose();return{origin:this.modelTransform.origin.clone(),xDir:new h.Vector3(1,0,0).applyMatrix4(r),yDir:new h.Vector3(0,1,0).applyMatrix4(r),zDir:new h.Vector3(0,0,1).applyMatrix4(r),minBound:t[0],maxBound:t[1],width:t[1].x-t[0].x,height:t[1].z-t[0].z,area:(t[1].x-t[0].x)*(t[1].z-t[0].z)};function n(e,t,r,n,o){var i=t.clone().multiplyScalar(o.x),a=r.clone().multiplyScalar(o.y),s=n.clone().multiplyScalar(o.z);return e.clone().add(i).add(a).add(s)}}},{key:"_computePreferredPath",value:function(){var e=[];"China"===U.countryName?(e[0]="oss_sz",e[1]="s3",e[2]="oss_usw",e[3]="local"):(e[0]="s3",e[1]="oss_usw",e[2]="oss_sz",e[3]="local");for(var t,r=this.cloudPath,n=0;n<e.length;n++){for(var o=0;o<r.length;o++)if(r[o].key===e[n]){t=r[o].dataUrl;break}if(t)break}return t||console.error("preferredPath error",this.name,r,e),t}},{key:"valid",get:function(){return this.validate()}}])&&wp(t.prototype,r),e}();function kp(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Op=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promiseFn=t.promiseFn,this.timer=t.timer,this.timeout=t.timeout,void 0!==t.promiseFn&&void 0!==this.timer&&void 0!==this.timeout?(this.processingTask=null,this.deferredTask=null,this.debug=t.debug||!1,this._running=null):console.error("RefreshQueue invalid construction.",t)}var t,r;return t=e,(r=[{key:"add",value:function(e){var t=this;null===this.processingTask?(this.processingTask=e,null!==this._running?this._running.then(function(){t._running=t._run()}):this._running=this._run()):null===this.deferredTask?this.deferredTask=e:null!==this.deferredTask?this.deferredTask=e:console.warn("RefreshQueue.add(): unknown condition")}},{key:"_run",value:function(){var e=this.debug;if(null===this.processingTask)return e&&console.log("no processingTask"),this._running=null,Promise.resolve();var t,r,n=this;return(t=this.promiseFn(this.processingTask),r=n.timeout,Promise.race([t,new Promise(function(e,t){setTimeout(function(){t(new Error("Refresh task time out "+r))},r)})])).catch(function(t){return e&&console.warn("refresh task failed:",n.processingTask,t),Promise.resolve()}).then(function(){return n.processingTask=n.deferredTask,n.deferredTask=null,e=n.timer,new Promise(function(t,r){setTimeout(function(){t()},e)});var e}).then(function(){return n._run()})}}])&&kp(t.prototype,r),e}();r.d(t,"HyperViewer",function(){return V}),r.d(t,"EarthViewer",function(){return tc}),r.d(t,"SessionEnv",function(){return n}),r.d(t,"LodForest",function(){return wu}),r.d(t,"HyperNode",function(){return W}),r.d(t,"HyperEntity",function(){return Rt}),r.d(t,"HyperLayer",function(){return Pt}),r.d(t,"AltizureProjectTile",function(){return _a}),r.d(t,"AltizureProjectTree",function(){return ra}),r.d(t,"AltizureLoader",function(){return gs}),r.d(t,"OSGSpec",function(){return nc}),r.d(t,"OSGTree",function(){return Gs}),r.d(t,"OSGTile",function(){return Bs}),r.d(t,"OSGLoader",function(){return $s}),r.d(t,"QuadLodNode",function(){return bn}),r.d(t,"QuadLodTree",function(){return qt}),r.d(t,"DEMSpec",function(){return ic}),r.d(t,"DEMTree",function(){return il}),r.d(t,"DEMTile",function(){return Rl}),r.d(t,"CoordinateSystems",function(){return s}),r.d(t,"PlanetConstants",function(){return i}),r.d(t,"PlanetMath",function(){return a}),r.d(t,"TreeMaterial",function(){return ir}),r.d(t,"ProjectorTreeMaterial",function(){return ff}),r.d(t,"ContourLineTreeMaterial",function(){return Th}),r.d(t,"TileBasicMaterial",function(){return tr}),r.d(t,"PhongTreeMaterial",function(){return fc}),r.d(t,"TilePhongMaterial",function(){return Zi}),r.d(t,"TilePhysicalMaterial",function(){return vc}),r.d(t,"TilePointsMaterial",function(){return bc}),r.d(t,"VideoMaterial",function(){return nf}),r.d(t,"CropTreeMaterial",function(){return Lf}),r.d(t,"CropTileMaterial",function(){return yf}),r.d(t,"PCTreeMaterial",function(){return dh}),r.d(t,"AltizureTreeMaterial",function(){return ap}),r.d(t,"TileFlatMaterial",function(){return kc}),r.d(t,"TileWireframeMaterial",function(){return Sc}),r.d(t,"VisibilityTreeMaterial",function(){return Xf}),r.d(t,"VisibilityTileMaterial",function(){return Qf}),r.d(t,"VisibilityTileMaterial2",function(){return Uf}),r.d(t,"ContourLineMaterial",function(){return xh}),r.d(t,"PCTileMaterial",function(){return nh}),r.d(t,"presetTexture",function(){return c}),r.d(t,"MaskLoader",function(){return f}),r.d(t,"OfflineRendererClass",function(){return Cc}),r.d(t,"ProjectBooleanMask",function(){return Of}),r.d(t,"MeshBasicMaterial2",function(){return zh}),r.d(t,"BPCTileMaterial",function(){return gp}),r.d(t,"PPCTileMaterial",function(){return hp}),r.d(t,"BASIC",function(){return ki}),r.d(t,"PHONG",function(){return 2}),r.d(t,"PBR",function(){return 3}),r.d(t,"WIREFRAME",function(){return 40}),r.d(t,"FLAT",function(){return 41}),r.d(t,"AltizureApi",function(){return C}),r.d(t,"AltizureProjectInfo",function(){return xp}),r.d(t,"RefreshQueue",function(){return Op}),r.d(t,"BrowserCapatibility",function(){return z}),r.d(t,"EventUtil",function(){return o}),r.d(t,"LoadUtil",function(){return u}),r.d(t,"HtmlHelper",function(){return d}),r.d(t,"FunctionUtil",function(){return v}),r.d(t,"MsgDecorators",function(){return l}),r.d(t,"PlanetRenderItems",function(){return Ku}),r.d(t,"EarthWmtsTileURL",function(){return Ru}),r.d(t,"DemWmtsTileURL",function(){return Lu}),r.d(t,"IMAGE_FORMAT",function(){return jn}),r.d(t,"DEM_ENCODING",function(){return or}),r.d(t,"altizureSpecLoader",function(){return os}),r.d(t,"altizureSpecWithApiInfo",function(){return is}),r.d(t,"ModelSpecV2",function(){return Ha}),r.d(t,"ModelSpecV3",function(){return Wa}),r.d(t,"RenderSpec",function(){return Ya}),r.d(t,"ProjectSpec",function(){return wa}),r.d(t,"MOUSE",function(){return h.MOUSE}),r.d(t,"mockSpecLoader",function(){return as}),r(21)}])})},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),r(0));r.n(o);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=n.CoordinateSystems.oblate,s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,null,[{key:"getLocalSystemOnEarthSurface",value:function(e,t,r,n){var i=a.getENUSystem(r,t),s=i.east,l=i.up,u=i.north,c=i.origin;return{lng:(new o.Vector3).copy(s),lat:(new o.Vector3).copy(u),alt:(new o.Vector3).copy(l),origin:(new o.Vector3).copy(c)}}},{key:"getNoneGroundCartesianFromLngLatAlt",value:function(e,t,r,n,i){var s=a.wgs842Ecef(r,t,n);return(new o.Vector3).copy(s)}},{key:"getLngLatAltFromNoneGroundCartesian",value:function(e,t,r){var n=a.ecef2Wgs84(t.x,t.y,t.z),o=n.latitude;return{lng:n.longitude,lat:o,alt:n.height}}},{key:"geographicToEarthSurface",value:function(e,t,r,n){var i=a.wgs842Ecef(r,t,0);return(new o.Vector3).copy(i)}},{key:"getTileGeographicEnvelopByGrid",value:function(e,t,r){var o=n.PlanetMath.getTileWebMercatorEnvelopeByGrid(e,t,r),i=o.minX,s=o.minY,l=o.maxX,u=o.maxY,c=a.webMercator2Wgs84(i,s),f=c.latitude,h=c.longitude,p=a.webMercator2Wgs84(l,u);return{minLat:f,minLng:h,maxLat:p.latitude,maxLng:p.longitude}}}]),e}();t.a=s},function(e,t,r){"use strict";var n=r(25),o=r(40),i=Object.prototype.toString;function a(e){return"[object Array]"===i.call(e)}function s(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!==e&&void 0!==e)if("object"!=typeof e&&(e=[e]),a(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:o,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:s,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return s(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]=r}for(var n=0,o=arguments.length;n<o;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,function(t,o){e[o]=r&&"function"==typeof t?n(t,r):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_three__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_0_three___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_three__),__WEBPACK_IMPORTED_MODULE_1_altizure_gl_engine__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_1_altizure_gl_engine___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_altizure_gl_engine__),__WEBPACK_IMPORTED_MODULE_2__earth_EarthConstants__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_4__util_HelperFunctions__=__webpack_require__(9),__WEBPACK_IMPORTED_MODULE_5__util_GeometryUtils__=__webpack_require__(13),__WEBPACK_IMPORTED_MODULE_6__TransformControls_js__=__webpack_require__(58);function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function set(e,t,r,n){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=_superPropBase(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else _defineProperty(n,t,r);return!0})(e,t,r,n)}function _set(e,t,r,n,o){if(!set(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Marker=function(_HyperNode){function Marker(_ref){var _this,earth=_ref.earth,sandbox=_ref.sandbox,_ref$name=_ref.name,name=void 0===_ref$name?"unknown":_ref$name,_ref$visible=_ref.visible,visible=void 0===_ref$visible||_ref$visible,_ref$interactable=_ref.interactable,interactable=void 0!==_ref$interactable&&_ref$interactable,clickable=_ref.clickable,eventHandlers=_ref.eventHandlers,position=_ref.position,orientation=_ref.orientation,scale=_ref.scale,_ref$pose=_ref.pose,pose=void 0===_ref$pose?{}:_ref$pose,_ref$showXYZ=_ref.showXYZ,showXYZ=void 0!==_ref$showXYZ&&_ref$showXYZ;_classCallCheck(this,Marker);var debug=!1;function Str2Num(e){if("string"==typeof e){if(!1===isNaN(e))return Number(e);console.error("Please enter a recognizable number in the scale.")}if("object"===_typeof(e)){var t=!0;if(Object.keys(e).forEach(function(r){e[r]=Number(e[r]),!0===isNaN(e[r])&&(t=!1)}),!0===t)return e;console.error("Please enter a set of recognizable number in the orientation or position.")}if("number"==typeof e){if(!1===isNaN(e))return Number(e);console.error("Please enter a recognizable number in the scale.")}}debug&&console.log("Marker constructor"),earth=earth||sandbox;var _pose={position:Str2Num(position)||Str2Num(pose.position),orientation:Str2Num(orientation)||Str2Num(pose.orientation)||new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion,scale:Str2Num(scale)||Str2Num(pose.scale)},_onClick,_onMouseOver,_onMouseEnter,_onMouseLeave,_onMouseDrag;return pose=_pose,earth?(_this=_possibleConstructorReturn(this,_getPrototypeOf(Marker).call(this,earth.markerLayer)),_this._position=pose.position,_this._orientation=(new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion).copy(pose.orientation),_this._scale=pose.scale,_this.earth=earth,_this._name=name,_this.shapeHolder=new __WEBPACK_IMPORTED_MODULE_0_three__.Object3D,_this.shapeHolder.name=_this._name+" shapeHolder",_this.sceneNode.add(_this.shapeHolder),_this.visible=visible,showXYZ&&(_this.__axesHelper=new __WEBPACK_IMPORTED_MODULE_0_three__.AxesHelper(1e3),_this.shapeHolder.add(_this.__axesHelper)),_this.contentHolder=new __WEBPACK_IMPORTED_MODULE_0_three__.Object3D,_this.shapeHolder.add(_this.contentHolder),_this.decoHolder=new __WEBPACK_IMPORTED_MODULE_0_three__.Object3D,_this.shapeHolder.add(_this.decoHolder),_this._interactShape=null,_this._interactable=!1,void 0!==clickable&&console.warn("clickable has deprecated, use interactable instead."),_this.interactable=interactable,_this.animationTime=0,eventHandlers&&(_onClick=eventHandlers._onClick?eval("("+eventHandlers._onClick+")"):null,_onMouseOver=eventHandlers._onMouseOver?eval("("+eventHandlers._onMouseOver+")"):null,_onMouseEnter=eventHandlers._onMouseEnter?eval("("+eventHandlers._onMouseEnter+")"):null,_onMouseLeave=eventHandlers._onMouseLeave?eval("("+eventHandlers._onMouseLeave+")"):null,_onMouseDrag=eventHandlers._onMouseDrag?eval("("+eventHandlers._onMouseDrag+")"):null),_this.eventHandlers={_onClick:_onClick,_onMouseOver:_onMouseOver,_onMouseEnter:_onMouseEnter,_onMouseLeave:_onMouseLeave,_onMouseDrag:_onMouseDrag},_this._property.eventHandlers={},_this._property.materialDescriptions=[],null===_this.earth._markerControl&&(_this.earth._markerControl=new __WEBPACK_IMPORTED_MODULE_6__TransformControls_js__.a(_this.earth.earthView.camera,_this.earth.domElement)),_this.setPose(_this._position,_this._orientation,_this._scale),_this):(console.error("Marker constructor is not assigned with an earth"),_possibleConstructorReturn(_this,void 0))}return _inherits(Marker,_HyperNode),_createClass(Marker,[{key:"destruct",value:function(){return this.interactable&&(this.interactable=!1),this.needRemoveSelfRef&&this.removeSelfRef&&this.removeSelfRef(),this.shapeHolder.remove(this.contentHolder),this.contentHolder=null,this.shapeHolder.remove(this.decoHolder),this.decoHolder=null,this._interactShape&&(this.shapeHolder.remove(this._interactShape),this._interactShape=null),this.sceneNode.remove(this.shapeHolder),this.shapeHolder=null,_get(_getPrototypeOf(Marker.prototype),"destruct",this).call(this)}},{key:"_interactBox",value:function(){if(!this.interactShape)return[];if(this.interactShape.isSprite){var e=Math.max(this.interactShape.scale.x,this.interactShape.scale.y)/2,t=this.interactShape.position.z;return[new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(e,e,e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(e,-e,e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(-e,e,e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(-e,-e,e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(e,e,-e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(e,-e,-e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(-e,e,-e+t),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(-e,-e,-e+t)]}if(!this.interactShape.geometry)return[];if(this.interactShape.geometry.computeBoundingBox(),!this.interactShape.geometry.boundingBox)return[];var r=this.interactShape.geometry.boundingBox,n=[new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.max.x,r.max.y,r.max.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.min.x,r.max.y,r.max.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.max.x,r.min.y,r.max.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.max.x,r.max.y,r.min.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.max.x,r.min.y,r.min.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.min.x,r.max.y,r.min.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.min.x,r.min.y,r.max.z),new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(r.min.x,r.min.y,r.min.z)],o=this.interactShape.scale,i=Math.max.apply(Math,[o.x,o.y,o.z])*this.scale;return n=n.map(function(e){return e.applyMatrix4((new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).makeScale(i,i,i))})}},{key:"orientationByHorizontalPoints",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={lng:0,lat:0,alt:0},o=0;o<e.length;++o)n.lng+=e[o].lng,n.lat+=e[o].lat,n.alt+=e[o].alt;n.lng/=e.length,n.lat/=e.length,n.alt/=e.length;var i=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLocalSystemOnEarthSurface(void 0,n.lng,n.lat,void 0),a=e.map(function(e){return d(i,e)}),s=Object(__WEBPACK_IMPORTED_MODULE_5__util_GeometryUtils__.b)(a),l=s.normal;if(l){l=l.normalize();var u=new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(0,0,t?-1:1),c=(new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion).setFromUnitVectors(l,u),f=(new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion).multiplyQuaternions(c,this.shapeHolder.quaternion.clone());if(r){var h=d(i,this.position).clone().sub(s.centroid);h=(h=h.applyQuaternion(c)).clone().add(s.centroid);var p=i.origin.clone().add(i.lng.clone().multiplyScalar(1*h.x)).add(i.lat.clone().multiplyScalar(1*h.y)).add(i.alt.clone().multiplyScalar(1*h.z));return{position:__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLngLatAltFromNoneGroundCartesian(void 0,p,void 0),orientation:f}}return f}return;function d(e,t){var r=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getNoneGroundCartesianFromLngLatAlt(__WEBPACK_IMPORTED_MODULE_2__earth_EarthConstants__.a.EarthResolution,t.lng,t.lat,t.alt,__WEBPACK_IMPORTED_MODULE_2__earth_EarthConstants__.a.scale).clone().sub(e.origin),n=1*r.dot(e.lng),o=1*r.dot(e.lat),i=1*r.dot(e.alt);return new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(n,o,i)}}},{key:"getUpdatePosition",value:function(){return this._updatePosition(),JSON.parse(JSON.stringify(this._position))}},{key:"_updatePosition",value:function(){if(0!==this.shapeHolder.position.x||0!==this.shapeHolder.position.y||0!==this.shapeHolder.position.z){var e=this.shapeHolder.position.clone().applyMatrix4(this.matrixWorld),t=new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4;t.getInverse(this.earth.markerLayer.matrixWorld);var r=e.applyMatrix4(t),n=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLngLatAltFromNoneGroundCartesian(void 0,r,void 0),o=n.lng,i=n.lat,a=n.alt;Object.assign(this._position,{lng:o,lat:i,alt:a});var s=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLocalSystemOnEarthSurface(void 0,this._position.lng,this._position.lat,void 0),l=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getNoneGroundCartesianFromLngLatAlt(void 0,this._position.lng,this._position.lat,this._position.alt,void 0),u=new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4;u.makeBasis(s.lng,s.lat,s.alt),u.setPosition(l),u.decompose(this.sceneNode.position,this.sceneNode.quaternion,this.sceneNode.scale),this.shapeHolder.position.x=0,this.shapeHolder.position.y=0,this.shapeHolder.position.z=0}}},{key:"on",value:function(e,t){switch(e){case"click":this.eventHandlers._onClick=t,this._property.eventHandlers._onClick=t.toString();break;case"mouseover":this.eventHandlers._onMouseOver=t,this._property.eventHandlers._onMouseOver=t.toString();break;case"mouseenter":this.eventHandlers._onMouseEnter=t,this._property.eventHandlers._onMouseEnter=t.toString();break;case"mouseleave":this.eventHandlers._onMouseLeave=t,this._property.eventHandlers._onMouseLeave=t.toString();break;case"mousedrag":this.eventHandlers._onMouseDrag=t,this._property.eventHandlers._onMouseDrag=t.toString();break;default:console.log("unknown eventType "+e)}}},{key:"off",value:function(e){switch(e){case"click":this.eventHandlers._onClick=null,this._property.eventHandlers._onClick=null;break;case"mouseover":this.eventHandlers._onMouseOver=null,this._property.eventHandlers._onMouseOver=null;break;case"mouseenter":this.eventHandlers._onMouseEnter=null,this._property.eventHandlers._onMouseEnter=null;break;case"mouseleave":this.eventHandlers._onMouseLeave=null,this._property.eventHandlers._onMouseLeave=null;break;case"mousedrag":this.eventHandlers._onMouseDrag=null,this._property.eventHandlers._onMouseDrag=null;break;default:console.log("unknown eventType "+e)}}},{key:"setContent",value:function(e){return!!function(e){var t=e instanceof __WEBPACK_IMPORTED_MODULE_0_three__.Object3D;t||console.warn("Marker: unknown content type",e);return t}(e)&&(this.contentHolder.add(e),!0)}},{key:"unsetContent",value:function(){return e(this.contentHolder),e(this.decoHolder),this._interactShape=null,!0;function e(e){e.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose(),e.material.dispose())});for(var t=e.children.length-1;t>=0;t--){var r=e.children[t];e.remove(r)}}}},{key:"setDecoration",value:function(e){this.decoHolder.add(e)}},{key:"light",value:function(){this.decoHolder.visible=!0}},{key:"dim",value:function(){this.decoHolder.visible=!1}},{key:"setPose",value:function(e,t,r){if(e){Object.keys(e).forEach(function(t){e[t]=Number(e[t])}),Object.assign(this._position,e);var n=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLocalSystemOnEarthSurface(void 0,e.lng,e.lat,void 0),o=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0),i=new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4;i.makeBasis(n.lng,n.lat,n.alt),i.setPosition(o),i.decompose(this.sceneNode.position,this.sceneNode.quaternion,this.sceneNode.scale),this.sceneNode.updateMatrix()}if(t){if(Object.keys(t).forEach(function(e){t[e]=Number(t[e])}),t.isEuler)this.shapeHolder.setRotationFromEuler(t);else if(t instanceof __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion)t.normalize(),this.shapeHolder.setRotationFromQuaternion(t),this._orientation.copy(t);else{var a=new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(t.x,t.y,t.z);a.normalize(),this.shapeHolder.rotateOnAxis(a,t.w)}this.shapeHolder.updateMatrix(),this.__euler=void 0}if(r)if("number"==typeof r||"string"==typeof r)!1===isNaN(Number(r))?(this.shapeHolder.scale.copy(new __WEBPACK_IMPORTED_MODULE_0_three__.Vector3(Number(r),Number(r),Number(r))),this.shapeHolder.updateMatrix()):console.warn("[Marker] scale must be a number, a string or an object containing x, y or z",r,this.shapeHolder.scale.clone());else{var s=!1;"number"!=typeof r.x&&"string"!=typeof r.x||!1===isNaN(Number(r.x))&&(this.shapeHolder.scale.setX(Number(r.x)),s=!0),"number"!=typeof r.y&&"string"!=typeof r.y||!1===isNaN(Number(r.y))&&(this.shapeHolder.scale.setY(Number(r.y)),s=!0),"number"!=typeof r.z&&"string"!=typeof r.z||!1===isNaN(Number(r.z))&&(this.shapeHolder.scale.setZ(Number(r.z)),s=!0),s?this.shapeHolder.updateMatrix():console.warn("[Marker] scale must be a number, a string or an object containing x, y or z",r,this.shapeHolder.scale.clone())}this.sceneNode.updateMatrixWorld(),this.earth._updateGPUPicker.add({force:!0})}},{key:"getMtlParams",value:function(){var e=[];return this.contentHolder.traverse(function(t){"Mesh"===t.type&&e.push(Object.assign({},t.mtlParams))}),e}},{key:"__markerSetInteractable",value:function(e){if(e){if(this._interactable)return;var t=this;this.listen("mouseover",function(e){t.eventHandlers._onMouseOver&&t.eventHandlers._onMouseOver(e)}),this.listen("mouseenter",function(e){t.eventHandlers._onMouseEnter&&t.eventHandlers._onMouseEnter(e)}),this.listen("mouseleave",function(e){t.eventHandlers._onMouseLeave&&t.eventHandlers._onMouseLeave(e)});var r=!1,n={x:0,y:0},o=!1,i=!1,a=!1;this.listen("mousedown",function(e){r=!0,n.x=e.clientX,n.y=e.clientY,0===e.button&&(o=!0),o&&t.eventHandlers._onMouseDrag&&(t.earth.freeze(),i=!0)}),this.listen("mousemove",function(e){o&&t.eventHandlers._onMouseDrag&&(a||(a=!s(e.clientX,e.clientY,n.x,n.y)),a&&t.eventHandlers._onMouseDrag(e))}),this.listen("mouseup",function(e){r&&s(e.clientX,e.clientY,n.x,n.y)&&t.eventHandlers._onClick&&t.eventHandlers._onClick(e),r=!1,o=!1,i&&(t.earth.unfreeze(),i=!1),a=!1})}else this._interactable&&(this.stopListen("mouseover"),this.stopListen("mouseenter"),this.stopListen("mouseleave"),this.stopListen("mousedown"),this.stopListen("mousemove"),this.stopListen("mouseup"));function s(e,t,r,n){return(e-r)*(e-r)+(t-n)*(t-n)<6}}},{key:"cast",value:function(e){if(this.interactShape){var t={x:e.clientX/window.innerWidth*2-1,y:-e.clientY/window.innerHeight*2+1};this.interactShape.geometry&&this.interactShape.geometry.computeFaceNormals(),this.interactShape.visible=!0;var r=Object(__WEBPACK_IMPORTED_MODULE_4__util_HelperFunctions__.c)(t,this.earth.earthView.camera,[this.interactShape]);if(this.interactShape.visible=!1,r){var n=r.point,o=new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4;o.getInverse(this.earth.earthToScene());var i=n.clone().applyMatrix4(o),a=__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLngLatAltFromNoneGroundCartesian(void 0,i,void 0),s=a.lng,l=a.lat,u=a.alt,c=r.normal.multiplyScalar(1),f=n.clone().add(c).applyMatrix4(o);return{contactPoint:{lng:s,lat:l,alt:u},normalDirection:__WEBPACK_IMPORTED_MODULE_3__earth_EarthMath__.a.getLngLatAltFromNoneGroundCartesian(void 0,f,void 0)}}}}},{key:"appendContent",value:function(e){this.contentHolder.add(e)}},{key:"reduceContent",value:function(e){this.contentHolder.remove(e)}},{key:"showControl",value:function(e){"translate"===e||"rotate"===e?(this.earth._markerControl.attach(this.shapeHolder),this.earth._markerControl.space="local",this.earth._markerControl.setMode(e),this.earth.scene.add(this.earth._markerControl)):console.error("control mode not supported",e)}},{key:"detachControl",value:function(){this.earth._markerControl.detach(this.shapeHolder),this.earth.scene.remove(this.earth._markerControl),this._updatePosition()}},{key:"setControlMode",value:function(e){"translate"===e||"rotate"===e?this.earth._markerControl.setMode(e):console.error("control mode not supported",e)}},{key:"changeMaterial",value:function(e){var t=this._property.materialDescriptions;this.contentHolder.traverse(function(r){if("Mesh"===r.type&&r.material.name===e.name){r.material=e;for(var n=!1,o=0;o<t.length;++o)t[o].name===e.name&&(t[o]=r.material.description,n=!0);n||t.push(r.material.description)}}),this._property.materialDescriptions=t}},{key:"getMaterials",value:function(){var e=[];return this.contentHolder.traverse(function(t){"Mesh"===t.type&&e.push(t.material)}),e}},{key:"sceneUpdated",value:function(e){}},{key:"animate",value:function(e){}},{key:"updateVisibility",value:function(e){}},{key:"listen",value:function(e,t){this.earth.interaction.register(this,e,t)||console.warn("Marker.listen failed.")}},{key:"stopListen",value:function(e){this.earth.interaction.unregister(this,e)||console.warn("Marker.listen failed.")}},{key:"shapeToEarth",value:function(){try{return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).getInverse(this.earth.earthToScene(),!0).multiply(this.shapeToScene())}catch(e){return void console.error(e)}}},{key:"shapeToScene",value:function(){return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).copy(this.matrixWorld).multiply(this.shapeHolder.matrix)}},{key:"objToShapeHolder",value:function(){return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).multiply(this.contentHolder.matrix)}},{key:"objToLayer",value:function(){return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).multiply(this.matrix).multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix)}},{key:"objToScene",value:function(){return this.contentHolder.updateMatrixWorld(!0),this.contentHolder.matrixWorld.clone()}},{key:"sceneToObj",value:function(){return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).getInverse(this.objToScene(),!0)}},{key:"objToEarth",value:function(){try{return(new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).getInverse(this.earth.earthToScene(),!0).multiply(this.objToScene())}catch(e){return void console.error(e)}}},{key:"earthToObj",value:function(){return this.sceneToObj().multiply(this.earth.earthToScene())}},{key:"position",set:function(e){var t=Object.assign(this.position,e);this.setPose(t)},get:function(){return JSON.parse(JSON.stringify(this._position))}},{key:"ID",get:function(){return this.sceneNode.uuid}},{key:"clickable",set:function(e){console.warn("Marker clickable is deprecating. Set to the interactable instead"),this.interactable=e},get:function(){return console.warn("Marker clickable is deprecating. Set to the interactable instead"),this._interactable}},{key:"interactable",set:function(e){this.__markerSetInteractable(e),this._interactable=e},get:function(){return this._interactable}},{key:"orientation",set:function(e){var t=e.x,r=e.y,n=e.z,o=e.w,i=new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion(t,r,n,o);return this.setPose(void 0,i,void 0)},get:function(){return this.shapeHolder.quaternion.clone()}},{key:"euler",set:function(e){var t=this.euler,r={x:t.x,y:t.y,z:t.z,order:t.order};Object.keys(t).forEach(function(e){t[e]=Number(t[e])}),Object.keys(r).forEach(function(e){r[e]=Number(r[e])});var n=Object.assign({},r,e),o=new __WEBPACK_IMPORTED_MODULE_0_three__.Euler(n.x,n.y,n.z,n.order);this.orientation=(new __WEBPACK_IMPORTED_MODULE_0_three__.Quaternion).setFromEuler(o),this.__euler=o},get:function(){return this.__euler?this.__euler:(new __WEBPACK_IMPORTED_MODULE_0_three__.Euler).setFromRotationMatrix((new __WEBPACK_IMPORTED_MODULE_0_three__.Matrix4).extractRotation(this.shapeHolder.matrix))}},{key:"scale",set:function(e){this.setPose(void 0,void 0,e)},get:function(){return this.shapeHolder.scale.x}},{key:"scaleX",set:function(e){this.setPose(void 0,void 0,{x:e})},get:function(){return this.shapeHolder.scale.x}},{key:"scaleY",set:function(e){this.setPose(void 0,void 0,{y:e})},get:function(){return this.shapeHolder.scale.y}},{key:"scaleZ",set:function(e){this.setPose(void 0,void 0,{z:e})},get:function(){return this.shapeHolder.scale.z}},{key:"visible",set:function(e){_set(_getPrototypeOf(Marker.prototype),"visible",e,this,!0),this.sceneNode&&(this.sceneNode.visible=e)},get:function(){return _get(_getPrototypeOf(Marker.prototype),"visible",this)}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}},{key:"interactShape",set:function(e){e.visible=!1,this._interactShape&&(this.shapeHolder.remove(this._interactShape),function(e){e.geometry&&e.geometry.dispose();e.material&&(e.material.map&&(e.material.map.dispose(),e.material.map=null),e.material.alphaMap&&(e.material.alphaMap.dispose(),e.material.alphaMap=null),e.material.dispose&&e.material.dispose())}(this._interactShape)),this._interactShape=e,this.shapeHolder.add(this._interactShape),this._interactShape.interactShapeNeedUpdate=!0},get:function(){return this._interactShape}}]),Marker}(__WEBPACK_IMPORTED_MODULE_1_altizure_gl_engine__.HyperNode);__webpack_exports__.a=Marker},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),{EarthResolution:1,scale:1,EARTH_RADIUS:n.PlanetConstants.EARTH_RADIUS,EQUATOR:n.PlanetConstants.EQUATOR});t.a=o},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=t,this.lat=r,this.alt=void 0===n?0:n,this.lng=Math.max(Math.min(180,this.lng),-180),this.lat=Math.max(Math.min(90,this.lat),-90)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt}}]),e}();t.a=o},function(e,t,r){"use strict";t.a={GLFENCE_SIDE_PLANE_RENDER_ORDER:1,GLFENCE_BASE_PLANE_RENDER_ORDER:2,GLFENCE_LINE_RENDER_ORDER:3,POLYLINE_RENDER_ORDER:3,LIGHTBEAM_RENDER_ORDER:3,SPRITE_PIN_RENDER_ORDER:3,TRANSFORM_CONTROL_RENDER_ORDER:10,HEIGHTMAP_RENDER_ORDER:3}},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c={},f=new Set,h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,n["TextureLoader"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"load",value:function(e,r,n,o){c[e]?r(c[e]):s(l(t.prototype),"load",this).call(this,e,function(t){if(r(t),c[e]=t,f.add(e),f.size>20){var n=f.values().next().value;c[n]&&(c[n].dispose(),delete c[n]),f.delete(n)}},n,o)}}]),t}();t.a=h},function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"a",function(){return i}),r.d(t,"c",function(){return a});var n=r(0);r.n(n);function o(e,t){var r;return function(){var n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearTimeout(r),n&&(r=setTimeout(function(){e&&e()},t))}}function i(e,t,r){var n,o=this;this.states=e;var i=this;return{start:function(){!function e(){t(o.states)?n=setTimeout(e,r):clearTimeout(n)}()},stop:function(){clearTimeout(n)},changeStates:function(e){i.states=Object.assign({},i.states,e)}}}var a=function(){var e=new n.Raycaster;return function(t,r,o){e.setFromCamera(t,r);var i=e.intersectObjects(o);if(i.length>0){var a=i[0];if(a&&a.object){var s=a.object,l=new n.Vector3(0,0,0).applyMatrix4(s.matrixWorld),u=a.face.normal.clone().applyMatrix4(s.matrixWorld).add(l.negate()).normalize();return{point:a.point,normal:u}}}}}()},function(e,t,r){e.exports=r(39)},function(e,t,r){"use strict";(function(t){var n=r(3),o=r(43),i={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var s={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=r(26):void 0!==t&&(e=r(26)),e}(),transformRequest:[function(e,t){return o(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],function(e){s.headers[e]={}}),n.forEach(["post","put","patch"],function(e){s.headers[e]=n.merge(i)}),e.exports=s}).call(t,r(42))},function(e,t,r){"use strict";var n=r(4),o=r(59),i=r(1),a=(r.n(i),r(60)),s=r(61),l=r(2),u=r(5),c=r(69),f=r(0);r.n(f);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t,r){return(p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&S(o,r.prototype),o}).apply(null,arguments)}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){k(e,t,r[t])})}return e}function v(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t,r,n){return(w="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=P(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else k(n,t,r);return!0})(e,t,r,n)}function x(e,t,r,n,o){if(!w(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t,r){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=P(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function P(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=A(e)););return e}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var M={BASIC:1,PHONG:2,PBR:3,WIREFRAME:40,FLAT:41},T=function(e){function t(e){var r,n=e.sandbox,s=e.name,l=e.visible,u=e.showBBox,c=void 0!==u&&u,h=e.interactable,p=e.eventHandlers,d=e.position,v=e.orientation,m=e.scale,y=e.pose,g=e.spec,w=e.autoScale,x=void 0!==w&&w,k=e.countryName;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var O=new o.a;O.position=g.model.gis.position,y&&O.copy(y),O.position=d,O.orientation=v,O.scale=m;var P=_(r=b(this,A(t).call(this,{sandbox:n,name:s,visible:l,interactable:h,eventHandlers:p,pose:O})));if(!function(){if(!g||!g.id)return!1;return!0}())return console.error("AltizureProjectMarker invalid input",g),b(r,void 0);!1===l&&console.warn("AltizureProjectMarker will not download until visible is true."),r._isMobile=i.BrowserCapatibility.isMobile,r.spec=g,r.countryName=k,r.showBBox=c;var S=r.spec.model.tiling;r.projInfo={PID:r.spec.id,id:r.spec.id,origin:S.origin,max_bound:S.maxBound,min_bound:S.minBound,length_unit_to_meter:1},r.autoScale=x,r.projHolder=new f.Object3D,r.projHolder.name="projHolder",r.projHolder.applyMatrix(r.spec.model.modelToENU);var M=r.spec.model.objToModel.clone();r.modelHolder=new f.Object3D,r.modelHolder.name="modelHolder",r.modelHolder.applyMatrix(M),r.projHolder.add(r.modelHolder),r._tree=null,r.treeNode=new f.Object3D,r.treeNode.name="treeNode",r.modelHolder.add(r.treeNode),r._waterManager=null,r.waterHolder=new f.Object3D,r.waterHolder.applyMatrix(r.spec.model.waterToENU),r.shapeHolder.add(r.waterHolder),r._photoManager=null,r.photoHolder=new f.Object3D,r.modelHolder.add(r.photoHolder),r._currentPhotoCam=null,r._focusVisual=new f.Mesh(new f.SphereBufferGeometry(.5),new f.MeshBasicMaterial({color:16711680,side:f.DoubleSide})),r._focusVisual.name="_focusVisual",r._focusVisual.visible=!1,r.modelHolder.add(r._focusVisual);var T=function(e){for(var t=e.min_bound,r=e.max_bound,n=e.origin,o=e.x,i=e.y,a=e.z,s=r.clone().add(t).multiplyScalar(.5),l=(new f.Matrix4).setPosition(s),u=(new f.Matrix4).setPosition(n),c=r.x-t.x,h=r.y-t.y,p=r.z-t.z,d=new f.BoxBufferGeometry(c,h,p),v=new Uint16Array(30),m=0;m<8;m++)v[3*m]=d.index.array[3*m+2],v[3*m+1]=d.index.array[3*m+1],v[3*m+2]=d.index.array[3*m];v[24]=d.index.array[32],v[25]=d.index.array[31],v[26]=d.index.array[30],v[27]=d.index.array[35],v[28]=d.index.array[34],v[29]=d.index.array[33],d.index.array=v,d.index.count=30,d.applyMatrix(l),d.applyMatrix((new f.Matrix4).makeBasis(o,i,a)),d.applyMatrix(u);var y=new f.Mesh(d);return y.name="box",{box:y}}({min_bound:S.minBound.clone(),max_bound:S.maxBound.clone(),origin:S.origin.clone(),x:S.xDir.clone(),y:S.yDir.clone(),z:S.zDir.clone()}).box,E=(new f.Matrix4).multiply(r.contentHolder.matrix).multiply(r.projHolder.matrix).multiply(r.modelHolder.matrix);r.decoHolder.add(T);var C=T.geometry.clone();C.applyMatrix(T.matrix),C.applyMatrix(E),C.computeBoundingBox();var j=C.boundingBox,R=j.max,L=j.min;r.projInfo.max_bound=R,r.projInfo.min_bound=L;var I=new a.a(R.x-L.x,R.y-L.y,R.z-L.z,6923221);I.position.copy(R.clone().add(L).multiplyScalar(.5)),r.decoHolder.add(I),r.__fence=I,T.applyMatrix(E),r.interactShape=T,r.hasDepthMap=!1,r._depthMap=void 0,r._depthMapNeedsUpdate=!0,r._overlayMarkers=[];return r._onInitSuccess=null,r._onInitFail=null,r.initialized=i.EventUtil.timedPromise(new Promise(function(e,t){P._onInitSuccess=e,P._onInitFail=t}),27e4),r.import(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,n["a"]),function(e,t,r){t&&g(e.prototype,t),r&&g(e,r)}(t,[{key:"destruct",value:function(){var e=!0;return this.interactable&&(this.interactable=!1),e=this.deport()&&e,this.modelHolder.remove(this.treeNode),this.treeNode=null,e=this.unsetContent()&&e,e=this.deportWater()&&e,e=O(A(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e=this;!function(t){if(!t)return Promise.reject(new Error("Invalid spec"));var r=t.name,n=e.treeNode,o=e.apiService,a=e.countryName,s=e.showBBox,l=function(){var t=null;switch(e.modelType){case"OSGLOD":t=i.OSGTree;break;default:t=i.AltizureProjectTree}return t}(),u=function(){var t=null;switch(e.modelType){case"OSGLOD":t=i.OSGTile;break;default:t=i.AltizureProjectTile}return t}(),c=i.TreeMaterial,f=function(){var t=null;switch(e.modelType){case"PTLOD":t=i.TilePointsMaterial;break;case"CAD":t=i.TilePhongMaterial;break;default:t=i.TileBasicMaterial}return t}(),h=function(){var t=null;switch(e.modelType){case"OSGLOD":t=e.osgBundleLoader;break;default:t=e.altizureBundleLoader}return t}();return new Promise(function(p,d){switch(e._tree=new l(u,{sceneGraphRoot:n,name:r,eventHandlers:{onContentInitialized:function(){e.onContentInitialized(),p(e)},onTileDownloaded:function(){e.earth.earthView.updateScene()}},debug:!1,altizureApi:o,projInfo:t,countryName:a,showBBox:s,TreeMaterialType:c,NodeMaterialType:f,loadWorker:h}),e._tree.visible=e.visible,e.modelType){case"OSGLOD":console.log("yes"),e._tree.material=new i.AltizureTreeMaterial({renderMode:i.BASIC,tree:e._tree});break;case"PTLOD":break;case"CAD":e._tree.material=new i.AltizureTreeMaterial({renderMode:i.BASIC,tree:e._tree}),e._tree.material.renderMode=i.PHONG;break;default:e._tree.material=new i.AltizureTreeMaterial({renderMode:i.BASIC,tree:e._tree})}})}(this.spec),this.forest.add(this._tree),this.setContent(this.projHolder)}},{key:"deport",value:function(){var e,t=!0;this._tree&&((e=this.treeNode).remove.apply(e,y(this.treeNode.children)),this.forest.remove(this._tree),t=t&&this._tree.destruct(),this._tree=null);return t||console.warn("AltizureProjectMarker deport failed."),t}},{key:"pickDepthMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e instanceof Array){var r=function(e){var t={max:{lat:e[0].lat,lng:e[0].lng},min:{lat:e[0].lat,lng:e[0].lng}};return e.map(function(e){e.lat>t.max.lat&&(t.max.lat=e.lat),e.lng>t.max.lng&&(t.max.lng=e.lng),e.lat<t.min.lat&&(t.min.lat=e.lat),e.lng<t.min.lng&&(t.min.lng=e.lng)}),[{lat:t.max.lat+1e-4,lng:t.max.lng+1e-4},{lat:t.min.lat-1e-4,lng:t.min.lng-1e-4}]}(e),n=this.position.alt,o=this.projInfo.min_bound.z+n,i=this.projInfo.max_bound.z+n,a=this.earth.markerSnapshot(r,{min:o,max:i},[this.modelHolder],!0),s=a.dimension.width,l=a.dimension.height,u=a.buffer,c=[],f=r[0].lat-r[1].lat,h=r[0].lng-r[1].lng;return e.map(function(e){var t=(e.lat-r[1].lat)/f,n=(e.lng-r[1].lng)/h,a=1===n?parseInt(s*n)-1:parseInt(s*n),p=1===t?parseInt(l*t)-1:parseInt(l*t);if(n>=0&&n<=1&&t>=0&&t<=1){var d=(1-u[p*s+a]/255)*(i-o)+o;c.push(d)}else console.warn("{lng, lat} is out of the boundary of the project marker",e)}),t?[c,r,a]:c}console.warn("[pickDepthMap] Argument is not an instance of Array",e)}},{key:"autoAdjustPolygons",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512;if(!(t.length<1||e.length<1)){for(var n=this.position.alt,o=this.position.alt+this.projInfo.max_bound.z-this.projInfo.min_bound.z,i=this.earth.markerSnapshot(e,{min:n,max:o},[this.modelHolder],!0,r),a={min:t[0].bottom,max:t[0].top},s=1;s<t.length;++s)a.min=a.min>t[s].bottom?t[s].bottom:a.min,a.max=a.max<t[s].top?t[s].top:a.max;a.min-=.1,a.max+=.1;for(var l=this.earth.generateMask(e,a,t,r),u=l.mask,c=l.mapping,f={},h=0;h<i.dimension.width;++h)for(var p=0;p<i.dimension.height;++p){var d=p*i.dimension.width+h,v=4*d,m=256*u.buffer[v]*256+256*u.buffer[v+1]+u.buffer[v+2],y=(1-i.buffer[d]/255)*(o-n)+n;f[m]?(f[m].top=f[m].top<y?y:f[m].top,f[m].bottom=f[m].bottom>y?y:f[m].bottom):f[m]={top:y,bottom:y}}for(var g in f)c[g]&&(c[g].top=f[g].top+.1,c[g].bottom=f[g].bottom-.1)}}},{key:"measureByPolygon",value:function(e,t){var r=this;return new Promise(function(n,o){setTimeout(function(){var o=r.getRegionVolume(e,t);n(o)},1e3)})}},{key:"getRegionVolume",value:function(e,t){if(void 0!==e){var r=m(this.pickDepthMap(e.boundaryPts,!0),3),n=r[0],o=r[1],i=r[2],a="number"==typeof t?t:Math.min.apply(Math,y(n)),s=this.projInfo.max_bound.z-this.projInfo.min_bound.z,l=this.position.alt+this.projInfo.min_bound.z,u=0+l,c=s+l,f=e.top>e.bottom?e.top:e.bottom,h=e.top<e.bottom?e.top:e.bottom;f+=.1,h-=.1;for(var p=this.earth.markerSnapshot(o,{min:f,max:h},[e.contentHolder]),d=c,v=u,g=!0,b=0,_=0,w=0,x=0;x<i.buffer.length;++x)if(0!==p.buffer[4*x+3]){var k=(1-i.buffer[x]/255)*(c-u)+u,O=k-a;O>0?b+=O*p.resolution:_-=O*p.resolution,w+=p.resolution,g?(d=k,v=k,g=!1):(d<k&&(d=k),v>k&&(v=k))}for(var P=0,A=i.dimension.width,S=i.dimension.height,M=0;M<A;++M)for(var T=0;T<S;++T){L(T*A+M)&&(P+=E(M,T))}return{cut:b,fill:_,area:w,surface:P,refAltitude:a,highest:d,lowest:v}}function E(e,t){var r=(t-1)*A+e,n=(t+1)*A+e,o=t*A+e-1,a=t*A+e+1,s=t*A+e,l=j(i.buffer[s]),u=0;function c(e,t,r,n){if(R(t)&&R(n)){var o=j(i.buffer[t]),a=j(i.buffer[r]),s=j(i.buffer[n]);u+=C(o,l,a)/4,u+=C(s,a,l)/4}else u+=p.resolution/4}function f(e,t,n){if(R(t)&&R(n)){var o=j(i.buffer[a]),s=j(i.buffer[r]);u+=C(l,o,s)/2}else u+=p.resolution/4}return f(s,o,r),f(s,a,n),c(s,o,(t+1)*A+e-1,n),c(s,a,(t-1)*A+e+1,r),u}function C(e,t,r){var n=i.resolutionwidth*i.resolutionwidth,o=i.resolutionheight*i.resolutionheight,a=Math.sqrt((e-t)*(e-t)+n),s=Math.sqrt((e-r)*(e-r)+o),l=Math.sqrt((t-r)*(t-r)+n+o),u=(a+s+l)/2;return Math.sqrt(u*(u-a)*(u-s)*(u-l))}function j(e){return(1-e/255)*s}function R(e){return e>=0&&e<i.buffer.length}function L(e){return R(e)&&0!==p.buffer[4*e+3]}console.error("polygon marker is required")}},{key:"_generateImages",value:function(e){var t=e.polygonMarkers;if(!(t.length<1)){var r=e.boundary,n=e.resolution,o={min:t[0].bottom,max:t[0].top},i=[];t.map(function(e){i.push(e.contentHolder),o.min=o.min>e.bottom?e.bottom:o.min,o.max=o.max<e.top?e.top:o.max}),o.min-=.1,o.max+=.1;for(var a=this.earth.markerSnapshot(r,o,i,!1,n),s=[],l=0;l<a.buffer.length;l+=4)s.push(a.buffer[l+3]);a=Object.assign(a,{buffer:s});var u={min:0,max:this.projInfo.max_bound.z-this.projInfo.min_bound.z},c=this.earth.markerSnapshot(r,u,[this.modelHolder],!0,n),f={min:0,max:0};return f.min=(1-c.buffer[0]/255)*(u.max-u.min)+u.min,f.max=f.min,c.buffer.map(function(e){var t=(1-e/255)*(u.max-u.min)+u.min;f.min=f.min>t?t:f.min,f.max=f.max<t?t:f.max}),f.min-=.1,f.max+=.1,{srcImg:this.earth.markerSnapshot(r,f,[this.modelHolder],!0,n),srcAltRange:f,dstImg:a,dstAltRange:o}}console.warn("AltizureProjectMarker _generateImages options.polygonMarkers length must not be smaller than 1")}},{key:"_detectOffset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;return new Promise(function(i,a){var s=new(r(71));s.onmessage=function(e){var t=e.data;t.finish?(i(t.offset),s.terminate()):o&&o(t)},s.onError=function(e){console.log("AltizureProjectMarker _detectOffset worker error",e)};var l=Object.assign({},n);l.projectDepthImage=e,l.maskImage=t,s.postMessage(l)})}},{key:"getOrientedInfo",value:function(){var e=this.spec.model,t=this.shapeHolder.matrix.clone();t=t.extractRotation(t);var r=(new f.Euler).setFromRotationMatrix(t);t.makeRotationFromEuler(r);var n,o,a=this.spec.version.major>=3;if(a){n=t.clone().multiply(e.modelToENU.clone()).clone();var s=(new f.Euler).setFromRotationMatrix(n,"XYZ");s.x+=1.5*Math.PI,n.makeRotationFromEuler(s)}else{var l=e.modelToENU.clone(),u=(new f.Matrix4).getInverse(l);n=(new f.Matrix4).multiply(u).multiply(t).multiply(l).multiply(e.objToModel.clone()).clone();var c=(new f.Euler).setFromRotationMatrix(n,"XYZ");c.x+=1.5*Math.PI,n.makeRotationFromEuler(c)}o=a?new i.ModelSpecV3(this.spec.modelType,this.spec.isImported,this.spec.model.tiling,this.spec.model.gis,this.spec.model.objToModel.clone(),n.clone()):new i.ModelSpecV2(this.spec.modelType,this.spec.isImported,this.spec.model.tiling,this.spec.model.gis,n.clone());var h=this.spec.render.initialCamPos,p=this.presetCameraMatrix;if(p){var d=new f.Matrix4;d.elements=p;var v=new f.Vector3(0,0,0).applyMatrix4(d),m=new f.Vector3(0,0,-1).applyMatrix4(d),y=(new f.Matrix4).getInverse(o.objToInitCam.clone()),g=(new f.Matrix4).multiply(this.matrix).multiply((new f.Matrix4).makeScale(this.shapeHolder.scale.x,this.shapeHolder.scale.y,this.shapeHolder.scale.z)).multiply(this.contentHolder.matrix).multiply(o.objToENU).multiply(y),b=(new f.Matrix4).getInverse(g),_=v.clone().applyMatrix4(b),w=m.clone().applyMatrix4(b);h={cameraPos:[_.x,_.y,_.z],centerPos:[w.x,w.y,w.z]}}var x=new i.RenderSpec(this.spec.render.annotations,h);return new i.ProjectSpec(this.spec.version,this.spec.id,this.spec.name,this.spec.owner,this.spec.views,this.spec.date,this.spec.storage,o,x)}},{key:"sceneUpdated",value:function(e){console.warn("AltizureProjectMarker sceneUpdated should be managed by forest")}},{key:"updateVisibility",value:function(e){console.warn("Ni")}},{key:"animate",value:function(e){this._water&&this._water.animate()}},{key:"importWater",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){v(i,n,o,a,s,"next",e)}function s(e){v(i,n,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"deportWater",value:function(){return this._waterManager&&this._waterManager.destruct(),!0}},{key:"importPhotos",value:function(e){var t=this._tree.basepath;t||console.error("No basepath");var r={url:e&&e.url?e.url:function(){var e=t||"",r=e+"/camera/0_0_0.json",n=e.replace("data","user_drive")+"/";return{cameraFile:r,photoBase:n}}(),length_unit_to_meter:1,photoHolder:this.photoHolder,objToScene:this.objToScene.bind(this),objToEarth:this.objToEarth.bind(this),createInstance:e.showCameras};return this._photoManager=new s.a(r),this._photoManager.init()}},{key:"deportPhotos",value:function(){return this._photoManager&&(this._photoManager.destruct(),this._photoManager=null),!0}},{key:"_snap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dist:200,orient:15,alpha:.1},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{focusVisualVisible:!0,method:1},n=this,o=null;this._focusVisual.visible=r.focusVisualVisible;var i=this.earth.earthView.height,a=this.earth.earthView.width,s=this.earth.control.pickProjectContactPointInEarth({rawX:a/2,rawY:i/2},"marker");if(!s)return Promise.reject(new Error("No focus."));var l=s.clone(),u=l.clone().applyMatrix4(this.earthToObj());if(this._focusVisual.position.copy(u),!(o=n._photoManager.cameraNear(n.earth.viewerCamera,u,e)))return this._focusVisual.material.color.setHex(16711680),console.warn("no nearby photo"),Promise.reject(new Error("No nearby photo."));this._focusVisual.material.color.setHex(65280);var c=n.earth.control,h=new f.Vector3,p=new f.Quaternion,d=new f.Vector3;n.objToEarth().multiply(o.camToObj).clone().decompose(h,p,d);var v=(new f.Matrix4).compose(h,p,new f.Vector3(1,1,1)),m=c.flyToMatNorthUp(v,t,l),y=o.loadDisplay(this._photoManager).then(function(e){var t=e._tree;return t.visible=!1,e!==n._currentPhotoCam&&(n._currentPhotoCam&&(n.photoHolder.remove(n._currentPhotoCam.photoDisplay),n._currentPhotoCam.disposeDisplay(0)),n._currentPhotoCam=e,n.photoHolder.add(n._currentPhotoCam.photoDisplay),t.opacity=1),Promise.resolve(t)});return Promise.all([m,y]).then(function(e){var t=e[1];return t&&(t.visible=!0),t._retrieveAllTiles(),Promise.resolve(o)}).catch(function(e){return console.error(e),e})}},{key:"imgPicker",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dist:200,orient:15,alpha:.1},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{focusVisualVisible:!0};this._focusVisual.visible=n.focusVisualVisible;var o=this.earth.earthView.height,i=this.earth.earthView.width,a=this.earth.control.pickProjectContactPointInEarth({rawX:i/2,rawY:o/2},"marker");if(!a)return Promise.reject(new Error("No focus."));var s=a.clone().clone().applyMatrix4(this.earthToObj());return this._focusVisual.position.copy(s),(e=this._photoManager.kCameraNear(this.earth.viewerCamera,s,t,r))?(this._focusVisual.material.color.setHex(65280),e):(this._focusVisual.material.color.setHex(16711680),console.warn("no nearby photo"),Promise.reject(new Error("No nearby photo.")))}},{key:"imgPickerByPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{dist:200,orient:15,alpha:.1},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{focusVisualVisible:!0};this._focusVisual.visible=n.focusVisualVisible;var o=this.earth.control.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");if(!o)return Promise.reject(new Error("No focus."));var i=o.clone().clone().applyMatrix4(this.earthToObj());return this._focusVisual.position.copy(i),this._photoManager.kCameraNear(this.earth.viewerCamera,i,t,r)||(console.warn("no nearby photo"),Promise.reject(new Error("No nearby photo.")))}},{key:"disposeCurrentDisplay",value:function(){this._currentPhotoCam&&this._currentPhotoCam.disposeDisplay(0)}},{key:"_fadeOutDisplay",value:function(e,t){var r=this;t>0?(e.material.opacity=t,t-=.5,setTimeout(function(){r._fadeOutDisplay(e,t)},100)):e.material.opacity=0}},{key:"crop",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;if("PTLOD"===this.modelType)return console.warn("This model type do not support this function"),!1;var n=e.map(function(e){return r.geoToProfile(e.lng,e.lat)});return this._tree.material._cropMask.paintPolygon(n,"#f00",t),this._tree.material.refreshMask(),!0}},{key:"uncrop",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;if("PTLOD"===this.modelType)return console.warn("This model type do not support this function"),!1;var n=e&&e.length>2?e.map(function(e){return r.geoToProfile(e.lng,e.lat)}):[{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}];return this._tree.material._cropMask.paintPolygon(n,"#0f0",t),this._tree.material.refreshMask(),!0}},{key:"loadCropMask",value:function(){if("PTLOD"!==this.modelType){var e=this;return this._tree.material.loadCropMask().then(function(t){return Promise.resolve(e)}).catch(function(e){return console.warn("[APM]",e),Promise.reject(e)})}console.warn("This model type do not support this function")}},{key:"loadCropMaskLocal",value:function(e){if("PTLOD"!==this.modelType){var t=this;return this._tree.material.loadCropMaskLocal({apiInfo:e}).then(function(e){return Promise.resolve(t)}).catch(function(e){return console.warn("[APM]",e),Promise.reject(e)})}console.warn("This model type do not support this function")}},{key:"getCropMask",value:function(){return"PTLOD"===this.modelType?void console.warn("This model type do not support this function"):this._tree.material._cropMask?{maskInfos:[this._tree.material._cropMask.packMask()]}:void 0}},{key:"showVideo",value:function(e){var t=this;if(!0===o(this)){var r=this._cameraMarker2visibilityInfo(e),n=this._tree.material.addVideoProjector(d({videoSrcUrl:e.videoSrcUrl,type:e.videoType,videoDom:e.videoDom},r));return n.updateDepthTexture(),{ID:this.ID+"-"+e.ID,update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!0===o(t)&&n){if(n.visible=void 0!==e.visible?e.visible:n.visible,e.cameraMarker){var r=e.cameraMarker,i=t._cameraMarker2visibilityInfo(r);n.camera.fov=i.fov,n.camera.aspect=i.aspect,n.near=i.near,n.far=i.far,n.lookAt(i.position,i.up,i.target)}(e=Object.assign({width:512,height:512,updateDepth:!0},e)).updateDepth&&n.updateDepthTexture(e.width,e.height)}},remove:function(){if(!0===o(t)){var e=t._tree.material.getProjectorIndex(n);t._tree.material.removeProjectorByIndex(e)}}}}function o(e){var t=!1;return e&&"OSGLOD"===e.modelType&&(t=!0),e&&"PTLOD"===e.modelType&&(t=!1),e&&"CAD"===e.modelType&&(t=!0),e&&"MESHLOD"===e.modelType&&(t=!0),t}}},{key:"_showImage",value:function(e){var t=this;if(!0===o(this)){var r=this._cameraMarker2visibilityInfo(e),n=this._tree.material.addImageProjector(d({texture:e._texture},r));return n.updateDepthTexture(),{ID:this.ID+"-"+e.ID,update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!0===o(t)&&t&&n){if(n.visible=void 0!==e.visible?e.visible:n.visible,e.cameraMarker){var r=e.cameraMarker,i=t._cameraMarker2visibilityInfo(r);n.camera.fov=i.fov,n.camera.aspect=i.aspect,n.near=i.near,n.far=i.far,n.lookAt(i.position,i.up,i.target)}(e=Object.assign({width:512,height:512,updateDepth:!0},e)).updateDepth&&n.updateDepthTexture(e.width,e.height)}},remove:function(){if(!0===o(t)&&t){var e=t._tree.material.getProjectorIndex(n);t._tree.material.removeProjectorByIndex(e)}}}}function o(e){var t=!1;return e&&"OSGLOD"===e.modelType&&(t=!0),e&&"PTLOD"===e.modelType&&(t=!1),e&&"CAD"===e.modelType&&(t=!0),e&&"MESHLOD"===e.modelType&&(t=!0),t}}},{key:"showVisibility",value:function(e){var t=this;if(!0===o(this)){var r=this._cameraMarker2visibilityInfo(e),n=null;return(n=this._tree.material.addVisibility(r)).updateDepthTexture(),{ID:this.ID+"-"+e.ID,update:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!0===o(t)&&n){if(n.visible=void 0!==e.visible?e.visible:n.visible,e.cameraMarker){var r=e.cameraMarker,i=t._cameraMarker2visibilityInfo(r);n.camera.fov=i.fov,n.camera.aspect=i.aspect,n.near=i.near,n.far=i.far,n.lookAt(i.position,i.up,i.target)}(e=Object.assign({width:512,height:512,updateDepth:!0},e)).updateDepth&&n.updateDepthTexture(e.width,e.height)}},remove:function(){if(!0===o(t)){var e=t._tree.material.getProjectorIndex(n);t._tree.material.removeProjectorByIndex(e)}}}}function o(e){var t=!1;return e&&"OSGLOD"===e.modelType&&(t=!0),e&&"PTLOD"===e.modelType&&(t=!1),e&&"CAD"===e.modelType&&(t=!0),e&&"MESHLOD"===e.modelType&&(t=!0),t}}},{key:"_cameraMarker2visibilityInfo",value:function(e){var t=new f.Matrix4;t.elements=e.camToEarth;var r=this.earthToObj(),n=new f.Matrix4;n.multiplyMatrices(r,t);var o=new f.Vector3(0,0,0);o.applyMatrix4(n);var i=new f.Vector3(0,1,0);i.applyMatrix4(n).sub(o);var a=new f.Vector3(0,0,-1);a.applyMatrix4(n);var s=a.clone().sub(o).length(),l=u.a.EARTH_RADIUS/u.a.scale;return{fov:e.fov,aspect:e.aspect,near:e.near*l*s,far:e.far*l*s,position:o,up:i,target:a}}},{key:"_updateCropMask",value:function(){console.warn("deprecated.")}},{key:"objToLayer",value:function(){return(new f.Matrix4).multiply(this.matrix).multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix).multiply(this.projHolder.matrix).multiply(this.modelHolder.matrix)}},{key:"objToEarth",value:function(){try{return(new f.Matrix4).getInverse(this.earth.earthToScene(),!0).multiply(this.objToScene())}catch(e){return void console.error(e)}}},{key:"earthToObj",value:function(){return this.sceneToObj().multiply(this.earth.earthToScene())}},{key:"objToScene",value:function(){return this.modelHolder.updateMatrixWorld(!0),this.modelHolder.matrixWorld.clone()}},{key:"sceneToObj",value:function(){return(new f.Matrix4).getInverse(this.objToScene(),!0)}},{key:"earthToProject",value:function(){return this.projHolder.updateMatrixWorld(!0),(new f.Matrix4).getInverse(this.projHolder.matrixWorld).multiply(this.earth.earthToScene())}},{key:"objToShapeHolder",value:function(){return(new f.Matrix4).multiply(this.contentHolder.matrix).multiply(this.projHolder.matrix).multiply(this.modelHolder.matrix)}},{key:"geoToProfile",value:function(e,t){var r=l.a.geographicToEarthSurface(void 0,e,t,void 0),n=this.spec.model.tiling.minBound.z,o=(new f.Matrix4).setPosition(new f.Vector3(0,0,-n)),i=this.sceneNode.matrix.clone().multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix).multiply(o),a=(new f.Matrix4).getInverse(i),s=r.clone().applyMatrix4(a);return this.pointProjToProfile(s)}},{key:"pointProjToProfile",value:function(e){var t=this.projInfo,r=t.min_bound.clone(),n=t.max_bound.clone();return e.sub(r).divide(n.clone().sub(r)),{u:e.x,v:e.y,w:e.z}}},{key:"onContentInitialized",value:function(){this._onInitSuccess&&this._onInitSuccess(this)}},{key:"changeDisplayMode",value:function(e){console.log("deprecated")}},{key:"matFromCameraInfo",value:function(e){var t=this.objToScene(),r=this.earth.earthToScene(),n=(new f.Matrix4).getInverse(r);if(e instanceof Array){var o=[];return e.map(function(e){o.push(i(e))}),o}return i(e);function i(e){var o=new f.Vector3(e.cameraPosition.x,e.cameraPosition.y,e.cameraPosition.z).applyMatrix4(t),i=new f.Vector3(e.centerPosition.x,e.centerPosition.y,e.centerPosition.z).applyMatrix4(t),a=new f.Vector3(e.cameraPosition.x,e.cameraPosition.y,e.cameraPosition.z).applyMatrix4(t);a=a.add(new f.Vector3(0,0,0).applyMatrix4(r).negate()).normalize();var s=(new f.Matrix4).lookAt(o,i,a).setPosition(o);return n.clone().multiply(s).elements}}},{key:"LngLatAltFromXYZ",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"obj",o=new f.Vector3(e,t,r);if("obj"===n)return o.applyMatrix4(this.objToEarth()),l.a.getLngLatAltFromNoneGroundCartesian(void 0,o,void 0);console.warn("space type not supported yet")}},{key:"XYZFromLngLatAlt",value:function(e,t,r){if("obj"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"obj")){var n=l.a.getNoneGroundCartesianFromLngLatAlt(void 0,e,t,r,void 0).clone().applyMatrix4(this.earthToObj());return[n.x,n.y,n.z]}console.warn("space type not supported yet")}},{key:"composeCamToEarth",value:function(e,t,r){e=new f.Vector3(e.x,e.y,e.z),t=new f.Vector3(t.x,t.y,t.z),r=new f.Vector3(r.x,r.y,r.z);var n=this.position,o=l.a.getLocalSystemOnEarthSurface(void 0,n.lng,n.lat,void 0);o.origin.add(o.alt.clone().multiplyScalar(n.alt));var i=this.spec.model.tiling.minBound.z,a=new f.Vector3(-this.projInfo.origin.x,-this.projInfo.origin.y,-this.projInfo.origin.z-i),s=e.clone().add(a),u=r.clone().add(a),c=t.clone(),h=v(o,s),p=v(o,u),d=v(o,c).sub(o.origin);return(new f.Matrix4).setPosition(h).lookAt(h,p,d);function v(e,t){return e.origin.clone().add(e.lng.clone().multiplyScalar(t.x)).add(e.lat.clone().multiplyScalar(t.y)).add(e.alt.clone().multiplyScalar(t.z))}}},{key:"_oldDisplayToEarth",value:function(){var e=(new f.Matrix4).makeBasis(new f.Vector3(1,0,0),new f.Vector3(0,0,1),new f.Vector3(0,-1,0)),t=this.spec.model.tiling.minBound.z,r=(new f.Matrix4).setPosition(new f.Vector3(0,0,-t));return(new f.Matrix4).multiply(this.matrix).multiply(this.shapeHolder.matrix).multiply(r).clone().multiply(e)}},{key:"initialCamPosFromCameraMatrix",value:function(e){var t=new f.Matrix4;t.elements=e;var r=new f.Vector3(0,0,0).applyMatrix4(t),n=new f.Vector3(0,0,-1).applyMatrix4(t),o=l.a.getLngLatAltFromNoneGroundCartesian(void 0,r,void 0),i=o.lng,a=o.lat,s=l.a.getLocalSystemOnEarthSurface(void 0,i,a,void 0).alt.clone(),u=n.clone().sub(r).normalize(),c=u.dot(s),h=Math.PI/180*3;if(c<-Math.cos(h)-1e-7){var p=new f.Vector3(0,1,0).applyMatrix4(t),d=(p=p.sub(r).normalize()).clone().sub(s.clone().multiplyScalar(s.dot(p))).normalize();u=s.clone().multiplyScalar(-Math.cos(h)).add(d.clone().multiplyScalar(Math.sin(h))).normalize(),n=r.clone().add(u.clone().multiplyScalar(n.clone().sub(r).length()))}var v=(new f.Matrix4).getInverse(this.spec.model.objToInitCam.clone()),m=this.objToEarth().multiply(v),y=(new f.Matrix4).getInverse(m);return{cameraPos:r.clone().applyMatrix4(y),centerPos:n.clone().applyMatrix4(y)}}},{key:"focus",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).time,t=void 0===e?1:e,r=this.presetCameraMatrix;return r?this.earth.camera.flyToMat(r,t):Promise.reject(new Error("focus"))}},{key:"_apiInfo",get:function(){console.warn("_apiInfo is deprecated")}},{key:"_projInfo",get:function(){console.warn("_projInfo is deprecated")}},{key:"_projCompleteInfo",get:function(){console.warn("_projCompleteInfo is deprecated")}},{key:"autoScale",set:function(e){if(!0===e&&(e=50),"string"==typeof e&&(e=Number(e)),"number"==typeof e&&e>0){var t=this.projInfo.max_bound,r=this.projInfo.min_bound,n=t.x-r.x,o=t.y-r.y,i=e/((n>o?n:o)*this.projInfo.length_unit_to_meter);this.setPose(void 0,void 0,i),this._property.autoScale=e}}},{key:"modelType",get:function(){return this.spec.model.modelType}},{key:"geoCoverage",get:function(){var e=this.projInfo.min_bound,t=this.projInfo.max_bound,r=(t.x-e.x)/2,n=(t.y-e.y)/2,o=t.clone().add(e).multiplyScalar(.5);o.z=e.z;var i,a,s=this.shapeHolder.matrix.clone(),u=new f.Vector3(r,n,0).add(o).applyMatrix4(s),c=new f.Vector3(-r,-n,0).add(o).applyMatrix4(s),h=new f.Vector3(r,-n,0).add(o).applyMatrix4(s),p=new f.Vector3(-r,n,0).add(o).applyMatrix4(s),d=l.a.getLocalSystemOnEarthSurface(void 0,this.position.lng,this.position.lat,void 0),v=d.origin.clone().add(d.alt.clone().multiplyScalar(1*this.position.alt)),m=[u,p,c,h].map(function(e){var t=v.clone();return t.add(d.lng.clone().multiplyScalar(1*e.x)),t.add(d.lat.clone().multiplyScalar(1*e.y)),t.add(d.alt.clone().multiplyScalar(1*e.z)),l.a.getLngLatAltFromNoneGroundCartesian(void 0,t,void 0)});return i=m[0].lng,a=m[0].lat,{maxLong:i,minLong:m[2].lng,maxLat:a,minLat:m[2].lat,boundaryPts:m}}},{key:"preferredPath",get:function(){return this.spec.storage.basePath}},{key:"dataUrl",get:function(){var e=this.preferredPath;return e&&e.length>0&&"/"===e[0]?(e="https://www.altizure.com"+e,Object.defineProperty(this,"dataUrl",{value:e+"/web/",writable:!1,configurable:!0}),this.dataUrl):e+"/web/"}},{key:"apiService",get:function(){return this.earth.apiService}},{key:"visible",set:function(e){this._tree&&(this._tree.visible=e),x(A(t.prototype),"visible",e,this,!0)},get:function(){return O(A(t.prototype),"visible",this)}},{key:"opacity",get:function(){if("PTLOD"!==this.modelType)return this._tree._material._sharedUniforms.opacity.value;console.warn("This model type do not support this function")},set:function(e){if("PTLOD"===this.modelType)console.warn("This model type do not support this function");else{var t=Number(e);!1===isNaN(t)&&(t<=1&&t>=0?this._tree._material.setValues({opacity:t,transparent:!0}):(this._tree._material.setValues({opacity:1,transparent:!1}),console.warn("opacity value range is [0, 1]")))}}},{key:"hsbc",get:function(){if("PTLOD"!==this.modelType)return this._tree._material._sharedUniforms.hsbc.value;console.warn("This model type do not support this function ")},set:function(e){if("PTLOD"===this.modelType)console.warn("This model type do not support this function ");else{var t=!0;e instanceof Array!=!0?t=!1:e.map(function(e){!0===isNaN(Number(e))&&(t=!1)}),4!==e.length&&(t=!1),!0===t?this._tree._material.setValues({hsbc:e}):console.warn("hsbc input need an array with 4 element")}}},{key:"forest",get:function(){return this.earth.markerLayer.forest}},{key:"altizureBundleLoader",get:function(){return this.earth.markerLayer.altizureBundleLoader}},{key:"osgBundleLoader",get:function(){return this.earth.markerLayer.osgBundleLoader}},{key:"water",get:function(){var e=new c.a({waterHolder:this.waterHolder,marker:this,PID:this.spec.id,altizureApi:this.apiService,spec:this.spec,renderer:this.earth.renderer,camera:this.earth.viewerCamera,scene:this.earth.scene});return this._water=e,Object.defineProperty(this,"water",{value:e,writable:!1,configurable:!0}),this.water}},{key:"photos",get:function(){if(this._photoManager){var e=this,t={snap:e._snap.bind(this),getByName:function(t){return e._photoManager.cameraByName(t)},photoUrl:function(t){return e._photoManager.photoUrl(t.name)}};return Object.defineProperty(this,"photos",{value:t,writable:!1,configurable:!0}),this.photos}console.warn("photos are not initialized.")}},{key:"displayProperty",set:function(e){if("PTLOD"===this.modelType)console.warn("This model type do not support this function");else{var t={hsbc:[0,.5,.5,.5],opacity:1,transparent:!0};void 0!==e.hsbc&&(t.hsbc=e.hsbc,this._tree._material.setValues({hsbc:t.hsbc})),void 0!==e.opacity&&(e.opacity<1?this._tree._material.setValues({opacity:e.opacity,transparent:!0}):(t.opacity=e.opacity,this._tree._material.setValues({opacity:1,transparent:!1})))}},get:function(){return"PTLOD"===this.modelType?(console.warn("This model type do not support this function"),null):this._tree._material._sharedUniforms}},{key:"displayMode",set:function(e){"PTLOD"===this.modelType?console.warn("This model type do not support this function"):"number"==typeof e||!1===isNaN(Number(e))?this._tree._material.renderMode=Number(e):"string"==typeof e&&((e=e.toUpperCase())in M==!0?this._tree._material.renderMode=M[e]:console.log("Unrecognized renderMode"))},get:function(){if("PTLOD"!==this.modelType){var e="BASIC";return 1===this._tree._material.renderMode?e="BASIC":2===this._tree._material.renderMode?e="PHONG":3===this._tree._material.renderMode?e="PBR":40===this._tree._material.renderMode?e="WIREFRAME":41===this._tree._material.renderMode&&(e="FLAT"),e}console.log("This model type do not support this function ")}},{key:"annotations",get:function(){var e=this,t=this.spec.render.annotations.edges.map(function(e){return e.node}),r=this.matFromCameraInfo(t),n=[];return t.map(function(t,o){n.push(Object.assign({},t,{flyMat:r[o],position:e.LngLatAltFromXYZ(t.modelx,t.modely,t.modelz)}))}),n}},{key:"presetCameraMatrixV2",get:function(){var e=this._oldDisplayToEarth(),t=this.spec.render.initialCamPos,r=t.cameraPos,n=t.centerPos;if(r&&n){var o=p(f.Vector3,y(r)),i=p(f.Vector3,y(n)),a=o.clone().applyMatrix4(e),s=i.clone().applyMatrix4(e),u=l.a.getLngLatAltFromNoneGroundCartesian(void 0,a,void 0),c=u.lng,h=u.lat,d=l.a.getLocalSystemOnEarthSurface(void 0,c,h,void 0).alt.clone();return(new f.Matrix4).lookAt(a,s,d).setPosition(a).elements}console.warn("initialCamPos does not exist")}},{key:"presetCameraMatrix",get:function(){var e=(new f.Matrix4).getInverse(this.spec.model.objToInitCam.clone()),t=this.objToEarth().multiply(e),r=this.spec.render.initialCamPos,n=r.cameraPos,o=r.centerPos;if(n&&o){var i=p(f.Vector3,y(n)),a=p(f.Vector3,y(o)),s=i.clone().applyMatrix4(t),u=a.clone().applyMatrix4(t),c=l.a.getLngLatAltFromNoneGroundCartesian(void 0,s,void 0),h=c.lng,d=c.lat,v=l.a.getLocalSystemOnEarthSurface(void 0,h,d,void 0).alt.clone();return(new f.Matrix4).lookAt(s,u,v).setPosition(s).elements}console.warn("initialCamPos does not exist")}},{key:"pointSize",get:function(){return"PTLOD"===this.modelType?(this._tree.style.size=2,this._tree.style.size):void console.warn("Not a point cloud project")},set:function(e){"PTLOD"===this.modelType?(this._tree.style.size=e,this._tree.material.updateMaterial()):console.warn("Not a point cloud project")}}],[{key:"quality",set:function(e){this._quality=e},get:function(){return void 0===this._quality&&(this._quality=60),this._quality}}]),t}();T.MAXANISOTROPY=1,t.a=T},function(e,t,r){"use strict";r.d(t,"a",function(){return d}),r.d(t,"b",function(){return s});var n=r(0),o=(r.n(n),r(6)),i=r(2),a=r(5);function s(e){var t=new n.Vector3;e.map(function(e){t.add(e)}),t.multiplyScalar(1/e.length);var r=0,o=0,i=0,a=0,s=0,l=0;e.map(function(e){var n=e.clone().sub(t);r+=n.x*n.x,o+=n.x*n.y,i+=n.x*n.z,a+=n.y*n.y,s+=n.y*n.z,l+=n.z*n.z}),r/=e.length,o/=e.length,i/=e.length,a/=e.length,s/=e.length,l/=e.length;var u,c,f=new n.Vector3(0,0,0),h=a*l-s*s;u=new n.Vector3(h,i*s-o*l,o*s-i*a),c=h*h,f.dot(u)<0&&(c=-c),f.add(u.multiplyScalar(c));var p=r*l-i*i;u=new n.Vector3(i*s-o*l,p,o*i-s*r),c=p*p,f.dot(u)<0&&(c=-c),f.add(u.multiplyScalar(c));var d=r*a-o*o;return u=new n.Vector3(o*s-i*a,o*i-s*r,d),c=d*d,f.dot(u)<0&&(c=-c),f.add(u.multiplyScalar(c)),{normal:f.normalize(),centroid:t}}function l(e,t,r,n){var o=e.clone().cross(t),i=t.clone().cross(r),a=o.length()*i.length(),s=-o.clone().dot(i)/a;s<-1&&(s=-1);var l=o.clone().cross(i),u=(l.dot(n)>=0?1:-1)*l.length()/a,c=Math.acos(s);return u>=0?c:2*Math.PI-c}function u(e){for(var t=[],r=[],n=0;n<e.length;++n){var o=e[n],s=e[n-1];if(!s||o.lng!==s.lng||o.lat!==s.lat||o.alt!==s.alt){var u=i.a.getNoneGroundCartesianFromLngLatAlt(a.a.EarthResolution,o.lng,o.lat,o.alt,a.a.scale),c=i.a.getNoneGroundCartesianFromLngLatAlt(a.a.EarthResolution,o.lng,o.lat,o.alt+1,a.a.scale);c.sub(u),t.push(u),r.push(c)}}for(var f=t.length,h=0,p=1;p<f-1;++p){h+=l(t[p-1],t[p],t[p+1],r[p])}return h+=l(t[f-2],t[0],t[1],r[0])-(f-3)*Math.PI}var c=180/Math.PI,f=Math.PI/4,h={y2lat:function(e){return 90*(Math.atan(Math.exp(e/c))/f-1)},x2lon:function(e){return e},lat2y:function(e){return Math.log(Math.tan((e/90+1)*f))*c},lon2x:function(e){return e}};function p(e){var t=e.map(function(e){return{y:h.lat2y(e.lat),x:h.lon2x(e.lng)}});return function(){for(var e=null,o=2;o<t.length;o++){var i=n(t[o-2],t[o-1],t[o]),a=Math.sign(i);null==e&&(e=a);var s=r(e,a);if(!1===s)return!1;e=a}var l=n(t[t.length-2],t[0],t[1]);return r(e,Math.sign(l))}();function r(e,t){return e===t}function n(e,t,r){var n=t.x-e.x,o=t.y-e.y,i=r.x-t.x;return n*(r.y-t.y)-o*i}}var d={checkPtsInPoly:function(e,t){t[0].equals(t[t.length-1])&&(t=t.slice()).pop();var r=e.map(function(e){return a(e)}),o=t.map(function(e){return a(e)}),i=function(e){var t,r=s(e),o=r.centroid,i=r.normal,a=(t=0===i.x&&0===i.y?new n.Vector3(1,0,0):new n.Vector3(-i.y,i.x,0).normalize()).clone().cross(i).normalize(),l=(new n.Matrix4).set(t.x,t.y,t.z,0,a.x,a.y,a.z,0,i.x,i.y,i.z,0,0,0,0,1),u=o.dot(i)/i.lengthSq(),c=o.clone().sub(o.clone().multiplyScalar(u));return{project:function(e){var t=e.clone().sub(c).applyMatrix4(l),r={lng:1e5*t.x,lat:1e5*t.y,alt:t.z,equals:function(e){return r.lng===e.lng&&r.lat===e.lat&&r.alt===e.alt}};return r}}}(o);return function(e,t){t[0].equals(t[t.length-1])&&(t=t.slice()).pop();for(var r=[],n=0;n<e.length;++n){var o=e[n];r[n]=!!o&&i(o,t)}return r;function i(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0,o=0;o<t.length;++o){var i=t[o],a=t[(o+1)%t.length],s=(e.lat-a.lat)/(i.lat-a.lat);if(s<1-r&&s>r)s*i.lng+(1-s)*a.lng>=e.lng&&(n+=1);else if(s>=1-r&&s<=1+r&&a.lng>=e.lng){var l=t[(o+2)%t.length];(i.lat>e.lat&&l.lat<e.lat||i.lat<e.lat&&l.lat>e.lat)&&(n+=1)}}return n%2==1}}(r.map(function(e){var t=i.project(e);return t.alt>=0&&t}),o.map(function(e){var t=i.project(e);return t.alt>=0&&t}));function a(e){var t=l(e.lng),r=l(e.lat),o=Math.cos(r),i=Math.cos(t)*o,a=Math.sin(t)*o,s=Math.sin(r);return new n.Vector3(i,a,s).normalize();function l(e){return e*Math.PI/180}}},areaByLngLatAlts:function(e){var t=a.a.EARTH_RADIUS;return e.length<4?0:u(e)*(t*t)},isLoopCounterClockwise:function(e){return e.length<3&&console.warn("invalid input"),u(e)<=2*Math.PI},overlapRegion:function(e,t){if(!1!==p(t)){var r=function(e,t){var r,n,o,i,a=e.reverse(),s=t.reverse();for(var l in r=s[s.length-1],s){n=s[l];var u=a;for(var c in a=[],o=u[u.length-1],u)f(i=u[c])?(f(o)||a.push(h()),a.push(i)):f(o)&&a.push(h()),o=i;r=n}return a.length>0?(a.push(a[0]),a.reverse()):(console.warn("no overlapping area"),a);function f(e){return(n[0]-r[0])*(e[1]-r[1])>(n[1]-r[1])*(e[0]-r[0])}function h(){var e=[r[0]-n[0],r[1]-n[1]],t=[o[0]-i[0],o[1]-i[1]],a=r[0]*n[1]-r[1]*n[0],s=o[0]*i[1]-o[1]*i[0],l=1/(e[0]*t[1]-e[1]*t[0]);return[(a*t[0]-s*e[0])*l,(a*t[1]-s*e[1])*l]}}(e.slice(0,e.length-1).map(function(e){return[h.lat2y(e.lat),h.lon2x(e.lng)]}),t.slice(0,t.length-1).map(function(e){return[h.lat2y(e.lat),h.lon2x(e.lng)]}));return r.length>0?r.map(function(e){return new o.a(h.x2lon(e[1]),h.y2lat(e[0]),0)}):0}console.warn("second polygon should be a convex polygon")},isPolygonConvex:p}},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"a",function(){return i});var n=r(0),o=(r.n(n),{DisplacementMapPositionCalculation_vertex:"\nuniform float displacementMapUsed;\nuniform sampler2D displacementMap;\nuniform float displacementScale;\nuniform float displacementBias;\nvec3 displacementMapOffset(vec3 normal, vec2 uv){\n  if(displacementMapUsed>0.5){\n    return normalize(normal) * (texture2D(displacementMap, uv).x * displacementScale + displacementBias);\n  }else{\n    return vec3(0.0);\n  }\n}\n",SimplePostProcessingColorCalculation_fragment:"\nuniform float red, green, blue, alpha;\nuniform float lighting;\nuniform vec2 contract;\nvec4 calculateSimplePostProcessingColor(vec4 color){\n  vec3 tempColor = color.rgb;\n  tempColor += vec3(red, blue, green);\n  for(int i=0;i<3;++i){\n      if(tempColor[i]<0.0)tempColor[i]=0.0;\n      else if(tempColor[i]>1.0)tempColor[i]=1.0;\n    }\n    if(lighting>0.0){\n      tempColor = log(tempColor*(lighting+1.0)+vec3(1.0))/log(vec3(lighting+2.0));\n    }\n    else{\n      tempColor = pow(tempColor,vec3(1.0-lighting));\n    }\n    for(int i=0;i<3;++i){\n      if(tempColor[i]<contract[0])tempColor[i]=0.0;\n      else if(tempColor[i]>contract[1])tempColor[i]=1.0;\n      else{\n        tempColor[i] = (tempColor[i]-contract[0])/(contract[1]-contract[0]);\n      }\n    }\n    return vec4(tempColor, color.a * alpha);\n}\n",MatrixTranspose:"\nfloat transpose(float m) {\n  return m;\n}\n\nmat2 transpose(mat2 m) {\n  return mat2(m[0][0], m[1][0],\n              m[0][1], m[1][1]);\n}\n\nmat3 transpose(mat3 m) {\n  return mat3(m[0][0], m[1][0], m[2][0],\n              m[0][1], m[1][1], m[2][1],\n              m[0][2], m[1][2], m[2][2]);\n}\n\nmat4 transpose(mat4 m) {\n  return mat4(m[0][0], m[1][0], m[2][0], m[3][0],\n              m[0][1], m[1][1], m[2][1], m[3][1],\n              m[0][2], m[1][2], m[2][2], m[3][2],\n              m[0][3], m[1][3], m[2][3], m[3][3]);\n}\n",MatrixInverse:"\nfloat inverse(float m) {\n  return 1.0 / m;\n}\n\nmat2 inverse(mat2 m) {\n  return mat2(m[1][1],-m[0][1],\n             -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n",getSharpnessMapColor:"\nvec3 getSharpnessMapColor(sampler2D map, vec2 vUv, float mapWidth, float mapHeight){\n  vec3 result = vec3(0.0);\n  result += 5.0 * texture2D(map, vUv).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x - 1.0/mapWidth, vUv.y)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x + 1.0/mapWidth, vUv.y)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x, vUv.y - 1.0/mapHeight)).rgb;\n  result += -1.0 * texture2D(map, vec2(vUv.x, vUv.y + 1.0/mapHeight)).rgb;\n  result /= 1.0;\n  return result;\n}\n"}),i={deepCopyUniforms:function(e){var t,r,o,i={};for(t in e)for(r in i[t]={},e[t])(o=e[t][r])instanceof n.Color||o instanceof n.Vector2||o instanceof n.Vector3||o instanceof n.Vector4||o instanceof n.Matrix4?i[t][r]=o.clone():o instanceof n.Texture?(i[t][r]=o.clone(),i[t][r].needsUpdate=!0):o instanceof Array?i[t][r]=o.slice():(String,i[t][r]=o);return i},getFloatStringPair:function(e){return"number"==typeof e?{f:e,s:e.toString()}:"string"==typeof e?{f:parseFloat(e),s:e}:null}}},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(15)),i=r(8);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[0,0,0]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[1,1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[0,0,0]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},diffuseOn:{type:"f",value:1},specularOn:{type:"f",value:1},ambientPercentage:{type:"f",value:100},diffusePercentage:{type:"f",value:100},specularPercentage:{type:"f",value:100}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+o.b.DisplacementMapPositionCalculation_vertex+n.ShaderChunk.common+n.ShaderChunk.bsdfs+n.ShaderChunk.lights_pars_begin+n.ShaderChunk.logdepthbuf_pars_vertex+"\nvoid main(){\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  vec4 mvPosition = modelViewMatrix * vec4( transformedPosition, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n"+n.ShaderChunk.logdepthbuf_vertex+"}",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\n\nuniform vec3 ka;\nuniform float mapKaUsed;\nuniform sampler2D mapKa;\nuniform float mapKaWidth;\nuniform float mapKaHeight;\nuniform vec3 kd;\nuniform float mapKdUsed;\nuniform sampler2D mapKd;\nuniform float mapKdWidth;\nuniform float mapKdHeight;\nuniform vec3 ks;\nuniform float mapKsUsed;\nuniform sampler2D mapKs;\nuniform float mapKsWidth;\nuniform float mapKsHeight;\nuniform float ns;\n\nuniform float d;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform float diffuseOn;\nuniform float specularOn;\nuniform float ambientPercentage;\nuniform float diffusePercentage;\nuniform float specularPercentage;\n"+n.ShaderChunk.common+n.ShaderChunk.bsdfs+n.ShaderChunk.lights_pars_begin+n.ShaderChunk.bumpmap_pars_fragment+n.ShaderChunk.normalmap_pars_fragment+n.ShaderChunk.logdepthbuf_pars_fragment+"\nvec3 getDiffuse(vec3 lightColor, vec3 direction, vec3 normal, vec3 diffuse){\n  return saturate(dot(direction, normal)) * lightColor * diffuse;\n}\n\nvec3 getSpecular(vec3 lightColor, vec3 direction, vec3 normal, vec3 position, vec3 camera, vec3 specular, float shininess){\n  vec3 viewDir = normalize(camera - position);\n  vec3 reflectedDir = 2.0 * dot(direction, normal) * normal - direction;\n  float specularTerm = max(0.0000001, dot(viewDir, reflectedDir));\n  specularTerm = pow(specularTerm, shininess);\n  return specularTerm * lightColor * specular;\n}\n\nvoid main(){\n"+n.ShaderChunk.logdepthbuf_fragment+"\n  vec3 color = vec3(0.0);\n  vec3 modelPosition = -vViewPosition;\n  vec3 treatedNormal = normalize(vNormal);\n  if(bumpMapUsed>0.5)treatedNormal = perturbNormalArb(modelPosition, treatedNormal, dHdxy_fwd());\n  if(normalMapUsed>0.5)treatedNormal = perturbNormal2Arb( modelPosition, treatedNormal );\n  vec3 ambientColor = ka;\n  vec3 diffuseColor = kd;\n  vec3 specularColor = ks;\n  float shininess = ns;\n  vec3 ambientResultColor = vec3(0.0);\n  vec3 diffuseResultColor = vec3(0.0);\n  vec3 specularResultColor = vec3(0.0);\n  if(mapKaUsed>0.5){\n    ambientColor *= texture2D(mapKa, vUv).rgb;\n  }\n  if(mapKdUsed>0.5){\n    diffuseColor *= texture2D(mapKd, vUv).rgb;\n  }\n  if(mapKsUsed>0.5){\n    specularColor *= texture2D(mapKs, vUv).rgb;\n  }\n\n  ambientResultColor += ambientColor;\n  #if NUM_DIR_LIGHTS > 0\n    for(int i=0;i<NUM_DIR_LIGHTS;++i){\n      if(diffuseOn>0.5){\n        diffuseResultColor += getDiffuse(directionalLights[i].color, directionalLights[i].direction, treatedNormal, diffuseColor);\n      }\n\n      if(specularOn>0.5){\n        specularResultColor += getSpecular(\n          directionalLights[i].color, directionalLights[i].direction, treatedNormal, modelPosition, cameraPosition, specularColor, shininess\n        );\n      }\n    }\n  #endif\n  #if NUM_POINT_LIGHTS > 0\n    for(int i=0;i<NUM_POINT_LIGHTS;++i){\n      vec3 direction = normalize(pointLights[i].position - modelPosition);\n      if(diffuseOn>0.5){\n        diffuseResultColor += getDiffuse(pointLights[i].color, direction, treatedNormal, diffuseColor);\n      }\n\n      if(specularOn>0.5){\n        specularResultColor += getSpecular(\n          pointLights[i].color, direction, treatedNormal, modelPosition, cameraPosition, specularColor, shininess\n        );\n      }\n    }\n  #endif\n  diffuseResultColor += diffuseColor * RECIPROCAL_PI; // indirect diffuse color\n\n  color += ambientResultColor * ambientPercentage / 100.0;\n  color += diffuseResultColor * diffusePercentage / 100.0;\n  color += specularResultColor * specularPercentage / 100.0;\n  gl_FragColor = vec4(color, d);\n}\n"},h=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=l(this,u(t).call(this));var o=JSON.parse(JSON.stringify(f.uniforms));return r.uniforms=n.UniformsUtils.merge([n.UniformsLib.lights,o]),r.vertexShader=f.vertexShader,r.fragmentShader=f.fragmentShader,r.transparent=!0,r.extensions.derivatives=!0,r.lights=!0,r.description={},r.description.type="MTLPhongShaderMaterial",r.loadMTLOptions(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["ShaderMaterial"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"loadMTLOptions",value:function(e){if(void 0!==e&&null!==e&&Object.keys(e).length>0){if(this.name=e.name,this.description.name=e.name,e.ka&&(this.uniforms.ka.value=e.ka,this.description.ka=e.ka),e.kd&&(this.uniforms.kd.value=e.kd,this.description.kd=e.kd),e.ks&&(this.uniforms.ks.value=e.ks,this.description.ks=e.ks),e.ns){var t=o.a.getFloatStringPair(e.ns);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}if(e.d){var r=o.a.getFloatStringPair(e.ns);r&&(this.uniforms.d.value=r.f,this.description.d=r.s)}var n=e.bump,i=e.map_kd;void 0!==i&&null!==i&&(this._loadTexture(i,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=i),void 0!==n&&null!==n&&(this._loadTexture(n,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=n);var a=e.mapKaPath;if(void 0!==a&&null!==a&&(this._loadTexture(a,this.uniforms.mapKa,this.uniforms.mapKaUsed,this.uniforms.mapKaPath,this.uniforms.mapKaWidth,this.uniforms.mapKaHeight),this.description.mapKaPath=a),e.ambientPercentage){var s=o.a.getFloatStringPair(e.ambientPercentage);s&&(this.uniforms.ambientPercentage.value=s.f,this.description.ambientPercentage=s.s)}if(e.diffuseOn){var l=o.a.getFloatStringPair(e.diffuseOn);l&&(this.uniforms.diffuseOn.value=l.f,this.description.diffuseOn=l.s)}if(e.diffusePercentage){var u=o.a.getFloatStringPair(e.diffusePercentage);u&&(this.uniforms.diffusePercentage.value=u.f,this.description.diffusePercentage=u.s)}var c=e.mapKsPath;if(void 0!==c&&null!==c&&(this._loadTexture(c,this.uniforms.mapKs,this.uniforms.mapKsUsed,this.uniforms.mapKsPath,this.uniforms.mapKsWidth,this.uniforms.mapKsHeight),this.description.mapKsPath=c),e.specularOn){var f=o.a.getFloatStringPair(e.specularOn);f&&(this.uniforms.specularOn.value=f.f,this.description.specularOn=f.s)}if(e.specularPercentage){var h=o.a.getFloatStringPair(e.specularPercentage);h&&(this.uniforms.specularPercentage.value=h.f,this.description.specularPercentage=h.s)}}}},{key:"setAmbientTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKa,this.uniforms.mapKaUsed,this.uniforms.mapKaPath,this.uniforms.mapKaWidth,this.uniforms.mapKaHeight),this.description.mapKaPath=e}},{key:"setAmbientColor",value:function(e){this.uniforms.ka.value=e.slice(0,3),this.description.ka=e.slice(0,3)}},{key:"setAmbientPercentage",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.ambientPercentage.value=t.f,this.description.ambientPercentage=t.s)}},{key:"setDiffuseTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=e}},{key:"setDiffuseColor",value:function(e){this.uniforms.kd.value=e.slice(0,3),this.description.kd=e.slice(0,3)}},{key:"setDiffuseState",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.diffuseOn.value=t.f,this.description.diffuseOn=t.s)}},{key:"setDiffusePercentage",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.diffusePercentage.value=t.f,this.description.diffusePercentage=t.s)}},{key:"setSpecularTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKs,this.uniforms.mapKsUsed,this.uniforms.mapKsPath,this.uniforms.mapKsWidth,this.uniforms.mapKsHeight),this.description.mapKsPath=e}},{key:"setSpecularColor",value:function(e){this.uniforms.ks.value=e.slice(0,3),this.description.ks=e.slice(0,3)}},{key:"setSpecularState",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.specularOn.value=t.f,this.description.specularOn=t.s)}},{key:"setSpecularShininess",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}},{key:"setSpecularPercentage",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.specularPercentage.value=t.f,this.description.specularPercentage=t.s)}},{key:"getAmbient",value:function(){return{color:this.array2Hex(this.uniforms.ka.value),textureUsed:this.uniforms.mapKaUsed.value,texturePath:this.uniforms.mapKaPath.value,percentage:this.uniforms.ambientPercentage.value}}},{key:"getDiffuse",value:function(){return{state:this.uniforms.diffuseOn.value,color:this.array2Hex(this.uniforms.kd.value),textureUsed:this.uniforms.mapKdUsed.value,texturePath:this.uniforms.mapKdPath.value,percentage:this.uniforms.diffusePercentage.value}}},{key:"getSpecular",value:function(){return{state:this.uniforms.specularOn.value,color:this.array2Hex(this.uniforms.ks.value),textureUsed:this.uniforms.mapKsUsed.value,texturePath:this.uniforms.mapKsPath.value,percentage:this.uniforms.specularPercentage.value,shininess:this.uniforms.ns.value}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"_loadTexture",value:function(e,t,r,o,a,s){if(""!==e){var l=new i.a;l.setCrossOrigin("anonymous"),l.withCredentials=!0,l.load(e,function(i){i.wrapS=n.RepeatWrapping,i.wrapT=n.RepeatWrapping,t.value=i,a&&(a.value=parseFloat(i.image.width)),s&&(s.value=parseFloat(i.image.height)),o.value=e,r.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else r.value=0}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.a=h},function(e,t,r){"use strict";var n=r(4),o=r(0),i=(r.n(o),r(5)),a=r(7);function s(e,t,r,n){return(s="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=c(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function l(e,t,r,n,o){if(!s(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=c(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}function v(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(e){var r;h(this,t),r=v(this,m(t).call(this));var n=e.pinLength,i=e.color,s=e.depthTest;r.visible=n>0,null!==t.geoCache&&void 0!==t.geoCache||(t.geoCache={});var l,u=new o.LineBasicMaterial({color:i,depthTest:s});t.geoCache.lineGeo?l=t.geoCache.lineGeo:((l=new o.Geometry).vertices.push(new o.Vector3(0,0,0),new o.Vector3(0,0,1)),l.verticesNeedUpdate=!0,t.geoCache.lineGeo=l);var c,f=new o.LineSegments(l,u);r.visible&&f.scale.set(n,n,n),r.pinLine=f,r.pinLine.renderOrder=a.a.SPRITE_PIN_RENDER_ORDER,r.add(r.pinLine),t.geoCache.pinGeo?c=t.geoCache.pinGeo:(c=new o.SphereBufferGeometry(1,32,32),t.geoCache.pinGeo=c);var p=new o.MeshBasicMaterial({color:i,depthTest:s}),d=new o.Mesh(c,p);d.position.set(0,0,n);return d.scale.set(1,1,1),r.pinHead=d,r.pinHead.renderOrder=a.a.SPRITE_PIN_RENDER_ORDER,r.add(r.pinHead),r}return y(t,o["Object3D"]),d(t,[{key:"destruct",value:function(){return this.pinHead&&(this.pinHead.material&&(this.pinHead.material.map&&this.pinHead.material.map.dispose(),this.pinHead.material.dispose()),this.remove(this.pinHead),this.pinHead=null),this.pinLine&&(this.pinLine.material&&this.pinLine.material.dispose(),this.remove(this.pinLine),this.pinLine=null),!0}},{key:"pinLength",set:function(e){this.visible=e>0,this.visible&&this.pinHead&&this.pinLine&&this.pinLine.geometry&&(this.pinHead.position.set(0,0,e),this.pinLine.scale.set(e,e,e))}},{key:"color",set:function(e){this.pinHead&&this.pinHead.material&&this.pinLine&&this.pinLine.material&&(this.pinHead.material.color=e,this.pinLine.material.color=e)}},{key:"depthTest",set:function(e){this.pinHead&&this.pinHead.material&&this.pinLine&&this.pinLine.material&&(this.pinLine.material.depthTest=e,this.pinHead.material.depthTest=e)}}]),t}();b.geoCache=null;var _=i.a.EARTH_RADIUS/5e5,w=function(e){function t(e){var r;h(this,t),(r=v(this,m(t).call(this,e)))._depthTest=!!e.depthTest&&e.depthTest,r._property.depthTest=r._depthTest,r._pinLength=void 0===e.pinLength||null===e.pinLength?0:e.pinLength,r._property.pinLength=r._pinLength,r._color=e.color?e.color:16777215,r._opacity="number"==typeof e.opacity?e.opacity:1,r._property.opacity=r._opacity,r._pinColor=e.pinColor?e.pinColor:16753920,r._property.color=r._pinColor,r._isSprite=e.isSprite||void 0===e.isSprite,r._property.isSprite=r._isSprite,r._visible=!e.visible||e.visible,r._property.visible=r._visible,r._scale=e.scale?e.scale:1,r._property.scale=r._scale,r._spriteScaleRatio=_,r._windowSizeRatio=1,r._aspectRatio=1,r._property.type="PlaneMarker",r._pivot={x:.5,y:.5},e.pivot&&"number"==typeof e.pivot.x&&"number"==typeof e.pivot.y&&(r._pivot=e.pivot);var n,i=r._pinLength,s={pinLength:i,depthTest:!0,color:r._pinColor};if(r.pin=new b(s),r.sceneNode.add(r.pin),r._isSprite){var l=new o.SpriteMaterial({map:null,color:r.color,depthTest:r._depthTest});(n=new o.Sprite(l)).center.set(r._pivot.x,r._pivot.y)}else{var u=new o.PlaneBufferGeometry(1,1);u.translate(.5-r._pivot.x,.5-r._pivot.y,0);var c=new o.MeshBasicMaterial({map:null,color:r.color,depthTest:r._depthTest,transparent:!0,side:o.DoubleSide});(n=new o.Mesh(u,c)).quaternion.setFromAxisAngle(new o.Vector3(1,0,0),Math.PI/2)}return n.position.set(0,0,i),n.scale.set(r._spriteScaleRatio*r._scale,r._spriteScaleRatio*r._scale,1),r.sprite=n,r.sprite.renderOrder=a.a.SPRITE_PIN_RENDER_ORDER,r.setContent(r.sprite),r.interactShape=r.sprite.clone(),r.fixedSize=e.fixedSize,r.sceneNode.updateMatrixWorld(),r}return y(t,n["a"]),d(t,[{key:"bindToWindowSize",value:function(e,t){this._windowSizeRatio=e/t}},{key:"animate",value:function(e){u(m(t.prototype),"animate",this).call(this,e);var r=e.camera.position;if(this.sprite&&this.fixedSize>0){var n=this.sprite.position.clone().applyMatrix4(this.sprite.matrixWorld).sub(r).length()/_/1580*this.fixedSize*this._windowSizeRatio;this.scale=n}}},{key:"destruct",value:function(){var e=!0;return this.interactable&&(this.interactable=!1),this.sprite&&(this.sprite.geometry&&this.sprite.geometry.dispose(),this.sprite.material&&(this.sprite.material.map&&this.sprite.material.map.dispose(),this.sprite.material.dispose())),this.pin&&(e=this.pin.destruct()&&e),e=this.unsetContent()&&e,e=u(m(t.prototype),"destruct",this).call(this)&&e}},{key:"setPose",value:function(e,r,n){if(u(m(t.prototype),"setPose",this).call(this,e,r,void 0),this.sprite&&n&&"number"==typeof n){if(this.sprite.scale.set(this._aspectRatio*this._spriteScaleRatio*n,this._spriteScaleRatio*n,1),this.interactShape.scale.set(this._aspectRatio*this._spriteScaleRatio*n,this._spriteScaleRatio*n,1),this.pin&&this.pin.pinHead){var o=n;this.pin.pinHead.scale.set(o,o,o)}this._scale=n,this._property.scale=n}}},{key:"isSprite",set:function(e){if(this._isSprite!==e){this._isSprite=e;var t,r=this.sprite;if(this._isSprite){var n=new o.SpriteMaterial({map:r.material.map,color:r.material.color,depthTest:r.material.depthTest,opacity:r.material.opacity});(t=new o.Sprite(n)).center.set(this._pivot.x,this._pivot.y)}else{var i=new o.PlaneBufferGeometry(1,1);i.translate(.5-this._pivot.x,.5-this._pivot.y,0);var s=new o.MeshBasicMaterial({map:r.material.map,color:r.material.color,depthTest:r.material.depthTest,transparent:!0,side:o.DoubleSide,opacity:r.material.opacity});(t=new o.Mesh(i,s)).quaternion.setFromAxisAngle(new o.Vector3(1,0,0),Math.PI/2)}t.position.copy(r.position),t.scale.copy(r.scale),this.contentHolder.remove(this.sprite),this.sprite&&(this.sprite.geometry&&this.sprite.geometry.dispose(),this.sprite.material&&(this.sprite.material.map&&this.sprite.material.map.dispose(),this.sprite.material.dispose())),this.sprite=t,this.sprite.renderOrder=a.a.SPRITE_PIN_RENDER_ORDER,this.contentHolder.add(this.sprite),this.contentHolder.updateMatrixWorld(),this.interactShape=this.sprite.clone()}},get:function(){return this._isSprite}},{key:"fixedSize",set:function(e){!0===(e=void 0!==e&&e)&&(e=200),!1!==e&&"number"!=typeof e&&(e=!1),this._fixedSize=e},get:function(){return this._fixedSize}},{key:"tagQuaternion",set:function(e){if(!this._isSprite&&this.sprite)if(e.isEuler)this.sprite.setRotationFromEuler(new o.Euler(e.x,e.y,e.z,e.order));else if(e instanceof o.Quaternion)this.sprite.setRotationFromQuaternion(e);else{var t=new o.Vector3(e.x,e.y,e.z);t.normalize(),this.sprite.rotateOnAxis(t,e.w)}}},{key:"pivot",set:function(e){var t=Object.assign({},this._pivot,e),r=t.x,n=t.y;if(this.sprite){if(this.sprite.isSprite)this.sprite.center.set(r,n),this._interactShape.center.set(r,n);else{for(var o=[-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],i=0;i<o.length;i+=3)o[i]+=.5-r,o[i+1]+=.5-n;this.sprite.geometry.attributes.position.setArray(new Float32Array(o)),this.sprite.geometry.attributes.position.needsUpdate=!0,this._interactShape.geometry.attributes.position.setArray(new Float32Array(o)),this._interactShape.geometry.attributes.position.needsUpdate=!0}this._pivot=t}},get:function(){return this._pivot}},{key:"texture",set:function(e){if(this.sprite&&this.sprite.material){this.sprite.material.map&&(this.sprite.material.map.dispose(),this.sprite.material.map=null),this.sprite.material.map=e.texture,this.sprite.material.needsUpdate=!0;var t=e.aspectRatio;this._aspectRatio=t,this.sprite.scale.set(t*this._spriteScaleRatio*this._scale,this._spriteScaleRatio*this._scale,1),this.interactShape.scale.set(t*this._spriteScaleRatio*this._scale,this._spriteScaleRatio*this._scale,1)}}},{key:"depthTest",set:function(e){this.sprite&&this.sprite.material&&(this.sprite.material.depthTest=e,this._depthTest=e,this._property.depthTest=e)},get:function(){return this._depthTest}},{key:"pinLength",set:function(e){if(!(e<0)){var t=e;this.pin&&this.sprite&&(this.pin.pinLength=t,this.sprite.position.set(0,0,t),this.interactShape.position.copy(this.sprite.position),this._pinLength=e,this._property.pinLength=e)}},get:function(){return this._pinLength}},{key:"color",set:function(e){this.sprite&&this.sprite.material&&(this.sprite.material.color=new o.Color(e)),this._color=e},get:function(){return this._color}},{key:"pinColor",set:function(e){this.pin&&this.sprite&&this.sprite.material&&(this.pin.color=new o.Color(e),this._pinColor=e,this._property.color=e)},get:function(){return this._pinColor}},{key:"opacity",set:function(e){this.sprite&&this.sprite.material&&(this.sprite.material.opacity=e),this._opacity=e},get:function(){return this._opacity}},{key:"scale",set:function(e){this.setPose(void 0,void 0,e)},get:function(){return this._scale}},{key:"visible",set:function(e){l(m(t.prototype),"visible",e,this,!0),this._visible=e,this.pin&&(this._pinLength>0?this.pin.visible=e:this.pin.visible=!1)},get:function(){return this._visible}}]),t}();t.a=w},function(e,t,r){"use strict";var n=r(17),o=r(19);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,r,n){return(l="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=f(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function u(e,t,r,n,o){if(!l(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=f(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=s(this,h(t).call(this,e)),!function(e){if(!e.text)return!1;return e.textStyle=e.textStyle||{},e.textStyle=Object.assign({},{margin:0,lineHeight:.1,align:"center",fillStyle:"rgb(255, 255, 255)",font:"normal normal 24px Arial",outlineWidth:2,outlineStyle:"black",resetCursorY:!0,trimText:!0},e.textStyle),!0}(e))return console.warn("TextTagMarker invalid init",e),s(r,void 0);return r._property.type="TextTagMarker",r._property.text=e.text,r._text=e.text,r._textStyle=e.textStyle,r._createTextTexture(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n["a"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"destruct",value:function(){return c(h(t.prototype),"destruct",this).call(this)}},{key:"_createTextTexture",value:function(){var e=Object.assign({},this._textStyle,{text:this.text}),r=new o.a(512,64);r.drawTextCooked(e),u(h(t.prototype),"texture",{texture:r.texture,aspectRatio:8},this,!0)}},{key:"text",get:function(){return this._text},set:function(e){if(e&&e.length>0){var r=Object.assign({},this._textStyle,{text:e}),n=new o.a(512,64);n.drawTextCooked(r),u(h(t.prototype),"texture",{texture:n.texture,aspectRatio:8},this,!0),this._text=e}}},{key:"textStyle",set:function(e){this._textStyle=Object.assign({},this._textStyle,e);var r=Object.assign({},this._textStyle,{text:this._text}),n=new o.a(512,64);n.drawTextCooked(r),u(h(t.prototype),"texture",{texture:n.texture,aspectRatio:8},this,!0)}}]),t}();t.a=d},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),function(e,t,r){var o=document.createElement("canvas");o.width=e,o.height=t,this.canvas=o,this.style=r||{},this.style={margin:void 0===this.style.margin?0:this.style.margin};var i=o.getContext("2d");this.context=i;var a=new n.Texture(o);this.texture=a,this.cursorY=0});o.prototype.clear=function(e){return void 0!==e?(this.context.fillStyle=e,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0,this},o.prototype.drawText=function(e,t,r,n,o){if(void 0!==o&&(this.context.font=o),void 0===t||null===t){var i=this.context.measureText(e);t=(this.canvas.width-i.width)/2}return this.context.fillStyle=n,this.context.strokeStyle="black",this.context.lineJoin="round",this.context.fillText(e,t,r),this.context.lineWidth=1,this.context.strokeText(e,t,r),this.context.fill(),this.context.stroke(),this.texture.needsUpdate=!0,this},o.prototype.drawTextCooked=function(e){var t=this,r=this.context,n=this.canvas,o=(e=e||{}).text,i={margin:void 0!==e.margin?e.margin:0,lineHeight:void 0!==e.lineHeight?e.lineHeight:.1,align:void 0!==e.align?e.align:"center",fillStyle:void 0!==e.fillStyle?e.fillStyle:"rgb(255, 255, 255)",font:void 0!==e.font?e.font:"bold 102.4px Arial",outlineWidth:void 0!==e.outlineWidth?e.outlineWidth:2,outlineStyle:void 0!==e.outlineStyle?e.outlineStyle:"black",resetCursorY:void 0===e.resetCursorY||e.resetCursorY,trimText:void 0===e.trimText||e.trimText},a=i.lineHeight,s=i.margin;i.lineHeight<1&&(a=i.lineHeight*n.height),i.margin<1&&(s=i.margin*n.height),console.assert("string"==typeof o),r.save(),r.fillStyle=i.fillStyle,r.lineJoin="round",r.font=i.font,r.textBaseline="top";var l=s+this.style.margin;i.resetCursorY||(l=this.cursorY+s);do{var u="";u=i.trimText?p(o):h(o),o=o.substr(u.length);var c=r.measureText(u),f=0;"left"===i.align?f=s+this.style.margin:"right"===i.align?f=n.width-s-c.width-this.style.margin:"center"===i.align?f=(n.width-c.width)/2:console.assert(!1),this.context.lineWidth=Math.max(1,i.outlineWidth),this.context.strokeStyle=i.outlineStyle,this.context.strokeText(u,f,l),this.context.fillText(u,f,l),l+=a}while(o.length>0&&!i.trimText);return r.restore(),this.cursorY=l,this.texture.needsUpdate=!0,this;function h(e){for(var o="",i=n.width-2*t.style.margin-2*s;o.length!==e.length;){if(r.measureText(o).width>i)break;o+=e.substr(o.length,1)}return o}function p(e){var o="",i=n.width-2*t.style.margin-2*s;if(r.measureText(e).width<i)return e.substr(0,e.length);var a=e.length-1;o=e.substr(0,a)+" ...";for(var l=r.measureText(o).width;a>0&&l>3*i;)a/=2,o=e.substr(0,a)+" ...",l=r.measureText(o).width;for(;a>0&&l>i;)a-=1,o=e.substr(0,a)+" ...",l=r.measureText(o).width;return o}},o.prototype.drawImage=function(){return this.context.drawImage.apply(this.context,arguments),this.texture.needsUpdate=!0,this},o.prototype.drawRectangle=function(e,t,r,n,o){return o={outlineWidth:(o=o||{}).outlineWidth||2,outlineStyle:o.outlineStyle||"rgb(0, 0, 0)",fillStyle:o.fillStyle||null},this.context.save(),null!==o.fillStyle&&(this.context.fillStyle=o.fillStyle,this.context.fillRect(e,t,r,n)),o.outlineWidth>0&&(this.context.strokeStyle=o.outlineStyle,this.context.lineWidth=o.outlineWidth,this.context.strokeRect(e,t,r,n)),this.context.restore(),this.texture.needsUpdate=!0,this},o.prototype.drawCircle=function(e,t,r,n){return n={outlineWidth:void 0===(n=n||{}).outlineWidth?2:2*n.outlineWidth,outlineStyle:void 0===n.outlineStyle?"rgb(0, 0, 0)":n.outlineStyle,fillStyle:void 0===n.fillStyle?null:n.fillStyle},this.context.save(),this.context.arc(e,t,r,0,2*Math.PI),n.outlineWidth>0&&(this.context.strokeStyle=n.outlineStyle,this.context.lineWidth=n.outlineWidth,this.context.stroke()),null!==n.fillStyle&&(this.context.fillStyle=n.fillStyle,this.context.fill()),this.context.restore(),this.texture.needsUpdate=!0,this},t.a=o},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(33)),i=r(21);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=h(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function c(e,t,r,n){return(c="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=h(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function f(e,t,r,n,o){if(!c(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=e.volume;if(!function(){var t=!0;if(!(t=t&&void 0===e.scale))return console.error("PolygonMarker should not be scaled, used lng lat directly."),t;try{i=Object.assign({},{height:100,color:16711680,opacity:.1},i)}catch(e){console.error("PolygonMarker init defaults failed.",i),t=!1}(t=t&&"number"==typeof i.top)||console.error("PolygonMarker top must be a number",i.top);(t=t&&"number"==typeof i.bottom)||console.error("PolygonMarker bottom must be a number",i.top);return t}())return console.error("PolygonMarker construction failed."),l(r,void 0);var a=!e.depthTest||e.depthTest;(r=l(this,p(t).call(this,e)))._top=i.top,r._bottom=i.bottom,r._depthTest=a;var s=new o.a(r.extrudeMesh.geometry),u=new n.LineSegments(s,new n.LineBasicMaterial({color:i.color,linewidth:2,depthTest:a}));return r.extrudeLine=u,r.setDecoration(r.extrudeLine),r._color=i.color,r._property.type="PolygonMarker",r._property.volume=i,r._property.name=e.name,r._property.depthTest=r._depthTest,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i["a"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"destruct",value:function(){return this.interactable&&(this.interactable=!1),this.unsetContent(),this.extrudeLine&&(this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.material&&this.extrudeLine.material.dispose()),u(p(t.prototype),"destruct",this).call(this)}},{key:"depthTest",set:function(e){this._depthTest=e,this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.depthTest=this._depthTest),this.extrudeLine&&this.extrudeLine.material&&(this.extrudeLine.material.depthTest=this._depthTest)},get:function(){return this._depthTest}},{key:"color",set:function(e){var t=new n.Color(e);this.extrudeMesh.material.color=t,this.extrudeMesh.material.needsUpdate=!0,this.extrudeLine.material.color=t,this.extrudeLine.material.needsUpdate=!0,this._property.volume.color=e},get:function(){return this.extrudeMesh.material.color}},{key:"opacity",set:function(e){return"number"!=typeof e?(console.warn("wrong opacity type"),!1):(e=Math.min(1,Math.max(0,e)),this.extrudeMesh.material.opacity=e,this.extrudeMesh.material.needsUpdate=!0,this._property.volume.opacity=e,!0)},get:function(){return this.extrudeMesh.material.opacity}},{key:"top",set:function(e){"number"==typeof e?(f(p(t.prototype),"top",e,this,!0),this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new o.a(this.extrudeMesh.geometry),this._top=e,this._property.volume.top=this._top):console.warn("PolygonMarker setter top: input can only be a number",e)},get:function(){return this._top}},{key:"bottom",set:function(e){"number"==typeof e?(f(p(t.prototype),"bottom",e,this,!0),this.extrudeLine.geometry&&this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new o.a(this.extrudeMesh.geometry),this._bottom=e,this._property.volume.bottom=this._bottom):console.warn("PolygonMarker setter bottom: input can only be a number",e)},get:function(){return this._bottom}}]),t}();t.a=v},function(e,t,r){"use strict";var n=r(4),o=r(6),i=r(2),a=r(0);r.n(a);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!function(e){var t=!0;void 0!==e.scale&&(console.error("PolygonBaseMarker should not be scaled, use lng lat directly."),t=!1);var r=e.volume.points;r[0].array||(r=[{array:r,hole:!1}],e.volume.points=r);for(var n=0,o=0;o<r.length;++o)r[o].hole||(n+=1);1!==n&&(console.error("PolygonBaseMarker points must have one and only one outer points array that is not hole"),t=!1);for(var i=0;i<r.length;++i){var a=r[i].array;if(a.length<4){console.error("PolygonBaseMarker needs at least 4 points",r,i),t=!1;break}if(!a[0].equals(a[a.length-1])){console.error("PolygonBaseMarker points are not closed. (first and last points should be equal)",r,i),t=!1;break}}var s=e.volume.top;if(Array.isArray(s)){Array.isArray(s[0])||(s=[s],e.volume.top=s);for(var l=0;l<r.length;++l){var u=r[l].array;if(s[l].length!==u.length-1){console.error("PolygonBaseMarker top array must be of length ",u.length-1,s),t=!1;break}}}var c=e.volume.bottom;if(Array.isArray(c)){Array.isArray(c[0])||(c=[c],e.volume.bottom=c);for(var f=0;f<r.length;++f){var h=r[f].array;if(c[f].length!==h.length-1){console.error("PolygonBaseMarker bottom array must be of length ",h.length-1,c),t=!1;break}}}return t}(e))return u(r,void 0);var n=e.volume,s=n.points,l=void 0===e.depthTest||null===e.depthTest||e.depthTest;n=Object.assign({},{top:1,bottom:0,hasTopCover:!0,hasBottomCover:!0,color:16777215,opacity:.1},n);var c=function(){for(var e,t=0;t<s.length;++t)if(!s[t].hole){e=s[t];break}for(var r=new o.a(0,0,0),u=0;u<e.array.length;++u)r.lng+=e.array[u].lng,r.lat+=e.array[u].lat;r.lng/=e.array.length,r.lat/=e.array.length;for(var c=i.a.getLocalSystemOnEarthSurface(void 0,r.lng,r.lat,void 0),f=new a.ShapePath,h=[],p=0;p<s.length;++p){for(var d=s[p],v=[],m=0;m<d.array.length;++m){var y=i.a.geographicToEarthSurface(void 0,d.array[m].lng,d.array[m].lat,void 0),g=y.clone().sub(c.origin),b=1*g.dot(c.lng),_=1*g.dot(c.lat),w=1*g.dot(c.alt);v.push(new a.Vector3(b,_,w))}for(var x=0;x<v.length-1;x++)h.push(v[x].x),h.push(v[x].y);var k=a.ShapeUtils.isClockWise(v);(k&&!d.hole||!k&&d.hole)&&v.reverse(),f.moveTo(v[0].x,v[0].y);for(var O=1;O<v.length;O++)f.lineTo(v[O].x,v[O].y)}h=new Float32Array(h);for(var P=f.toShapes(!0),A={steps:1,depth:1,bevelEnabled:!1},S=new a.ExtrudeGeometry(P[0],A),M=1;M<P.length;++M){var T=P[M];S.addShape(T,A)}var E={top:{},bottom:{}},C=S.vertices,j=Math.floor(S.vertices.length/2),R=S.vertices.length,L={top:{},bottom:{}};function I(e,t,r){var n=Math.round(e.x*t);n=Math.floor(n/r);var o=Math.round(e.y*t);return o=Math.floor(o/r),n+"_"+o}for(var D=0;D<j;++D){var z=I(C[D],1e4,10);L.bottom[z]=D}for(var N=j;N<R;++N){var B=I(C[N],1e4,10);L.top[B]=N}for(var U=0;U<h.length/2;++U){var F=2*U,V=I({x:h[F],y:h[F+1]},1e4,10);E.top[U]=L.top[V],E.bottom[U]=L.bottom[V]}if("number"==typeof n.top){for(var H=j;H<R;++H)C[H].z=n.top;S.verticesNeedUpdate=!0}else if(Array.isArray(n.top)){for(var W=0,G=0;G<n.top.length;++G)for(var K=0;K<n.top[G].length;++K){var X=E.top[W];W+=1,C[X].z=n.top[G][K]}S.verticesNeedUpdate=!0}if("number"==typeof n.bottom){for(var Y=0;Y<j;++Y)C[Y].z=n.bottom;S.verticesNeedUpdate=!0}else if(Array.isArray(n.bottom)){for(var q=0,Z=0;Z<n.bottom.length;++Z)for(var Q=0;Q<n.bottom[Z].length;++Q){var J=E.bottom[q];q+=1,C[J].z=n.bottom[Z][Q]}S.verticesNeedUpdate=!0}for(var $=0,ee=0;ee<s.length;++ee)$+=s[ee].array.length-1;$*=2;var te=(S.faces.length-$)/2,re=S.faces.slice(0,te),ne=S.faces.slice(te,2*te),oe=S.faces.slice(2*te),ie=S.faceVertexUvs[0].slice(0,te),ae=S.faceVertexUvs[0].slice(te,2*te),se=S.faceVertexUvs[0].slice(2*te),le={faces:ne,uvs:ae},ue={faces:re,uvs:ie},ce={faces:oe,uvs:se};n.hasTopCover||(S.faces.splice(te,te),S.elementsNeedUpdate=!0,S.faceVertexUvs[0].splice(te,te),S.uvsNeedUpdate=!0);n.hasBottomCover||(S.faces.splice(0,te),S.elementsNeedUpdate=!0,S.faceVertexUvs[0].splice(0,te),S.uvsNeedUpdate=!0);var fe=new a.MeshBasicMaterial({color:n.color,transparent:!0,opacity:n.opacity,depthWrite:!0,side:a.DoubleSide,depthTest:l});return{mesh:new a.Mesh(S,fe),center:r,topCover:le,bottomCover:ue,otherCover:ce,verticesIndexMapping:E,system:c}}();e.position=c.center,(r=u(this,f(t).call(this,e)))._points=n.points;for(var h=0;h<r._points.length;++h)if(!r._points[h].hole){r.boundaryPts=r._points[h].array;break}return r._depthTest=l,r._color=n.color,r._opactiy=n.opacity,r._top=n.top,r._bottom=n.bottom,r._hasTopCover=n.hasTopCover,r._hasBottomCover=n.hasBottomCover,r._verticesIndexMapping=c.verticesIndexMapping,r.system=c.system,r.extrudeMesh=c.mesh,r.setContent(r.extrudeMesh),r.interactShape=r.extrudeMesh.clone(),r.topCover=c.topCover,r.bottomCover=c.bottomCover,r.otherCover=c.otherCover,r._property.depthTest=l,r._property.volume=n,r._property.type="PolygonBaseMarker",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"destruct",value:function(){return this.interactable&&(this.interactable=!1),this.unsetContent(),this.extrudeMesh&&(this.extrudeMesh.geometry&&this.extrudeMesh.geometry.dispose(),this.extrudeMesh.material&&this.extrudeMesh.material.dispose()),c(f(t.prototype),"destruct",this).call(this)}},{key:"color",set:function(e){var t=new a.Color(e);this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.color=t,this._color=e,this._property.volume.color=e)},get:function(){return this._color}},{key:"depthTest",set:function(e){this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.depthTest=e,this._depthTest=e,this._property.depthTest=e)},get:function(){return this._depthTest}},{key:"opacity",set:function(e){this.extrudeMesh&&this.extrudeMesh.material&&(this.extrudeMesh.material.opacity=e,this._opactiy=e,this._property.volume.opacity=e)},get:function(){return this._opactiy}},{key:"top",set:function(e){if("number"==typeof e){for(var t=this.extrudeMesh.geometry.vertices,r=Math.floor(t.length/2);r<t.length;++r)t[r].z=e;this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._top=e,this._property.volume.top=this._top}else if(Array.isArray(e)){Array.isArray(e)&&(Array.isArray(e[0])||(e=[e]));for(var n=this.extrudeMesh.geometry.vertices,o=0,i=0;i<e.length;++i)for(var a=0;a<e[i].length;++a){var s=this._verticesIndexMapping.top[o];o+=1,n[s]&&(n[s].z=e[i][a])}this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._top=e,this._property.volume.top=this._top}else console.warn("PolygonBaseMarker setter top invalid value, either be a number or an array")},get:function(){return this._top}},{key:"bottom",set:function(e){if("number"==typeof e){for(var t=this.extrudeMesh.geometry.vertices,r=0;r<Math.floor(t.length/2);++r)t[r].z=e;this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._bottom=e,this._property.volume.bottom=this._bottom}else if(Array.isArray(e)){Array.isArray(e)&&(Array.isArray(e[0])||(e=[e]));for(var n=this.extrudeMesh.geometry.vertices,o=0,i=0;i<e.length;++i)for(var a=0;a<e[i].length;++a){var s=this._verticesIndexMapping.top[o];o+=1,n[s]&&(n[s].z=e[i][a])}this.extrudeMesh.geometry.verticesNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone(),this._bottom=e,this._property.volume.bottom=this._bottom}else console.warn("PolygonBaseMarker setter bottom invalid value, either be a number or an array of length "+(this._points.length-1),e)},get:function(){return this._bottom}},{key:"hasTopCover",set:function(e){if(e!==this._hasTopCover){this._hasTopCover=!this._hasTopCover;var t=[],r=[];this._hasBottomCover&&(t=t.concat(this.bottomCover.faces),r=r.concat(this.bottomCover.uvs)),this._hasTopCover&&(t=t.concat(this.topCover.faces),r=r.concat(this.topCover.uvs)),t=t.concat(this.otherCover.faces),r=r.concat(this.otherCover.uvs),this.extrudeMesh.geometry.faces=t,this.extrudeMesh.geometry.faceVertexUvs[0]=r,this.extrudeMesh.geometry.elementsNeedUpdate=!0,this.extrudeMesh.geometry.uvsNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone()}},get:function(){return this._hasTopCover}},{key:"hasBottomCover",set:function(e){if(e!==this._hasBottomCover){this._hasBottomCover=!this._hasBottomCover;var t=[],r=[];this._hasBottomCover&&(t=t.concat(this.bottomCover.faces),r=r.concat(this.bottomCover.uvs)),this._hasTopCover&&(t=t.concat(this.topCover.faces),r=r.concat(this.topCover.uvs)),t=t.concat(this.otherCover.faces),r=r.concat(this.otherCover.uvs),this.extrudeMesh.geometry.faces=t,this.extrudeMesh.geometry.faceVertexUvs[0]=r,this.extrudeMesh.geometry.elementsNeedUpdate=!0,this.extrudeMesh.geometry.uvsNeedUpdate=!0,this.interactShape.geometry.dispose(),this.interactShape.geometry=this.extrudeMesh.geometry.clone()}},get:function(){return this._hasBottomCover}}]),t}();t.a=p},function(e,t,r){"use strict";r.d(t,"a",function(){return g});var n=r(4),o=r(6),i=r(0),a=(r.n(i),r(19)),s=r(2);function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&f(e.prototype,t),r&&f(e,r),e}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(e){var r;return c(this,t),(r=p(this,d(t).call(this)))._labelOptions=[],r._textOptions=e.textOptions,r}return v(t,i["Object3D"]),h(t,[{key:"addNewLabel",value:function(e,t){if(this._labelOptions.push(e),t){var r=new i.Sprite(new i.SpriteMaterial({map:null,color:16777215,depthTest:!1})),n=new a.a(e.width,e.height),o=Object.assign({},this._textOptions,{text:e.text});n=n.drawTextCooked(o),r.material.map=n.texture,r.position.copy(e.positionxyz),r.scale.set(e.scale.x,e.scale.y,e.scale.z),this.add(r)}}},{key:"drawOnLabel",value:function(e,t){var r=this.children[e];if(this._labelOptions[e]=Object.assign({},this._labelOptions[e],t),r){if(t.positionxyz&&r.position.copy(t.positionxyz),t.text&&t.width&&t.height){var n=new a.a(t.width,t.height),o=Object.assign({},this._textOptions,{text:t.text});n=n.drawTextCooked(o),r.material.map.dispose(),r.material.map=n.texture}t.scale&&r.scale.set(t.scale.x,t.scale.y,t.scale.z)}}},{key:"constructAllLabels",value:function(){if(this.children.length<this._labelOptions.length)for(var e=this.children.length;e<this._labelOptions.length;++e){var t=this._labelOptions[e],r=new i.Sprite(new i.SpriteMaterial({map:null,color:16777215,depthTest:!1})),n=new a.a(t.width,t.height),o=Object.assign({},this._textOptions,{text:t.text});n=n.drawTextCooked(o),r.material.map=n.texture,r.position.copy(t.positionxyz),r.scale.set(t.scale.x,t.scale.y,t.scale.z),this.add(r)}}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.material&&(t.material.map&&t.material.map.dispose(),t.material.dispose()),this.remove(t)}return!0}},{key:"textOptions",set:function(e){this._textOptions=Object.assign({},this._textOptions,e);for(var t=0;t<this.children.length;++t){var r=this.children[t],n=this._labelOptions[t],o=new a.a(n.width,n.height),i=Object.assign({},this._textOptions,{text:n.text});o=o.drawTextCooked(i),r.material.map.dispose(),r.material.map=o.texture,r.position.copy(n.positionxyz),r.scale.set(n.scale.x,n.scale.y,n.scale.z)}}}]),t}(),g=function(e){function t(e){var r;if(c(this,t),!function(e){return!(!e||!e.earth&&!e.sandbox)&&(null!==e.points&&void 0!==e.points&&e.points instanceof Array?!(e.points.length<2)||(console.warn("[PolyBaseLineMarker] cannot be constructed due to no enough points",e.points),!1):(console.warn("[PolyBaseLineMarker] no usable points!",e),!1))}(e))return console.warn("[PolyBaseLineMarker] invalid markerOptions!",e),p(r,void 0);var n=new i.Vector3(0,0,0),a=e.points.map(function(e){var t=s.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0);return n.add(t),t});n.multiplyScalar(1/a.length);var l=s.a.getLngLatAltFromNoneGroundCartesian(void 0,n,void 0);e.position=new o.a(l.lng,l.lat,0),(r=p(this,d(t).call(this,e)))._points=e.points,r._lineWidth=e.lineWidth?e.lineWidth:1,r._color=e.color?e.color:16777215,r._depthTest=void 0===e.depthTest||e.depthTest,r._property.points=r._points,r._property.lineWidth=r._lineWidth,r._property.color=r._color,r._property.depthTest=r._depthTest;e.textOptions=e.textOptions||{},r._labelsVisible=void 0!==e.labelsVisible&&e.labelsVisible,r._textOptions=Object.assign({},{margin:0,lineHeight:.1,align:"center",fillStyle:"red",font:"bold 60px Times New Roman",outlineWidth:2,outlineStyle:"black",resetCursorY:!0,trimText:!0},e.textOptions),r._property.labelsVisible=r._labelsVisible,r._property.textOptions=r._textOptions,r._calculateSystem(),r._pointsxyz=r._points.map(function(e){return r._convertPointToXYZPoint(e)}),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=void 0,r.labelHolder=new y({textOptions:r._textOptions}),r.contentHolder.add(r.labelHolder),r.labelHolder.visible=r._labelsVisible;for(var u=0;u<r._points.length-1;++u){var f=r._constructLabelOptions(u,u+1);r.labelHolder.addNewLabel(f,r._labelsVisible)}r._labelScaleFunc=function(e){return 1},r._property.labelScaleFunc=r._labelScaleFunc.toString();var h=r.position,v={lng:h.lng,lat:h.lat,alt:h.alt+1},m=r._convertPointToXYZPoint(h),g=r._convertPointToXYZPoint(v);return r._unitAltVector=g.clone().sub(m),r._property.type="PolyBaseLineMarker",r}return v(t,n["a"]),h(t,[{key:"_calculateSystem",value:function(){this.system=s.a.getLocalSystemOnEarthSurface(void 0,this.position.lng,this.position.lat,void 0)}},{key:"_convertPointToXYZPoint",value:function(e){null!==this.system&&void 0!==this.system||this._calculateSystem();var t=s.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0).clone().sub(this.system.origin),r=1*t.dot(this.system.lng),n=1*t.dot(this.system.lat),o=1*t.dot(this.system.alt);return new i.Vector3(r,n,o)}},{key:"_distanceText",value:function(e){return(Math.round(100*e)/100).toString()+" m"}},{key:"_constructLineOptions",value:function(e,t){return{}}},{key:"_constructPointOptions",value:function(e){return{}}},{key:"_constructLabelOptions",value:function(e,t){var r={},n=this._points[e],o=this._points[t],i=this.earth.calculateDistanceBetweenTwoPoints(n,o),a="";i>=.01&&(a=this._distanceText(i)),r.text=a;var s=64*a.length+64,l=Math.log(s)/Math.log(2);l=Math.floor(l)+1,s=Math.pow(2,l);r.width=s,r.height=128;var u=this._pointsxyz[e],c=this._pointsxyz[t];r.positionxyz=u.clone().add(c).multiplyScalar(.5);return r.scale={x:10*s/128,y:10,z:1},r}},{key:"_constructInteractShapeGeometry",value:function(){return new i.Geometry}},{key:"addPoint",value:function(e){this._points.push(e),this._pointsxyz.push(this._convertPointToXYZPoint(e));var t=this._constructLabelOptions(this.pointsNumber-2,this.pointsNumber-1);this.labelHolder.addNewLabel(t,this._labelsVisible)}},{key:"setPoint",value:function(e,t){(e<0||e>=this._points.length)&&console.warn("[PolyCylinderLineMarker] setPoint index out of boundary",e,t),this._points[e]=t,this._pointsxyz[e]=this._convertPointToXYZPoint(t);var r=this;function n(e){var t=r._constructLabelOptions(e,e+1);r.labelHolder.drawOnLabel(e,t)}0!==e&&n(e-1),e!==this.pointsNumber-1&&n(e)}},{key:"destruct",value:function(){var e=!0;return this.labelHolder&&(e=this.labelHolder.destruct()&&e),e=l(d(t.prototype),"destruct",this).call(this)&&e}},{key:"points",get:function(){return this._points}},{key:"pointsNumber",get:function(){return this._points.length}},{key:"color",set:function(e){this._color=e,this._property.color=e},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e},get:function(){return this._depthTest}},{key:"labelsVisible",set:function(e){this._labelsVisible=e,this._property.labelsVisible=e,this.labelHolder.visible=this._labelsVisible,this._labelsVisible&&this.labelHolder.constructAllLabels()},get:function(){return this._labelsVisible}},{key:"textOptions",set:function(e){this._textOptions=Object.assign({},this._textOptions,e),this._property.textOptions=e,this.labelHolder.textOptions=this._textOptions},get:function(){return this._textOptions}},{key:"labelScaleFunc",set:function(e){"function"==typeof e&&"number"==typeof e(1)&&(this._labelScaleFunc=e,this._property.labelScaleFunc=e.toString())},get:function(){return this._labelScaleFunc}},{key:"length",get:function(){for(var e=0,t=0;t<this._points.length-1;++t)e+=this.earth.calculateDistanceBetweenTwoPoints(this._points[t],this._points[t+1]);return e}}]),t}()},function(e,t,r){"use strict";var n=r(4),o=r(2),i=r(5),a=r(0);r.n(a);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.camToEarth){var n=y(e.camToEarth),l=n.position,c=n.orientation;e.position=l,e.orientation=c}(r=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?u(e):t}(this,f(t).call(this,e))).setPose(),r._showNear=void 0===e.showNear||e.showNear,r._showFar=void 0!==e.showFar&&e.showFar,r._color=void 0===e.color?new a.Color(16711680):new a.Color(e.color);var h=i.a.EARTH_RADIUS/i.a.scale,p={fov:45,nearInMeter:1e-5*h,farInMeter:.01*h,aspect:1,visColor:r._color.getHex(),visIntensity:1,visPenumbra:.05,visDecay:1},d=Object.assign({},p,e);r._fov=d.fov,r.zoom=1,void 0!==d.near?r._near=d.near*h:void 0!==d.nearInMeter&&(r._near=d.nearInMeter),void 0!==d.far?r._far=d.far*h:void 0!==d.farInMeter&&(r._far=d.farInMeter),r._aspect=d.aspect,r.view=null,r.visColor=d.visColor,r.visIntensity=d.visIntensity,r.visPenumbra=d.visPenumbra,r.visDecay=d.visDecay,r._projectionMatrix=new a.Matrix4;var v=u(r),m=function(){var e=new a.ShaderMaterial({uniforms:{color:{value:new a.Color(16777215)},opacity:{value:1}},vertexShader:"attribute vec3 vertexcolor;varying vec3 vVertexcolor;attribute float alpha;varying float vAlpha;attribute float power;varying float vPower;\n#include <logdepthbuf_pars_vertex>\nvoid main(){vec3 transformed = vec3( position );vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );gl_Position = projectionMatrix * mvPosition;vVertexcolor=vertexcolor;vAlpha=alpha;vPower=power;\n#include <logdepthbuf_vertex>}",fragmentShader:"varying vec3 vVertexcolor;varying float vAlpha;varying float vPower;uniform vec3 color;uniform float opacity;\n#include <logdepthbuf_pars_fragment>\nvoid main(){\n#include <logdepthbuf_fragment>\nfloat colorAlpha=pow(vAlpha,vPower);gl_FragColor=vec4(color,opacity)*vec4(vVertexcolor,colorAlpha);}",blending:a.AdditiveBlending,depthTest:!0,transparent:!0}),t={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},r={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},n={vertices:[],colors:[],alphas:[],powers:[],pointMap:{}},o=new a.Color(16755200),i=v._color,s=new a.Color(43775),l=new a.Color(16777215),u=new a.Color(3355443);function c(e,t,r,n,o,i,a,s){f(e,t,n,o,a),f(e,r,n,i,s)}function f(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.vertices.push(0,0,0),e.colors.push(r.r,r.g,r.b),e.alphas.push(n),e.powers.push(o),void 0===e.pointMap[t]&&(e.pointMap[t]=[]),e.pointMap[t].push(e.vertices.length/3-1)}c(r,"n1","n2",o),c(r,"n2","n4",o),c(r,"n4","n3",o),c(r,"n3","n1",o),c(r,"cn1","cn2",u),c(r,"cn3","cn4",u),c(n,"f1","f2",o),c(n,"f2","f4",o),c(n,"f4","f3",o),c(n,"f3","f1",o),c(n,"cf1","cf2",u),c(n,"cf3","cf4",u),c(t,"p","n1",i),c(t,"p","n2",i),c(t,"p","n3",i),c(t,"p","n4",i),c(t,"n1","f1",o,1,0),c(t,"n2","f2",o,1,0),c(t,"n3","f3",o,1,0),c(t,"n4","f4",o,1,0),c(t,"u1","u2",s),c(t,"u2","u3",s),c(t,"u3","u1",s),c(n,"c","t",l),c(t,"p","c",u);var h=new a.BufferGeometry;h.addAttribute("position",new a.Float32BufferAttribute(t.vertices,3)),h.addAttribute("vertexcolor",new a.Float32BufferAttribute(t.colors,3)),h.addAttribute("alpha",new a.Float32BufferAttribute(t.alphas,1)),h.addAttribute("power",new a.Float32BufferAttribute(t.powers,1));var p=new a.BufferGeometry;p.addAttribute("position",new a.Float32BufferAttribute(r.vertices,3)),p.addAttribute("vertexcolor",new a.Float32BufferAttribute(r.colors,3)),p.addAttribute("alpha",new a.Float32BufferAttribute(r.alphas,1)),p.addAttribute("power",new a.Float32BufferAttribute(r.powers,1));var d=new a.BufferGeometry;d.addAttribute("position",new a.Float32BufferAttribute(r.vertices,3)),d.addAttribute("vertexcolor",new a.Float32BufferAttribute(r.colors,3)),d.addAttribute("alpha",new a.Float32BufferAttribute(r.alphas,1)),d.addAttribute("power",new a.Float32BufferAttribute(r.powers,1));var m=new a.LineSegments(h,e);m.name="camera frame";var y=new a.LineSegments(p,e),g=new a.LineSegments(d,e);v._otherPointMap=t.pointMap,v._nearPointMap=r.pointMap,v._farPointMap=n.pointMap;var b=function(e){var t=[].concat([0,0,0,0]).concat([0,0,0,0]).concat(e).concat(e),r=new a.DataTexture(new Uint8Array(t),2,2,a.RGBAFormat,a.UnsignedByteType,a.UVMapping);return r.needsUpdate=!0,r.minFilter=r.magFilter=a.LinearFilter,r}([255,255,255,255]);var _=new a.MeshBasicMaterial({color:i,transparent:!0,opacity:.5,side:a.DoubleSide,alphaMap:b}),w=new a.Geometry;w.vertices.push(new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0),new a.Vector3(0,0,0)),w.faces.push(new a.Face3(0,1,2),new a.Face3(0,2,4),new a.Face3(0,4,3),new a.Face3(0,3,1)),w.faceVertexUvs[0]=[[new a.Vector2(.5,1),new a.Vector2(0,0),new a.Vector2(1,0)],[new a.Vector2(.5,1),new a.Vector2(0,0),new a.Vector2(1,0)],[new a.Vector2(.5,1),new a.Vector2(0,0),new a.Vector2(1,0)],[new a.Vector2(.5,1),new a.Vector2(0,0),new a.Vector2(1,0)]];var x=new a.Mesh(w,_);return{otherLines:m,nearLines:y,farLines:g,nearCone:x}}();function y(e){var t=new a.Matrix4;t.elements=e;var r=new a.Vector3,n=new a.Quaternion,i=new a.Vector3;t.clone().decompose(r,n,i);var s=o.a.getLngLatAltFromNoneGroundCartesian(void 0,r,void 0),l=s.lng,u=s.lat,c=s.alt,f=o.a.getLocalSystemOnEarthSurface(void 0,l,u,void 0),h=new a.Matrix4;h.makeBasis(f.lng,f.lat,f.alt),h.setPosition(r);var p=t.clone();return(new a.Matrix4).getInverse(h).clone().multiply(p).clone().decompose(r,n,i),{position:{lng:l,lat:u,alt:c},orientation:n.normalize(),scale:new a.Vector3(1,1,1)}}return r._otherLines=m.otherLines,r._nearLines=m.nearLines,r._farLines=m.farLines,r.contentHolder.add(r._otherLines),r.contentHolder.add(r._nearLines),r.contentHolder.add(r._farLines),r._matrixToMarkerPose=y,r._nearCone=m.nearCone,r.decoHolder.add(r._nearCone),r.interactShape=new a.Mesh(r._nearCone.geometry,new a.MeshBasicMaterial({side:a.DoubleSide})),r.updateProjectionMatrix(),r.updateShape(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"updateShape",value:function(){var e=new a.Camera;e.projectionMatrix.copy(this._projectionMatrix);var t=this._otherLines.geometry,r=this._otherPointMap,n=this._nearLines.geometry,o=this._nearPointMap,i=this._farLines.geometry,s=this._farPointMap,l=new a.Vector3;function u(e,a,l,u){c(t,r,e,a,l,u),c(n,o,e,a,l,u),c(i,s,e,a,l,u)}function c(t,r,n,o,i,a){l.set(o,i,a).unproject(e);var s=r[n];if(void 0!==s)for(var u=t.getAttribute("position"),c=0,f=s.length;c<f;c++)u.setXYZ(s[c],l.x,l.y,l.z)}function f(e,t,r){var n=t[r];if(void 0!==n){var o=e.getAttribute("position");return new a.Vector3(o.getX(n[0]),o.getY(n[0]),o.getZ(n[0]))}return null}u("c",0,0,-1),u("t",0,0,1),u("n1",-1,-1,-1),u("n2",1,-1,-1),u("n3",-1,1,-1),u("n4",1,1,-1),u("f1",-1,-1,1),u("f2",1,-1,1),u("f3",-1,1,1),u("f4",1,1,1),u("u1",.7,1.1,-1),u("u2",-.7,1.1,-1),u("u3",0,2,-1),u("cf1",-1,0,1),u("cf2",1,0,1),u("cf3",0,-1,1),u("cf4",0,1,1),u("cn1",-1,0,-1),u("cn2",1,0,-1),u("cn3",0,-1,-1),u("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0,n.getAttribute("position").needsUpdate=!0,i.getAttribute("position").needsUpdate=!0,this._nearLines.visible=this._showNear,this._farLines.visible=this._showFar;var h=this._nearCone.geometry;h.vertices[0].copy(f(t,r,"p")),h.vertices[1].copy(f(t,r,"n1")),h.vertices[2].copy(f(t,r,"n2")),h.vertices[3].copy(f(t,r,"n3")),h.vertices[4].copy(f(t,r,"n4")),h.verticesNeedUpdate=!0}},{key:"updateProjectionMatrix",value:function(){var e=this._near,t=e*Math.tan(Math.PI/180*.5*this.fov)/this.zoom,r=2*t,n=this.aspect*r,o=-.5*n,i=this.view,a=this._far;if(this._showFar||(a=2*e),null!==this.view&&this.view.enabled){var s=i.fullWidth,l=i.fullHeight;o+=i.offsetX*n/s,t-=i.offsetY*r/l,n*=i.width/s,r*=i.height/l}this._projectionMatrix.makePerspective(o,o+n,t,t-r,e,a)}},{key:"setPose",value:function(e,r,n){c(f(t.prototype),"setPose",this).call(this,e,r,n);var i=(new a.Matrix4).compose(new a.Vector3,this.shapeHolder.quaternion.clone(),this.shapeHolder.scale.clone()),s=this.position,l=s.lng,u=s.lat,h=s.alt,p=o.a.getLocalSystemOnEarthSurface(void 0,l,u,void 0),d=o.a.getNoneGroundCartesianFromLngLatAlt(void 0,l,u,h,void 0),v=new a.Matrix4;v.makeBasis(p.lng,p.lat,p.alt),v.setPosition(d),this._camToEarth=v.multiply(i).elements,this._updateSpotLight()}},{key:"lookAt",value:function(e){var t=o.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0),r=this.camToEarth,n=new a.Vector3(r[12],r[13],r[14]),i=o.a.getLocalSystemOnEarthSurface(void 0,e.lng,e.lat,void 0).alt,s=(new a.Matrix4).setPosition(n).lookAt(n,t,i);this.camToEarth=s.elements;var l=1*t.clone().sub(n).length();this.farInMeter=l}},{key:"bindSpotLight",value:function(e){this._spotLight=e,this.setPose()}},{key:"unbindSpotLight",value:function(){this._spotLight=void 0}},{key:"_updateSpotLight",value:function(){if(!this._spotLight)return!1;var e=new a.Matrix4;e.elements=this.camToEarth;var t=(new a.Vector3).setFromMatrixPosition(e),r=new a.Vector3(0,0,-1).applyMatrix4(e);return this._spotLight.setPose({position:t,target:r}),this._spotLight.color.setHex(this.visColor),this._spotLight.intensity=this.visIntensity,this._spotLight.penumbra=this.visPenumbra,this._spotLight.distance=this.far,this._spotLight.angle=Math.max(10,this.fov-10)/180*Math.PI,this._spotLight.decay=this.visDecay,!0}},{key:"camToEarth",set:function(e){this._camToEarth=e;var t=this._matrixToMarkerPose(e),r=t.position,n=t.orientation;this.setPose(r,n)},get:function(){return this._camToEarth}},{key:"fov",set:function(e){this._fov=e,this.updateProjectionMatrix(),this.updateShape(),this._updateSpotLight()},get:function(){return this._fov}},{key:"aspect",set:function(e){this._aspect=e,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._aspect}},{key:"near",set:function(e){this._near=e*i.a.EARTH_RADIUS/i.a.scale,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._near/i.a.EARTH_RADIUS*i.a.scale}},{key:"nearInMeter",set:function(e){var t=e/i.a.EARTH_RADIUS*i.a.scale;this.near=t},get:function(){return this.near/i.a.scale*i.a.EARTH_RADIUS}},{key:"far",set:function(e){this._far=e*i.a.EARTH_RADIUS/i.a.scale,this.updateProjectionMatrix(),this.updateShape(),this._updateSpotLight()},get:function(){return this._far/i.a.EARTH_RADIUS*i.a.scale}},{key:"farInMeter",set:function(e){var t=e/i.a.EARTH_RADIUS*i.a.scale;this.far=t},get:function(){return this.far/i.a.scale*i.a.EARTH_RADIUS}},{key:"showNear",set:function(e){this._showNear=e,this._nearLines.visible=e},get:function(){return this._showNear}},{key:"showFar",set:function(e){this._showFar=e,this._farLines.visible=e,this.updateProjectionMatrix(),this.updateShape()},get:function(){return this._showFar}},{key:"color",set:function(e){var t=new a.Color(e);this._color=t,this._nearCone.material.color=t;for(var r=this._otherLines.geometry.getAttribute("vertexcolor"),n=0;n<8;++n)r.setXYZ(n,t.r,t.g,t.b);r.needsUpdate=!0},get:function(){return this._color}},{key:"visColor",set:function(e){this.__visColor=e,this._updateSpotLight()},get:function(){return this.__visColor?this.__visColor:this.color.getHex()}},{key:"visIntensity",set:function(e){this.__visIntensity=e,this._updateSpotLight()},get:function(){return void 0!==this.__visIntensity?this.__visIntensity:3}},{key:"visPenumbra",set:function(e){this.__visPenumbra=e,this._updateSpotLight()},get:function(){return void 0!==this.__visPenumbra?this.__visPenumbra:.05}},{key:"visDecay",set:function(e){this.__visDecay=e,this._updateSpotLight()},get:function(){return void 0!==this.__visDecay?this.__visDecay:1}}]),t}();t.a=p},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),r(57)),i=r(2),a=r(72),s=r(30),l=r(0);r.n(l);function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=n.SessionEnv.env.ISMOBILE,f=function(){function e(t,r){var i=r.HOST,u=r.api,f=r.camera,h=r.renderItems,p=void 0===h?{}:h,d=r.eventHandlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var v=p.planet,m=p.background,y=p.quality;m=Object.assign({},{transparent:!1,opacity:1,color:2565927},m),y=void 0!==y?y:60;var g="function"==typeof v||"string"==typeof v?v:null;v=void 0!==v?v:{},void 0!==p.earthUseTexture&&void 0===v.showPlanetTexture&&(v.showPlanetTexture=p.earthUseTexture),void 0!==p.orbitRing&&void 0===v.showOrbitRing&&(v.showOrbitRing=p.orbitRing),(p.earth||v.visible)&&(v.visible=!0),!1!==p.earth&&!1!==v.visible||(v.visible=!1),p.skyBox&&(v.skyBoxProperties=p.skyBox),v=Object.assign({},{visible:!0,showPlanetTexture:!0,showOrbitRing:!1,showDem:!1,showPlanetWireframe:!1,showGroundCloud:!0,mapMaxLevel:c?10:16},v),g&&(v.wmtsTileURL=new n.EarthWmtsTileURL("engine-init-map",g));var b={planet:v,background:m,quality:y};f&&f.poseTo&&console.error("renderItems.camera.poseTo deprecated"),f&&f.flyTo&&console.error("renderItems.camera.flyTo deprecated"),f&&f.center&&(f.poseTo=f.center),f&&f.flyToCenter&&(f.flyTo=f.flyToCenter),this.earthView=new n.EarthViewer(t,{HOST:i,api:u,camera:f,renderItems:b,eventHandlers:d});var _=new l.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!1,alpha:!1,premultipliedAlpha:!1});_.context.getExtension("OES_standard_derivatives"),_.name="Measurement renderer",this.snapshoter=Object(s.a)(_),this._measurementRenderer=_;var w=this;w.earthView.layers.marker=new o.a({parent:w.sceneRoot,quality:p.quality,forest:w.earthView.forest}),w.earthView.layers.marker.sceneNode.name="marker layer sceneNode",this.materialManager=new a.a}return function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(e,[{key:"destruct",value:function(){return this._measurementRenderer.dispose(),this._measurementRenderer.forceContextLoss(),this._measurementRenderer.context=null,this._measurementRenderer.domElement=null,this._measurementRenderer=null,this.snapshoter.destruct(),this.earthView.destruct()}},{key:"freeze",value:function(){return this.earthView.control.enabled=!1,!0}},{key:"unfreeze",value:function(){return this.earthView.control.enabled=!0,!0}},{key:"addAltizureProjects",value:function(e){return this.earthView.addAltizureProjects(e)}},{key:"pick",value:function(e){var t=0,r=0;return e.changedTouches?(t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY):(t=e.x,r=e.y),this.earthView.control.pickEarthContactPoint({rawX:t,rawY:r})}},{key:"pickByPose",value:function(e){return this.earthView.control.pickEarthContactPointByPose(e)}},{key:"pickOnProjects",value:function(e){var t={rawX:0,rawY:0};e.changedTouches?(t.rawX=e.changedTouches[0].pageX,t.rawY=e.changedTouches[0].pageY):(t.rawX=e.x,t.rawY=e.y);var r=this.earthView.control.pickProjectContactPoint(t,"marker");return r||(r=this.earthView.control.pickProjectContactPoint(t)),r}},{key:"pickOnProjectsByPose",value:function(e){var t=this.earthView.control.pickProjectContactPointByPose(e,"marker");return t||(t=this.earthView.control.pickProjectContactPointByPose(e)),t}},{key:"calculateDistanceBetweenTwoPoints",value:function(e,t){var r={lng:(e.lng+t.lng)/2,lat:(e.lat+t.lat)/2,alt:0},n=i.a.getLocalSystemOnEarthSurface(void 0,r.lng,r.lat,void 0),o=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0).clone().sub(n.origin),a=1*o.dot(n.lng),s=1*o.dot(n.lat),l=1*o.dot(n.alt),u=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,t.lng,t.lat,t.alt,void 0).clone().sub(n.origin),c=a-1*u.dot(n.lng),f=s-1*u.dot(n.lat),h=l-1*u.dot(n.alt);return Math.sqrt(c*c+f*f+h*h)}},{key:"lngLatAlt2XYZ",value:function(e){return i.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0).clone().applyMatrix4(this.markerLayer.matrixWorld)}},{key:"markerSnapshot",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:512,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;(e.length<2||void 0===r.length||r.length<1)&&console.error("[markerSnapshot] arguments not sufficient");var a={max:{lat:e[0].lat,lng:e[0].lng},min:{lat:e[0].lat,lng:e[0].lng}};e.map(function(e){e.lat>a.max.lat&&(a.max.lat=e.lat),e.lng>a.max.lng&&(a.max.lng=e.lng),e.lat<a.min.lat&&(a.min.lat=e.lat),e.lng<a.min.lng&&(a.min.lng=e.lng)});var s={lat:(a.max.lat+a.min.lat)/2,lng:(a.max.lng+a.min.lng)/2,alt:t.min},u=Object.assign({},s,{alt:t.max}),c={lat:a.max.lat,lng:(a.max.lng+a.min.lng)/2,alt:t.min},f={lat:(a.max.lat+a.min.lat)/2,lng:a.max.lng,alt:t.min};s=this.lngLatAlt2XYZ(s),u=this.lngLatAlt2XYZ(u),c=this.lngLatAlt2XYZ(c),f=this.lngLatAlt2XYZ(f);var h=(u=u.clone().add(s.clone().negate())).length(),p=c.clone().add(s.clone().negate()),d=f.clone().add(s.clone().negate()),v=d.length(),m=p.length(),y=new l.OrthographicCamera;y.left=-v,y.right=v,y.top=m,y.bottom=-m;var g=s.clone().add(u.clone().multiplyScalar(2)),b=new l.Matrix4;b.lookAt(g,s,p.clone().normalize()),y.position.copy(g),y.quaternion.setFromRotationMatrix(b),y.near=h,y.far=2*h,y.updateProjectionMatrix();var _=(t.max-t.min)/h,w=m/v,x=w>=1?{width:o,height:Math.round(o/w)}:{width:Math.round(w*o),height:o},k={dimension:{width:x.width,height:x.height},resolution:4*d.length()*p.length()*_*_/(x.width*x.height),resolutionwidth:2*d.length()*_/x.width,resolutionheight:2*p.length()*_/x.height,bbox:a};return k.buffer=n?this.snapshoter.renderDepthSnapshot(y,r,x.width,x.height,i):this.snapshoter.renderColorSnapshot(y,r,x.width,x.height),k}},{key:"generateMask",value:function(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,o=[],i={},a=0;a<r.length;++a){var s=r[a].interactShape.clone();s.material=new l.MeshBasicMaterial({color:a+1,transparent:!1}),s.visible=!0,s.matrix.copy(r[a].interactShape.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale),o.push(s),i[a+1]=r[a]}for(var u=this.markerSnapshot(e,t,o,!1,n),c=0;c<o.length;++c){var f=o[c];f&&f.material&&f.material.dispose()}return{mask:u,mapping:i}}},{key:"earthToScene",value:function(){return this.markerLayer.matrixWorld.clone()}},{key:"renderItems",get:function(){return this.earthView.renderItems}},{key:"scene",get:function(){return this.earthView.scene}},{key:"enableDolly",set:function(e){this.earthView.control.enabledDolly=e}},{key:"sceneRoot",get:function(){return this.earthView.ecefNode}},{key:"markerLayer",get:function(){return this.earthView.layers.marker}},{key:"viewerCamera",get:function(){return this.earthView.camera}},{key:"domElement",get:function(){return this.earthView.renderer.domElement}},{key:"renderer",get:function(){return this.earthView.renderer}}]),e}();t.a=f},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t,r){"use strict";var n=r(3),o=r(44),i=r(46),a=r(47),s=r(48),l=r(27);e.exports=function(e){return new Promise(function(t,u){var c=e.data,f=e.headers;n.isFormData(c)&&delete f["Content-Type"];var h=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",d=e.auth.password||"";f.Authorization="Basic "+btoa(p+":"+d)}if(h.open(e.method.toUpperCase(),i(e.url,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,h.onreadystatechange=function(){if(h&&4===h.readyState&&(0!==h.status||h.responseURL&&0===h.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in h?a(h.getAllResponseHeaders()):null,n={data:e.responseType&&"text"!==e.responseType?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:r,config:e,request:h};o(t,u,n),h=null}},h.onerror=function(){u(l("Network Error",e,null,h)),h=null},h.ontimeout=function(){u(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",h)),h=null},n.isStandardBrowserEnv()){var v=r(49),m=(e.withCredentials||s(e.url))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;m&&(f[e.xsrfHeaderName]=m)}if("setRequestHeader"in h&&n.forEach(f,function(e,t){void 0===c&&"content-type"===t.toLowerCase()?delete f[t]:h.setRequestHeader(t,e)}),e.withCredentials&&(h.withCredentials=!0),e.responseType)try{h.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&h.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){h&&(h.abort(),u(e),h=null)}),void 0===c&&(c=null),h.send(c)})}},function(e,t,r){"use strict";var n=r(45);e.exports=function(e,t,r,o,i){var a=new Error(e);return n(a,t,r,o,i)}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,r){"use strict";var n=r(1);r.n(n);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c,f=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=a(this,l(t).call(this,e))).name="SDKOfflineRendererClass",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,n["OfflineRendererClass"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"renderDepthSnapshot",value:function(e,r,n,o){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=s(l(t.prototype),"renderDepthSnapshot",this).call(this,e,r,n,o),u=0;u<a.length;++u)a[u]=255*a[u];return i>0&&function(e,t,r,n,o){for(var i=0;i<t;++i)for(var a=0;a<r;++a){for(var s=[],l=0;l<n;++l)for(var u=0;u<o;++u){var c=(u+a)*t+l+i;c>=0&&c<e.length&&s.push(e[c])}s.length===n*o&&(s.sort(function(e,t){return e-t}),e[a*t+i]=s[Math.floor(s.length/2)])}}(a,n,o,i,i),a}}]),t}();t.a=function(e){if(void 0===e){if(void 0!==c)return c;console.error("init offline renderer error: should provide renderer")}else c=new f(e);return c}},function(e,t,r){"use strict";var n=r(4),o=r(77),i=r(0),a=(r.n(i),r(81));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?c(e):t}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);e.autoScale=void 0!==e.autoScale?e.autoScale:4,e.autoScale=!0===e.autoScale?4:e.autoScale,e.autoScale=!1===e.autoScale?0:e.autoScale;var n=c(r=u(this,h(t).call(this,e)));if(n.initialized=new Promise(function(e,t){n._onContentLoaded=e,n._onContentFail=t}),!function(){if(!e||!e.shape||!e.objUrl)return console.error("OBJMarker missing arguments",e),!1;n._property.type="OBJMarker",n._property.shape=e.shape,n._property.objUrl=e.objUrl,n._property.mtlUrl=e.mtlUrl,n._property.upDir=e.upDir,n._property.scale=e.scale,e.upDir||(e.upDir={x:0,y:0,z:1});e.scale||(e.scale=1);return!0}())return u(r,void 0);for(var s=[],l=0;l<r._property.materialDescriptions.length;++l){var f=r._property.materialDescriptions[l],p=new(0,r.earth.materialManager.materials[f.type.toLowerCase()])(f);s.push(p)}if(null===t.objCache&&(t.objCache=new a.a),null===t.loading&&(t.loading={}),void 0!==e.shape){var d=e.shape;if("CUSTOMIZE"===d&&void 0!==e.objUrl){var v=e.objUrl,m=e.mtlUrl||"",y={objUrl:v,mtlUrl:m,upDir:function(e){return new i.Vector3(e.x,e.y,e.z)}(e.upDir),scale:e.scale,clickable:e.clickable,autoScale:e.autoScale},g=t.objCache.get(v,null);if(!g||e.isRollOver){var b=function(){var e=new i.MeshLambertMaterial({color:16711680,transparent:!0,opacity:.5}),t=new i.Mesh(new i.ConeGeometry(.2,1.6,20),e);t.rotateX(-Math.PI/2);var r=new i.MeshLambertMaterial({color:16711680,wireframe:!0}),n=new i.Mesh(new i.RingGeometry(.35,.4,32),r);n.translateZ(-.75);var o=new i.Group;o.add(t),o.add(n);var a=new i.Group;a.add(o);var s=new i.Matrix4;s.makeTranslation(0,0,.8),a.applyMatrix(s);return s.makeScale(4,4,4),a.applyMatrix(s),a}(),_=t.loading[v];_?_.push({marker:c(r),mtls:s}):(t.loading[v]=[],Object(o.a)(y).then(function(r){t.objCache.set(v,r),t.loading[v].map(function(e){var r=e.marker,o=e.mtls;r.unsetContent();var i=t.objCache.get(v,null);r._putContent(i,o),r._onContentLoaded(n)}),t.loading[v]=null,e.isRollOver&&r.children[0].children.map(function(e){e.material.color=new i.Color(1,0,0),e.material.wireframe=!0}),n.unsetContent(),n._putContent(r,s),n._onContentLoaded(n)}).catch(function(t){e.errHandler&&e.errHandler(t),console.error("addMTLOBJ err",t)})),n._putContent(b,s)}else n._putContent(g,s),n._onContentLoaded(n)}else"CUSTOMIZE"===d&&(console.error("OBJ url is requred"),n._onContentFail(n))}else console.error("OBJ load failed"),n._onContentFail(n);return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n["a"]),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"destruct",value:function(){return this.interactable&&(this.interactable=!1),f(h(t.prototype),"unsetContent",this).call(this),f(h(t.prototype),"destruct",this).call(this)}},{key:"_putContent",value:function(e,t){var r=this;this.setContent(e),t.map(function(e){r.changeMaterial(e)}),this._updateMaterialDescriptions()}},{key:"_onContentLoaded",value:function(){}},{key:"_onContentFail",value:function(){}},{key:"_updateMaterialDescriptions",value:function(){var e=this;this.contentHolder.traverse(function(t){if("Mesh"===t.type){var r=t.material.description;if(null!==r&&void 0!==r){for(var n=!1,o=0;o<e._property.materialDescriptions.length;++o)e._property.materialDescriptions[o].name===r.name&&(e._property.materialDescriptions[o]=r,n=!0);n||e._property.materialDescriptions.push(r)}}})}},{key:"setBboxColor",value:function(e){var t=this.decoHolder.children[0].material.color.clone();return this.decoHolder.children[0].material.color.copy(e),t}},{key:"setContent",value:function(e){return!!function(e){var t=e instanceof i.Object3D;t||console.warn("Marker: unknown content type",e);return t}(e)&&(this.contentHolder.add(e),e.objSpaceBBox&&(this.decoHolder.add(e.objSpaceBBox),this.interactShape=e.objSpaceBBox.clone(),this.interactShape.geometry=e.objSpaceBBox.geometry.clone()),!0)}},{key:"objToLayer",value:function(){var e=(new i.Matrix4).multiply(this.matrix).multiply(this.shapeHolder.matrix).multiply(this.contentHolder.matrix),t=this.contentHolder.children[0];if(!t)return e;var r=t.children[0];return r?e.multiply(t.matrix).multiply(r.matrix):e}},{key:"objToShapeHolder",value:function(){var e=this.contentHolder.matrix.clone(),t=this.contentHolder.children[0];if(!t)return e;var r=t.children[0];return r?e.multiply(t.matrix).multiply(r.matrix):e}},{key:"objToScene",value:function(){this.contentHolder.updateMatrixWorld(!0);var e=this.contentHolder.children[0];if(!e)return this.contentHolder.matrixWorld.clone();var t=e.children[0];return t?(t.updateMatrixWorld(!0),t.matrixWorld.clone()):this.contentHolder.matrixWorld.clone()}},{key:"bboxColor",set:function(e){this.decoHolder.children[0].material.color.copy(new i.Color(e))},get:function(){return this.decoHolder.children[0].material.color}}]),t}();d.objCache=null,d.loading=null,t.a=d},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(17)),i=r(8);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r,n){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=h(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function c(e,t,r,n,o){if(!u(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=h(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,p(t).call(this,e)))._property.type="TagMarker",r._property.imgUrl=e.imgUrl,null!==t.textureCache&&void 0!==t.textureCache||(t.textureCache={}),r._addTag(e.imgUrl),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o["a"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"destruct",value:function(){var e=f(p(t.prototype),"destruct",this).call(this);return t.clearAllImgTextureCache(),t.textureCache=null,e}},{key:"_addTag",value:function(e,r,o){var a=this,s=this;if(t.ImgTextureCacheExist(e)){var l=t.getImgTextureFromCache(e);l.minFilter=l.magFilter=n.LinearFilter,l.needsUpdate=!0,c(p(t.prototype),"texture",{texture:l,aspectRatio:l.image.width/l.image.height},this,!0),s.imgUrl=e,r&&r()}else{var u=new i.a;u.setCrossOrigin("anonymous"),u.withCredentials=!0,u.load(e,function(o){o.minFilter=o.magFilter=n.LinearFilter,o.needsUpdate=!0,c(p(t.prototype),"texture",{texture:o,aspectRatio:o.image.width/o.image.height},a,!0),s.imgUrl=e,t.cacheImgTexture(s.imgUrl,o),r&&r()},function(e){},function(r){console.warn("an error happened while loading "+e);var i=[0,0,0,0],l=[255,0,0,255],u=[];u=(u=(u=u.concat(l).concat(i).concat(l)).concat(i).concat(l).concat(i)).concat(l).concat(i).concat(l);var f=new n.DataTexture(new Uint8Array(u),3,3,n.RGBAFormat,n.UnsignedByteType,n.UVMapping);f.minFilter=f.magFilter=n.LinearFilter,f.needsUpdate=!0,c(p(t.prototype),"texture",{texture:f,aspectRatio:f.image.width/f.image.height},a,!0);s.imgUrl="TagMarkerTexture404",t.cacheImgTexture("TagMarkerTexture404",f),s._property.imgUrl="TagMarkerTexture404",o&&o()})}}},{key:"texture",set:function(e){this.textureAsync={data:e,onSuccess:void 0,onFail:void 0}},get:function(){return this.imgUrl}},{key:"textureAsync",set:function(e){var r=this,o=e.data,a=e.onSuccess,s=e.onFail,l=this;if(t.ImgTextureCacheExist(o)){var u=t.getImgTextureFromCache(o);c(p(t.prototype),"texture",{texture:u,aspectRatio:u.image.width/u.image.height},this,!0),l.imgUrl=o,l._property.imgUrl=o,a&&a()}else{var f=new i.a;f.setCrossOrigin("anonymous"),f.withCredentials=!0,f.load(o,function(e){e.minFilter=n.LinearFilter,e.magFilter=n.LinearFilter,e.needsUpdate=!0,c(p(t.prototype),"texture",{texture:e,aspectRatio:e.image.width/e.image.height},r,!0),l.imgUrl=o,t.cacheImgTexture(o,e),l._property.imgUrl=o,a&&a()},function(e){},function(e){console.warn("an error happened while loading "+o),s&&s()})}},get:function(){return this.imgUrl}}],[{key:"ImgTextureCacheExist",value:function(e){return!!t.textureCache&&(null!==t.textureCache[e]&&void 0!==t.textureCache[e])}},{key:"getImgTextureFromCache",value:function(e){return t.ImgTextureCacheExist(e)?t.textureCache[e]:null}},{key:"cacheImgTexture",value:function(e,r){null!==t.textureCache&&void 0!==t.textureCache||(t.textureCache={}),t.textureCache[e]=r}},{key:"clearAllImgTextureCache",value:function(){for(var e in t.textureCache)t.textureCache[e]&&t.textureCache[e].dispose();t.textureCache={}}}]),t}();v.textureCache=null,t.a=v},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e,t){n.BufferGeometry.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var r,o,i=[],a=Math.cos(4/180*Math.PI),s=[0,0],l={},u=["a","b","c"];e.isBufferGeometry?(o=new n.Geometry).fromBufferGeometry(e):o=e.clone(),o.computeFaceNormals();for(var c=o.vertices,f=o.faces,h=0,p=f.length;h<p;h++)for(var d=f[h],v=0;v<3;v++)s[0]=d[u[v]],s[1]=d[u[(v+1)%3]],s.sort(b),void 0===l[r=s.toString()]?l[r]={index1:s[0],index2:s[1],face1:h,face2:void 0}:l[r].face2=h;for(r in l){var m=l[r];if(void 0===m.face2||f[m.face1].normal.dot(f[m.face2].normal)<=a){var y=c[m.index1];i.push(y.x,y.y,y.z),y=c[m.index2],i.push(y.x,y.y,y.z)}}var g=new Float32Array(i);function b(e,t){return e-t}this.addAttribute("position",new n.BufferAttribute(g,3))}o.prototype=Object.create(n.BufferGeometry.prototype),o.prototype.constructor=o,t.a=o},function(e,t,r){"use strict";var n=r(20),o=r(2),i=r(6),a=r(33),s=r(0);r.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=e.position,a=o.a.getLocalSystemOnEarthSurface(void 0,n.lng,n.lat,void 0),s=a.origin,l=e.radius,u=l,h=a.lng.clone().normalize().multiplyScalar(u),p=a.lat.clone().normalize().multiplyScalar(u),d=e.sided,v=[],m=0;m<d;++m){var y=2*Math.PI*m/d,g=p.clone().multiplyScalar(Math.cos(y)).add(h.clone().multiplyScalar(Math.sin(y))),b=s.clone().add(g),_=o.a.getLngLatAltFromNoneGroundCartesian(void 0,b,void 0),w=new i.a(_.lng,_.lat,_.alt);v.push(w)}v.push(v[0]);var x={top:e.top,bottom:e.bottom,opacity:e.opacity,color:e.color,points:v};return e.volume=x,(r=c(this,f(t).call(this,e)))._sided=d,r._radius=l,r._property.type="RegularPolygonMarker",r._property.sided=r._sided,r._property.radius=r._radius,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(t,[{key:"radius",set:function(e){var t=e/this._radius;this._radius=e,this._property.radius=this._radius,this.extrudeMesh.geometry.applyMatrix((new s.Matrix4).makeScale(t,t,1)),this.extrudeLine.geometry.applyMatrix((new s.Matrix4).makeScale(t,t,1));var r=this,n=function(){for(var e=r._radius,t=r.system,n=t.origin,a=t.lng.clone().normalize().multiplyScalar(e),s=t.lat.clone().normalize().multiplyScalar(e),l=[],u=0;u<r._sided;u++){var c=2*Math.PI*u/r._sided,f=s.clone().multiplyScalar(Math.cos(c)).add(a.clone().multiplyScalar(Math.sin(c))),h=n.clone().add(f),p=o.a.getLngLatAltFromNoneGroundCartesian(void 0,h,void 0),d=new i.a(p.lng,p.lat,p.alt);l.push(d)}return l.push(new i.a(l[0].lng,l[0].lat,l[0].alt)),l}();this._points[0].array=n,this.boundaryPts=n},get:function(){return this._radius}},{key:"sided",set:function(e){this._sided=e,this._property.sided=this._sided;var t=this,r=function(){for(var e=t._radius,r=t.system,n=r.origin,a=r.lng.clone().normalize().multiplyScalar(e),l=r.lat.clone().normalize().multiplyScalar(e),u=[],c=[],f=0;f<t._sided;f++){var h=2*Math.PI*f/t._sided,p=l.clone().multiplyScalar(Math.cos(h)).add(a.clone().multiplyScalar(Math.sin(h))),d=1*p.dot(r.lng),v=1*p.dot(r.lat),m=p.dot(r.alt);u.push(new s.Vector3(d,v,m));var y=n.clone().add(p.clone()),g=o.a.getLngLatAltFromNoneGroundCartesian(void 0,y,void 0),b=new i.a(g.lng,g.lat,g.alt);c.push(b)}u.push(u[0].clone()),c.push(new i.a(c[0].lng,c[0].lat,c[0].alt));var _=new s.Shape;_.moveTo(u[0].x,u[0].y);for(var w=1;w<u.length;w++)_.lineTo(u[w].x,u[w].y);var x=new s.ExtrudeGeometry(_,{steps:1,depth:1,bevelEnabled:!1}),k={top:{},bottom:{}},O=x.vertices,P=Math.floor(x.vertices.length/2),A=x.vertices.length,S=Math.pow(10,3),M={top:{},bottom:{}};function T(e){return Math.round(e.x*S)+"_"+Math.round(e.y*S)}for(var E=0;E<P;++E){var C=T(O[E]);M.bottom[C]=E}for(var j=P;j<A;++j){var R=T(O[j]);M.top[R]=j}for(var L=0;L<u.length-1;++L){var I=T(u[L]);k.top[L]=M.top[I],k.bottom[L]=M.bottom[I]}for(var D=P;D<A;++D)O[D].z=t._top;for(var z=0;z<P;++z)O[z].z=t._bottom;x.verticesNeedUpdate=!0;var N=u.length-3,B=x.faces.slice(0,N),U=x.faces.slice(N,2*N),F=x.faces.slice(2*N),V=x.faceVertexUvs[0].slice(0,N),H=x.faceVertexUvs[0].slice(N,2*N),W=x.faceVertexUvs[0].slice(2*N),G={faces:U,uvs:H},K={faces:B,uvs:V},X={faces:F,uvs:W};t._hasTopCover||(x.faces.splice(N,N),x.elementsNeedUpdate=!0,x.faceVertexUvs[0].splice(N,N),x.uvsNeedUpdate=!0);t._hasBottomCover||(x.faces.splice(0,N),x.elementsNeedUpdate=!0,x.faceVertexUvs[0].splice(0,N),x.uvsNeedUpdate=!0);return{geometry:x,topCover:G,bottomCover:K,otherCover:X,verticesIndexMapping:k,points:c}}();this._verticesIndexMapping=r.verticesIndexMapping,this.topCover=r.topCover,this.bottomCover=r.bottomCover,this.otherCover=r.otherCover,this._points[0].array=r.points,this.boundaryPts=r.points,this.extrudeMesh.geometry.dispose(),this.extrudeMesh.geometry=r.geometry,this.extrudeLine.geometry.dispose(),this.extrudeLine.geometry=new a.a(r.geometry),this.interactShape.geometry.dispose(),this.interactShape.geometry=r.geometry},get:function(){return this._sided}}]),t}();t.a=p},function(e,t,r){"use strict";var n=r(22),o=r(0),i=(r.n(o),r(7));function a(e,t,r,n){return(a="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=u(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function s(e,t,r,n,o){if(!a(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=u(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var r;return f(this,t),(r=d(this,v(t).call(this)))._lineMaterial=new o.MeshBasicMaterial({color:e.color,depthTest:e.depthTest,side:o.DoubleSide,opacity:e.opacity,transparent:!0}),r._unitCylinderLineGeometry=e.unitCylinderLineGeometry,r._scaledLineWidth=e.lineWidth,r._lineOptions=[],r}return m(t,o["Object3D"]),p(t,[{key:"addNewLine",value:function(e){this._lineOptions.push(e);var t=this._unitCylinderLineGeometry,r=new o.Mesh(t,this._lineMaterial);r.applyMatrix((new o.Matrix4).makeScale(this._scaledLineWidth,e.distance,this._scaledLineWidth));var n=new o.Matrix4;n.makeBasis(e.system.x,e.system.y,e.system.z),n.setPosition(e.system.origin),r.applyMatrix(n),r.renderOrder=i.a.POLYLINE_RENDER_ORDER,this.add(r)}},{key:"updateLine",value:function(e,t){this._lineOptions[e]=t;var r=this.children[e];r.matrix.identity(),r.applyMatrix((new o.Matrix4).makeScale(this._scaledLineWidth,t.distance,this._scaledLineWidth));var n=new o.Matrix4;n.makeBasis(t.system.x,t.system.y,t.system.z),n.setPosition(t.system.origin),r.applyMatrix(n)}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose()}return this._lineMaterial.dispose(),this._lineOptions=[],!0}},{key:"lineWidth",set:function(e){this._scaledLineWidth=e;for(var t=0;t<this.children.length;++t){var r=this.children[t],n=this._lineOptions[t];r.matrix.identity(),r.applyMatrix((new o.Matrix4).makeScale(this._scaledLineWidth,n.distance,this._scaledLineWidth));var i=new o.Matrix4;i.makeBasis(n.system.x,n.system.y,n.system.z),i.setPosition(n.system.origin),r.applyMatrix(i)}}},{key:"opacity",set:function(e){this._lineMaterial.opacity=e}},{key:"depthTest",set:function(e){this._lineMaterial.depthTest=e}},{key:"color",set:function(e){this._lineMaterial.color=e}}]),t}(),b=function(e){function t(e){var r;return f(this,t),(r=d(this,v(t).call(this)))._pointMaterial=new o.MeshBasicMaterial({color:e.color,depthTest:e.depthTest,side:o.DoubleSide,opacity:e.opacity,transparent:!0}),r._unitSpherePointGeometry=e.unitSpherePointGeometry,r._scaledLineWidth=e.lineWidth,r._pointOptions=[],r}return m(t,o["Object3D"]),p(t,[{key:"addNewPoint",value:function(e){this._pointOptions.push(e);var t=this._unitSpherePointGeometry,r=new o.Mesh(t,this._pointMaterial);r.applyMatrix((new o.Matrix4).makeScale(this._scaledLineWidth,this._scaledLineWidth,this._scaledLineWidth)),r.position.copy(e.positionxyz),r.renderOrder=i.a.POLYLINE_RENDER_ORDER,this.add(r)}},{key:"updatePoint",value:function(e,t){this._pointOptions[e]=t,this.children[e].position.copy(t.positionxyz)}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose()}return this._pointMaterial.dispose(),this._pointOptions=[],!0}},{key:"lineWidth",set:function(e){this._scaledLineWidth=e;for(var t=0;t<this.children.length;++t){var r=this.children[t],n=this._pointOptions[t];r.matrix.identity(),r.applyMatrix((new o.Matrix4).makeScale(this._scaledLineWidth,this._scaledLineWidth,this._scaledLineWidth)),r.position.copy(n.positionxyz)}}},{key:"opacity",set:function(e){this._pointMaterial.opacity=e}},{key:"depthTest",set:function(e){this._pointMaterial.depthTest=e}},{key:"color",set:function(e){this._pointMaterial.color=e}}]),t}(),_=function(e){function t(e){var r;f(this,t);var n=!0;e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE&&(n=!1),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=!0,(r=d(this,v(t).call(this,e)))._opacity="number"==typeof e.opacity?e.opacity:1,r._property.opacity=r._opacity,r._labelScaleFunc=function(e){return 1/(Math.abs(e)+.005)},r._property.labelScaleFunc=r._labelScaleFunc.toString(),r._labelScale=10*r._labelScaleFunc(r._lineWidth);for(var i=0;i<r.labelHolder._labelOptions.length;++i){var a=r.labelHolder._labelOptions[i],s={x:a.width/a.height*r._labelScale,y:r._labelScale,z:1};r.labelHolder.drawOnLabel(i,{scale:s})}if(n){r.lineHolder=new g({color:r._color,opacity:r._opacity,depthTest:r._depthTest,lineWidth:r._lineWidth,unitCylinderLineGeometry:t.cache.unitCylinderLineGeometry}),r.pointHolder=new b({color:r._color,opacity:r._opacity,depthTest:r._depthTest,lineWidth:r._lineWidth,unitSpherePointGeometry:t.cache.unitSpherePointGeometry}),r.contentHolder.add(r.lineHolder),r.contentHolder.add(r.pointHolder);for(var l=0;l<r._points.length-1;l+=1){var u=r._constructLineOptions(l,l+1);r.lineHolder.addNewLine(u)}for(var c=0;c<r._points.length;++c){var h=r._constructPointOptions(c);r.pointHolder.addNewPoint(h)}var p=r._constructInteractShapeGeometry(),m=new o.Mesh(p,new o.MeshBasicMaterial({side:o.DoubleSide}));r.interactShape=m}return r._property.type="PolyCylinderLineMarker",r}return m(t,n["a"]),p(t,[{key:"_constructLineOptions",value:function(e,r){var n=Object.assign({},l(v(t.prototype),"_constructLineOptions",this).call(this,e,r)),o=this._pointsxyz[e],i=this._pointsxyz[r],a=o.clone().add(i).multiplyScalar(.5),s={};return s.y=i.clone().add(o.clone().negate()).normalize(),s.x=this._unitAltVector.clone().normalize(),s.z=s.y.clone().cross(s.x.clone()).normalize(),s.x=s.y.clone().cross(s.z.clone()).normalize(),s.origin=a.clone(),n.system=s,n.distance=i.clone().add(o.clone().negate()).length(),n}},{key:"_constructPointOptions",value:function(e){var r=Object.assign({},l(v(t.prototype),"_constructPointOptions",this).call(this,e)),n=this._pointsxyz[e];return r.positionxyz=n,r}},{key:"_constructInteractShapeGeometry",value:function(){for(var e=l(v(t.prototype),"_constructInteractShapeGeometry",this).call(this),r=this.lineHolder._unitCylinderLineGeometry,n=this.lineHolder._scaledLineWidth,i=0;i<this._points.length-1;i+=1){var a=this.lineHolder._lineOptions[i];if(!(a.distance<=0)){var s=(new o.Matrix4).makeScale(n,a.distance,n),u=new o.Matrix4;u.makeBasis(a.system.x,a.system.y,a.system.z),u.setPosition(a.system.origin),e.merge(r,u.multiply(s))}}for(var c=this.pointHolder._unitSpherePointGeometry,f=0;f<this._points.length;f+=1){var h=this.pointHolder._pointOptions[f],p=(new o.Matrix4).makeScale(n,n,n),d=(new o.Matrix4).setPosition(h.positionxyz);e.merge(c,d.multiply(p))}return e}},{key:"_updateInteractShape",value:function(){var e=this._constructInteractShapeGeometry();this.interactShape.geometry.dispose(),this.interactShape.geometry=e}},{key:"addPoint",value:function(e){l(v(t.prototype),"addPoint",this).call(this,e);var r=this._constructLineOptions(this.pointsNumber-2,this.pointsNumber-1);this.lineHolder.addNewLine(r);var n=this._constructPointOptions(this.pointsNumber-1);this.pointHolder.addNewPoint(n);var o=this.pointsNumber-2,i=this.labelHolder._labelOptions[o],a={x:i.width/i.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(o,{scale:a}),this._updateInteractShape()}},{key:"setPoint",value:function(e,r){l(v(t.prototype),"setPoint",this).call(this,e,r);var n=this;0!==e&&(i(e-1),a(e-1,this._labelScale)),e!==this.pointsNumber-1&&(i(e),a(e,this._labelScale));var o=this._constructPointOptions(e);function i(e){var t=n._constructLineOptions(e,e+1);n.lineHolder.updateLine(e,t)}function a(e,t){var r=n.labelHolder._labelOptions[e],o={x:r.width/r.height*t,y:t,z:1};n.labelHolder.drawOnLabel(e,{scale:o})}this.pointHolder.updatePoint(e,o),this._updateInteractShape()}},{key:"destruct",value:function(){var e=!0;return e=this.lineHolder.destruct()&&e,e=this.pointHolder.destruct()&&e,e=l(v(t.prototype),"destruct",this).call(this)&&e}},{key:"lineWidth",set:function(e){this._lineWidth=e,this._property.lineWidth=e,this.lineHolder.lineWidth=this._lineWidth,this.pointHolder.lineWidth=this._lineWidth,this._labelScale=10*this._labelScaleFunc(this._lineWidth);for(var t=0;t<this.labelHolder._labelOptions.length;++t){var r=this.labelHolder._labelOptions[t],n={x:r.width/r.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(t,{scale:n})}this._updateInteractShape()},get:function(){return this._lineWidth}},{key:"labelScaleFunc",set:function(e){s(v(t.prototype),"labelScaleFunc",e,this,!0),this._labelScale=10*this._labelScaleFunc(this._lineWidth);for(var r=0;r<this.labelHolder._labelOptions.length;++r){var n=this.labelHolder._labelOptions[r],o={x:n.width/n.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(r,{scale:o})}},get:function(){return this._labelScaleFunc}},{key:"opacity",set:function(e){this._opacity=e,this._property.opacity=e,this.lineHolder.opacity=e,this.pointHolder.opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){this._color=e,this._property.color=e;var t=new o.Color(this._color);this.lineHolder.color=t,this.pointHolder.color=t},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e,this.lineHolder.depthTest=e,this.pointHolder.depthTest=e},get:function(){return this._depthTest}}]),t}();_.cache={unitCylinderLineGeometry:new o.CylinderGeometry(1,1,1,8),unitSpherePointGeometry:new o.SphereGeometry(1,8,8)},t.a=_},function(e,t,r){"use strict";r.d(t,"a",function(){return D});var n=r(22),o=r(0),i=(r.n(o),r(7)),a=r(9),s=r(8),l=r(1);r.n(l);function u(e,t,r,n){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=h(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function c(e,t,r,n,o){if(!u(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=h(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),e}function y(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w={FENCE:"fence",ARROW:"arrow"},x={LINEAR:"linear",REPEAT:"repeat"},k={HORIZONTAL:"horizontal",VERTICAL:"vertical",NONE:"none"},O=new Uint8Array([255,255,255,255,212,212,212,212,169,169,169,169,126,126,126,126,83,83,83,83,41,41,41,41,0,0,0,0,0,0,0,0]),P=new o.DataTexture(O,1,8,o.RGBAFormat,o.UnsignedByteType,o.UVMapping);P.minFilter=P.magFilter=o.LinearFilter,P.wrapS=P.wrapT=o.RepeatWrapping,P.needsUpdate=!0;for(var A=[],S=0;S<16;++S){for(var M=Math.abs(S-8),T=8-M,E=0;E<8+4*T;++E)A.push(0);for(var C=0;C<16;++C)A.push(255);for(var j=0;j<8+4*M;++j)A.push(0)}var R=new o.DataTexture(new Uint8Array(A),16,16,o.RGBAFormat,o.UnsignedByteType,o.UVMapping);R.minFilter=R.magFilter=o.LinearFilter,R.wrapS=R.wrapT=o.RepeatWrapping,R.needsUpdate=!0;var L={ARROW:P,FENCE:R},I=function(e){function t(e){var r;d(this,t),(r=y(this,g(t).call(this)))._lineMaterial=new l.MeshBasicMaterial2({color:e.color,depthTest:e.depthTest,side:o.DoubleSide,opacity:e.opacity,transparent:!0,alphaMap:null}),r._lineOptions=[],r._unitAltVector=e.unitAltVector,r._fenceHeight=e.fenceHeight;var n=new o.Geometry;return n.vertices.push(new o.Vector3(0,0,0),new o.Vector3(1,0,0),new o.Vector3(0,1,0),new o.Vector3(1,1,0)),n.faces.push(new o.Face3(0,1,2),new o.Face3(1,2,3)),n.faceVertexUvs[0]=[[new o.Vector2(0,0),new o.Vector2(1,0),new o.Vector2(0,1)],[new o.Vector2(1,0),new o.Vector2(0,1),new o.Vector2(1,1)]],r._lineGeometry=n,r._uvType=x.LINEAR,r}return b(t,o["Object3D"]),m(t,[{key:"updateLineUvs",value:function(e){if(this._uvType=e,e===x.LINEAR)for(var t=0;t<this.children.length;++t){for(var r=this.children[t],n=[[new o.Vector2(0,0),new o.Vector2(1,0),new o.Vector2(0,1)],[new o.Vector2(1,0),new o.Vector2(0,1),new o.Vector2(1,1)]],i=0;i<2;++i)for(var a=0;a<3;++a)r.geometry.faceVertexUvs[0][i][a].set(n[i][a].x,n[i][a].y);r.geometry.uvsNeedUpdate=!0}else{var s=1,l=this._fenceHeight;if(this._lineMaterial.alphaMap&&this._lineMaterial.alphaMap.image){var u=this._lineMaterial.alphaMap.image;s=u.width/u.height||1}for(var c=0,f=0;f<this.children.length;++f){var h=this.children[f],p=this._lineOptions[f],d=p.baseLine[0].clone().sub(p.baseLine[1]).length()/l/s*1,v=[[new o.Vector2(c,0),new o.Vector2(c+d,0),new o.Vector2(c,1)],[new o.Vector2(c+d,0),new o.Vector2(c,1),new o.Vector2(c+d,1)]];c+=d;for(var m=0;m<2;++m)for(var y=0;y<3;++y)h.geometry.faceVertexUvs[0][m][y].set(v[m][y].x,v[m][y].y);h.geometry.uvsNeedUpdate=!0}}}},{key:"addNewLine",value:function(e){this._lineOptions.push(e);var t=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),r=e.baseLine.slice();e.baseLine.map(function(e){r.push(e.clone().add(t))});var n=new o.Vector3(0,0,0);r.map(function(e){n.add(e)}),n.multiplyScalar(.25);var a=this._lineGeometry.clone();a.vertices=r.map(function(e){return e.clone().sub(n)}),a.verticesNeedUpdate=!0;var s=new o.Mesh(a,this._lineMaterial);s.position.copy(n),s.renderOrder=i.a.POLYLINE_RENDER_ORDER,this.add(s),this.updateLineUvs(this._uvType)}},{key:"updateLine",value:function(e,t){this._lineOptions[e]=t;var r=this.children[e],n=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),i=t.baseLine.slice();t.baseLine.map(function(e){i.push(e.clone().add(n))});var a=new o.Vector3(0,0,0);i.map(function(e){a.add(e)}),a.multiplyScalar(.25);var s=this._lineGeometry.clone();s.vertices=i.map(function(e){return e.clone().sub(a)}),r.geometry.dispose(),r.geometry=s,r.position.copy(a),this.updateLineUvs(this._uvType)}},{key:"destruct",value:function(){this._lineMaterial.alphaMap&&this._lineMaterial.alphaMap.dispose(),this._lineMaterial.map&&this._lineMaterial.map.dispose(),this._lineMaterial.dispose(),this._lineOptions=[];for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose(),this.remove(t)}return!0}},{key:"fenceHeight",set:function(e){var t=this;this._fenceHeight=e;for(var r=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),n=function(e){var n=t._lineOptions[e],i=t.children[e],a=n.baseLine.slice();n.baseLine.map(function(e){a.push(e.clone().add(r))});var s=new o.Vector3(0,0,0);a.map(function(e){s.add(e)}),s.multiplyScalar(.25);var l=t._lineGeometry.clone();l.vertices=a.map(function(e){return e.clone().sub(s)}),i.geometry.dispose(),i.geometry=l,i.position.copy(s)},i=0;i<this.children.length;++i)n(i);this.updateLineUvs(this._uvType)}},{key:"opacity",set:function(e){this._lineMaterial.opacity=e}},{key:"color",set:function(e){this._lineMaterial.color=e}},{key:"depthTest",set:function(e){this._lineMaterial.depthTest=e}}]),t}(),D=function(e){function t(e){var r;d(this,t);var n=!0;e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE&&(n=!1),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=!0,(r=y(this,g(t).call(this,e)))._fenceHeight=e.fenceHeight?e.fenceHeight:5,r._opacity=e.opacity?e.opacity:1,r._property.fenceHeight=r._fenceHeight,r._property.opacity=r._opacity,r._labelScaleFunc=function(e){return Math.abs(e)/5},r._property.labelScaleFunc=r._labelScaleFunc.toString(),r._labelScale=10*r._labelScaleFunc(r._fenceHeight);for(var i=0;i<r.labelHolder._labelOptions.length;++i){var s=r.labelHolder._labelOptions[i],l={x:s.width/s.height*r._labelScale,y:r._labelScale,z:1};r.labelHolder.drawOnLabel(i,{scale:l})}if(n){r.lineHolder=new I({color:r._color,depthTest:r._depthTest,opacity:r._opacity,unitAltVector:r._unitAltVector,fenceHeight:r._fenceHeight}),r.contentHolder.add(r.lineHolder);for(var u=0;u<r._points.length-1;u+=1){var c=r._constructLineOptions(u,u+1);r.lineHolder.addNewLine(c)}var f=r._constructInteractShapeGeometry(),h=new o.Mesh(f,new o.MeshBasicMaterial({side:o.DoubleSide}));r.interactShape=h,r._speed="number"==typeof e.speed?e.speed:1,r._uvAnimation=new a.a({offset:0,speed:r._speed,lastTime:void 0},function(e){if(e.lastTime||(e.lastTime=Date.now()),!r._style)return!0;if(r._style.animation===k.HORIZONTAL||r._style.animation===k.VERTICAL){var t=Date.now(),n=e.speed*(t-e.lastTime)/1e3;e.lastTime=t,e.offset-=n;for(var o=0;o<r.lineHolder.children.length;++o){for(var i=r.lineHolder.children[o].geometry.faceVertexUvs[0],a=0;a<i.length;a+=1)for(var s=0;s<i[a].length;s+=1)r._style.animation===k.HORIZONTAL?i[a][s].x-=n:r._style.animation===k.VERTICAL&&(i[a][s].y-=n),e.offset<=-1&&(r._style.animation===k.HORIZONTAL?i[a][s].x+=1:r._style.animation===k.VERTICAL&&(i[a][s].y+=1));e.offset<=-1&&(e.offset+=1),r.lineHolder.children[o].geometry.uvsNeedUpdate=!0}}return!0},100),r._uvAnimation.start();var p=Object.assign({texture:w.FENCE,alphaMap:"none",alphaChannel:"green",mapping:x.LINEAR,color:r._color,opacity:r._opacity,animation:k.HORIZONTAL},e.style);r.style=p}return r._property.type="PolyFenceLineMarker",r}return b(t,n["a"]),m(t,[{key:"_updateAlphaTexture",value:function(e,t){e===w.FENCE?t(L.ARROW):e===w.ARROW?t(L.FENCE):(this._textureLoader=this._textureLoader||new s.a,this._textureLoader.load(e,function(e){e.minFilter=e.magFilter=o.LinearFilter,e.wrapS=e.wrapT=o.RepeatWrapping,e.needsUpdate=!0,t(e)}))}},{key:"_constructLineOptions",value:function(e,r){var n=Object.assign({},f(g(t.prototype),"_constructLineOptions",this).call(this,e,r)),o=this._pointsxyz[e],i=this._pointsxyz[r];return n.baseLine=[o,i],n}},{key:"_constructInteractShapeGeometry",value:function(){for(var e=f(g(t.prototype),"_constructInteractShapeGeometry",this).call(this),r=this._unitAltVector.clone().multiplyScalar(this._fenceHeight),n=0;n<this._points.length-1;n+=1){var i=this._constructLineOptions(n,n+1),a=new o.Geometry;a.vertices.push(i.baseLine[0],i.baseLine[1],i.baseLine[0].clone().add(r),i.baseLine[1].clone().add(r)),a.faces.push(new o.Face3(0,1,2),new o.Face3(1,2,3)),e.merge(a)}return e}},{key:"_updateInteractShape",value:function(){var e=this._constructInteractShapeGeometry();this.interactShape.geometry.dispose(),this.interactShape.geometry=e}},{key:"addPoint",value:function(e){f(g(t.prototype),"addPoint",this).call(this,e);var r=this._constructLineOptions(this.pointsNumber-2,this.pointsNumber-1);this.lineHolder.addNewLine(r);var n=this.pointsNumber-2,o=this.labelHolder._labelOptions[n],i={x:o.width/o.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(n,{scale:i}),this._updateInteractShape()}},{key:"setPoint",value:function(e,r){if(f(g(t.prototype),"setPoint",this).call(this,e,r),0!==e){var n=this._constructLineOptions(e-1,e);this.lineHolder.updateLine(e-1,n);var o=this.labelHolder._labelOptions[e-1],i={x:o.width/o.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(e-1,{scale:i})}if(e!==this.pointsNumber-1){var a=this._constructLineOptions(e,e+1);this.lineHolder.updateLine(e,a);var s=this.labelHolder._labelOptions[e],l={x:s.width/s.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(e,{scale:l})}this._updateInteractShape()}},{key:"destruct",value:function(){var e=!0;return this._uvAnimation&&(this._uvAnimation.stop(),this._uvAnimation=void 0),e=this.lineHolder.destruct()&&e,e=f(g(t.prototype),"destruct",this).call(this)&&e}},{key:"opacity",set:function(e){this.lineHolder.opacity=e,this._opacity=e,this._property.opacity=e},get:function(){return this._opacity}},{key:"fenceHeight",set:function(e){this._fenceHeight=e,this._property.fenceHeight=e,this.lineHolder.fenceHeight=e,this._labelScale=10*this._labelScaleFunc(this._fenceHeight);for(var t=0;t<this.labelHolder._labelOptions.length;++t){var r=this.labelHolder._labelOptions[t],n={x:r.width/r.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(t,{scale:n})}this._updateInteractShape()},get:function(){return this._fenceHeight}},{key:"labelScaleFunc",set:function(e){c(g(t.prototype),"labelScaleFunc",e,this,!0),this._labelScale=10*this._labelScaleFunc(this._fenceHeight);for(var r=0;r<this.labelHolder._labelOptions.length;++r){var n=this.labelHolder._labelOptions[r],o={x:n.width/n.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(r,{scale:o})}},get:function(){return this._labelScaleFunc}},{key:"lineWidth",set:function(e){this._lineWidth=e,this._property.lineWidth=e},get:function(){return this._lineWidth}},{key:"color",set:function(e){this._color=e,this._property.color=e,this.lineHolder.color=new o.Color(e)},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e,this.lineHolder.depthTest=e},get:function(){return this._depthTest}},{key:"style",set:function(e){var t=this;e=e||{};var r=this._style,n=Object.assign({},r,e);e.alphaMap&&!e.mapping&&(n.alphaMap===w.FENCE?n.mapping=x.LINEAR:n.alphaMap===w.ARROW&&(n.mapping=x.REPEAT)),this._style=n,n.mapping!==x.LINEAR&&n.mapping!==x.REPEAT&&(console.warn("invalid mapping: ",n.mapping," mapping set to 'repeat'"),n.mapping=x.REPEAT);var o=void 0!==n.texture&&(!r||r.texture!==n.texture),i=void 0!==n.alphaMap&&(!r||r.alphaMap!==n.alphaMap),a=n.animation&&(!r||r.animation!==n.animation),s=!a&&n.mapping&&(!r||r.mapping!==n.mapping);o&&("none"===this._style.texture?this.lineHolder._lineMaterial.map&&(this.lineHolder._lineMaterial.map.dispose(),this.lineHolder._lineMaterial.map=null,this.lineHolder._lineMaterial.needsUpdate=!0):this._updateAlphaTexture(this._style.texture,function(e){t.lineHolder._lineMaterial.map&&(t.lineHolder._lineMaterial.map.dispose(),t.lineHolder._lineMaterial.map=null),t.lineHolder._lineMaterial.map=e,t.lineHolder._lineMaterial.map.needsUpdate=!0,t.lineHolder._lineMaterial.needsUpdate=!0,t.lineHolder.updateLineUvs(t._style.mapping)})),i&&("none"===this._style.alphaMap?this.lineHolder._lineMaterial.alphaMap&&(this.lineHolder._lineMaterial.alphaMap.dispose(),this.lineHolder._lineMaterial.alphaMap=null,this.lineHolder._lineMaterial.needsUpdate=!0):this._updateAlphaTexture(this._style.alphaMap,function(e){t.lineHolder._lineMaterial.alphaMap&&(t.lineHolder._lineMaterial.alphaMap.dispose(),t.lineHolder._lineMaterial.alphaMap=null),t.lineHolder._lineMaterial.alphaMap=e,t.lineHolder._lineMaterial.alphaMap.needsUpdate=!0,t.lineHolder._lineMaterial.needsUpdate=!0,t.lineHolder.updateLineUvs(t._style.mapping)})),a&&(this.lineHolder.updateLineUvs(this._style.mapping),this._uvAnimation&&this._uvAnimation.changeStates({offset:0}),this._style.animation=e.animation),s&&this.lineHolder.updateLineUvs(this._style.mapping),this.color=this._style.color,this.opacity=this._style.opacity;var l=function(e){var t={value:1,valid:!0};switch(e){case"red":t.value=0;break;case"green":t.value=1;break;case"blue":t.value=2;break;case"alpha":t.value=3;break;default:t.valid=!1}return t}(this._style.alphaChannel);l.valid&&(this.lineHolder._lineMaterial.alphaChannel=l.value)},get:function(){return this._style}},{key:"speed",set:function(e){"number"==typeof e&&(this._speed=e,this._uvAnimation&&this._uvAnimation.changeStates({speed:this._speed}))},get:function(){return this._speed}}]),t}()},function(e,t){e.exports={name:"altizure",version:"3.9.6",description:"altizure js sdk v3",main:"./release/altizure-core.min.js",scripts:{release:"yarn clean && yarn core && gulp sdk-release && yarn plugin && gulp all",build:"yarn clean && gulp sdk-build && yarn cored",test:"jest ./test/",lint:"eslint ./src/",prcheck:"yarn lint && yarn test && yarn docs","setup-examples":"cd .. && git clone git@bitbucket.org:jingbo/altizure.sdk.examples.git && cd altizure && ln -s ../altizure.sdk.examples/ sdk.examples",core:"./node_modules/.bin/webpack --config webpack.config.core.js && cp ./build/altizure-core.min.js ./release/altizure-core.min.js",cored:"./node_modules/.bin/webpack --config webpack.config.core.d.js",prepublishOnly:"npm version patch && yarn && yarn release",postpublish:"git push origin v3",clean:"gulp clean",docs:"gulp docs",translate:"gulp docs-zhCN && ./docs/translator/test.js ./docs/i18n_locales/zh_CN/src && gulp docs-zhCN","setup-translator":"ln -s ../../translate_docs ./docs/translator",plugin:"rm -rf ./build/node_modules package-lock.json && node setup-plugins.js",engine:"cd ../altizure.gl-engine2 && cp ./build/altizure-gl-engine.js ../altizure/node_modules/altizure-gl-engine/release/altizure-gl-engine.min.js && cp ./build/altizure-gl-engine.js.map ../altizure/node_modules/altizure-gl-engine/release/altizure-gl-engine.min.js.map && cd ../altizure && yarn build","engine-update":"yarn remove altizure-gl-engine && yarn add -D altizure-gl-engine@beta"},repository:{type:"git",url:"git+https://bitbucket.org/jingbo/altizure.git"},keywords:["altizure","js","sdk","webgl"],author:"Jingbo Liu",license:"MIT",homepage:"https://bitbucket.org/jingbo/altizure#readme",dependencies:{axios:"0.18.1",cmask:"^1.0.2",kdbush:"^1.0.1",poly2tri:"^1.5.0",pqsort:"^1.0.4",supercluster:"^6.0.2",three:"0.97.0","worker-loader":"^2.0.0"},devDependencies:{"@babel/cli":"^7.4.4","@babel/core":"^7.4.5","@babel/plugin-proposal-class-properties":"^7.5.5","@babel/plugin-proposal-decorators":"^7.4.4","@babel/preset-env":"^7.4.5","@babel/preset-stage-2":"^7.0.0","@babel/preset-typescript":"^7.3.3","altizure-gl-engine":"^3.9.5","babel-eslint":"^10.0.2","babel-jest":"^24.8.0","babel-loader":"^8.0.6",eslint:"^5.16.0","eslint-config-standard":"^12.0.0-alpha.0","eslint-plugin-import":"^2.17.3","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.1.1","eslint-plugin-standard":"^4.0.0",gulp:"^3.9.1","gulp-clean":"^0.4.0","gulp-concat":"^2.6.1","gulp-jsdoc3":"^2.0.0","gulp-rename":"^1.3.0",jest:"^24.8.0","jest-canvas-mock":"^2.1.1",jsdoc:"^3.5.5","jsdoc-i18n-plugin":"^0.0.3",npmi:"^4.0.0",path:"^0.12.7","regenerator-runtime":"^0.11.1","tui-jsdoc-template":"^1.2.2",typescript:"^3.5.3","uglifyjs-webpack-plugin":"^1.2.5",webpack:"^3.12.0","webpack-bundle-analyzer":"^2.13.1"},optionalDependencies:{},jest:{verbose:!0,testURL:"http://localhost/",setupFiles:["jest-canvas-mock"]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"version",function(){return z}),r.d(t,"PolyLineMarker",function(){return B}),r.d(t,"Solution",function(){return N});var n=r(24),o=r(6),i=r(4),a=r(31),s=r(32),l=r(18),u=r(82),c=r(20),f=r(34),h=r(83),p=r(84),d=r(35),v=r(85),m=r(36),y=r(86),g=r(23),b=r(87),_=r(88),w=r(89),x=r(90),k=r(91),O=r(92),P=r(93),A=r(12),S=r(98),M=r(99),T=r(30),E=r(107),C=r(108),j=r(13),R=r(0),L=(r.n(R),r(1)),I=(r.n(L),r(37)),D=r.n(I);r.d(t,"Earth",function(){return n.a}),r.d(t,"Marker",function(){return i.a}),r.d(t,"LngLatAlt",function(){return o.a}),r.d(t,"OBJMarker",function(){return a.a}),r.d(t,"TagMarker",function(){return s.a}),r.d(t,"TextTagMarker",function(){return l.a}),r.d(t,"CanvasTagMarker",function(){return u.a}),r.d(t,"PolygonMarker",function(){return c.a}),r.d(t,"RegularPolygonMarker",function(){return f.a}),r.d(t,"CylinderVolumeMarker",function(){return h.a}),r.d(t,"DitchMarker",function(){return p.a}),r.d(t,"PolyCylinderLineMarker",function(){return d.a}),r.d(t,"PolyTubeLineMarker",function(){return v.a}),r.d(t,"PolyFenceLineMarker",function(){return m.a}),r.d(t,"PlanarPatchMarker",function(){return y.a}),r.d(t,"CameraMarker",function(){return g.a}),r.d(t,"VideoProjectorMarker",function(){return w.a}),r.d(t,"ImageProjectorMarker",function(){return x.a}),r.d(t,"LightBeamMarker",function(){return b.a}),r.d(t,"ZoneMarker",function(){return _.a}),r.d(t,"AltizureProjectMarker",function(){return A.a}),r.o(L,"DEMSpec")&&r.d(t,"DEMSpec",function(){return L.DEMSpec}),r.d(t,"DemMarker",function(){return k.a}),r.d(t,"drawGeoJson",function(){return O.a}),r.d(t,"FusionPhotoControl",function(){return S.a}),r.d(t,"Sandbox",function(){return P.a}),r.d(t,"MarkerCluster",function(){return M.a}),r.d(t,"offlineRenderer",function(){return T.a}),r.d(t,"SkylineHeightLimitCalculator",function(){return E.a}),r.d(t,"HeightMapMarker",function(){return C.a}),r.d(t,"GeometryUtils",function(){return j.a}),r.o(L,"EarthWmtsTileURL")&&r.d(t,"EarthWmtsTileURL",function(){return L.EarthWmtsTileURL}),r.o(L,"DemWmtsTileURL")&&r.d(t,"DemWmtsTileURL",function(){return L.DemWmtsTileURL}),r.o(L,"IMAGE_FORMAT")&&r.d(t,"IMAGE_FORMAT",function(){return L.IMAGE_FORMAT}),r.o(L,"DEM_ENCODING")&&r.d(t,"DEM_ENCODING",function(){return L.DEM_ENCODING}),r.o(L,"MOUSE")&&r.d(t,"MOUSE",function(){return L.MOUSE}),r.o(L,"altizureSpecLoader")&&r.d(t,"altizureSpecLoader",function(){return L.altizureSpecLoader}),r.o(L,"altizureSpecWithApiInfo")&&r.d(t,"altizureSpecWithApiInfo",function(){return L.altizureSpecWithApiInfo}),r.o(R,"WebGLRenderTarget")&&r.d(t,"WebGLRenderTarget",function(){return R.WebGLRenderTarget}),r.o(R,"NearestFilter")&&r.d(t,"NearestFilter",function(){return R.NearestFilter}),r.o(R,"RGBAFormat")&&r.d(t,"RGBAFormat",function(){return R.RGBAFormat}),r.o(R,"OrthographicCamera")&&r.d(t,"OrthographicCamera",function(){return R.OrthographicCamera}),r.o(R,"Quaternion")&&r.d(t,"Quaternion",function(){return R.Quaternion}),r.o(R,"Color")&&r.d(t,"Color",function(){return R.Color});var z=D.a.version;console.log("https://altizure.cn SDK ".concat(z));var N=P.a,B=m.a;Object.assign=Object.assign||function(e){for(var t=arguments,r=1;r<t.length;r+=1){var n=t[r];for(var o in Object.keys(n))e[o]=n[o]}return e}},function(e,t,r){"use strict";var n=r(3),o=r(25),i=r(41),a=r(11);function s(e){var t=new i(e),r=o(i.prototype.request,t);return n.extend(r,i.prototype,t),n.extend(r,t),r}var l=s(a);l.Axios=i,l.create=function(e){return s(n.merge(a,e))},l.Cancel=r(29),l.CancelToken=r(55),l.isCancel=r(28),l.all=function(e){return Promise.all(e)},l.spread=r(56),e.exports=l,e.exports.default=l},function(e,t){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},function(e,t,r){"use strict";var n=r(11),o=r(3),i=r(50),a=r(51);function s(e){this.defaults=e,this.interceptors={request:new i,response:new i}}s.prototype.request=function(e){"string"==typeof e&&(e=o.merge({url:arguments[0]},arguments[1])),(e=o.merge(n,{method:"get"},this.defaults,e)).method=e.method.toLowerCase();var t=[a,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},o.forEach(["delete","get","head","options"],function(e){s.prototype[e]=function(t,r){return this.request(o.merge(r||{},{method:e,url:t}))}}),o.forEach(["post","put","patch"],function(e){s.prototype[e]=function(t,r,n){return this.request(o.merge(n||{},{method:e,url:t,data:r}))}}),e.exports=s},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l,u=[],c=!1,f=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):f=-1,u.length&&p())}function p(){if(!c){var e=s(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++f<t;)l&&l[f].run();f=-1,t=u.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new d(e,t)),1!==u.length||c||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(3);e.exports=function(e,t){n.forEach(e,function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])})}},function(e,t,r){"use strict";var n=r(27);e.exports=function(e,t,r){var o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,o){return e.config=t,r&&(e.code=r),e.request=n,e.response=o,e}},function(e,t,r){"use strict";var n=r(3);function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var i;if(r)i=r(t);else if(n.isURLSearchParams(t))i=t.toString();else{var a=[];n.forEach(t,function(e,t){null!==e&&void 0!==e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),a.push(o(t)+"="+o(e))}))}),i=a.join("&")}return i&&(e+=(-1===e.indexOf("?")?"?":"&")+i),e}},function(e,t,r){"use strict";var n=r(3),o=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,i,a={};return e?(n.forEach(e.split("\n"),function(e){if(i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t){if(a[t]&&o.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([r]):a[t]?a[t]+", "+r:r}}),a):a}},function(e,t,r){"use strict";var n=r(3);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function o(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=o(window.location.href),function(t){var r=n.isString(t)?o(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var n=r(3);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,o,i,a){var s=[];s.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),n.isString(o)&&s.push("path="+o),n.isString(i)&&s.push("domain="+i),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var n=r(3);function o(){this.handlers=[]}o.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},o.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},o.prototype.forEach=function(e){n.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=o},function(e,t,r){"use strict";var n=r(3),o=r(52),i=r(28),a=r(11),s=r(53),l=r(54);function u(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return u(e),e.baseURL&&!s(e.url)&&(e.url=l(e.baseURL,e.url)),e.headers=e.headers||{},e.data=o(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return u(e),t.data=o(t.data,t.headers,e.transformResponse),t},function(t){return i(t)||(u(e),t&&t.response&&(t.response.data=o(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(3);e.exports=function(e,t,r){return n.forEach(r,function(r){e=r(e,t)}),e}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(29);function o(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new n(e),t(r.reason))})}o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var e;return{token:new o(function(t){e=t}),cancel:e}},e.exports=o},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),r(12));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var r,n=e.parent,o=e.quality,i=void 0===o?60:o,a=e.forest;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,u(t).call(this,n)))._quality=i,r._property.type="MarkerLayer",r._forest=a,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["HyperLayer"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"destruct",value:function(){var e=!0;return this._altizureBundleLoader&&(e=this._altizureBundleLoader.destruct()&&e),this._osgBundleLoader&&(e=this._osgBundleLoader.destruct()&&e),l(u(t.prototype),"destruct",this).call(this)&&e}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e instanceof o.a||e.sceneUpdated(t)},{camera:t})}},{key:"forest",get:function(){return this._forest}},{key:"altizureBundleLoader",get:function(){if(n.BrowserCapatibility.workers){var e=new n.AltizureLoader;return this._altizureBundleLoader=e,Object.defineProperty(this,"altizureBundleLoader",{value:e,writable:!1,configurable:!0}),this.altizureBundleLoader}console.error("The brower is too old or corrupted. Please install the newest Chrome/Firefox/Edge.")}},{key:"osgBundleLoader",get:function(){var e=n.BrowserCapatibility.isMobile?2:6,t=new n.OSGLoader({workerSize:e});return this._osgBundleLoader=t,Object.defineProperty(this,"osgBundleLoader",{value:t,writable:!1,configurable:!0}),this.osgBundleLoader}}]),t}();t.a=f},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(7)),i=function(e){n.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=n.FrontSide,this.transparent=!0,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(i.prototype=Object.create(n.MeshBasicMaterial.prototype)).constructor=i;var a=function(e){n.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(e),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,1,0),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};(a.prototype=Object.create(n.LineBasicMaterial.prototype)).constructor=a;var s=new i({visible:!1,transparent:!1,side:n.DoubleSide}),l=function(){this.init=function(){n.Object3D.call(this),this.handles=new n.Object3D,this.pickers=new n.Object3D,this.planes=new n.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes);var e=new n.PlaneBufferGeometry(50,50,2,2),t=new n.MeshBasicMaterial({visible:!1,side:n.DoubleSide}),r={XY:new n.Mesh(e,t),YZ:new n.Mesh(e,t),XZ:new n.Mesh(e,t),XYZE:new n.Mesh(e,t)};for(var i in this.activePlane=r.XYZE,r.YZ.rotation.set(0,Math.PI/2,0),r.XZ.rotation.set(-Math.PI/2,0,0),r)r[i].name=i,r[i].renderOrder=o.a.TRANSFORM_CONTROL_RENDER_ORDER,this.planes.add(r[i]),this.planes[i]=r[i];var a=function(e,t){for(var r in e)for(i=e[r].length;i--;){var n=e[r][i][0],a=e[r][i][1],s=e[r][i][2];n.name=r,n.renderOrder=o.a.TRANSFORM_CONTROL_RENDER_ORDER,a&&n.position.set(a[0],a[1],a[2]),s&&n.rotation.set(s[0],s[1],s[2]),t.add(n)}};a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),this.traverse(function(e){if(e instanceof n.Mesh||e instanceof n.Line){e.updateMatrix();var t=e.geometry.clone();t.applyMatrix(e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name===e?t.material.highlight(!0):t.material.highlight(!1))})}};(l.prototype=Object.create(n.Object3D.prototype)).constructor=l,l.prototype.update=function(e,t){var r=new n.Vector3(0,0,0),o=new n.Vector3(0,1,0),i=new n.Matrix4;this.traverse(function(n){-1!==n.name.search("E")?n.quaternion.setFromRotationMatrix(i.lookAt(t,r,o)):-1===n.name.search("X")&&-1===n.name.search("Y")&&-1===n.name.search("Z")||n.quaternion.setFromEuler(e)})};var u=function(){l.call(this);var e=new n.Geometry,t=new n.Mesh(new n.CylinderGeometry(0,.05,.2,12,1,!1));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var r=new n.BufferGeometry;r.addAttribute("position",new n.Float32BufferAttribute([0,0,0,1,0,0],3));var o=new n.BufferGeometry;o.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,1,0],3));var u=new n.BufferGeometry;u.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new n.Mesh(e,new i({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new n.Line(r,new a({color:16711680}))]],Y:[[new n.Mesh(e,new i({color:65280})),[0,.5,0]],[new n.Line(o,new a({color:65280}))]],Z:[[new n.Mesh(e,new i({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new n.Line(u,new a({color:255}))]],XYZ:[[new n.Mesh(new n.OctahedronGeometry(.1,0),new i({color:16777215,opacity:.25,visible:!1})),[0,0,0],[0,0,0]]],XY:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new i({color:16776960,opacity:.25,side:n.DoubleSide})),[.15,.15,0]]],YZ:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new i({color:65535,opacity:.25,side:n.DoubleSide})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.PlaneBufferGeometry(.29,.29),new i({color:16711935,opacity:.25,side:n.DoubleSide})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[0,.6,0]]],Z:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[0,0,.6],[Math.PI/2,0,0]]],XY:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),s),[.2,.2,0]]],YZ:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),s),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.PlaneBufferGeometry(.4,.4),s),[.2,0,.2],[-Math.PI/2,0,0]]]},this.setActivePlane=function(e,t){var r=new n.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE),"XY"===e&&(this.activePlane=this.planes.XY),"YZ"===e&&(this.activePlane=this.planes.YZ),"XZ"===e&&(this.activePlane=this.planes.XZ)},this.init()};(u.prototype=Object.create(l.prototype)).constructor=u;var c=function(){l.call(this);var e=function(e,t,r){var o=new n.BufferGeometry,i=[];r=r||1;for(var a=0;a<=64*r;++a)"x"===t&&i.push(0,Math.cos(a/32*Math.PI)*e,Math.sin(a/32*Math.PI)*e),"y"===t&&i.push(Math.cos(a/32*Math.PI)*e,0,Math.sin(a/32*Math.PI)*e),"z"===t&&i.push(Math.sin(a/32*Math.PI)*e,Math.cos(a/32*Math.PI)*e,0);return o.addAttribute("position",new n.Float32BufferAttribute(i,3)),o};this.handleGizmos={X:[[new n.Line(new e(1,"x",.5),new a({color:16711680}))]],Y:[[new n.Line(new e(1,"y",.5),new a({color:65280}))]],Z:[[new n.Line(new e(1,"z",.5),new a({color:255}))]],E:[[new n.Line(new e(1.25,"z",1),new a({color:13421568}))]],XYZE:[[new n.Line(new e(1,"z",1),new a({color:7895160}))]]},this.pickerGizmos={X:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n.Mesh(new n.TorusBufferGeometry(1,.12,4,12,Math.PI),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n.Mesh(new n.TorusBufferGeometry(1.25,.12,2,24),s)]],XYZE:[[new n.Mesh]]},this.setActivePlane=function(e){"E"===e&&(this.activePlane=this.planes.XYZE),"X"===e&&(this.activePlane=this.planes.YZ),"Y"===e&&(this.activePlane=this.planes.XZ),"Z"===e&&(this.activePlane=this.planes.XY)},this.update=function(e,t){l.prototype.update.apply(this,arguments);this.handles,this.pickers;var r=new n.Matrix4,o=new n.Euler(0,0,1),i=new n.Quaternion,a=new n.Vector3(1,0,0),s=new n.Vector3(0,1,0),u=new n.Vector3(0,0,1),c=new n.Quaternion,f=new n.Quaternion,h=new n.Quaternion,p=t.clone();o.copy(this.planes.XY.rotation),i.setFromEuler(o),r.makeRotationFromQuaternion(i).getInverse(r),p.applyMatrix4(r),this.traverse(function(e){i.setFromEuler(o),"X"===e.name&&(c.setFromAxisAngle(a,Math.atan2(-p.y,p.z)),i.multiplyQuaternions(i,c),e.quaternion.copy(i)),"Y"===e.name&&(f.setFromAxisAngle(s,Math.atan2(p.x,p.z)),i.multiplyQuaternions(i,f),e.quaternion.copy(i)),"Z"===e.name&&(h.setFromAxisAngle(u,Math.atan2(p.y,p.x)),i.multiplyQuaternions(i,h),e.quaternion.copy(i))})},this.init()};(c.prototype=Object.create(l.prototype)).constructor=c;var f=function(){l.call(this);var e=new n.Geometry,t=new n.Mesh(new n.BoxGeometry(.125,.125,.125));t.position.y=.5,t.updateMatrix(),e.merge(t.geometry,t.matrix);var r=new n.BufferGeometry;r.addAttribute("position",new n.Float32BufferAttribute([0,0,0,1,0,0],3));var o=new n.BufferGeometry;o.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,1,0],3));var u=new n.BufferGeometry;u.addAttribute("position",new n.Float32BufferAttribute([0,0,0,0,0,1],3)),this.handleGizmos={X:[[new n.Mesh(e,new i({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new n.Line(r,new a({color:16711680}))]],Y:[[new n.Mesh(e,new i({color:65280})),[0,.5,0]],[new n.Line(o,new a({color:65280}))]],Z:[[new n.Mesh(e,new i({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new n.Line(u,new a({color:255}))]],XYZ:[[new n.Mesh(new n.BoxBufferGeometry(.125,.125,.125),new i({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[0,.6,0]]],Z:[[new n.Mesh(new n.CylinderBufferGeometry(.2,0,1,4,1,!1),s),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.BoxBufferGeometry(.4,.4,.4),s)]]},this.setActivePlane=function(e,t){var r=new n.Matrix4;t.applyMatrix4(r.getInverse(r.extractRotation(this.planes.XY.matrixWorld))),"X"===e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"===e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"===e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"===e&&(this.activePlane=this.planes.XYZE)},this.init()};(f.prototype=Object.create(l.prototype)).constructor=f;var h=function(e,t){n.Object3D.call(this),t=void 0!==t?t:document,this.object=void 0,this.visible=!1,this.translationSnap=null,this.rotationSnap=null,this.space="world",this.size=1,this.axis=null;var r=this,o="translate",i=!1,a={translate:new u,rotate:new c,scale:new f};for(var s in a){var l=a[s];l.visible=s===o,this.add(l)}var h={type:"change"},p={type:"mouseDown"},d={type:"mouseUp",mode:o},v={type:"objectChange"},m=new n.Raycaster,y=new n.Vector2,g=new n.Vector3,b=new n.Vector3,_=new n.Vector3,w=new n.Vector3,x=1,k=new n.Matrix4,O=new n.Vector3,P=new n.Matrix4,A=new n.Vector3,S=new n.Quaternion,M=new n.Vector3(1,0,0),T=new n.Vector3(0,1,0),E=new n.Vector3(0,0,1),C=new n.Quaternion,j=new n.Quaternion,R=new n.Quaternion,L=new n.Quaternion,I=new n.Quaternion,D=new n.Vector3,z=new n.Vector3,N=new n.Matrix4,B=new n.Matrix4,U=new n.Vector3,F=new n.Vector3,V=new n.Euler,H=new n.Matrix4,W=new n.Vector3,G=new n.Euler;function K(e){if(void 0!==r.object&&!0!==i&&(void 0===e.button||0===e.button)){var t=Z(e.changedTouches?e.changedTouches[0]:e,a[o].pickers.children),n=null;t&&(n=t.object.name,e.preventDefault()),r.axis!==n&&(r.axis=n,r.update(),r.dispatchEvent(h))}}function X(e){if(void 0!==r.object&&!0!==i&&(void 0===e.button||0===e.button)){var t=e.changedTouches?e.changedTouches[0]:e;if(0===t.button||void 0===t.button){var n=Z(t,a[o].pickers.children);if(n){e.preventDefault(),e.stopPropagation(),r.dispatchEvent(p),r.axis=n.object.name,r.update(),O.copy(W).sub(F).normalize(),a[o].setActivePlane(r.axis,O);var s=Z(t,[a[o].activePlane]);s&&(D.copy(r.object.position),z.copy(r.object.scale),N.extractRotation(r.object.matrix),H.extractRotation(r.object.matrixWorld),B.extractRotation(r.object.parent.matrixWorld),U.setFromMatrixScale(P.getInverse(r.object.parent.matrixWorld)),b.copy(s.point))}}i=!0}}function Y(e){if(void 0!==r.object&&null!==r.axis&&!1!==i&&(void 0===e.button||0===e.button)){var t=Z(e.changedTouches?e.changedTouches[0]:e,[a[o].activePlane]);!1!==t&&(e.preventDefault(),e.stopPropagation(),g.copy(t.point),"translate"===o?(g.sub(b),g.multiply(U),"local"===r.space&&(g.applyMatrix4(P.getInverse(H)),-1===r.axis.search("X")&&(g.x=0),-1===r.axis.search("Y")&&(g.y=0),-1===r.axis.search("Z")&&(g.z=0),g.applyMatrix4(N),r.object.position.copy(D),r.object.position.add(g)),"world"!==r.space&&-1===r.axis.search("XYZ")||(-1===r.axis.search("X")&&(g.x=0),-1===r.axis.search("Y")&&(g.y=0),-1===r.axis.search("Z")&&(g.z=0),g.applyMatrix4(P.getInverse(B)),r.object.position.copy(D),r.object.position.add(g)),null!==r.translationSnap&&("local"===r.space&&r.object.position.applyMatrix4(P.getInverse(H)),-1!==r.axis.search("X")&&(r.object.position.x=Math.round(r.object.position.x/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Y")&&(r.object.position.y=Math.round(r.object.position.y/r.translationSnap)*r.translationSnap),-1!==r.axis.search("Z")&&(r.object.position.z=Math.round(r.object.position.z/r.translationSnap)*r.translationSnap),"local"===r.space&&r.object.position.applyMatrix4(H))):"scale"===o?(g.sub(b),g.multiply(U),"local"===r.space&&("XYZ"===r.axis?(x=1+g.y/Math.max(z.x,z.y,z.z),r.object.scale.x=z.x*x,r.object.scale.y=z.y*x,r.object.scale.z=z.z*x):(g.applyMatrix4(P.getInverse(H)),"X"===r.axis&&(r.object.scale.x=z.x*(1+g.x/z.x)),"Y"===r.axis&&(r.object.scale.y=z.y*(1+g.y/z.y)),"Z"===r.axis&&(r.object.scale.z=z.z*(1+g.z/z.z))))):"rotate"===o&&(g.sub(F),g.multiply(U),A.copy(b).sub(F),A.multiply(U),"E"===r.axis?(g.applyMatrix4(P.getInverse(k)),A.applyMatrix4(P.getInverse(k)),_.set(Math.atan2(g.z,g.y),Math.atan2(g.x,g.z),Math.atan2(g.y,g.x)),w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),S.setFromRotationMatrix(P.getInverse(B)),I.setFromAxisAngle(O,_.z-w.z),C.setFromRotationMatrix(H),S.multiplyQuaternions(S,I),S.multiplyQuaternions(S,C),r.object.quaternion.copy(S)):"XYZE"===r.axis?(I.setFromEuler(g.clone().cross(A).normalize()),S.setFromRotationMatrix(P.getInverse(B)),j.setFromAxisAngle(I,-g.clone().angleTo(A)),C.setFromRotationMatrix(H),S.multiplyQuaternions(S,j),S.multiplyQuaternions(S,C),r.object.quaternion.copy(S)):"local"===r.space?(g.applyMatrix4(P.getInverse(H)),A.applyMatrix4(P.getInverse(H)),_.set(Math.atan2(g.z,g.y),Math.atan2(g.x,g.z),Math.atan2(g.y,g.x)),w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),C.setFromRotationMatrix(N),null!==r.rotationSnap?(j.setFromAxisAngle(M,Math.round((_.x-w.x)/r.rotationSnap)*r.rotationSnap),R.setFromAxisAngle(T,Math.round((_.y-w.y)/r.rotationSnap)*r.rotationSnap),L.setFromAxisAngle(E,Math.round((_.z-w.z)/r.rotationSnap)*r.rotationSnap)):(j.setFromAxisAngle(M,_.x-w.x),R.setFromAxisAngle(T,_.y-w.y),L.setFromAxisAngle(E,_.z-w.z)),"X"===r.axis&&C.multiplyQuaternions(C,j),"Y"===r.axis&&C.multiplyQuaternions(C,R),"Z"===r.axis&&C.multiplyQuaternions(C,L),r.object.quaternion.copy(C)):"world"===r.space&&(_.set(Math.atan2(g.z,g.y),Math.atan2(g.x,g.z),Math.atan2(g.y,g.x)),w.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x)),S.setFromRotationMatrix(P.getInverse(B)),null!==r.rotationSnap?(j.setFromAxisAngle(M,Math.round((_.x-w.x)/r.rotationSnap)*r.rotationSnap),R.setFromAxisAngle(T,Math.round((_.y-w.y)/r.rotationSnap)*r.rotationSnap),L.setFromAxisAngle(E,Math.round((_.z-w.z)/r.rotationSnap)*r.rotationSnap)):(j.setFromAxisAngle(M,_.x-w.x),R.setFromAxisAngle(T,_.y-w.y),L.setFromAxisAngle(E,_.z-w.z)),C.setFromRotationMatrix(H),"X"===r.axis&&S.multiplyQuaternions(S,j),"Y"===r.axis&&S.multiplyQuaternions(S,R),"Z"===r.axis&&S.multiplyQuaternions(S,L),S.multiplyQuaternions(S,C),r.object.quaternion.copy(S))),r.update(),r.dispatchEvent(h),r.dispatchEvent(v))}}function q(e){e.preventDefault(),void 0!==e.button&&0!==e.button||(i&&null!==r.axis&&(d.mode=o,r.dispatchEvent(d)),i=!1,"TouchEvent"in window&&e instanceof TouchEvent?(r.axis=null,r.update(),r.dispatchEvent(h)):K(e))}function Z(r,n){var o=t.getBoundingClientRect(),i=(r.clientX-o.left)/o.width,a=(r.clientY-o.top)/o.height;y.set(2*i-1,-2*a+1),m.setFromCamera(y,e);var s=m.intersectObjects(n,!0);return!!s[0]&&s[0]}t.addEventListener("mousedown",X,!1),t.addEventListener("touchstart",X,!1),t.addEventListener("mousemove",K,!1),t.addEventListener("touchmove",K,!1),t.addEventListener("mousemove",Y,!1),t.addEventListener("touchmove",Y,!1),t.addEventListener("mouseup",q,!1),t.addEventListener("mouseout",q,!1),t.addEventListener("touchend",q,!1),t.addEventListener("touchcancel",q,!1),t.addEventListener("touchleave",q,!1),this.dispose=function(){t.removeEventListener("mousedown",X),t.removeEventListener("touchstart",X),t.removeEventListener("mousemove",K),t.removeEventListener("touchmove",K),t.removeEventListener("mousemove",Y),t.removeEventListener("touchmove",Y),t.removeEventListener("mouseup",q),t.removeEventListener("mouseout",q),t.removeEventListener("touchend",q),t.removeEventListener("touchcancel",q),t.removeEventListener("touchleave",q)},this.attach=function(e){this.object=e,this.visible=!0,this.update()},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.getMode=function(){return o},this.setMode=function(e){for(var t in"scale"===(o=e||o)&&(r.space="local"),a)a[t].visible=t===o;this.update(),r.dispatchEvent(h)},this.setTranslationSnap=function(e){r.translationSnap=e},this.setRotationSnap=function(e){r.rotationSnap=e},this.setSize=function(e){r.size=e,this.update(),r.dispatchEvent(h)},this.setSpace=function(e){r.space=e,this.update(),r.dispatchEvent(h)},this.update=function(){void 0!==r.object&&(r.object.updateMatrixWorld(),F.setFromMatrixPosition(r.object.matrixWorld),V.setFromRotationMatrix(P.extractRotation(r.object.matrixWorld)),e.updateMatrixWorld(),W.setFromMatrixPosition(e.matrixWorld),G.setFromRotationMatrix(P.extractRotation(e.matrixWorld)),x=F.distanceTo(W)/6*r.size,this.position.copy(F),this.scale.set(x,x,x),e instanceof n.PerspectiveCamera?O.copy(W).sub(F).normalize():e instanceof n.OrthographicCamera&&O.copy(W).normalize(),"local"===r.space?a[o].update(V,O):"world"===r.space&&a[o].update(new n.Euler,O),a[o].highlight(r.axis))}};(h.prototype=Object.create(n.Object3D.prototype)).constructor=h,t.a=h},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",function(){return u});var a=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o(this,e),i(this,"lng",void 0),i(this,"lat",void 0),i(this,"alt",void 0),this.lng=t,this.lat=r,this.alt=n},s=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;o(this,e),this.x=t,this.y=r,this.z=n,this.w=i},l=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;o(this,e),this.x=t,this.y=r,this.z=n,i(this,"autoScale",!1)},u=function(){function e(t,r,n){o(this,e),i(this,"_position",new a),i(this,"_orientation",new s),i(this,"_scale",new l),this.position=t,this.orientation=r,this.scale=n}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"copy",value:function(e){e instanceof Object&&(this.position=e.position,this.orientation=e.orientation,this.scale=e.scale)}},{key:"scale",set:function(e){e&&("number"==typeof e?this._scale.x=this._scale.y=this._scale.z=e:e instanceof l&&(this._scale=e))},get:function(){return this._scale}},{key:"position",set:function(e){e&&(this._position.lng=e.lng,this._position.lat=e.lat,this._position.alt=e.alt)},get:function(){return this._position}},{key:"orientation",set:function(e){e&&(this._orientation.x=e.x,this._orientation.y=e.y,this._orientation.z=e.z,this._orientation.w=e.w)},get:function(){return this._orientation}}]),e}()},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(7));function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(e,r,i,l){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u=a(this,s(t).call(this));var c=e/2,f=r/2,h=i/2,p=function(e){var t=[0,0,0,0,0,0,0,0].concat(e).concat(e),r=new n.DataTexture(new Uint8Array(t),2,2,n.RGBAFormat,n.UnsignedByteType,n.UVMapping);return r.needsUpdate=!0,r.minFilter=r.magFilter=n.LinearFilter,r}([255,255,255,255]),d=new n.MeshBasicMaterial({color:l,transparent:!0,alphaMap:p,side:n.DoubleSide,depthWrite:!1});var v=P([0,-f,-h,0,-f,h,0,f,-h,0,f,h],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),m=new n.Mesh(v,d);m.position.x-=c,m.renderOrder=o.a.GLFENCE_SIDE_PLANE_RENDER_ORDER;var y=P([0,-f,-h,0,-f,h,0,f,-h,0,f,h],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),g=new n.Mesh(y,d);g.position.x+=c,g.renderOrder=o.a.GLFENCE_SIDE_PLANE_RENDER_ORDER;var b=P([-c,0,-h,-c,0,h,c,0,-h,c,0,h],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),_=new n.Mesh(b,d);_.position.y-=f,_.renderOrder=o.a.GLFENCE_SIDE_PLANE_RENDER_ORDER;var w=P([-c,0,-h,-c,0,h,c,0,-h,c,0,h],[1,1,1,0,0,1,0,0],[0,1,2,1,2,3],.6),x=new n.Mesh(w,d);x.position.y+=f,x.renderOrder=o.a.GLFENCE_SIDE_PLANE_RENDER_ORDER;var k=P([-c,-f,0,-c,f,0,c,-f,0,c,f,0],[0,0,0,0,0,0,0,0],[0,1,2,1,2,3],.6),O=new n.Mesh(k,d);function P(e,t,r,o){for(var i=0;i<t.length;++i)i%2==1&&(t[i]=t[i]*o);var a=new n.BufferGeometry;return a.addAttribute("position",new n.Float32BufferAttribute(new Float32Array(e),3)),a.addAttribute("uv",new n.Float32BufferAttribute(new Float32Array(t),2)),a.index=new n.Uint16BufferAttribute(new Uint16Array(r),1),a}O.position.z-=h,O.renderOrder=o.a.GLFENCE_BASE_PLANE_RENDER_ORDER,u.add(m),u.add(g),u.add(_),u.add(x),u.add(O);for(var A=new n.BufferGeometry,S=[-c,-f,-h,-c,-f,h,-c,f,-h,-c,f,h,c,-f,-h,c,-f,h,c,f,-h,c,f,h],M=[d.color.r,d.color.g,d.color.b,.66],T=[d.color.r,d.color.g,d.color.b,0],E=[],C=0;C<4;++C)E=E.concat(M).concat(T);A.addAttribute("position",new n.BufferAttribute(new Float32Array(S),3)),A.addAttribute("vertexcolor",new n.BufferAttribute(new Float32Array(E),4));var j=new n.ShaderMaterial({uniforms:{},vertexShader:"attribute vec4 vertexcolor;varying vec4 vColor;void main(){vec3 transformed = vec3( position );vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );gl_Position = projectionMatrix * mvPosition;vColor=vertexcolor;}",fragmentShader:"varying vec4 vColor;void main(){gl_FragColor=vColor;}",blending:n.AdditiveBlending,depthTest:!0,transparent:!0}),R=new n.LineSegments(A,j);return R.renderOrder=o.a.GLFENCE_LINE_RENDER_ORDER,u.add(R),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,n["Object3D"]),t}();t.a=u},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(10)),i=r.n(o),a=r(62),s=r(68),l=r.n(s);function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t){var r=t.url,n=r.cameraFile,o=r.photoMode,i=r.minLevel,a=r.maxLevel,s=r.photoBase,l=t.length_unit_to_meter,u=t.photoHolder,c=t.objToScene,f=t.objToEarth,h=t.createInstance,p=void 0!==h&&h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e){if(!n||!s)return!1;s.endsWith("/")||(console.warn("photoBase isnt ending with slash",s),s+="/");return!!l&&!!u&&!!c}()?(this._3d=u,this._lines=null,this.length_unit_to_meter=l,this._cameras={},this._url={cameraFile:n,photoMode:o,minLevel:i,maxLevel:a,photoBase:s},this._objToScene=function(){return c()},this._objToEarth=function(){return f()},this._indToName={},this._createInstance=p):console.error("PhotoManager",arguments)}return function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(e,[{key:"destruct",value:function(){var e=!0;for(var t in this._lines&&(this._3d.remove(this._lines),this._lines.material.dispose(),this._lines.geometry.dispose(),this._lines=null),this._cameras)e=this._cameras[t].destruct()&&e;return this._kdtree&&this._kdtree.dispose(),e||console.warn("PhotoManager destruct error."),e}},{key:"init",value:function(){var e=this;return this._downloadCameraFile().then(function(t){if(e._lines&&e._3d.remove(e._lines),e._createInstance&&(e._lines=function(t){var r,o,i,a=new n.BufferGeometry,s=new n.LineBasicMaterial({vertexColors:n.VertexColors});if(t instanceof Array){i=parseFloat(t[0][0])/e.length_unit_to_meter,r=new Float32Array(3*(t.length-1)*22),o=new Float32Array(3*(t.length-1)*22);for(var l=1;l<t.length;l++){for(var u=t[l],c=0;c<3;c++)u[c]=u[c]/e.length_unit_to_meter;y(i,u,r,o,l-1)}}else{i=parseFloat(t.camera_scale)/e.length_unit_to_meter;var f=t.camera_info,h=3*f.length*22;r=new Float32Array(h),o=new Float32Array(h);for(var p=0;p<f.length;p++){for(var d=f[p].display,v=0;v<3;v++)d[v]=d[v]/e.length_unit_to_meter;y(i,d,r,o,p)}}a.addAttribute("position",new n.BufferAttribute(r,3)),a.addAttribute("color",new n.BufferAttribute(o,3));var m=new n.LineSegments(a,s);return m.name="cameras",m;function y(e,t,r,o,i){var a,s=new n.Vector3(t[0],t[1],t[2]),l=new n.Vector3(t[3],t[4],t[5]),u=new n.Vector3(t[6],t[7],t[8]);u.normalize().multiplyScalar(e),l.normalize().multiplyScalar(u.length()*t[9]);var c=l.clone().cross(u).normalize().multiplyScalar(l.length()*t[10]),f=new Array(4),h=s.clone().add(u);f[0]=h.clone().sub(l).sub(c),f[1]=h.clone().add(l).sub(c),f[2]=h.clone().add(l).add(c),f[3]=h.clone().sub(l).add(c);var p=[f[0],f[1],f[1],f[2],f[2],f[3],f[3],f[0],s,f[0],s,f[1],s,f[2],s,f[3],h,h.clone().sub(c),h,h.clone().sub(l),h,h.clone().sub(u)],d=[];for(a=0;a<22;a++)a<16?d.push({r:.48,g:.45,b:.89}):a<18?d.push({r:1,g:0,b:0}):a<20?d.push({r:0,g:1,b:0}):a<22&&d.push({r:0,g:0,b:1});for(a=0;a<p.length;a++)r[3*(22*i+a)]=p[a].x,r[3*(22*i+a)+1]=p[a].y,r[3*(22*i+a)+2]=p[a].z,o[3*(22*i+a)]=d[a].r,o[3*(22*i+a)+1]=d[a].g,o[3*(22*i+a)+2]=d[a].b}}(t),e._3d.add(e._lines)),!(t instanceof Array)){var r=parseFloat(t.camera_scale)/e.length_unit_to_meter;(function(t){for(var r=t.camera_info,n=[],o=0;o<r.length;o++){var i=r[o];i.visCam=i.vis_cam,i.mode=e._url.photoMode,i.minLevel=e._url.minLevel,i.maxLevel=e._url.maxLevel,n[o]={name:i.name,width:Number(i.image_size[0]),height:Number(i.image_size[1]),id:i.id,raw:i.raw,display:i.display,visCam:i.visCam,mode:i.mode,minLevel:i.minLevel,maxLevel:i.maxLevel}}return n})(t).forEach(function(t){var n=t.name;if(e._cameras[n])console.warn("".concat(n," exists"),e._cameras[n]);else{t.edgeLength=r;for(var o=0;o<3;o++)t.display[o]=t.display[o]/e.length_unit_to_meter;e._cameras[n]=new a.a(t),e._indToName[t.id]=n}})}return Promise.resolve()}).catch(function(e){return console.error(e),Promise.resolve()})}},{key:"cameraByName",value:function(e){return this._cameras[e]}},{key:"cameraById",value:function(e){return this.cameraByName(this._indToName[e])}},{key:"_downloadCameraFile",value:function(){return i()({method:"get",url:this._url.cameraFile}).then(function(e){return Promise.resolve(e.data)}).catch(function(e){return console.error("_downloadCameraFile",e),Promise.reject(e)})}},{key:"_downloadPhotoThumb",value:function(e){}},{key:"_downloadPhoto",value:function(e){}},{key:"_getClosestCamFromList",value:function(e,t,r){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{dist:100,orient:25};arguments.length>4&&arguments[4];try{o=(new n.Matrix4).getInverse(this._objToScene(),!0)}catch(e){return void console.error(e)}var a=o.multiply(e.matrixWorld.clone()),s=new n.Vector3,l=new n.Quaternion,u=new n.Vector3;a.decompose(s,l,u);var c=new n.Vector3(0,0,-1).applyQuaternion(l).normalize(),f=s,h=99999,p=null;for(var d in r){var v=r[d],m=v.positionInObj.distanceTo(t)/f.distanceTo(t);if(!((m=Math.max(m,1/m))>i.dist)){var y=t.clone().sub(v.positionInObj),g=y.angleTo(c)/Math.PI*180;if(!(g>i.orient)){var b=y.normalize().angleTo(v.lookDirInObj.normalize())/Math.PI*180;if(!(b>.4*v.fov||b>i.orient||b>e.fov/2)){var _=g+2*b;_<h&&(p=d,h=_)}}}}if(null!==p)return r[p]}},{key:"_kClosestCamFromList",value:function(e,t,r){var o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{dist:100,orient:100},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;try{o=(new n.Matrix4).getInverse(this._objToScene(),!0)}catch(e){return void console.error(e)}var s=o.multiply(e.matrixWorld.clone()),u=new n.Vector3,c=new n.Quaternion,f=new n.Vector3;s.decompose(u,c,f);var h=new n.Vector3(0,0,-1).applyQuaternion(c).normalize(),p=u,d=[];for(var v in r){var m=r[v],y=m.positionInObj.distanceTo(t)/p.distanceTo(t);if(!((y=Math.max(y,1/y))>i.dist)){var g=t.clone().sub(m.positionInObj),b=g.angleTo(h)/Math.PI*180;if(!(b>i.orient)){var _=g.normalize().angleTo(m.lookDirInObj.normalize())/Math.PI*180;if(!(_>.4*m.fov||_>i.orient||_>e.fov/2)){var w=b+2*_;d.push({data:v,value:w})}}}}l()(d,a);var x=d.slice(0,a).reduce(function(e,t){return t&&t.value<1/0&&e.push(r[t.data]),e},[]);return console.log(x),x}},{key:"cameraNear",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.3;return this._getClosestCamFromList(e,t,this._cameras,r,n)}},{key:"kCameraNear",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return this._kClosestCamFromList(e,t,this._cameras,r,n)}},{key:"cameraNearPhoto",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.3,i=this,a=r.visCam.map(function(e){return i.cameraById(e)});return this._getClosestCamFromList(e,t,a,n,o)}},{key:"photoUrl",value:function(e){return"".concat(this._url.photoBase).concat(e)}}]),e}();t.a=c},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(63)),i=r(64),a=r(65),s=r(67);function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(t){var r=t.id,a=t.name,s=t.width,l=t.height,u=t.raw,c=t.display,f=t.edgeLength,h=t.visCam,p=t.mode,d=t.maxLevel,v=void 0===d?1:d,m=t.minLevel,y=void 0===m?0:m;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=r,this.name=a,this.width=s,this.height=l,this.raw=u,this.display=c,this.edgeLength=f,this.visCam=h,this.mode=p,this.maxLevel=v,this.minLevel=y,this._tree=null,this._pose=new o.a,this._objToCam=null,this._camToObj=null,this._cvmat=new i.a(u),this.objToCam=this._cvmat.getModelViewMatrix().clone(),this._instance=null,this._photoDisplay=null,this._displayStatus="none";var g=new n.Vector3,b=new n.Quaternion,_=new n.Vector3;this.camToObj.decompose(g,b,_),this._positionInObj=g,this._lookDirInObj=new n.Vector3(0,0,-1).applyQuaternion(b).normalize()}return function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(e,[{key:"destruct",value:function(){return this.disposeDisplay(0,!0),!0}},{key:"disposeDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;"disposing"!==this._displayStatus&&"none"!==this._displayStatus&&(this._displayStatus="disposing",this._disposing(e))}},{key:"loadDisplay",value:function(e){var t=this;if(null===this._tree){var r=e.photoUrl(this.name);this._tree=new a.a(s.a,{sceneGraphRoot:this.photoDisplay,name:"PhotoQuadLodTree",maxLevel:this.maxLevel,minLevel:this.minLevel,mode:this.mode,width:this.width,height:this.height,baseUrl:r,debug:!1})}return this._tree._retrieveBasicTiles().then(function(e){return Promise.resolve(t)})}},{key:"_disposing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("disposing"===this._displayStatus){var r=this;return e<.1?(this._tree&&(this._tree.visible=!1),t&&this._destructDisplay(),!0):(this._tree&&(this._tree.opacity=e),e-=.2,setTimeout(function(){r._disposing(e)},100),!0)}}},{key:"_destructDisplay",value:function(){return this._displayStatus="none",this._tree&&(this._tree.destruct(),this._tree=null),!0}},{key:"addCamera",value:function(e,t,r,o){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=new n.Vector3(t[0],t[1],t[2]),l=new n.Vector3(t[3],t[4],t[5]),u=new n.Vector3(t[6],t[7],t[8]);u.normalize().multiplyScalar(e);var c=Math.tan(this._cvmat.heightAngle()/2);l.normalize().multiplyScalar(u.length()*c);var f=l.clone().cross(u).normalize().multiplyScalar(l.length()*t[10]),h=new Array(4),p=s.clone().add(u);h[0]=p.clone().sub(l).sub(f),h[1]=p.clone().add(l).sub(f),h[2]=p.clone().add(l).add(f),h[3]=p.clone().sub(l).add(f);var d=[h[0],h[1],h[1],h[2],h[2],h[3],h[3],h[0],s,h[0],s,h[1],s,h[2],s,h[3],p,p.clone().sub(f),p,p.clone().sub(l),p,p.clone().sub(u)],v=[];for(i=0;i<22;i++)i<16?v.push({r:.48,g:.45,b:.89}):i<18?v.push({r:1,g:0,b:0}):i<20?v.push({r:0,g:1,b:0}):i<22&&v.push({r:0,g:0,b:1});for(i=0;i<d.length;i++)r[3*(22*a+i)]=d[i].x,r[3*(22*a+i)+1]=d[i].y,r[3*(22*a+i)+2]=d[i].z,o[3*(22*a+i)]=v[i].r,o[3*(22*a+i)+1]=v[i].g,o[3*(22*a+i)+2]=v[i].b}},{key:"objToCam",get:function(){return this._objToCam?this._objToCam.clone():this._objToCam},set:function(e){this._objToCam?this._objToCam.copy(e):this._objToCam=e.clone();try{var t=(new n.Matrix4).getInverse(e,!0);this._camToObj?this._camToObj.copy(t):this._camToObj=t}catch(e){console.error(e)}}},{key:"camToObj",get:function(){return this._camToObj.clone()}},{key:"positionInObj",get:function(){return this._positionInObj.clone()}},{key:"lookDirInObj",get:function(){return this._lookDirInObj.clone()}},{key:"fov",get:function(){return this._cvmat.heightAngle()/Math.PI*180}},{key:"aspect",get:function(){return this.width/this._cvmat.alpha_u_/(this.height/this._cvmat.alpha_v_)}},{key:"near",get:function(){return this.edgeLength}},{key:"pose",set:function(e){this._pose.value=e},get:function(){return this._pose.value}},{key:"photoDisplay",get:function(){var e=this;if(!this._photoDisplay){var t=function(t,r){var o=new n.Vector3(r[0],r[1],r[2]),i=new n.Vector3(r[3],r[4],r[5]),a=new n.Vector3(r[6],r[7],r[8]);a.normalize().multiplyScalar(t);var s=Math.tan(e._cvmat.heightAngle()/2);i.normalize().multiplyScalar(a.length()*s);var l=i.clone().cross(a).normalize().multiplyScalar(i.length()*r[10]),u=new Array(4),c=o.clone().add(a);return u[0]=c.clone().sub(i).sub(l),u[1]=c.clone().add(i).sub(l),u[2]=c.clone().add(i).add(l),u[3]=c.clone().sub(i).add(l),(new n.Matrix4).makeBasis(l.clone().negate(),i.clone(),a.clone().negate().normalize()).setPosition(c)}(this.edgeLength,this.display.slice());this._photoDisplay=new n.Object3D,this._photoDisplay.applyMatrix(t)}return this._displayStatus="ready",this._photoDisplay}},{key:"instance",get:function(){if(!this._instance){var e=new n.BufferGeometry,t=new n.LineBasicMaterial({vertexColors:n.VertexColors}),r=new Float32Array(66),o=new Float32Array(66),i=this.display.slice(),a=this.edgeLength;this.addCamera(a,i,r,o),e.addAttribute("position",new n.BufferAttribute(r,3)),e.addAttribute("color",new n.BufferAttribute(o,3));var s=new n.LineSegments(e,t);s.name="cameras",this._instance=s}return this._instance}}]),e}();t.a=u},function(e,t,r){"use strict";var n=r(5);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,o=t.lat,i=void 0===o?0:o,a=t.alt,s=void 0===a?0:a,l=t.north,u=void 0===l?0:l,c=t.tilt,f=void 0===c?0:c,h=t.up,p=void 0===h?0:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=i,this.alt=s,this.north=u,this.tilt=f,this.up=p}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"lng",set:function(e){this._lng=Math.max(Math.min(180,e),-180)},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(90,e),-90)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*n.a.EARTH_RADIUS,e)},get:function(){return this._alt}},{key:"north",set:function(e){this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,o=e.north,i=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==o&&(this._pose.north=o),void 0!==i&&(this._pose.tilt=i),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}]),e}();t.a=i},function(e,t,r){"use strict";var n=r(0);r.n(n);t.a=function(e){this.raw_=new Array(3),this.u0_=0,this.v0_=0,this.alpha_u_=0,this.alpha_v_=0,this.s_=0,this.center_=null,this.ext_={rotation:null,translation:null},this.M_=null,this.invM_=null,this.p4_=null,this.principle_axis_=null,this.K_=null,this.invK_=null;var t=this,r=!1;function o(){var e=t.raw_,r=new n.Vector3(e[0][0],e[0][1],e[0][2]),o=new n.Vector3(e[1][0],e[1][1],e[1][2]),i=new n.Vector3(e[2][0],e[2][1],e[2][2]),a=new n.Matrix3,s=new n.Vector3,l=1/i.length(),u=l*l;t.u0_=u*r.dot(i),t.v0_=u*o.dot(i),t.alpha_u_=Math.sqrt(u*r.lengthSq()-t.u0_*t.u0_),t.alpha_v_=Math.sqrt(u*o.lengthSq()-t.v0_*t.v0_),a.fromArray(r.clone().sub(i.clone().multiplyScalar(t.u0_)).multiplyScalar(l/t.alpha_u_).toArray().concat(o.clone().sub(i.clone().multiplyScalar(t.v0_)).multiplyScalar(l/t.alpha_v_).toArray()).concat(i.clone().normalize().toArray())).transpose(),s.z=l*e[2][3],s.x=l*(e[0][3]-t.u0_*e[2][3])/t.alpha_u_,s.y=l*(e[1][3]-t.v0_*e[2][3])/t.alpha_v_,t.ext_.rotation=a,t.ext_.translation=s,t.center_=s.clone().negate().applyMatrix3(a.clone().transpose()),t.M_=(new n.Matrix3).set(e[0][0],e[0][1],e[0][2],e[1][0],e[1][1],e[1][2],e[2][0],e[2][1],e[2][2]),t.p4_=new n.Vector3(e[0][3],e[1][3],e[2][3]),t.invM_=(new n.Matrix3).getInverse(t.M_);var c=new n.Vector3(e[2][0],e[2][1],e[2][2]);t.M_.determinant()<0&&c.negate(),t.principle_axis_=c.multiplyScalar(1/c.length())}!function(){if(e&&e.length>=12){for(var i=0;i<3;++i){t.raw_[i]=new Array(4);for(var a=0;a<4;++a)t.raw_[i][a]=e[4*i+a]}(function(){if(o(),t.ext_.rotation.determinant()<0){var e=new Array(3),r=t.alpha_u_,n=t.alpha_v_;e=[[r,0,r],[0,r,n],[0,0,1]];for(var i=new Array(3),a=0;a<3;++a){i[a]=new Array(4);for(var s=0;s<3;++s)i[a][s]=t.ext_.rotation[a][s];i[a][3]=-t.ext_.translation[a]}for(var l=0;l<3;++l)for(var u=0;u<4;++u)t.raw_[l][u]=e[l][0]*i[0][u]+e[l][1]*i[1][u]+e[l][2]*i[2][u];o()}})(),t.K_=(new n.Matrix3).set(t.alpha_u_,0,t.u0_,0,t.alpha_v_,t.v0_,0,0,1),t.M_=t.K_.clone().multiply(t.ext_.rotation),t.p4_=t.ext_.translation.clone().applyMatrix3(t.M_),t.invM_=(new n.Matrix3).getInverse(t.M_),t.invK_=(new n.Matrix3).getInverse(t.K_),t.principle_axis_=new n.Vector3(t.ext_.rotation.elements[2],t.ext_.rotation.elements[5],t.ext_.rotation.elements[8]),t.M_.determinant()<0&&t.principle_axis_.negate(),r&&(console.log("-----------------------"),console.log("In"),console.log("Focal",t.alpha_u_),console.log("Projective Center x:",t.u0_,"y:",t.v0_,"s:",t.s_),console.log("Ext"),console.log("center:",t.center_),console.log("Rotation",t.ext_.rotation),console.log("Translation",t.ext_.translation))}else console.log("input error!")}(),this.getModelViewMatrix=function(){var e,r=t.center_;!function(){var r=(new n.Matrix3).set(1,0,0,0,-1,0,0,0,-1);e=r.multiply(t.ext_.rotation)}();var o=function(e){var t={X:0,Y:0,Z:0,W:0},r=e.clone().elements,n=function(e){return e.elements[0]+e.elements[4]+e.elements[8]}(e)+1;if(n>1e-6){var o=.5/Math.sqrt(n);t.W=.25/o,t.X=(r[7]-r[5])*o,t.Y=(r[2]-r[6])*o,t.Z=(r[3]-r[1])*o}else if(r[0]>r[4]&&r[0]>r[8]){var i=2*Math.sqrt(1+r[0]-r[4]-r[8]);t.X=.25*i,t.Y=(r[1]+r[3])/i,t.Z=(r[2]+r[6])/i,t.W=(r[5]+r[7])/i}else if(r[4]>r[8]){var a=2*Math.sqrt(1+r[4]-r[0]-r[8]);t.X=(r[1]+r[3])/a,t.Y=.25*a,t.Z=(r[5]+r[7])/a,t.W=(r[2]+r[6])/a}else{var s=2+Math.sqrt(1+r[8]-r[0]-r[4]);t.X=(r[2]+r[6])/s,t.Y=(r[5]+r[7])/s,t.Z=.25*s,t.W=(r[1]-r[3])/s}return t}(e);return function(e){var t=Math.sqrt(e.X*e.X+e.Y*e.Y+e.Z*e.Z+e.W*e.W);e.X/=t,e.Y/=t,e.X/=t,e.W/=t}(o),e=function(e,t){var r=e.clone().elements,n=t.W*t.W,o=t.X*t.X,i=t.Y*t.Y,a=t.Z*t.Z,s=1/(o+i+a+n);r[0]=(o-i-a+n)*s,r[4]=(-o+i-a+n)*s,r[8]=(-o-i+a+n)*s;var l=t.X*t.Y,u=t.Z*t.W;r[3]=2*(l+u)*s,r[1]=2*(l-u)*s,l=t.X*t.Z,u=t.Y*t.W,r[6]=2*(l-u)*s,r[2]=2*(l+u)*s,l=t.Y*t.Z,u=t.X*t.W,r[7]=2*(l+u)*s,r[5]=2*(l-u)*s;for(var c=new Array(3),f=0;f<3;++f){c[f]=new Array(3);for(var h=0;h<3;++h)c[f][h]=r[3*f+h]}return c}(e,o),function(){for(var t=[],o=0;o<3;++o){for(var i=0;i<3;++i)t.push(e[o][i]);t.push(0)}t.push(0),t.push(0),t.push(0),t.push(1);var a=(new n.Matrix4).fromArray(t),s=(new n.Matrix4).fromArray([1,0,0,0,0,1,0,0,0,0,1,0,-r.x,-r.y,-r.z,1]);return a.multiply(s)}()},this.getProjectionMatrix=function(e,r,o,i){var a=o/t.alpha_u_*e,s=i/t.alpha_v_*e,l=a-t.u0_/t.alpha_u_*e,u=l-a,c=t.v0_/t.alpha_v_*e,f=c-s,h=2*e/(l-u),p=(l+u)/(l-u),d=2*e/(c-f),v=(c+f)/(c-f),m=-(r+e)/(r-e),y=r*e*-2/(r-e),g=new n.Matrix4,b=new Array(12);return b[0]=h,b[1]=0,b[2]=p,b[3]=0,b[4]=0,b[5]=d,b[6]=v,b[7]=0,b[8]=0,b[9]=0,b[10]=m,b[11]=y,b[12]=0,b[13]=0,b[14]=-1,b[15]=0,g.set(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]),g},this.getProjectionFov=function(e,t,r,o){var i=new n.Matrix4,a=r*Math.tan(.5*e),s=o-r,l=-(o+r)/s,u=o*r*-2/s,c=2*r/(a- -a);c/=t;var f=2*r/(a- -a),h=new Array(16);return h[0]=c,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=f,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=l,h[11]=u,h[12]=0,h[13]=0,h[14]=-1,h[15]=0,i.set(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15]),i},this.getU=function(){return this.u0_},this.getV=function(){return this.v0_},this.heightAngle=function(){return 2*Math.atan(t.v0_/t.alpha_v_)},this.pointApply=function(e){return(new n.Vector3).set(e[0],e[1],e[2]).applyMatrix3(t.ext_.rotation).add(t.ext_.translation).toArray()}}},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),r(0)),i=(r.n(o),r(66));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){u(e,t,r[t])})}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t,r){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(e,r){var o,a=r.sceneGraphRoot,s=r.name,l=void 0===s?"PhotoQuadLodTree":s,u=r.eventHandlers,c=void 0===u?{}:u,h=r.maxLevel,d=void 0===h?1:h,v=r.minLevel,m=void 0===v?0:v,y=r.mode,g=r.width,b=r.height,_=r.baseUrl,w=r.debug,x=void 0!==w&&w,k=r.TreeMaterialType,O=void 0===k?n.TreeMaterial:k,P=r.NodeMaterialType,A=void 0===P?i.a:P;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=f(this,p(t).call(this,e,{sceneGraphRoot:a,name:l,eventHandlers:c,maxLevel:d,minLevel:m,debug:x,TreeMaterialType:O,NodeMaterialType:A}))).sharedOptions.treeMaterial=o.material,o.mode=y,o.baseUrl=_,o.width=g,o.height=b,"lod"===y){var S=Math.max(g,b),M=Math.log2(S),T=Math.floor(M);M=M>T?T+1:T,o.boundingPowerof2=Math.pow(2,M)}return o.root=new o.Node({parent:null,name:l,x:0,y:0,level:0,sharedOptions:o.sharedOptions}),o.numOfNodes++,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,n["QuadLodTree"]),function(e,t,r){t&&c(e.prototype,t),r&&c(e,r)}(t,[{key:"destruct",value:function(){return this.maxLevel=0,this.minLevel=0,h(p(t.prototype),"destruct",this).call(this)}},{key:"expand",value:function(e){if("lod"===this.mode){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){for(var r=e.x,n=e.y,o={level:e.level+1,parent:e,sharedOptions:this.sharedOptions},i=[l({x:2*r,y:2*n},o),l({x:2*r,y:2*n+1},o),l({x:2*r+1,y:2*n},o),l({x:2*r+1,y:2*n+1},o)],a=[],s=0;s<i.length;++s){var u=this._generateMapInfo(i[s].level,i[s].x,i[s].y);u.fromRect[0]<u.fromRect[2]&&u.fromRect[1]<u.fromRect[3]&&a.push(i[s])}for(var c=0;c<a.length;++c)e.nodes[c]=new this.Node(a[c]);return this.numOfNodes+=a.length,this.debug&&console.log("tree expand"),!0}return console.warn("unknown expand error"),!1}return h(p(t.prototype),"expand",this).call(this,e)}},{key:"_retrieveBasicTiles",value:function(){for(var e=this,t=this,r=[this.root],n=0;n<this.minLevel;++n){for(var o=[],i=0;i<r.length;++i)0===r[i].nodes.length&&this.expand(r[i]),o.push.apply(o,s(r[i].nodes));r=o}for(var a=[],l=0;l<r.length;++l)r[l].loaded||a.push(r[l]);var u=a.map(function(t){return e._sendMapRequest(t.level,t.x,t.y).then(function(r){e._putTexture2node(r,t)})});return Promise.all(u).then(function(){return Promise.resolve(t)})}},{key:"_retrieveAllTiles",value:function(){for(var e=[this.root],t=0;t<this.minLevel;++t){for(var r=[],n=0;n<e.length;++n)e[n].nodes.length>0?r.push.apply(r,s(e[n].nodes)):r.push(e[n]);e=r}for(var o=0;o<e.length;++o)this._loadChildrenTiles(e[o])}},{key:"_putTexture2node",value:function(e,t){if(!t.expired){e.wrapS=e.wrapT=o.ClampToEdgeWrapping,e.minFilter=e.magFilter=o.LinearFilter;var r=this._generateMapInfo(t.level,t.x,t.y,e),n=t.digest({map:e,mapInfo:r});t.onContentLoaded(n),t.displayByload()}}},{key:"_sendMapRequest",value:function(e,t,r){var o=this.baseUrl+("lod"===this.mode?"/".concat(e,"/").concat(t,"/").concat(r,".jpg"):"");return n.LoadUtil.loadTexture({textureUrl:o},6e4)}},{key:"_loadChildrenTiles",value:function(e){var t=this;e.expired||e.level>=this.maxLevel||"lod"!==this.mode||this.expand(e)&&e.nodes.map(function(e){t._sendMapRequest(e.level,e.x,e.y).then(function(r){t._putTexture2node(r,e),t._loadChildrenTiles(e)})})}},{key:"_generateMapInfo",value:function(e,t,r,n){var o=Math.pow(2,e),i=[0,0,1,1],a=[t/o,(r=o-1-r)/o,(t+1)/o,(r+1)/o];if("lod"===this.mode){var s=(1-this.width/this.boundingPowerof2)/2,l=(1-this.height/this.boundingPowerof2)/2,u=o*s,c=o*l;if(t<u||r<c||t>o-1-u||r>o-1-c){var f=a.slice();t<u&&(a[0]=s),t>o-1-u&&(a[2]=1-s),r<c&&(a[1]=l),r>o-1-c&&(a[3]=1-l),i=[(a[0]-f[0])/(f[2]-f[0]),(a[1]-f[1])/(f[3]-f[1]),(a[2]-f[0])/(f[2]-f[0]),(a[3]-f[1])/(f[3]-f[1])],n&&(i=[h(i[0],n.image.width),h(i[1],n.image.height),h(i[2],n.image.width),h(i[3],n.image.height)])}a[0]=(a[0]-s)/(1-2*s),a[1]=(a[1]-l)/(1-2*l),a[2]=(a[2]-s)/(1-2*s),a[3]=(a[3]-l)/(1-2*l)}return{fromRect:i,toRect:a};function h(e,t){var r=e*t;return(r=Math.floor(r))/t}}},{key:"opacity",set:function(e){this.sharedOptions.opacity=e,this.traverse(this.root,function(t){t&&t.content&&t.content.material&&(t.content.material.opacity=e)})},get:function(){return this.sharedOptions.opacity}}]),t}();t.a=v},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u="\nvarying vec2 textureCoord;\nvoid main () {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  textureCoord = uv;\n}\n",c="\nvarying vec2 textureCoord;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec4 fromRect;\nuniform vec4 toRect;\nvec4 getColor (sampler2D map, vec2 uv, vec4 fromRect, vec4 toRect) {\n  vec2 scale = (uv - toRect.xy) / (toRect.zw - toRect.xy);\n  vec2 nuv = fromRect.xy + scale * (fromRect.zw - fromRect.xy);\n  return texture2D(map, nuv);\n}\nvoid main () {\n  vec4 color = getColor(map, textureCoord, fromRect, toRect);\n  gl_FragColor = vec4(color.xyz, opacity);\n}\n",f=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=a(this,s(t).call(this,{}));var n=e.map,o=void 0===e.opacity?1:e.opacity,i=void 0===e.fromRect?[0,0,1,1]:e.fromRect,l=void 0===e.toRect?[0,0,1,1]:e.toRect;return r.uniforms={map:{type:"t",value:n},opacity:{type:"f",value:o},fromRect:{type:"f4",value:i},toRect:{type:"f4",value:l}},r.vertexShader=u,r.fragmentShader=c,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,n["ShaderMaterial"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"opacity",set:function(e){this.uniforms&&(this.uniforms.opacity.value=e)},get:function(){return this.uniforms.opacity.value}},{key:"map",set:function(e){this.uniforms.map.value=e},get:function(){return this.uniforms.map.value}},{key:"fromRect",set:function(e){this.uniforms.fromRect.value=e},get:function(){return this.uniforms.fromRect.value}},{key:"toRect",set:function(e){this.uniforms.toRect.value=e},get:function(){return this.uniforms.toRect.value}}]),t}();t.a=f},function(e,t,r){"use strict";var n=r(1),o=(r.n(n),r(0));r.n(o);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var r,n=e.parent,o=e.name,i=e.x,a=e.y,l=e.level,c=e.sharedOptions;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,u(t).call(this,{parent:n,name:o,x:i,y:a,level:l,sharedOptions:c}))).style={},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["QuadLodNode"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"destruct",value:function(){var e=l(u(t.prototype),"destruct",this).call(this);return this.style.map&&(this.style.map.dispose(),this.style.map=void 0),this._material&&this._material.dispose(),e}},{key:"digest",value:function(e){var t=e.map,r=e.mapInfo;this.gpuUsage=t.image.width*t.image.height*4,this.style.map&&(this.style.map.dispose(),this.style.map=void 0),this.style.map=t,this.style.fromRect=r.fromRect,this.style.toRect=r.toRect;var n=r.toRect,i=new o.BufferGeometry;return i.addAttribute("position",new o.Float32BufferAttribute(new Float32Array([2*n[0]-1,2*n[3]-1,0,2*n[2]-1,2*n[3]-1,0,2*n[0]-1,2*n[1]-1,0,2*n[2]-1,2*n[1]-1,0]),3)),i.addAttribute("normal",new o.Float32BufferAttribute(new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),3)),i.addAttribute("uv",new o.Float32BufferAttribute(new Float32Array([n[0],n[3],n[2],n[3],n[0],n[1],n[2],n[1]]),2)),i.setIndex([0,2,1,2,3,1]),new o.Mesh(i,this.material)}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,e&&(e.map&&e.map.dispose(),e.dispose())}return!0}},{key:"material",get:function(){return this._material||(this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this)),this._material}}]),t}();t.a=f},function(e,t,r){var n,o,i;!function(r,a){o=[e,t],void 0===(i="function"==typeof(n=a)?n.apply(t,o):n)||(e.exports=i)}(0,function(e,t){"use strict";function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t,n){for(var o=e[Math.floor((n+t)/2)];t<=n;){for(;e[t].value<o.value;)t++;for(;e[n].value>o.value;)n--;t<=n&&(r(e,t,n),t++,n--)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.length,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:t.length-1;if(o<i){var a=n(t,o,i);e(t,r,o,a-1),a<r-1&&e(t,r,a,i)}},e.exports=t.default})},function(e,t,r){"use strict";var n=r(70),o=r(1),i=(r.n(o),r(0));r.n(i);function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){s(e,t,r[t])})}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(e,t,r,n,o,i,a){try{var s=e[i](a),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,s,"next",e)}function s(e){u(i,n,o,a,s,"throw",e)}a(void 0)})}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(t){var r=this,n=t.waterHolder,o=t.marker,a=t.PID,s=t.altizureApi,l=t.spec,u=t.renderer,c=t.camera,f=t.scene;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.PID=a,this.marker=o,this._waterHolder=n,this._waters=[],this._altizureApi=s,this._renderer=u,this._camera=c,this._scene=f,this._waterMasks=[],this._orthoInfo=l.model.orthoInfo,this.waterProperty={},this.waterProperty.width=this._orthoInfo.maxBound.x-this._orthoInfo.minBound.x,this.waterProperty.height=this._orthoInfo.maxBound.y-this._orthoInfo.minBound.y,this.waterProperty.maxLevel=this._orthoInfo.maxBound.z,this.waterProperty.minLevel=this._orthoInfo.minBound.z,this.waterProperty.position=(new i.Vector3).addVectors(this._orthoInfo.minBound,this._orthoInfo.maxBound).multiplyScalar(.5),this.waterProperty.maxWave=Math.max(this.waterProperty.width,this.waterProperty.height)/100,this.initialized=this.downloadNormalTexture().then(function(){return Promise.resolve(r.marker)})}return function(e,t,r){t&&f(e.prototype,t),r&&f(e,r)}(e,[{key:"destruct",value:function(){return this.deport(),this.waterProperty={},this.initialized=void 0,!0}},{key:"deport",value:function(){var e=this;if(this._waters.length>0&&(this._waters.forEach(function(t){e._waterHolder.remove(t),t.destruct()}),this._waters=[]),this._waterMasks.length>0){for(var t=0;t<this._waterMasks.length;++t)this._waterMasks[t].destruct();this._waterMasks=[]}}},{key:"destructWater",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._removeWater(e)}},{key:"destructAllWater",value:function(){this.deport()}},{key:"_removeWater",value:function(e){var t=this._waters[e],r=this._waterMasks[e];this._waters.splice(e,1),this._waterMasks.splice(e,1),this._waterHolder.remove(t),t.destruct(),r.destruct()}},{key:"import",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",this.initialized.then(function(){return r.download().then(function(e){var r=l(e,2),n=(r[0],r[1]);if(n&&n.length>0){var o=n.map(function(e){return t.create(e)});return Promise.all(o)}var i="No water exists.";return console.warn(i),Promise.reject(new Error(i))}).then(function(e){return Promise.resolve(t.marker)}).catch(function(e){return console.warn(e),Promise.reject(e)})}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"importLocal",value:function(){var e=c(regeneratorRuntime.mark(function e(t,r){var n,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this,e.abrupt("return",this.initialized.then(function(){return Promise.all([o.downloadNormalTextureLocal(r),o.loadWaterParams(t)])}).then(function(e){var t=l(e,2),r=(t[0],t[1]);if(r&&r.length>0){var o=r.map(function(e){return n.createLocal(e)});return Promise.all(o)}var i="No water exists.";return console.warn(i),Promise.reject(new Error(i))}).then(function(e){return Promise.resolve(n.marker)}).catch(function(e){return console.warn(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getWaterMasks",value:function(){for(var e=[],t=0;t<this._waters.length;++t){var r=this._waters[t],n=a({},this._waterMasks[t].packMask(),{level:r.level,color:r.color,wave:r.wave,alpha:r.alpha});e.push(n)}return[{maskInfos:e}]}},{key:"crop",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.map(function(e){return t.marker.geoToProfile(e.lng,e.lat)}),i=this._waterMasks[n];i.paintPolygon(o,"#f00",r);var a=this.getWater(n),s=a.material.uniforms.cropMask.value;return i.texture!==s&&(s.dispose(),a.material.uniforms.cropMask.value=i.texture),!0}},{key:"uncrop",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.marker,o=e&&e.length>2?e.map(function(e){return n.geoToProfile(e.lng,e.lat)}):[{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}],i=this._waterMasks[r];i.paintPolygon(o,"#0f0",t);var a=this.getWater(r),s=a.material.uniforms.cropMask.value;return i.texture!==s&&(s.dispose(),a.material.uniforms.cropMask.value=i.texture),!0}},{key:"downloadNormalTexture",value:function(){var t=c(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.waterNormalTexture){t.next=4;break}return t.abrupt("return",Promise.resolve(e.waterNormalTexture));case 4:return r="https://cdn-china.altizure.cn/public/images/editor/assets/img/waternormals.jpg",n="https://cdn-inter.altizure.com/public/images/editor/assets/img/waternormals.jpg",t.abrupt("return",Promise.race([o.LoadUtil.loadTexture({textureUrl:r},6e4),o.LoadUtil.loadTexture({textureUrl:n},6e4)]).then(function(e){return e.wrapS=e.wrapT=i.RepeatWrapping,Promise.resolve(e)}).catch(function(e){return console.warn("Water Normal Texture",e),Promise.resolve(o.presetTexture.solidColorTexture(0,0,0))}).then(function(t){return e.waterNormalTexture=t,Promise.resolve(t)}));case 7:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},{key:"downloadNormalTextureLocal",value:function(){var t=c(regeneratorRuntime.mark(function t(r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.waterNormalTexture){t.next=4;break}return t.abrupt("return",Promise.resolve(e.waterNormalTexture));case 4:return t.abrupt("return",o.LoadUtil.loadTexture({textureUrl:r},6e4).then(function(e){return e.wrapS=e.wrapT=i.RepeatWrapping,Promise.resolve(e)}).catch(function(e){return console.warn("Water Normal Texture",e),Promise.resolve(o.presetTexture.solidColorTexture(0,0,0))}).then(function(t){return e.waterNormalTexture=t,Promise.resolve(t)}));case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"download",value:function(){var e=c(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.downloadNormalTexture(),r=this.downloadWaterParams(),e.abrupt("return",Promise.all([t,r]));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"downloadWaterParams",value:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.MaskLoader.loadMaskAPI({api:this.altizureApi,pid:this.PID,type:"water"}).then(function(e){return Promise.resolve(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"loadWaterParams",value:function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.MaskLoader.loadMaskLocal({apiInfo:t,type:"water"}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(e){var t=this;return this.downloadNormalTexture().then(function(r){e.normalMap=r;var n=t._createWater(e);return t._waters.push(n.water),t._waterMasks.push(n.mask),Promise.resolve(n)})}},{key:"createLocal",value:function(e){var t=this;return this.downloadNormalTextureLocal().then(function(r){e.normalMap=r;var n=t._createWater(e);return t._waters.push(n.water),t._waterMasks.push(n.mask),Promise.resolve(n)})}},{key:"createWater",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{alpha:.9,color:378258,level:0,speed:.5,wave:.5,maskSize:2048},r=t.alpha,n=void 0===r?.9:r,o=t.color,i=void 0===o?378258:o,a=t.level,s=void 0===a?0:a,l=t.speed,u=void 0===l?.5:l,c=t.wave,f=void 0===c?.5:c,h=t.maskSize,p=void 0===h?2048:h;if(!e.waterNormalTexture)return this.downloadNormalTexture(),void console.warn("[WaterManager] texture not ready, please import before call createWater");var d=this._createWater({alpha:n,color:i,level:s,speed:u,wave:f,width:p,height:p,image:{rgba:null},normalMap:e.waterNormalTexture});return this._waters.push(d.water),this._waterMasks.push(d.mask),this._waters.length-1}},{key:"_createWater",value:function(e){var t=e.alpha,r=e.color,a=e.level,s=e.speed,l=e.wave,u=e.width,c=e.height,f=e.image,h=e.normalMap,p=(e.polyNum,new o.ProjectBooleanMask({maskSize:u}));f.rgba&&u&&u>0&&(p.imageData={uint8:f.rgba,maskSize:u});var d=p.texture,v={renderer:this._renderer,camera:this._camera,scene:this._scene,alpha:t,color:r,level:a,speed:s,wave:l,width:u,height:c,waterWidth:this.waterProperty.width,waterHeight:this.waterProperty.height,normalMap:h,cropMask:d},m=new n.a(v),y=new i.Vector3(this.waterProperty.position.x,this.waterProperty.position.y,this.waterProperty.position.z);return y.setZ(a),m.position.copy(y),m.updateMatrix(),this._waterHolder.add(m),{water:m,mask:p}}},{key:"animate",value:function(){var e=0,t=(new Date).getTime();this._lastUpdateTime&&(e=t-this._lastUpdateTime,this._waters.forEach(function(t){t.animate(e)})),this._lastUpdateTime=t}},{key:"getWater",value:function(e){return this._waters[e]}},{key:"_maskToTexture",value:function(e){var t=e.uint8,r=e.maskSize;return t&&r&&r>0?this._waterMask.imageData={uint8:t,maskSize:r}:console.warn("no Mask"),this._waterMask.texture}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"defaultConfig",get:function(){return{}}},{key:"speed",get:function(){return this.defaultWater.speed},set:function(e){this.defaultWater.speed=e}},{key:"wave",get:function(){return this.defaultWater.wave},set:function(e){this.defaultWater.wave=e}},{key:"color",get:function(){return this.defaultWater.color},set:function(e){this.defaultWater.color=e}},{key:"level",get:function(){return this.defaultWater.level},set:function(e){this.defaultWater.level=e}},{key:"defaultWater",get:function(){if(this._waters.length>0)return this._waters[0];console.warn("No water exists.")}}]),e}();h.waterNormalTexture=null,t.a=h},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u={uniforms:n.UniformsUtils.merge([n.UniformsLib.fog,{normalMap:{type:"t",value:null},mirrorSampler:{type:"t",value:null},alpha:{type:"f",value:1},time:{type:"f",value:0},distortionScale:{type:"f",value:20},noiseScale:{type:"f",value:1},textureMatrix:{type:"m4",value:new n.Matrix4},sunColor:{type:"c",value:new n.Color(8355711)},sunDirection:{type:"v3",value:new n.Vector3(.70707,.70707,0)},eye:{type:"v3",value:new n.Vector3(0,0,0)},waterColor:{type:"c",value:new n.Color(5592405)},cropMask:{type:"t",value:null},useMask:{type:"b",value:!1}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","void main()","{","  mirrorCoord = modelMatrix * vec4(position, 1.0);","  worldPosition = mirrorCoord.xyz;","  modelPosition = position;","  surfaceX = vec3( modelMatrix[0][0], modelMatrix[0][1], modelMatrix[0][2]);","  surfaceY = vec3( modelMatrix[1][0], modelMatrix[1][1], modelMatrix[1][2]);","  surfaceZ = vec3( modelMatrix[2][0], modelMatrix[2][1], modelMatrix[2][2]);","  vUv = uv;","  mirrorCoord = textureMatrix * mirrorCoord;","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform float noiseScale;","uniform sampler2D normalMap;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","varying vec3 modelPosition;","varying vec3 surfaceX;","varying vec3 surfaceY;","varying vec3 surfaceZ;","varying vec2 vUv;","uniform sampler2D cropMask;","uniform bool useMask;","void sunLight(const vec3 surfaceNormal, const vec3 eyeDirection, in float shiny, in float spec, in float diffuse, inout vec3 diffuseColor, inout vec3 specularColor)","{","  vec3 reflection = normalize(reflect(-sunDirection, surfaceNormal));","  float direction = max(0.0, dot(eyeDirection, reflection));","  specularColor += pow(direction, shiny) * sunColor * spec;","  diffuseColor += max(dot(sunDirection, surfaceNormal), 0.0) * sunColor * diffuse;","}","vec3 getNoise(in vec2 uv)","{","  vec2 uv0 = uv / (103.0 * noiseScale) + vec2(time / 17.0, time / 29.0);","  vec2 uv1 = uv / (107.0 * noiseScale) - vec2(time / -19.0, time / 31.0);","  vec2 uv2 = uv / (vec2(8907.0, 9803.0) * noiseScale) + vec2(time / 101.0, time /   97.0);","  vec2 uv3 = uv / (vec2(1091.0, 1027.0) * noiseScale) - vec2(time / 109.0, time / -113.0);","  vec4 noise = texture2D(normalMap, uv0) +","    texture2D(normalMap, uv1) +","    texture2D(normalMap, uv2) +","    texture2D(normalMap, uv3);","  return noise.xyz * 0.5 - 1.0;","}",n.ShaderChunk.common,"void main()","{","  vec3 worldToEye = eye - worldPosition;","  vec3 eyeDirection = normalize(worldToEye);","  if (useMask) {","    vec2 os_uv = vec2(vUv.x, 1.0 - vUv.y);","    float mask_val = texture2D(cropMask, os_uv).y;","    if(mask_val < 0.05) {","      discard;","    }","  }","  vec3 noise = getNoise(modelPosition.xy * 1.0);","  vec3 distordCoord = noise.x * surfaceX + noise.y * surfaceY;","  vec3 distordNormal = normalize(distordCoord + surfaceZ);","  if(dot(eyeDirection, surfaceZ) < 0.0)","    distordNormal = distordNormal * -1.0;","  vec3 diffuseLight = vec3(0.0);","  vec3 specularLight = vec3(0.0);","  sunLight(distordNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight);","  float distance = length(worldToEye);","  vec2 distortion = distordCoord.xy * distortionScale * sqrt(distance) * 0.07;"," vec3 mirrorDistord = mirrorCoord.xyz + vec3(distortion.x, distortion.y, 0.0);"," vec3 reflectionSample = texture2DProj(mirrorSampler, mirrorCoord).xyz;","  float theta = max(dot(eyeDirection, distordNormal), 0.0);","  float reflectance = 0.3 + (1.0 - 0.3) * pow((1.0 - theta), 3.0);","  vec3 scatter = max(0.0, dot(distordNormal, eyeDirection)) * waterColor;","  vec3 albedo = mix(sunColor * diffuseLight * 0.3 + scatter, (vec3(0.1) + reflectionSample * 0.9 + reflectionSample * specularLight), reflectance);"," vec3 outgoingLight = albedo;"," gl_FragColor = vec4( outgoingLight, alpha );","}"].join("\n")},c=function(e){function t(e){var r,o=e.renderer,i=e.camera,l=e.scene,c=(e.width,e.height,e.level,e.waterWidth),f=e.waterHeight,h=e.alpha,p=void 0===h?1:h,d=e.color,v=void 0===d?8355711:d,m=e.speed,y=void 0===m?.5:m,g=e.wave,b=void 0===g?1:g,_=e.normalMap,w=void 0===_?null:_,x=e.cropMask,k=void 0===x?null:x,O=(e.clipBias,e.sunColor),P=void 0===O?16777215:O,A=e.sunDirection,S=void 0===A?new n.Vector3(.70707,.70707,0):A,M=e.eye,T=void 0===M?new n.Vector3(0,0,0):M,E=e.distortionScale,C=void 0===E?20:E,j=e.side,R=void 0===j?n.FrontSide:j,L=e.fog,I=void 0!==L&&L;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var D=new n.PlaneBufferGeometry(c,f,3,3),z=new n.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:n.UniformsUtils.clone(u.uniforms),transparent:!0,side:R,fog:I});return z.uniforms.alpha.value=p,z.uniforms.time.value=0,z.uniforms.normalMap.value=w,z.uniforms.sunColor.value=new n.Color(P),z.uniforms.waterColor.value=new n.Color(v),z.uniforms.sunDirection.value=S,z.uniforms.eye.value=T,z.uniforms.distortionScale.value=C,z.uniforms.noiseScale.value=b,z.uniforms.cropMask.value=k,z.uniforms.useMask.value=null!==k,(r=a(this,s(t).call(this,D,z))).name="water",r._renderer=o,i instanceof n.PerspectiveCamera?r._camera=i:(r._camera=new n.PerspectiveCamera,console.error(r.name+": camera is not a Perspective Camera!")),r._scene=l,r.speed=y,r.renderBuf=new n.WebGLRenderTarget(512,512),r.textureMatrix=new n.Matrix4,r.mirrorCamera=r._camera.clone(),r.mirrorPlane=new n.Plane,r.clipPlane=new n.Vector4,z.uniforms.mirrorSampler.value=r.renderBuf.texture,z.uniforms.textureMatrix.value=r.textureMatrix,r.material.needsUpdate=!0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,n["Mesh"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"destruct",value:function(){return this.geometry.dispose(),this.material.dispose(),this.renderBuf.dispose(),console.warn("water desctruct not implemented"),!0}},{key:"animate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;if(this.material.uniforms.time.value+=this.speed*e/2e3,this._scene){this.updateTextureMatrix(),this.material.visible=!1;var t=this.renderBuf,r=this._renderer.getRenderTarget();this._renderer.setRenderTarget(t),this._renderer.clear(),this._renderer.render(this._scene,this.mirrorCamera,t,!0),this._renderer.setRenderTarget(r),this.material.visible=!0}this.material.needsUpdate=!0}},{key:"updateTextureMatrix",value:function(){this.updateMatrixWorld(),this._camera.updateMatrixWorld();var e=(new n.Vector3).setFromMatrixPosition(this._camera.matrixWorld),t=(new n.Vector3).setFromMatrixPosition(this.matrixWorld),r=(new n.Matrix4).extractRotation(this.matrixWorld),o=new n.Vector3(0,0,1).applyEuler((new n.Euler).setFromRotationMatrix(r)),i=e.clone().sub(t);if(o.dot(i)<0){var a=new n.Vector3(0,0,1).applyEuler((new n.Euler).setFromRotationMatrix(r));o.reflect(a)}var s=i.clone().negate();s.reflect(o).negate(),s.add(t);var l=(new n.Matrix4).extractRotation(this._camera.matrixWorld),u=(new n.Vector3).set(0,0,-1);u.applyMatrix4(l),u.add(e);var c=t.clone().sub(u);c.reflect(o).negate(),c.add(t);var f=new n.Vector3(0,-1,0);f.applyMatrix4(l),f.reflect(o).negate(),this.mirrorCamera.position.copy(s),this.mirrorCamera.up=f,this.mirrorCamera.lookAt(c),this.mirrorCamera.aspect=this._camera.aspect,this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(o,t),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var h=new n.Vector4,p=this.mirrorCamera.projectionMatrix;h.x=(v(this.clipPlane.x)+p.elements[8])/p.elements[0],h.y=(v(this.clipPlane.y)+p.elements[9])/p.elements[5],h.z=-1,h.w=(1+p.elements[10])/p.elements[14];var d=new n.Vector4;function v(e){return e?e<0?-1:1:0}d=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(h)),p.elements[2]=d.x,p.elements[6]=d.y,p.elements[10]=d.z+1- -1e-4,p.elements[14]=d.w,this.material.uniforms.eye.value=e}},{key:"wave",get:function(){return this.material.uniforms.noiseScale.value},set:function(e){this.material.uniforms.noiseScale.value=e,this.material.needsUpdate=!0}},{key:"color",get:function(){return this.material.uniforms.waterColor.value.getHex()},set:function(e){this.material.uniforms.waterColor.value=new n.Color(e),this.material.needsUpdate=!0}},{key:"level",get:function(){return this.position.z},set:function(e){this.position.z=e}},{key:"alpha",get:function(){return this.material.uniforms.alpha.value},set:function(e){this.material.uniforms.alpha.value=e,this.material.needsUpdate=!0}},{key:"distortionScale",set:function(e){this.material.uniforms.distortionScale.value=e,this.material.needsUpdate=!0},get:function(){return this.material.uniforms.distortionScale.value}}]),t}();t.a=c},function(e,t,r){e.exports=function(){return r(14)('!function(e){var r={};function i(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=r,i.d=function(e,r,n){i.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="",i(i.s=0)}([function(e,r){function i(e,r,i,n,o,t){for(var a=Math.floor((n.width-1)/2),f=Math.floor((n.height-1)/2),h=0,s=a*f*4,u=[],d=function(n){for(var a=function(a){var f=0;r.map(function(r){var o={x:r.position.x+i.x+n,y:r.position.y+i.y+a};f+=function(e,r,i){for(var n=0,o=0;o<r.dimension.width;++o)for(var t=0;t<r.dimension.height;++t){var a=t*r.dimension.width+o,f=r.buffer[a];if(f>0){var h=i.x+o,s=i.y+t;if(h>=0&&h<e.dimension.width&&s>=0&&s<e.dimension.height){var u=s*e.dimension.width+h;n+=e.buffer[u]*f}}}return n}(e,r.newMask,o)}),u.push({score:f,offset:{x:i.x+n,y:i.y+a}}),postMessage((h+=1)/s*(t-o)+o)},d=-f;d<=f;++d)a(d)},g=-a;g<=a;++g)d(g);return u.sort(function(e,r){return r.score-e.score}),u[0]}function n(e,r,i){for(var n=0,o=i.low;o<i.high;++o)for(var t=r.low;t<r.high;++t){var a=o*e.dimension.width+t;n+=e.buffer[a]}return n}function o(e,r,i){for(var n={dimension:{width:r.high-r.low,height:i.high-i.low},buffer:[]},o=i.low;o<i.high;++o)for(var t=r.low;t<r.high;++t){var a=o*e.dimension.width+t;n.buffer.push(e.buffer[a])}return{newMask:n,position:{x:r.low,y:i.low}}}onmessage=function(e){var r=e.data,t=r.maskLowThreshold?r.maskLowThreshold:20,a=r.maskHighThreshold?r.maskHighThreshold:200,h=r.widthSegments?r.widthSegments:20,u=r.heightSegments?r.heightSegments:20,d=r.offsetWindowWidth?r.offsetWindowWidth:21,g=r.offsetWindowHeight?r.offsetWindowHeight:21,v=r.wideSearchSaliency?r.wideSearchSaliency:.2,l=r.windowSearchSaliency?r.windowSearchSaliency:.9;postMessage(1);var w=r.projectDepthImage,c=r.maskImage;s(w,1),postMessage(3),s(c,1),postMessage(6);var m=f(c,t,a);postMessage(18);var b=0;m.buffer.map(function(e){e>0&&(b+=1)});var p=f(w,0,0,b);postMessage(30);var M=function(e,r,t,a,f,h,s){for(var u=Math.floor(r.dimension.width/t),d=Math.floor(r.dimension.height/a),g=0,v=[],l=0;l<t;++l)for(var w={low:l*u,high:(l+1)*u},c=0;c<a;++c){var m={low:c*d,high:(c+1)*d},b=n(r,w,m);v.push({saliency:b,widthrange:w,heightrange:m}),g+=b}v.sort(function(e,r){return r.saliency-e.saliency}),postMessage(40);for(var p=0,M=[],y=[],x=0;x<v.length;++x){var k=v[x];if((p+=k.saliency)<=g*f){var S=o(r,k.widthrange,k.heightrange);M.push(S),y.push(S)}else{if(!(p<=g*h))break;var W=o(r,k.widthrange,k.heightrange);y.push(W)}}postMessage(50);var j=i(e,M,{x:0,y:0},{width:Math.floor(u*(t/2))+1,height:Math.floor(d*(a/2))+1},50,90);return postMessage(90),i(e,y,j.offset,s,90,99).offset}(p,m,h,u,v,l,{width:d,height:g});postMessage(100);var y={lng:-M.x/p.dimension.width*(w.bbox.max.lng-w.bbox.min.lng),lat:M.y/p.dimension.height*(w.bbox.max.lat-w.bbox.min.lat)};postMessage({finish:!0,offset:y})};var t={width:3,height:3,kernel:[[-1,0,1],[-2,0,2],[-1,0,1]]},a={width:3,height:3,kernel:[[1,2,1],[0,0,0],[-1,-2,-1]]};function f(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,o=e.dimension.width,f=e.dimension.height,s=h(e,{width:3,height:3,kernel:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]]}),u=h(s,t),d=h(s,a),g=new Array(o*f),v=new Array(o*f),l=0;l<v.length;++l){var w=u.buffer[l],c=d.buffer[l];g[l]=Math.sqrt(w*w+c*c);for(var m=Math.atan2(c,w)/Math.PI*180;m<0;)m+=180;m>22.5&&m<=67.5?m=45:m>67.5&&m<=112.5?m=90:m>112.5&&m<=157.5?m=135:(m<=22.5&&m>=0||m>157.5&&m<=180)&&(m=0),v[l]=m}for(var b=g.slice(),p=0;p<o;++p)for(var M=0;M<f;++M){var y=M*o+p,x=v[y],k=g[y];90===x?k>=g[M*o+(p+1)%o]&&k>=g[M*o+(p-1)%o]?b[y]=g[y]:b[y]=0:45===x?k>=g[(M+1)%f*o+(p+1)%o]&&k>=g[(M-1)%f*o+(p-1)%o]?b[y]=g[y]:b[y]=0:135===x?k>=g[(M+1)%f*o+(p-1)%o]&&k>=g[(M-1)%f*o+(p+1)%o]?b[y]=g[y]:b[y]=0:k>=g[(M+1)%f*o+p]&&k>=g[(M-1)%f*o+p]?b[y]=g[y]:b[y]=0}if(0===r&&0===i&&void 0!==n){var S=b[0],W=b[0];b.map(function(e){S=S>e?e:S,W=W<e?e:W});for(var j=[],O=0;O<254;++O)j.push(0);for(var A=0;A<b.length;++A){b[A]=(b[A]-S)/(W-S)*255;for(var H=0;H<254&&b[A]>H+1;++H)j[H]+=1}for(var T=0;T<254;++T){var I=253-T;if(i=I+1,j[I]>n)break}r=.5*i}for(var P=new Array(o*f),L=0;L<o;++L)for(var _=0;_<f;++_){var q=_*o+L,D=b[q];P[q]=D>i?2:D<r?0:1}for(var z=P.slice(),B=0;B<o;++B)for(var C=0;C<f;++C){var E=C*o+B,F=0;2===P[C%f*o+(B+1)%o]&&(F+=1),2===P[C%f*o+(B-1)%o]&&(F+=1),2===P[(C+1)%f*o+(B+1)%o]&&(F+=1),2===P[(C+1)%f*o+B%o]&&(F+=1),2===P[(C+1)%f*o+(B-1)%o]&&(F+=1),2===P[(C-1)%f*o+(B+1)%o]&&(F+=1),2===P[(C-1)%f*o+B%o]&&(F+=1),2===P[(C-1)%f*o+(B-1)%o]&&(F+=1),z[E]=F>0?2:0}var G=Object.assign({},e,{buffer:z});return function(e){var r=e.buffer[0],i=e.buffer[0];e.buffer.map(function(e){r=r>e?e:r,i=i<e?e:i});for(var n=0;n<e.buffer.length;++n)e.buffer[n]=(e.buffer[n]-r)/(i-r)*255}(G),G}function h(e,r){for(var i=e.dimension.width,n=e.dimension.height,o=new Array(i*n),t=r.kernel,a=Math.floor((r.width-1)/2),f=Math.floor((r.height-1)/2),h=0;h<i;++h)for(var s=0;s<n;++s){for(var u=0,d=-a;d<a+1;++d)for(var g=-f;g<f+1;++g){var v=(s+g)*i+h+d;v>=0&&v<e.buffer.length&&(u+=e.buffer[v]*t[d+a][g+f])}o[s*i+h]=u}return Object.assign({},e,{buffer:o})}function s(e,r){for(var i=0;i<e.dimension.height/2;++i)for(var n=0;n<e.dimension.width*r;++n){var o=i*e.dimension.width*r+n,t=(e.dimension.height-1-i)*e.dimension.width*r+n,a=e.buffer[o];e.buffer[o]=e.buffer[t],e.buffer[t]=a}}}]);',r.p+"OffsetDetectionWorker.js")}},function(e,t,r){"use strict";var n=r(73),o=r(16),i=r(74),a=r(75),s=r(76);function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.materials={mtlmatcapshadermaterial:n.a,mtlphongshadermaterial:o.a,mtlpbrshadermaterial:i.a,suggestivecontoursshadermaterial:a.a},this.setObjectMaterial=this.setObjectMaterial.bind(this)}return function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(e,[{key:"setObjectMaterial",value:function(e,t,r){var n=this.materials[t.toLowerCase()],o=[];if(r instanceof Array){if(r.map(function(t){var r=new n(t);e.changeMaterial(r),o.push(r)}),"suggestivecontoursshadermaterial"===t.toLowerCase()){var i=e.shapeHolder.children[0].children[0].children[0].children[0].geometry,a=new s.a;a.calculateForGeometry(i),e.shapeHolder.children[0].children[0].children[0].children[0].geometry=a.getBufferGeometry()}return o}console.error("[materialmanager] options error",r)}}]),e}();t.a=u},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(15)),i=r(8);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[.2,.2,.2]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[.1,.1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[1,.1,.1]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},MatcapTextureUsed:{type:"f",value:0},MatcapTexture:{type:"t",value:null},MatcapTexturePath:{value:null},fraction:{type:"v3",value:[1,1,1]}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+o.b.DisplacementMapPositionCalculation_vertex+n.ShaderChunk.logdepthbuf_pars_vertex+"\nvoid main()\n{\n  // passing texture to fragment shader\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  vec3 transformed = vec3( position );\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n"+n.ShaderChunk.logdepthbuf_vertex+"}",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform sampler2D MatcapTexture;\nuniform float MatcapTextureUsed;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nuniform vec3 fraction;\n"+n.ShaderChunk.bumpmap_pars_fragment+n.ShaderChunk.normalmap_pars_fragment+n.ShaderChunk.logdepthbuf_pars_fragment+"\nvoid main() {\n"+n.ShaderChunk.logdepthbuf_fragment+"\n  vec3 modelPosition = -vViewPosition;\n  vec3 treatedNormal = normalize(vNormal);\n  if(bumpMapUsed>0.5)treatedNormal = perturbNormalArb(modelPosition, treatedNormal, dHdxy_fwd());\n  if(normalMapUsed>0.5)treatedNormal = perturbNormal2Arb( modelPosition, treatedNormal );\n  vec3 r = reflect(treatedNormal, normalize(modelPosition));\n  float m = 2.0 * sqrt(pow(r.x,2.0)+pow(r.y,2.0)+pow(r.z+1.5,2.0));\n  vec2 matcapuv = r.xy / m + 0.5;  \n\n  vec3 base = fraction;\n  if(MatcapTextureUsed > 0.5){\n    base *= texture2D(MatcapTexture, matcapuv).rgb;\n  }\n\n  gl_FragColor = vec4(base,1.0);\n}\n"},h=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,u(t).call(this))).uniforms=JSON.parse(JSON.stringify(f.uniforms)),r.vertexShader=f.vertexShader,r.fragmentShader=f.fragmentShader,r.transparent=!0,r.extensions.derivatives=!0,r.description={},r.description.type="MTLMatcapShaderMaterial",r.loadMTLOptions(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["ShaderMaterial"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"loadMTLOptions",value:function(e){if(null!==e&&void 0!==e&&Object.keys(e).length>0){this.name=e.name,this.description.name=e.name;var t=e.bump;void 0!==t&&null!==t&&(this._loadTexture(t,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=t);var r=e.MatcapTexturePath;void 0!==r&&null!==r&&(this._loadTexture(r,this.uniforms.MatcapTexture,this.uniforms.MatcapTextureUsed,this.uniforms.MatcapTexturePath),this.description.MatcapTexturePath=r),e.fraction&&(this.uniforms.fraction.value=e.fraction,this.description.fraction=e.fraction)}}},{key:"loadMatcapTexture",value:function(e){this._loadTexture(e,this.uniforms.MatcapTexture,this.uniforms.MatcapTextureUsed,this.uniforms.MatcapTexturePath),this.description.MatcapTexturePath=e}},{key:"_loadTexture",value:function(e,t,r,n){if(""!==e){var o=new i.a;o.setCrossOrigin(""),o.withCredentials=!0,o.load(e,function(o){t.value=o,n.value=e,r.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else r.value=0}},{key:"getMatcapTexturePath",value:function(){return{value:this.uniforms.MatcapTexturePath.value}}},{key:"setMatcapTextureFraction",value:function(e){this.uniforms.fraction.value=e,this.description.fraction=e}},{key:"getFraction",value:function(){return{value:this.array2Hex(this.uniforms.fraction.value)}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.a=h},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(15)),i=r(8);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f={uniforms:{bumpMapUsed:{type:"f",value:0},bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpMapPath:{value:null},normalMapUsed:{type:"f",value:0},normalMap:{type:"t",value:null},normalScale:{type:"v2",value:[1,1]},normalMapPath:{value:null},displacementMapUsed:{type:"f",value:0},displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:0},displacementBias:{type:"f",value:0},displacementMapPath:{value:null},ka:{type:"v3",value:[.2,.2,.2]},mapKaUsed:{type:"f",value:0},mapKa:{type:"t",value:null},mapKaPath:{value:null},mapKaWidth:{type:"f",value:1},mapKaHeight:{type:"f",value:1},kd:{type:"v3",value:[.1,.1,1]},mapKdUsed:{type:"f",value:0},mapKd:{type:"t",value:null},mapKdPath:{value:null},mapKdWidth:{type:"f",value:1},mapKdHeight:{type:"f",value:1},ks:{type:"v3",value:[1,.1,.1]},mapKsUsed:{type:"f",value:0},mapKs:{type:"t",value:null},mapKsPath:{value:null},mapKsWidth:{type:"f",value:1},mapKsHeight:{type:"f",value:1},ns:{type:"f",value:20},d:{type:"f",value:1},perceptualRoughness:{type:"f",value:1},metallic:{type:"f",value:0},f0:{type:"v3",value:[.04,.04,.04]},baseColorPercentage:{type:"f",value:100}},vertexShader:"\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n"+o.b.DisplacementMapPositionCalculation_vertex+n.ShaderChunk.common+n.ShaderChunk.bsdfs+n.ShaderChunk.lights_pars_begin+n.ShaderChunk.logdepthbuf_pars_vertex+"\nvoid main(){\n  vUv = uv;\n  vNormal = normalize(normalMatrix * normal);\n  vViewPosition = -(modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 transformedPosition = position + displacementMapOffset(normal, uv);\n  vec4 mvPosition = modelViewMatrix * vec4( transformedPosition, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n"+n.ShaderChunk.logdepthbuf_vertex+"}",fragmentShader:"\n#define USE_BUMPMAP\n#define USE_NORMALMAP\nvarying vec2 vUv;\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n\nuniform float perceptualRoughness;\nuniform float metallic;\nuniform vec3 f0;\nuniform float baseColorPercentage;\n\nuniform float bumpMapUsed;\nuniform float normalMapUsed;\n\nuniform vec3 ka;\nuniform float mapKaUsed;\nuniform sampler2D mapKa;\nuniform vec3 kd;\nuniform float mapKdUsed;\nuniform sampler2D mapKd;\nuniform vec3 ks;\nuniform float mapKsUsed;\nuniform sampler2D mapKs;\nuniform float ns;\nuniform float d;\n"+n.ShaderChunk.common+n.ShaderChunk.bsdfs+n.ShaderChunk.lights_pars_begin+n.ShaderChunk.bumpmap_pars_fragment+n.ShaderChunk.normalmap_pars_fragment+n.ShaderChunk.logdepthbuf_pars_fragment+"\n#define minRoughness 0.04\n\nvec3 F_Schlick2(vec3 specularColor, float VdotH)\n{\n  float maxColor = max(max(specularColor.r, specularColor.g), specularColor.b);\n  vec3 r90 = vec3(1.0) * maxColor;\n  return specularColor + (r90 - specularColor) * pow(1.0 - VdotH, 5.0);\n}\n\n// Simplified implementation of fresnel from “An Inexpensive BRDF Model for Physically based Rendering” by Christophe Schlick\nvec3 F_Schlick3(float metalness, float VdotH)\n{\n  return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\n// The following equations model the geometric occlusion term of the spec equation  (aka G())\n// Implementation from “A Reflectance Model for Computer Graphics” by Robert Cook and Kenneth Torrance,\nfloat geometricOcclusionCookTorrance(float NdotV, float NdotH, float VdotH, float NdotL)\n{\n  return min(min(2.0 * NdotV * NdotH / VdotH, 2.0 * NdotL * NdotH / VdotH), 1.0);\n}\n\n// implementation of microfacet occlusion from “An Inexpensive BRDF Model for Physically based Rendering” by Christophe Schlick\nfloat geometricOcclusionSchlick(float roughness, float LdotH, float NdotH)\n{\n  float k = roughness * 0.79788; // 0.79788 = sqrt(2.0/3.1415);\n  // alternately, k can be defined with\n  // float k = (roughness + 1) * (roughness + 1) / 8;\n\n  float l = LdotH / (LdotH * (1.0 - k) + k);\n  float n = NdotH / (NdotH * (1.0 - k) + k);\n  return l * n;\n}\n\n// the following Smith implementations are from “Geometrical Shadowing of a Random Rough Surface” by Bruce G. Smith\nfloat geometricOcclusionSmith(float roughness2, float NdotL, float NdotV)\n{\n  float NdotL2 = NdotL * NdotL;\n  float NdotV2 = NdotV * NdotV;\n  float v = ( -1.0 + sqrt ( roughness2 * (1.0 - NdotL2 ) / NdotL2 + 1.)) * 0.5;\n  float l = ( -1.0 + sqrt ( roughness2 * (1.0 - NdotV2 ) / NdotV2 + 1.)) * 0.5;\n  return (1.0 / max((1.0 + v + l ), 0.000001));\n}\n\nfloat SmithG1_var2(float NdotV, float r)\n{\n  float tanSquared = (1.0 - NdotV * NdotV) / max((NdotV * NdotV), 0.00001);\n  return 2.0 / (1.0 + sqrt(1.0 + r * r * tanSquared));\n}\n\nfloat SmithG1(float NdotV, float r)\n{\n  return 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n}\n\nfloat geometricOcclusionSmithGGX(float roughness2, float NdotL, float NdotV)\n{\n  return SmithG1_var2(NdotL, roughness2) * SmithG1_var2(NdotV, roughness2);\n}\n\n// The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\n// implementation from “Average Irregularity Representation of a Roughened Surface for Ray Reflection” by T. S. Trowbridge, and K. P. Reitz\nfloat GGX(float roughness2, float NdotH)\n{\n  float roughness4 = roughness2 * roughness2;\n  float f = (NdotH * roughness4 - NdotH) * NdotH + 1.0;\n  return roughness4 * RECIPROCAL_PI / (f * f);\n}\n\nvec3 getDiffuse(vec3 N, vec3 L, vec3 lightColor, vec3 diffuseColor){\n  float NdotL = saturate(dot(N, L));\n  return NdotL * lightColor * diffuseColor;\n}\n\nvec3 getSpecular(vec3 N, vec3 L, vec3 V, vec3 H, vec3 lightColor, vec3 specularColor, float roughness){\n  float roughness2 = pow(roughness, 2.0);\n  float NdotL = saturate(dot(N, L));\n  float NdotV = saturate(dot(N, V));\n  float NdotH = saturate(dot(N, H));\n  float LdotH = saturate(dot(L, H));\n  float VdotH = saturate(dot(V, H));\n  // vec3 F = F_Schlick( specularColor, LdotH );\n  vec3 F = F_Schlick2(specularColor, VdotH);\n  // vec3 F = F_Schlick3(metalness, VdotH);\n  // float G = G_GGX_SmithCorrelated( roughness2, NdotL, NdotV );\n  float G = geometricOcclusionSmithGGX(roughness2, NdotL, NdotV);\n  // float G = geometricOcclusionSmith(roughness2, NdotL, NdotV);\n  // float G = geometricOcclusionSchlick(roughness, LdotH, NdotH);\n  // float G = geometricOcclusionCookTorrance(NdotV, NdotH, VdotH, NdotL);\n  // float D = D_GGX( roughness2, NdotH );\n  float D = GGX(roughness2, NdotH);\n  return NdotL * lightColor * F * G * D;\n}\n\nvoid main(){\n"+n.ShaderChunk.logdepthbuf_fragment+"\n  vec3 modelPosition = -vViewPosition;\n  vec3 N = normalize(vNormal);\n  if(bumpMapUsed>0.5)N=perturbNormalArb(modelPosition, N, dHdxy_fwd());\n  if(normalMapUsed>0.5)N = perturbNormal2Arb( modelPosition, N );\n  vec3 V = normalize(cameraPosition - modelPosition);\n\n  vec3 diffuseResultColor = vec3(0.0);\n  vec3 specularResultColor = vec3(0.0);\n  vec3 diffuseColor = kd;\n  if(mapKdUsed>0.5)diffuseColor *= texture2D(mapKd, vUv).rgb;\n  diffuseColor *= baseColorPercentage / 100.0;\n  float roughness = clamp(perceptualRoughness, minRoughness, 1.0);\n  float metal = clamp(metallic, 0.0, 1.0);\n  vec3 backGroundColor = mix(diffuseColor, vec3(0.04, 0.04, 0.04), 0.6);\n  vec3 specularColor = mix(f0, diffuseColor, metal);\n  diffuseColor = mix(diffuseColor, backGroundColor, metal);\n\n  #if NUM_POINT_LIGHTS > 0\n    for(int i=0;i<NUM_POINT_LIGHTS;++i){\n      vec3 L = normalize(pointLights[i].position - modelPosition);\n      vec3 H = normalize(V+L);\n      diffuseResultColor += getDiffuse(N, L, pointLights[i].color, diffuseColor);\n      specularResultColor += getSpecular(N, L, V, H, pointLights[i].color, specularColor, roughness);\n    }\n  #endif\n  #if NUM_DIR_LIGHTS > 0\n    for(int i=0;i<NUM_DIR_LIGHTS;++i){\n      vec3 L = normalize(directionalLights[i].direction);\n      vec3 H = normalize(V+L);\n      diffuseResultColor += getDiffuse(N, L, directionalLights[i].color, diffuseColor);\n      specularResultColor += getSpecular(N, L, V, H, directionalLights[i].color, specularColor, roughness);\n    }\n  #endif\n  diffuseResultColor += diffuseColor * RECIPROCAL_PI; // indirect diffuse color\n\n  vec3 color = vec3(0.0);\n  color += diffuseResultColor;\n  color += specularResultColor;\n\n  gl_FragColor = vec4(color, d);\n}\n"},h=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=l(this,u(t).call(this));var o=JSON.parse(JSON.stringify(f.uniforms));return r.uniforms=n.UniformsUtils.merge([n.UniformsLib.lights,o]),r.vertexShader=f.vertexShader,r.fragmentShader=f.fragmentShader,r.transparent=!0,r.extensions.derivatives=!0,r.lights=!0,r.description={},r.description.type="MTLPBRShaderMaterial",r.loadMTLOptions(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["ShaderMaterial"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"loadMTLOptions",value:function(e){if(void 0!==e&&null!==e&&Object.keys(e).length>0){if(this.name=e.name,this.description.name=e.name,e.ka&&(this.uniforms.ka.value=e.ka,this.description.ka=e.ka),e.kd&&(this.uniforms.kd.value=e.kd,this.description.kd=e.kd),e.ks&&(this.uniforms.ks.value=e.ks,this.description.ks=e.ks),e.ns){var t=o.a.getFloatStringPair(e.ns);t&&(this.uniforms.ns.value=t.f,this.description.ns=t.s)}if(e.d){var r=o.a.getFloatStringPair(e.ns);r&&(this.uniforms.d.value=r.f,this.description.d=r.s)}var n=e.bump,i=e.map_kd;if(void 0!==i&&null!==i&&(this._loadTexture(i,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=i),void 0!==n&&null!==n&&(this._loadTexture(n,this.uniforms.bumpMap,this.uniforms.bumpMapUsed,this.uniforms.bumpMapPath),this.description.bump=n),e.metallic){var a=o.a.getFloatStringPair(e.metallic);a&&(this.uniforms.metallic.value=a.f,this.description.metallic=a.s)}if(e.perceptualRoughness){var s=o.a.getFloatStringPair(e.perceptualRoughness);s&&(this.uniforms.perceptualRoughness.value=s.f,this.description.perceptualRoughness=s.s)}if(e.f0&&(this.uniforms.f0.value=e.f0,this.description.f0=e.f0),e.baseColorPercentage){var l=o.a.getFloatStringPair(e.baseColorPercentage);l&&(this.uniforms.baseColorPercentage.value=l.f,this.description.baseColorPercentage=l.s)}}}},{key:"_loadTexture",value:function(e,t,r,n,o,a){if(""!==e){var s=new i.a;s.setCrossOrigin("anonymous"),s.withCredentials=!0,s.load(e,function(i){t.value=i,o&&(o.value=parseFloat(i.image.width)),a&&(a.value=parseFloat(i.image.height)),n.value=e,r.value=1},function(e){},function(t){console.warn("an error happened while loading "+e)})}else r.value=0}},{key:"setMetallic",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.metallic.value=t.f,this.description.metallic=t.s)}},{key:"setRoughness",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.perceptualRoughness.value=t.f,this.description.perceptualRoughness=t.s)}},{key:"setSpecularF0",value:function(e){this.uniforms.f0.value=e,this.description.f0=e}},{key:"setBaseColor",value:function(e){this.uniforms.kd.value=e.slice(0,3),this.description.kd=e.slice(0,3)}},{key:"setBaseColorTexture",value:function(e){this._loadTexture(e,this.uniforms.mapKd,this.uniforms.mapKdUsed,this.uniforms.mapKdPath,this.uniforms.mapKdWidth,this.uniforms.mapKdHeight),this.description.map_kd=e}},{key:"setBaseColorPercentage",value:function(e){var t=o.a.getFloatStringPair(e);t&&(this.uniforms.baseColorPercentage.value=t.f,this.description.baseColorPercentage=t.s)}},{key:"getMetallic",value:function(){return{value:this.uniforms.metallic.value}}},{key:"getRoughness",value:function(){return{value:this.uniforms.perceptualRoughness.value}}},{key:"getSpecularF0",value:function(){return{value:this.uniforms.f0.value}}},{key:"getBaseColor",value:function(){return{color:this.array2Hex(this.uniforms.kd.value),textureUsed:this.uniforms.mapKdUsed.value,texturePath:this.uniforms.mapKdPath.value,percentage:this.uniforms.baseColorPercentage.value}}},{key:"array2Hex",value:function(e){return"#"+Math.round(255*e[0]).toString(16)+Math.round(255*e[1]).toString(16)+Math.round(255*e[2]).toString(16)}},{key:"clone",value:function(){return new this.constructor(this.description)}}]),t}();t.a=h},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l={uniforms:{fz:{type:"f",value:5},c_limit:{type:"f",value:1},sc_limit:{type:"f",value:1},dwkr_limit:{type:"f",value:2e-4},limit:{type:"f",value:1}},vertexShader:"\n// Object Space Suggestive Contours vertex shader\n// Jeroen Baert - www.forceflow.be\n\nattribute vec3 pdir1;\nattribute vec3 pdir2;\nattribute float curv1;\nattribute float curv2;\nattribute vec4 dcurv;\n\n// OUT: variables for fragment shader\nvarying float ndotv;\nvarying float kr;\nvarying float dwkr2;\n\nvarying float contoursZeroCrossingParas;\n\nuniform float fz;\n\nvoid main()\n{\n  // attributes parameters should be precalculated and put in attributes of BufferGeometry\n  // without transformation, it will be view-independent and relatively clean\n  // vec3 modelPosition = position;\n  // vec3 unitNormal = normalize(normal);\n  // vec3 modelpdir1 = normalize(pdir1);\n  // vec3 modelpdir2 = normalize(pdir2);\n\n  // after transformation, it will be relative dirty and view-dependent\n  vec3 modelPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n  vec3 unitNormal = normalize(normalMatrix * normal);\n  vec3 modelpdir1 = normalize(normalMatrix * pdir1);\n  vec3 modelpdir2 = normalize(normalMatrix * pdir2);\n\n  // compute vector to camera\n  vec3 view = normalize(cameraPosition - modelPosition);\n\n  // compute ndotv (and normalize view)\n  ndotv = dot(unitNormal,view);\n\n  contoursZeroCrossingParas = 1.0;\n\n  // optimalisation: if this vector points away from cam, don't even bother computing the rest.\n  // the data will not be used in computing pixel color\n  if(!(ndotv < 0.0))\n  {\n    // compute kr\n    vec3 w = normalize(view - unitNormal * dot(view, unitNormal));\n    float u = dot(w, normalize(modelpdir1));\n    float v = dot(w, normalize(modelpdir2));\n    float u2 = u*u;\n    float v2 = v*v;\n    float t_kr = (curv1*u2) + (curv2*v2);\n    // and dwkr\n    float uv = u*v;\n    float dwII = (u2*u*dcurv.x) + (3.0*u*uv*dcurv.y) + (3.0*uv*v*dcurv.z) + (v*v2*dcurv.w);\n    // extra term due to second derivative\n    float t_dwkr = dwII + 2.0 * curv1 * curv2 * ndotv/sqrt((1.0 - pow(ndotv, 2.0)));\n\n    // use feature size\n    kr = fz*(t_kr); // absolute value to use it in limits\n    float dwkr = fz*fz*t_dwkr; // two times fz because derivative\n    dwkr2 = (dwkr-dwkr*pow(ndotv, 2.0)) / length(w);\n\n    if(kr>0.0){\n      contoursZeroCrossingParas = 1.0;\n    }else if(kr<0.0){\n      contoursZeroCrossingParas = -1.0;\n    }else{\n      contoursZeroCrossingParas = 0.0;\n    }\n  }\n\n  // position transformation\n  vec3 transformed = vec3( position );\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n} \n",fragmentShader:"\n// Object Space Suggestive Contours vertex shader\n// Jeroen Baert - www.forceflow.be\n\n// IN: computed values from vertex shader\nvarying float ndotv;\nvarying float kr;\nvarying float dwkr2;\n\nvarying float contoursZeroCrossingParas;\n\n// IN: uniform values\nuniform float dwkr_limit;\nuniform float limit;\nuniform float c_limit;\nuniform float sc_limit;\n\nvoid main()\n{\n  // base color\n  vec4 color = vec4(1.0); \n  \n  if(ndotv<0.0){\n    gl_FragColor = color;\n  }else{\n    if(contoursZeroCrossingParas<1.0 && contoursZeroCrossingParas>-1.0){\n      // compute limits\n      float contour_limit = c_limit*(pow(ndotv, 2.0)/(kr));\n      float sucontour_limit = sc_limit*((kr)/dwkr2);\n      contour_limit = abs(contour_limit);\n      sucontour_limit = abs(sucontour_limit);\n\n      // contours\n      if(contour_limit<limit)\n      {\n        color.xyz = min(color.xyz, vec3(contour_limit, contour_limit, contour_limit));\n      }\n      // suggestive contours\n      if((sucontour_limit<limit) && dwkr2>dwkr_limit)\n      {\n        color.xyz = min(color.xyz, vec3(sucontour_limit, sucontour_limit, sucontour_limit));\n      }\n    }\n\n    gl_FragColor = color;\n  }\n} \n"},u=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=i(this,a(t).call(this))).uniforms=JSON.parse(JSON.stringify(l.uniforms)),r.vertexShader=l.vertexShader,r.fragmentShader=l.fragmentShader,r.extensions.derivatives=!0,r.transparent=!0,e.name&&(r.name=e.name),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,n["ShaderMaterial"]),t}();t.a=u},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.positions=null,this.faces=null,this.verticesNumber=0,this.facesNumber=0,this.pointareas=null,this.cornerareas=null,this.pdir1=null,this.pdir2=null,this.curv1=null,this.curv2=null,this.dcurv=null,this.bufferGeometry=null,this.calculated=!1}return function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(e,[{key:"calculateForGeometry",value:function(e){var t=(new Date).getTime();console.log("Calculation Start..."),this.initForGeometry(e),this.compute(),this.bufferGeometry=(new n.BufferGeometry).fromGeometry(e),this.addToBufferGeometry(this.bufferGeometry),t=(new Date).getTime()-t,console.log("Calculation Done, total time (in milliseconds): ",t),this.calculated=!0}},{key:"doCurvaturesSmoothing",value:function(){if(this.calculated){for(var e=new Array(this.verticesNumber),t=new Array(this.verticesNumber),r=new Array(this.verticesNumber),n=new Array(this.verticesNumber),o=0;o<this.verticesNumber;++o)r[o]=1,n[o]=1,e[o]=this.curv1[o],t[o]=this.curv2[o];for(var i=0;i<this.facesNumber;++i){var a=this.faces[i];e[a.a]+=this.curv1[a.b]+this.curv1[a.c],e[a.b]+=this.curv1[a.a]+this.curv1[a.c],e[a.c]+=this.curv1[a.a]+this.curv1[a.b],t[a.a]+=this.curv2[a.b]+this.curv2[a.c],t[a.b]+=this.curv2[a.a]+this.curv2[a.c],t[a.c]+=this.curv2[a.a]+this.curv2[a.b],r[a.a]+=2,r[a.b]+=2,r[a.c]+=2,n[a.a]+=2,n[a.b]+=2,n[a.c]+=2}for(var s=0;s<this.verticesNumber;++s)e[s]/=r[s],t[s]/=n[s];this.curv1=e,this.curv2=t}}},{key:"getBufferGeometry",value:function(){return this.bufferGeometry}},{key:"initForGeometry",value:function(e){this.clearCalculator(),e.computeVertexNormals(!0),this.positions=e.vertices,this.faces=e.faces,this.verticesNumber=this.positions.length,this.facesNumber=this.faces.length,this.pointareas=new Array(this.verticesNumber);for(var t=0;t<this.verticesNumber;++t)this.pointareas[t]=0;this.cornerareas=new Array(this.facesNumber);for(var r=0;r<this.facesNumber;++r)this.cornerareas[r]=[0,0,0];this.pdir1=new Array(this.verticesNumber);for(var o=0;o<this.verticesNumber;++o)this.pdir1[o]=new n.Vector3;this.pdir2=new Array(this.verticesNumber);for(var i=0;i<this.verticesNumber;++i)this.pdir2[i]=new n.Vector3;this.curv1=new Array(this.verticesNumber);for(var a=0;a<this.verticesNumber;++a)this.curv1[a]=0;this.curv2=new Array(this.verticesNumber);for(var s=0;s<this.verticesNumber;++s)this.curv2[s]=0;this.dcurv=new Array(this.verticesNumber);for(var l=0;l<this.verticesNumber;++l)this.dcurv[l]=[0,0,0,0]}},{key:"compute",value:function(){this.needPointareas(),this.needCurvatures(),this.needDcurv()}},{key:"addToBufferGeometry",value:function(e){for(var t=3*this.facesNumber,r=new Float32Array(3*t),o=new Float32Array(3*t),i=new Float32Array(t),a=new Float32Array(t),s=new Float32Array(4*t),l=0;l<this.facesNumber;++l)for(var u=this.faces[l],c=0;c<3;++c){var f=u.a;0===c?f=u.a:1===c?f=u.b:2===c&&(f=u.c),r[3*l*3+3*c]=this.pdir1[f].x,r[3*l*3+3*c+1]=this.pdir1[f].y,r[3*l*3+3*c+2]=this.pdir1[f].z,o[3*l*3+3*c]=this.pdir2[f].x,o[3*l*3+3*c+1]=this.pdir2[f].y,o[3*l*3+3*c+2]=this.pdir2[f].z,i[3*l+c]=this.curv1[f],a[3*l+c]=this.curv2[f],s[3*l*4+4*c]=this.dcurv[f][0],s[3*l*4+4*c+1]=this.dcurv[f][1],s[3*l*4+4*c+2]=this.dcurv[f][2],s[3*l*4+4*c+3]=this.dcurv[f][3]}e.addAttribute("pdir1",new n.BufferAttribute(r,3)),e.addAttribute("pdir2",new n.BufferAttribute(o,3)),e.addAttribute("curv1",new n.BufferAttribute(i,1)),e.addAttribute("curv2",new n.BufferAttribute(a,1)),e.addAttribute("dcurv",new n.BufferAttribute(s,4))}},{key:"clearCalculator",value:function(){this.positions=null,this.faces=null,this.verticesNumber=0,this.facesNumber=0,this.pointareas=null,this.cornerareas=null,this.pdir1=null,this.pdir2=null,this.curv1=null,this.curv2=null,this.dcurv=null}},{key:"ldltdc",value:function(e,t){for(var r=o(e,2),n=r[0],i=r[1],a=new Array(t-1),s=0;s<t-1;s++)a[s]=0;for(var l=0;l<t;l++){for(var u=0;u<l;u++)a[u]=n[l][u]*i[u];for(var c=l;c<t;c++){for(var f=n[l][c],h=0;h<l;h++)f-=a[h]*n[c][h];if(l===c){if(f<=0)return[!1,n,i];i[l]=1/f}else n[c][l]=f}}return[!0,n,i]}},{key:"ldltsl",value:function(e,t,r,n,o){for(var i=0;i<o;i++){for(var a=r[i],s=0;s<i;s++)a-=e[i][s]*n[s];n[i]=a*t[i]}for(var l=o-1;l>=0;l--){for(var u=0,c=l+1;c<o;c++)u+=e[c][l]*n[c];n[l]-=u*t[l]}return n}},{key:"rotCoordSys",value:function(e){var t=o(e,5),r=t[0],n=t[1],i=t[2],a=t[3],s=t[4];a=r.clone(),s=n.clone();var l=r.clone().cross(n),u=l.clone().dot(i);if(u<=-1)return s=s.clone().multiplyScalar(-1),[r,n,i,a=a.clone().multiplyScalar(-1),s];var c=i.clone().sub(l.clone().multiplyScalar(u)),f=l.clone().add(i.clone()).multiplyScalar(1/(1+u));return[r,n,i,a=a.clone().sub(f.clone().multiplyScalar(a.clone().dot(c))),s=s.clone().sub(f.clone().multiplyScalar(s.clone().dot(c)))]}},{key:"projCurv",value:function(e,t,r,i,a){var s=o(e,2),l=s[0],u=s[1],c=o(a,5),f=c[0],h=c[1],p=(c[2],c[3],c[4],new n.Vector3),d=new n.Vector3,v=this.rotCoordSys([f,h,l.clone().cross(u),p,d]);f=v[0],h=v[1],p=v[3],d=v[4];var m=p.clone().dot(l),y=p.clone().dot(u),g=d.clone().dot(l),b=d.clone().dot(u);return[l,u,f,h,t*m*m+r*(2*m*y)+i*y*y,t*m*g+r*(m*b+g*y)+i*y*b,t*g*g+r*(2*g*b)+i*b*b]}},{key:"projDcurv",value:function(e,t,r){var n,i,a=o(e,2),s=a[0],l=a[1],u=o(r,3),c=u[0],f=u[1],h=u[2],p=this.rotCoordSys([c,f,s.clone().cross(l),n,i]);c=p[0],f=p[1],n=p[3],i=p[4];var d=n.clone().dot(s),v=n.clone().dot(l),m=i.clone().dot(s),y=i.clone().dot(l);return h[0]=t[0]*d*d*d+3*t[1]*d*d*v+3*t[2]*d*v*v+t[3]*v*v*v,h[1]=t[0]*d*d*m+t[1]*(d*d*y+2*m*d*v)+t[2]*(m*v*v+2*d*v*y)+t[3]*v*v*y,h[2]=t[0]*d*m*m+t[1]*(m*m*v+2*d*m*y)+t[2]*(d*y*y+2*m*y*v)+t[3]*v*y*y,h[3]=t[0]*m*m*m+3*t[1]*m*m*y+3*t[2]*m*y*y+t[3]*y*y*y,[s,l,c,f,h]}},{key:"diagonalizeCurv",value:function(e,t,r,n,i){var a,s,l=o(e,2),u=l[0],c=l[1],f=o(i,5),h=f[0],p=f[1],d=(f[2],f[3]),v=f[4],m=o(this.rotCoordSys([u,c,h,a,s]),5);u=m[0],c=m[1],h=m[2],a=m[3],s=m[4];var y=1,g=0,b=0;if(0!==r){var _=.5*(n-t)/r;g=(b=_<0?1/(_-Math.sqrt(1+_*_)):1/(_+Math.sqrt(1+_*_)))*(y=1/Math.sqrt(1+b*b))}if(d=t-b*r,v=n+b*r,Math.abs(d)>=Math.abs(v))p=a.clone().multiplyScalar(y).sub(s.clone().multiplyScalar(g));else{var w=d;d=v,v=w,p=a.clone().multiplyScalar(g).add(s.clone().multiplyScalar(y))}return[u,c,h,p,h.clone().cross(p),d,v]}},{key:"needCurvatures",value:function(){console.log("Computing curvatures...");for(var e=new Array(this.verticesNumber),t=0;t<this.verticesNumber;++t)e[t]=0;for(var r=0;r<this.facesNumber;++r){var n=this.faces[r];this.pdir1[n.a]=this.positions[n.b].clone().sub(this.positions[n.a]),this.pdir1[n.b]=this.positions[n.c].clone().sub(this.positions[n.b]),this.pdir1[n.c]=this.positions[n.a].clone().sub(this.positions[n.c])}for(var o=0;o<this.facesNumber;++o){var i=this.faces[o],a=i.vertexNormals[0],s=i.vertexNormals[1],l=i.vertexNormals[2];this.pdir1[i.a]=this.pdir1[i.a].clone().cross(a),this.pdir1[i.a].normalize(),this.pdir2[i.a]=a.clone().cross(this.pdir1[i.a]),this.pdir1[i.b]=this.pdir1[i.b].clone().cross(s),this.pdir1[i.b].normalize(),this.pdir2[i.b]=s.clone().cross(this.pdir1[i.b]),this.pdir1[i.c]=this.pdir1[i.c].clone().cross(l),this.pdir1[i.c].normalize(),this.pdir2[i.c]=l.clone().cross(this.pdir1[i.c])}for(var u=0;u<this.facesNumber;++u){var c=this.faces[u],f=[this.positions[c.c].clone().sub(this.positions[c.b]),this.positions[c.a].clone().sub(this.positions[c.c]),this.positions[c.b].clone().sub(this.positions[c.a])],h=f[0];h.normalize();var p=f[0].clone().cross(f[1]).clone().cross(h);p.normalize();for(var d=[0,0,0],v=[[0,0,0],[0,0,0],[0,0,0]],m=0;m<3;++m){var y=f[m].clone().dot(h),g=f[m].clone().dot(p);v[0][0]+=y*y,v[0][1]+=y*g,v[2][2]+=g*g;var b=m>0?m-1:m+2,_=m<2?m+1:m-2,w=c.vertexNormals[b].clone().sub(c.vertexNormals[_]),x=w.clone().dot(h),k=w.clone().dot(p);d[0]+=x*y,d[1]+=x*g+k*y,d[2]+=k*g}v[1][1]=v[0][0]+v[2][2],v[1][2]=v[0][1];var O,P=[0,0,0],A=this.ldltdc([v,P],3);if(O=A[0],v=A[1],P=A[2],O){var S=[d[0],d[1],d[2]];d=this.ldltsl(v,P,S,d,3);for(var M=0;M<3;++M){var T=c.a;0===M?T=c.a:1===M?T=c.b:2===M&&(T=c.c);var E=0,C=0,j=0,R=this.pdir1[T].clone(),L=this.pdir2[T].clone(),I=this.projCurv([h,p],d[0],d[1],d[2],[R,L,E,C,j]);h=I[0],p=I[1],R=I[2],L=I[3],E=I[4],C=I[5],j=I[6],this.pdir1[T]=R,this.pdir2[T]=L;var D=this.cornerareas[u][M]/this.pointareas[T];this.curv1[T]+=D*E,e[T]+=D*C,this.curv2[T]+=D*j}}else console.log("Fail to ldltdc!")}for(var z=0;z<this.facesNumber;++z)for(var N=this.faces[z],B=0;B<3;++B){var U=N.vertexNormals[B],F=N.a;0===B?F=N.a:1===B?F=N.b:2===B&&(F=N.c);var V=this.diagonalizeCurv([this.pdir1[F],this.pdir2[F]],this.curv1[F],e[F],this.curv2[F],[U,this.pdir1[F],this.pdir2[F],this.curv1[F],this.curv2[F]]);this.pdir1[F]=V[0],this.pdir2[F]=V[1],U=V[2],this.pdir1[F]=V[3],this.pdir2[F]=V[4],this.curv1[F]=V[5],this.curv2[F]=V[6]}console.log("Done...")}},{key:"needDcurv",value:function(){console.log("Computing dcurv...");for(var e=0;e<this.facesNumber;++e){var t=this.faces[e],r=[this.positions[t.c].clone().sub(this.positions[t.b]),this.positions[t.a].clone().sub(this.positions[t.c]),this.positions[t.b].clone().sub(this.positions[t.a])],n=r[0];n.normalize();var o=r[0].clone().cross(r[1]).clone().cross(n);o.normalize();for(var i=[[0,0,0],[0,0,0],[0,0,0]],a=0;a<3;++a){var s=t.a;0===a?s=t.a:1===a?s=t.b:2===a&&(s=t.c);var l=this.projCurv([this.pdir1[s],this.pdir2[s]],this.curv1[s],0,this.curv2[s],[n,o,i[a][0],i[a][1],i[a][2]]);this.pdir1[s]=l[0],this.pdir2[s]=l[1],n=l[2],o=l[3],i[a][0]=l[4],i[a][1]=l[5],i[a][2]=l[6]}for(var u=[0,0,0,0],c=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],f=0;f<3;++f){for(var h=f>0?f-1:f+2,p=f<2?f+1:f-2,d=[0,0,0],v=0;v<3;++v)d[v]=i[h][v]-i[p][v];var m=r[f].clone().dot(n),y=r[f].clone().dot(o),g=m*m,b=y*y,_=m*y;c[0][0]+=g,c[0][1]+=_,c[3][3]+=b,u[0]+=m*d[0],u[1]+=y*d[0]+2*m*d[1],u[2]+=2*y*d[1]+m*d[2],u[3]+=y*d[2]}c[1][1]=2*c[0][0]+c[3][3],c[1][2]=2*c[0][1],c[2][2]=c[0][0]+2*c[3][3],c[2][3]=c[0][1];var w,x=[0,0,0,0],k=this.ldltdc([c,x],4);if(w=k[0],c=k[1],x=k[2],w)for(var O=[u[0],u[1],u[2],u[3]],P=[(u=this.ldltsl(c,x,O,u,4))[0],u[1],u[2],u[3]],A=0;A<3;++A){var S=t.a;0===A?S=t.a:1===A?S=t.b:2===A&&(S=t.c);var M=[0,0,0,0],T=this.projDcurv([n,o],P,[this.pdir1[S],this.pdir2[S],M]);n=T[0],o=T[1],this.pdir1[S]=T[2],this.pdir2[S]=T[3],M=T[4];for(var E=this.cornerareas[e][A]/this.pointareas[S],C=0;C<4;++C)this.dcurv[S][C]+=E*M[C]}else console.log("Fail to ldltdc!")}console.log("Done...")}},{key:"needPointareas",value:function(){console.log("Computing pointareas...");for(var e=0;e<this.facesNumber;++e){var t=this.faces[e],r=[this.positions[t.c].clone().sub(this.positions[t.b]),this.positions[t.a].clone().sub(this.positions[t.c]),this.positions[t.b].clone().sub(this.positions[t.a])],n=.5*r[0].clone().cross(r[1]).length(),o=[r[0].clone().lengthSq(),r[1].clone().lengthSq(),r[2].clone().lengthSq()],i=[o[0]*(o[1]+o[2]-o[0]),o[1]*(o[2]+o[0]-o[1]),o[2]*(o[0]+o[1]-o[2])];if(i[0]<=0)this.cornerareas[e][1]=-.25*o[2]*n/r[0].clone().dot(r[2]),this.cornerareas[e][2]=-.25*o[1]*n/r[0].clone().dot(r[1]),this.cornerareas[e][0]=n-this.cornerareas[e][1]-this.cornerareas[e][2];else if(i[1]<=0)this.cornerareas[e][2]=-.25*o[0]*n/r[1].clone().dot(r[0]),this.cornerareas[e][0]=-.25*o[2]*n/r[1].clone().dot(r[2]),this.cornerareas[e][1]=n-this.cornerareas[e][0]-this.cornerareas[e][2];else if(i[2]<=0)this.cornerareas[e][0]=-.25*o[1]*n/r[2].clone().dot(r[1]),this.cornerareas[e][1]=-.25*o[0]*n/r[2].clone().dot(r[0]),this.cornerareas[e][2]=n-this.cornerareas[e][0]-this.cornerareas[e][1];else for(var a=.5*n/(i[0]+i[1]+i[2]),s=0;s<3;++s)this.cornerareas[e][s]=a*(i[(s+1)%3]+i[(s+2)%3]);this.pointareas[t.a]+=this.cornerareas[e][0],this.pointareas[t.b]+=this.cornerareas[e][1],this.pointareas[t.c]+=this.cornerareas[e][2]}console.log("Done...")}}]),e}();t.a=a},function(e,t,r){"use strict";t.a=function(e){if(!function(){if("string"!=typeof e.objUrl||e.objUrl.length<=0)return t&&console.warn("[addMTLOBJ] Invalid obj url",e.objUrl),!1;var r={mtlUrl:"",upDir:new n.Vector3(0,0,1),center:!0,scale:1};try{e=Object.assign({},r,e)}catch(r){return t&&console.warn("[addMTLOBJ] read loadOptions failed",e),!1}void 0===e.upDir||void 0===e.upDir.x||void 0===e.upDir.y||void 0===e.upDir.z?e.upDir=new n.Vector3(0,0,1):e.upDir.normalize();return!0}())return Promise.reject(new Error("Invalid loadOptions"));var t=!1;return new Promise(function(r,i){var a=new o.a;a.setCrossOrigin("anonymous");var s=e.mtlUrl;a.load(e.objUrl,s,function(t){void 0!==t&&null!==t||i(new Error("empty"));for(var o=new n.Group,a=0;a<t.children.length;a++){var s=t.children[a],l=s.geometry.attributes.position?s.geometry.attributes.position.count:0;l>0?(o.add(s),a--):(s.geometry.dispose(),s.material.map&&s.material.map.dispose(),s.material.dispose())}t=o;var u=new n.Matrix4,c=new n.BoxHelper(t,16776960);c.geometry.computeBoundingBox();var f=new n.BoxGeometry(c.geometry.boundingBox.max.x-c.geometry.boundingBox.min.x,c.geometry.boundingBox.max.y-c.geometry.boundingBox.min.y,c.geometry.boundingBox.max.z-c.geometry.boundingBox.min.z),h=new n.Vector3;c.geometry.boundingBox.getCenter(h),u.makeTranslation(h.x,h.y,h.z),f.applyMatrix(u);var p=new n.MeshBasicMaterial({color:16776960,wireframe:!0}),d=new n.Mesh(f,p),v=new n.Group;v.add(t),e.center&&(u.makeTranslation(-h.x,-h.y,-h.z),v.applyMatrix(u));var m,y=new n.Vector3(0,0,1),g=e.upDir.clone().normalize();if(!g.equals(y)){var b=g.cross(y),_=g.angleTo(y);u.makeRotationAxis(b,_),v.applyMatrix(u)}g=e.upDir.normalize(),m=g.x>=g.y?g.x>=g.z?"x":"z":g.y>=g.z?"y":"z";var w=(c.geometry.boundingBox.max[m]-c.geometry.boundingBox.min[m])/2;u.makeTranslation(0,0,w),v.applyMatrix(u);var x=new n.Vector3;c.geometry.boundingBox.getSize(x);var k=Math.max(x.x,x.z,x.y),O=e.autoScale>0?e.autoScale/k:1,P=O;u.makeScale(P,P,P),v.applyMatrix(u),d.applyMatrix(v.matrix),v.objSpaceBBox=d,r(v)},function(e){t&&console.log(e);if(e.lengthComputable){var r=e.loaded/e.total*100;t&&console.log(Math.round(r,2)+"% downloaded")}},function(e){i(e)})})};var n=r(0),o=(r.n(n),r(78))},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(79)),i=r(16),a=r(10),s=r.n(a),l=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager,this.pendingMesh=[]};l.prototype={constructor:l,load:function(e,t,a,l,u){var c=this,f=new o.a(this.manager);f.setBaseUrl(t.substr(0,t.lastIndexOf("/")+1)),f.setCrossOrigin(this.crossOrigin),f.load(t,function(t){var o=t;o.preload(),s()({method:"get",url:e}).then(function(e){var t=0,s=new(r(80));s.onmessage=function(e){if(e.data.isFinish){var r=new n.Group;c.pendingMesh.map(function(e){r.add(e)}),a(r),c.pendingMesh=[],s.terminate()}else{var l=e.data.mesh,u=function(e){var t=new n.BufferGeometry;t.addAttribute("position",new n.BufferAttribute(e.geometry.position,e.geometry.positionItemSize)),e.geometry.uv.length>0&&t.addAttribute("uv",new n.BufferAttribute(e.geometry.uv,e.geometry.uvItemSize));e.geometry.normal.length>0&&t.addAttribute("normal",new n.BufferAttribute(e.geometry.normal,e.geometry.normalItemSize));return t}(l),f=l.meshName,h=l.materialName,p="material"+t;t+=1,h=h||p;var d=o.create(h);(d=d||new i.a({name:h})).name=h;var v=new n.Mesh(u,d);f&&(v.name=f);var m={name:h,ka:d.uniforms.ka.value,kd:d.uniforms.kd.value,ks:d.uniforms.ks.value,map_kd:d.uniforms.mapKdPath.value,ns:d.uniforms.ns.value,bump:d.uniforms.bumpMapPath.value,d:d.uniforms.d.value};v.mtlParams=m,c.pendingMesh.push(v)}},s.onerror=function(e){console.warn("Worker runtime error",e.message)};var l={data:e.data};s.postMessage(l)}).catch(function(e){console.error("OBJMTLLoader",e),a()})},l,u)},setCrossOrigin:function(e){this.crossOrigin=e}},t.a=l},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(16)),i=r(10),a=r.n(i),s=function(e){this.manager=void 0!==e?e:n.DefaultLoadingManager};s.prototype={constructor:s,load:function(e,t,r,n){var o=this;a()({method:"get",url:e}).then(function(e){t(o.parse(e.data))}).catch(function(e){console.warn(e),t(o.parse(""))})},setBaseUrl:function(e){this.baseUrl=e},setCrossOrigin:function(e){this.crossOrigin=e},setMaterialOptions:function(e){this.materialOptions=e},parse:function(e){for(var t=e.split("\n"),r={},n=/\s+/,o={},i=0;i<t.length;i++){var a=t[i];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var l=a.indexOf(" "),u=l>=0?a.substring(0,l):a;u=u.toLowerCase();var c=l>=0?a.substring(l+1):"";if(c=c.trim(),"newmtl"===u)r={name:c},o[c]=r;else if(r)if("ka"===u||"kd"===u||"ks"===u){var f=c.split(n,3);r[u]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else r[u]=c}}var h=new s.MaterialCreator(this.baseUrl,this.materialOptions);return h.setCrossOrigin(this.crossOrigin),h.setManager(this.manager),h.setMaterials(o),h}},(s.MaterialCreator=function(e,t){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:n.DoubleSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:n.RepeatWrapping}).prototype={constructor:s.MaterialCreator,setCrossOrigin:function(e){this.crossOrigin=e},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var r in e){var n=e[r],o={};for(var i in t[r]=o,n){var a=!0,s=n[i],l=i.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[1]&&(a=!1);break;case"d":this.options&&this.options.invertTransparency&&(s=1-s)}a&&(o[l]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this.materialsInfo[e],r={name:e,side:this.side},i={name:e,side:this.side};for(var a in t&&t.map_kd&&delete t.kd,t){var s=t[a];switch(a.toLowerCase()){case"kd":r.color=(new n.Color).fromArray(s),i.kd=s.slice(0,3);break;case"ka":i.ka=s.slice(0,3);break;case"ks":r.specular=(new n.Color).fromArray(s),i.ks=s.slice(0,3);break;case"map_kd":r.map=this.loadTexture(this.baseUrl+s),r.map.wrapS=n.RepeatWrapping,r.map.wrapT=n.RepeatWrapping,i.map_kd=this.baseUrl+s;break;case"ns":r.shininess=parseFloat(s),i.ns=parseFloat(s);break;case"d":s<1&&(r.transparent=!0,r.opacity=s,i.d=s);break;case"map_bump":case"bump":if(r.bumpMap)break;void 0!==s&&""!==s&&(r.bumpMap=this.loadTexture(this.baseUrl+s),r.bumpMap.wrapS=this.wrap,r.bumpMap.wrapT=this.wrap,i.bump=this.baseUrl+s)}}return this.materials[e]=new o.a(i),this.materials[e]},loadTexture:function(e,t,r,o,i){var a,l=n.Loader.Handlers.get(e),u=void 0!==this.manager?this.manager:n.DefaultLoadingManager;return null!==l?a=l.load(e,r):(a=new n.Texture,(l=new n.ImageLoader(u)).setCrossOrigin(this.crossOrigin),l.load(e,function(e){a.image=s.ensurePowerOfTwo_(e),a.needsUpdate=!0,r&&r(a)},o,i)),void 0!==t&&(a.mapping=t),a}},s.ensurePowerOfTwo_=function(e){if(!n.Math.isPowerOfTwo(e.width)||!n.Math.isPowerOfTwo(e.height)){var t=document.createElement("canvas");return t.width=s.nextHighestPowerOfTwo_(e.width),t.height=s.nextHighestPowerOfTwo_(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),t}return e},s.nextHighestPowerOfTwo_=function(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1},t.a=s},function(e,t,r){e.exports=function(){return r(14)('!function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=6)}([function(t,n,e){"use strict";var i=e(1),o=function(t,n){this.name="PointError",this.points=n=n||[],this.message=t||"Invalid Points!";for(var e=0;e<n.length;e++)this.message+=" "+i.toString(n[e])};(o.prototype=new Error).constructor=o,t.exports=o},function(t,n,e){"use strict";function i(t){return"("+t.x+";"+t.y+")"}t.exports={toString:function(t){var n=t.toString();return"[object Object]"===n?i(t):n},toStringBase:i,compare:function(t,n){return t.y===n.y?t.x-n.x:t.y-n.y},equals:function(t,n){return t.x===n.x&&t.y===n.y}}},function(t,n,e){"use strict";var i=function(t,n,e){this.points_=[t,n,e],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},o=e(1).toString;i.prototype.toString=function(){return"["+o(this.points_[0])+o(this.points_[1])+o(this.points_[2])+"]"},i.prototype.getPoint=function(t){return this.points_[t]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(t){return this.neighbors_[t]},i.prototype.containsPoint=function(t){var n=this.points_;return t===n[0]||t===n[1]||t===n[2]},i.prototype.containsEdge=function(t){return this.containsPoint(t.p)&&this.containsPoint(t.q)},i.prototype.containsPoints=function(t,n){return this.containsPoint(t)&&this.containsPoint(n)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(t){return this.interior_=t,this},i.prototype.markNeighborPointers=function(t,n,e){var i=this.points_;if(t===i[2]&&n===i[1]||t===i[1]&&n===i[2])this.neighbors_[0]=e;else if(t===i[0]&&n===i[2]||t===i[2]&&n===i[0])this.neighbors_[1]=e;else{if(!(t===i[0]&&n===i[1]||t===i[1]&&n===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=e}},i.prototype.markNeighbor=function(t){var n=this.points_;t.containsPoints(n[1],n[2])?(this.neighbors_[0]=t,t.markNeighborPointers(n[1],n[2],this)):t.containsPoints(n[0],n[2])?(this.neighbors_[1]=t,t.markNeighborPointers(n[0],n[2],this)):t.containsPoints(n[0],n[1])&&(this.neighbors_[2]=t,t.markNeighborPointers(n[0],n[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(t){var n=this.points_;return t===n[0]?n[2]:t===n[1]?n[0]:t===n[2]?n[1]:null},i.prototype.pointCCW=function(t){var n=this.points_;return t===n[0]?n[1]:t===n[1]?n[2]:t===n[2]?n[0]:null},i.prototype.neighborCW=function(t){return t===this.points_[0]?this.neighbors_[1]:t===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(t){return t===this.points_[0]?this.neighbors_[2]:t===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(t){return t===this.points_[0]?this.constrained_edge[1]:t===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(t){return t===this.points_[0]?this.constrained_edge[2]:t===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(t){return t===this.points_[0]?this.constrained_edge[0]:t===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(t,n){t===this.points_[0]?this.constrained_edge[1]=n:t===this.points_[1]?this.constrained_edge[2]=n:this.constrained_edge[0]=n},i.prototype.setConstrainedEdgeCCW=function(t,n){t===this.points_[0]?this.constrained_edge[2]=n:t===this.points_[1]?this.constrained_edge[0]=n:this.constrained_edge[1]=n},i.prototype.getDelaunayEdgeCW=function(t){return t===this.points_[0]?this.delaunay_edge[1]:t===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(t){return t===this.points_[0]?this.delaunay_edge[2]:t===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(t,n){t===this.points_[0]?this.delaunay_edge[1]=n:t===this.points_[1]?this.delaunay_edge[2]=n:this.delaunay_edge[0]=n},i.prototype.setDelaunayEdgeCCW=function(t,n){t===this.points_[0]?this.delaunay_edge[2]=n:t===this.points_[1]?this.delaunay_edge[0]=n:this.delaunay_edge[1]=n},i.prototype.neighborAcross=function(t){return t===this.points_[0]?this.neighbors_[0]:t===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(t,n){var e=t.pointCW(n);return this.pointCW(e)},i.prototype.legalize=function(t,n){var e=this.points_;if(t===e[0])e[1]=e[0],e[0]=e[2],e[2]=n;else if(t===e[1])e[2]=e[1],e[1]=e[0],e[0]=n;else{if(t!==e[2])throw new Error("poly2tri Invalid Triangle.legalize() call");e[0]=e[2],e[2]=e[1],e[1]=n}},i.prototype.index=function(t){var n=this.points_;if(t===n[0])return 0;if(t===n[1])return 1;if(t===n[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(t,n){var e=this.points_;if(t===e[0]){if(n===e[1])return 2;if(n===e[2])return 1}else if(t===e[1]){if(n===e[2])return 0;if(n===e[0])return 2}else if(t===e[2]){if(n===e[0])return 1;if(n===e[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(t){this.constrained_edge[t]=!0},i.prototype.markConstrainedEdgeByEdge=function(t){this.markConstrainedEdgeByPoints(t.p,t.q)},i.prototype.markConstrainedEdgeByPoints=function(t,n){var e=this.points_;n===e[0]&&t===e[1]||n===e[1]&&t===e[0]?this.constrained_edge[2]=!0:n===e[0]&&t===e[2]||n===e[2]&&t===e[0]?this.constrained_edge[1]=!0:(n===e[1]&&t===e[2]||n===e[2]&&t===e[1])&&(this.constrained_edge[0]=!0)},t.exports=i},function(t,n,e){"use strict";var i=e(1),o=function(t,n){this.x=+t||0,this.y=+n||0,this._p2t_edge_list=null};o.prototype.toString=function(){return i.toStringBase(this)},o.prototype.toJSON=function(){return{x:this.x,y:this.y}},o.prototype.clone=function(){return new o(this.x,this.y)},o.prototype.set_zero=function(){return this.x=0,this.y=0,this},o.prototype.set=function(t,n){return this.x=+t||0,this.y=+n||0,this},o.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},o.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},o.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},o.prototype.mul=function(t){return this.x*=t,this.y*=t,this},o.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,t},o.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},o.negate=function(t){return new o(-t.x,-t.y)},o.add=function(t,n){return new o(t.x+n.x,t.y+n.y)},o.sub=function(t,n){return new o(t.x-n.x,t.y-n.y)},o.mul=function(t,n){return new o(t*n.x,t*n.y)},o.cross=function(t,n){return"number"==typeof t?"number"==typeof n?t*n:new o(-t*n.y,t*n.x):"number"==typeof n?new o(n*t.y,-n*t.x):t.x*n.y-t.y*n.x},o.toString=i.toString,o.compare=i.compare,o.cmp=i.compare,o.equals=i.equals,o.dot=function(t,n){return t.x*n.x+t.y*n.y},t.exports=o},function(t,n,e){"use strict";var i=e(12),o=e(0),r=e(2),s=e(5).Node,a=e(13),p=a.EPSILON,h=a.Orientation,u=a.orient2d,d=a.inScanArea,l=a.isAngleObtuse;function c(t,n){var e=t.locateNode(n),o=function(t,n,e){var i=new r(n,e.point,e.next.point);i.markNeighbor(e.triangle),t.addToMap(i);var o=new s(n);o.next=e.next,o.prev=e,e.next.prev=o,e.next=o,_(t,i)||t.mapTriangleToNodes(i);return o}(t,n,e);return n.x<=e.point.x+p&&x(t,e),function(t,n){var e=n.next;for(;e.next&&!l(e.point,e.next.point,e.prev.point);)x(t,e),e=e.next;e=n.prev;for(;e.prev&&!l(e.point,e.next.point,e.prev.point);)x(t,e),e=e.prev;n.next&&n.next.next&&function(t){var n=t.point.x-t.next.next.point.x,e=t.point.y-t.next.next.point.y;return i(e>=0,"unordered y"),n>=0||Math.abs(n)<e}(n)&&function(t,n){u(n.point,n.next.point,n.next.next.point)===h.CCW?t.basin.left_node=n.next.next:t.basin.left_node=n.next;t.basin.bottom_node=t.basin.left_node;for(;t.basin.bottom_node.next&&t.basin.bottom_node.point.y>=t.basin.bottom_node.next.point.y;)t.basin.bottom_node=t.basin.bottom_node.next;if(t.basin.bottom_node===t.basin.left_node)return;t.basin.right_node=t.basin.bottom_node;for(;t.basin.right_node.next&&t.basin.right_node.point.y<t.basin.right_node.next.point.y;)t.basin.right_node=t.basin.right_node.next;if(t.basin.right_node===t.basin.bottom_node)return;t.basin.width=t.basin.right_node.point.x-t.basin.left_node.point.x,t.basin.left_highest=t.basin.left_node.point.y>t.basin.right_node.point.y,function t(n,e){if(function(t,n){var e;e=t.basin.left_highest?t.basin.left_node.point.y-n.point.y:t.basin.right_node.point.y-n.point.y;if(t.basin.width>e)return!0;return!1}(n,e))return;x(n,e);if(e.prev===n.basin.left_node&&e.next===n.basin.right_node)return;if(e.prev===n.basin.left_node){if(u(e.point,e.next.point,e.next.next.point)===h.CW)return;e=e.next}else if(e.next===n.basin.right_node){if(u(e.point,e.prev.point,e.prev.prev.point)===h.CCW)return;e=e.prev}else e=e.prev.point.y<e.next.point.y?e.prev:e.next;t(n,e)}(t,t.basin.bottom_node)}(t,n)}(t,o),o}function f(t,n,e){t.edge_event.constrained_edge=n,t.edge_event.right=n.p.x>n.q.x,y(e.triangle,n.p,n.q)||(!function(t,n,e){t.edge_event.right?function(t,n,e){for(;e.next.point.x<n.p.x;)u(n.q,e.next.point,n.p)===h.CCW?b(t,n,e):e=e.next}(t,n,e):function(t,n,e){for(;e.prev.point.x>n.p.x;)u(n.q,e.prev.point,n.p)===h.CW?w(t,n,e):e=e.prev}(t,n,e)}(t,n,e),g(t,n.p,n.q,e.triangle,n.q))}function g(t,n,e,i,r){if(!y(i,n,e)){var s=i.pointCCW(r),a=u(e,s,n);if(a===h.COLLINEAR)throw new o("poly2tri EdgeEvent: Collinear not supported!",[e,s,n]);var p=i.pointCW(r),d=u(e,p,n);if(d===h.COLLINEAR)throw new o("poly2tri EdgeEvent: Collinear not supported!",[e,p,n]);a===d?g(t,n,e,i=a===h.CW?i.neighborCCW(r):i.neighborCW(r),r):E(t,n,e,i,r)}}function y(t,n,e){var i=t.edgeIndex(n,e);if(-1!==i){t.markConstrainedEdgeByIndex(i);var o=t.getNeighbor(i);return o&&o.markConstrainedEdgeByPoints(n,e),!0}return!1}function x(t,n){var e=new r(n.prev.point,n.point,n.next.point);e.markNeighbor(n.prev.triangle),e.markNeighbor(n.triangle),t.addToMap(e),n.prev.next=n.next,n.next.prev=n.prev,_(t,e)||t.mapTriangleToNodes(e)}function _(t,n){for(var e=0;e<3;++e)if(!n.delaunay_edge[e]){var i=n.getNeighbor(e);if(i){var o=n.getPoint(e),r=i.oppositePoint(n,o),s=i.index(r);if(i.constrained_edge[s]||i.delaunay_edge[s]){n.constrained_edge[e]=i.constrained_edge[s];continue}if(v(o,n.pointCCW(o),n.pointCW(o),r)){n.delaunay_edge[e]=!0,i.delaunay_edge[s]=!0,C(n,o,i,r);var a=!_(t,n);return a&&t.mapTriangleToNodes(n),(a=!_(t,i))&&t.mapTriangleToNodes(i),n.delaunay_edge[e]=!1,i.delaunay_edge[s]=!1,!0}}}return!1}function v(t,n,e,i){var o=t.x-i.x,r=t.y-i.y,s=n.x-i.x,a=n.y-i.y,p=o*a-s*r;if(p<=0)return!1;var h=e.x-i.x,u=e.y-i.y,d=h*r-o*u;return!(d<=0)&&(o*o+r*r)*(s*u-h*a)+(s*s+a*a)*d+(h*h+u*u)*p>0}function C(t,n,e,i){var o,r,s,a,p,h,u,d,l,c,f,g;o=t.neighborCCW(n),r=t.neighborCW(n),s=e.neighborCCW(i),a=e.neighborCW(i),p=t.getConstrainedEdgeCCW(n),h=t.getConstrainedEdgeCW(n),u=e.getConstrainedEdgeCCW(i),d=e.getConstrainedEdgeCW(i),l=t.getDelaunayEdgeCCW(n),c=t.getDelaunayEdgeCW(n),f=e.getDelaunayEdgeCCW(i),g=e.getDelaunayEdgeCW(i),t.legalize(n,i),e.legalize(i,n),e.setDelaunayEdgeCCW(n,l),t.setDelaunayEdgeCW(n,c),t.setDelaunayEdgeCCW(i,f),e.setDelaunayEdgeCW(i,g),e.setConstrainedEdgeCCW(n,p),t.setConstrainedEdgeCW(n,h),t.setConstrainedEdgeCCW(i,u),e.setConstrainedEdgeCW(i,d),t.clearNeighbors(),e.clearNeighbors(),o&&e.markNeighbor(o),r&&t.markNeighbor(r),s&&t.markNeighbor(s),a&&e.markNeighbor(a),t.markNeighbor(e)}function b(t,n,e){e.point.x<n.p.x&&(u(e.point,e.next.point,e.next.next.point)===h.CCW?m(t,n,e):(!function t(n,e,i){u(i.next.point,i.next.next.point,i.next.next.next.point)===h.CCW?m(n,e,i.next):u(e.q,i.next.next.point,e.p)===h.CCW&&t(n,e,i.next)}(t,n,e),b(t,n,e)))}function m(t,n,e){x(t,e.next),e.next.point!==n.p&&u(n.q,e.next.point,n.p)===h.CCW&&u(e.point,e.next.point,e.next.next.point)===h.CCW&&m(t,n,e)}function w(t,n,e){e.point.x>n.p.x&&(u(e.point,e.prev.point,e.prev.prev.point)===h.CW?W(t,n,e):(!function t(n,e,i){u(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===h.CW?W(n,e,i.prev):u(e.q,i.prev.prev.point,e.p)===h.CW&&t(n,e,i.prev)}(t,n,e),w(t,n,e)))}function W(t,n,e){x(t,e.prev),e.prev.point!==n.p&&u(n.q,e.prev.point,n.p)===h.CW&&u(e.point,e.prev.point,e.prev.prev.point)===h.CW&&W(t,n,e)}function E(t,n,e,r,s){var a=r.neighborAcross(s);i(a,"FLIP failed due to missing triangle!");var p=a.oppositePoint(r,s);if(r.getConstrainedEdgeAcross(s)){var l=r.index(s);throw new o("poly2tri Intersecting Constraints",[s,p,r.getPoint((l+1)%3),r.getPoint((l+2)%3)])}d(s,r.pointCCW(s),r.pointCW(s),p)?(C(r,s,a,p),t.mapTriangleToNodes(r),t.mapTriangleToNodes(a),s===e&&p===n?e===t.edge_event.constrained_edge.q&&n===t.edge_event.constrained_edge.p&&(r.markConstrainedEdgeByPoints(n,e),a.markConstrainedEdgeByPoints(n,e),_(t,r),_(t,a)):E(t,n,e,r=function(t,n,e,i,o,r){var s;if(n===h.CCW)return s=i.edgeIndex(o,r),i.delaunay_edge[s]=!0,_(t,i),i.clearDelaunayEdges(),e;return s=e.edgeIndex(o,r),e.delaunay_edge[s]=!0,_(t,e),e.clearDelaunayEdges(),i}(t,u(e,p,n),r,a,s,p),s)):(!function t(n,e,o,r,s,a){var p=s.neighborAcross(a);i(p,"FLIP failed due to missing triangle");var h=p.oppositePoint(s,a);if(d(o,r.pointCCW(o),r.pointCW(o),h))E(n,o,h,p,h);else{var u=N(e,o,p,h);t(n,e,o,r,p,u)}}(t,n,e,r,a,N(n,e,a,p)),g(t,n,e,r,s))}function N(t,n,e,i){var r=u(n,i,t);if(r===h.CW)return e.pointCCW(i);if(r===h.CCW)return e.pointCW(i);throw new o("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[n,i,t])}n.triangulate=function(t){t.initTriangulation(),t.createAdvancingFront(),function(t){var n,e=t.pointCount();for(n=1;n<e;++n)for(var i=t.getPoint(n),o=c(t,i),r=i._p2t_edge_list,s=0;r&&s<r.length;++s)f(t,r[s],o)}(t),function(t){for(var n=t.front().head().next.triangle,e=t.front().head().next.point;!n.getConstrainedEdgeCW(e);)n=n.neighborCCW(e);t.meshClean(n)}(t)}},function(t,n,e){"use strict";var i=function(t,n){this.head_=t,this.tail_=n,this.search_node_=t};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(t){this.head_=t},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(t){this.tail_=t},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(t){this.search_node_=t},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(t){var n=this.search_node_;if(t<n.value){for(;n=n.prev;)if(t>=n.value)return this.search_node_=n,n}else for(;n=n.next;)if(t<n.value)return this.search_node_=n.prev,n.prev;return null},i.prototype.locatePoint=function(t){var n=t.x,e=this.findSearchNode(n),i=e.point.x;if(n===i){if(t!==e.point)if(t===e.prev.point)e=e.prev;else{if(t!==e.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");e=e.next}}else if(n<i)for(;(e=e.prev)&&t!==e.point;);else for(;(e=e.next)&&t!==e.point;);return e&&(this.search_node_=e),e},t.exports=i,t.exports.Node=function(t,n){this.point=t,this.triangle=n||null,this.next=null,this.prev=null,this.value=t.x}},function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=e(7),o=e(8);e.n(o);onmessage=function(t){!function(t,n){function e(t,n,e){return new i.c(t,n,e)}function r(t,n){return new i.b(t,n)}function s(t,n,e,o){return new i.a(t,n,e,o)}var a=0;function p(t,e){if(d.length>0){u.vertices=d;for(var i=[],o=[],r=[],s=0;s<u.faces.length;++s){var a=u.faces[s];i.push(u.vertices[a.a].x),i.push(u.vertices[a.a].y),i.push(u.vertices[a.a].z),i.push(u.vertices[a.b].x),i.push(u.vertices[a.b].y),i.push(u.vertices[a.b].z),i.push(u.vertices[a.c].x),i.push(u.vertices[a.c].y),i.push(u.vertices[a.c].z),3===a.vertexNormals.length?(r.push(a.vertexNormals[0].x),r.push(a.vertexNormals[0].y),r.push(a.vertexNormals[0].z),r.push(a.vertexNormals[1].x),r.push(a.vertexNormals[1].y),r.push(a.vertexNormals[1].z),r.push(a.vertexNormals[2].x),r.push(a.vertexNormals[2].y),r.push(a.vertexNormals[2].z)):(r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z),r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z),r.push(a.normal.x),r.push(a.normal.y),r.push(a.normal.z))}for(var p=0;p<u.faceVertexUvs[0].length;++p){var l=u.faceVertexUvs[0][p];o.push(l[0].x),o.push(l[0].y),o.push(l[1].x),o.push(l[1].y),o.push(l[2].x),o.push(l[2].y)}h.geometry={normal:new Float32Array(r),uv:new Float32Array(o),position:new Float32Array(i),normalItemSize:3,positionItemSize:3,uvItemSize:2},n(h),u={faces:[],faceVertexUvs:[[]],vertices:[]}}void 0!==t&&(h.meshName=t),void 0!==e&&(h.materialName=e)}var h={},u={faces:[],faceVertexUvs:[[]],vertices:[]},d=[],l=[],c=[];function f(t,n,e,i){void 0===i?u.faces.push(s(parseInt(t)-(a+1),parseInt(n)-(a+1),parseInt(e)-(a+1))):u.faces.push(s(parseInt(t)-(a+1),parseInt(n)-(a+1),parseInt(e)-(a+1),[l[parseInt(i[0])-1].clone(),l[parseInt(i[1])-1].clone(),l[parseInt(i[2])-1].clone()]))}function g(t,n,e){u.faceVertexUvs[0].push([c[parseInt(t)-1].clone(),c[parseInt(n)-1].clone(),c[parseInt(e)-1].clone()])}function y(t,n,e){void 0===t[3]?(f(t[0],t[1],t[2],e),void 0!==n&&n.length>0&&g(n[0],n[1],n[2])):(void 0!==e&&e.length>0?(f(t[0],t[1],t[3],[e[0],e[1],e[3]]),f(t[1],t[2],t[3],[e[1],e[2],e[3]])):(f(t[0],t[1],t[3]),f(t[1],t[2],t[3])),void 0!==n&&n.length>0&&(g(n[0],n[1],n[3]),g(n[1],n[2],n[3])))}for(var x=/v( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,_=/vn( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,v=/vt( +[\\d|\\.|\\+|\\-|e]+)( +[\\d|\\.|\\+|\\-|e]+)/,C=/f( +\\d+)( +\\d+)( +\\d+)( +\\d+)?/,b=/f( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+))?/,m=/f( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))( +(\\d+)\\/(\\d+)\\/(\\d+))?/,w=/f( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))( +(\\d+)\\/\\/(\\d+))?/,W=/f( +(\\d+)\\/(\\d+)\\/(\\d+)){5,}?/,E=t.split("\\n"),N=null,P=0;P<E.length;P++){var I,z=E[P];if(0!==(z=z.trim()).length&&"#"!==z.charAt(0))if(null!==(I=x.exec(z))){if(null===N){var T=I[1].split(".")[1]?I[1].split(".")[1].length:0;T>7&&(T=7),N=Math.pow(10,T)}d.push(e(parseFloat(I[1]),parseFloat(I[2]),parseFloat(I[3])))}else if(null!==(I=_.exec(z)))l.push(e(parseFloat(I[1]),parseFloat(I[2]),parseFloat(I[3])));else if(null!==(I=v.exec(z)))c.push(r(parseFloat(I[1]),parseFloat(I[2])));else if(null!==(I=C.exec(z)))y([I[1],I[2],I[3],I[4]]);else if(null!==(I=b.exec(z)))y([I[2],I[5],I[8],I[11]],[I[3],I[6],I[9],I[12]]);else if(null!==(I=W.exec(z))){for(var S=z.split(" "),A=/(\\d+)\\/(\\d+)\\/(\\d+)/,q=[],k=[],F=[],O=[],V=null,D=null,L=null,B=null,M=1;M<S.length;M++){var j=void 0;if(null!==(j=A.exec(S[M]))){k.push(parseInt(j[1])),F.push(parseInt(j[2])),O.push(parseInt(j[3]));var U=d[parseInt(j[1])-1].clone();if(null===L&&(L=l[parseInt(j[3])-1]),null===B)B=U.clone(),q.push({x:0,y:0,id:0});else if(null===V){var H=U.clone().add(B.clone().negate());(V=H.clone()).normalize(),(D=V.clone().cross(L.clone())).normalize(),q.push({x:H.length()*N,y:0,id:1}),0===V.lengthSq()&&console.error("model contains duplicate points")}else{var R=U.clone().add(B.clone().negate());q.push({x:R.dot(V)*N,y:R.dot(D)*N,id:M-1})}}}try{var G=new o.SweepContext(q);G.triangulate();var J=G.getTriangles();J.map(function(t){var n=t.getPoints().map(function(t){return t.id});f(k[n[0]],k[n[1]],k[n[2]],[O[n[0]],O[n[1]],O[n[2]]]),g(F[n[0]],F[n[1]],F[n[2]])})}catch(t){console.error("error",t)}}else null!==(I=m.exec(z))?y([I[2],I[6],I[10],I[14]],[I[3],I[7],I[11],I[15]],[I[4],I[8],I[12],I[16]]):null!==(I=w.exec(z))?y([I[2],I[5],I[8],I[11]],[],[I[3],I[6],I[9],I[12]]):/^o /.test(z)?(p(),a+=d.length,d=[]):/^g /.test(z)?p(z.substring(2).trim(),void 0):/^usemtl /.test(z)?p(void 0,z.substring(7).trim()):/^mtllib /.test(z)||/^s /.test(z)||console.warn("OBJMTLLoader: Unhandled line "+z)}p(void 0,void 0),n("finish")}(t.data.data,function(t){var n=!1,e=null;"finish"===t?n=!0:e=t,postMessage({mesh:e,isFinish:n})})},onerror=function(t){throw console.error("BundleLoader error",t),t}},function(t,n,e){"use strict";function i(t,n){this.x=t||0,this.y=n||0}function o(t,n,e){this.x=t||0,this.y=n||0,this.z=e||0}function r(t,n,e){return{r:t,g:n,b:e}}function s(t,n,e,i,s,a){this.a=t,this.b=n,this.c=e,this.normal=i&&i.isVector3?i:new o,this.vertexNormals=Array.isArray(i)?i:[],this.color=s&&s.isColor?s:new r(1,1,1),this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=void 0!==a?a:0}e.d(n,"b",function(){return i}),e.d(n,"c",function(){return o}),e.d(n,"a",function(){return s}),Object.assign(i.prototype,{constructor:i,isVector2:!0,clone:function(){return new this.constructor(this.x,this.y)}}),Object.assign(o.prototype,{constructor:o,isVector3:!0,clone:function(){return new this.constructor(this.x,this.y,this.z)},add:function(t,n){return void 0!==n?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,n)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this.z=t.z+n.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},normalize:function(){return this.divideScalar(this.length()||1)},divideScalar:function(t){return this.multiplyScalar(1/t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t,n){if(void 0!==n)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,n);var e=this.x,i=this.y,o=this.z;return this.x=i*t.z-o*t.y,this.y=o*t.x-e*t.z,this.z=e*t.y-i*t.x,this},crossVectors:function(t,n){var e=t.x,i=t.y,o=t.z,r=n.x,s=n.y,a=n.z;return this.x=i*a-o*s,this.y=o*r-e*a,this.z=e*s-i*r,this}}),Object.assign(r.prototype,{isColor:!0})},function(t,n,e){"use strict";(function(t){var i=t.poly2tri;n.noConflict=function(){return t.poly2tri=i,n},n.VERSION=e(10).version,n.PointError=e(0),n.Point=e(3),n.Triangle=e(2),n.SweepContext=e(11);var o=e(4);n.triangulate=o.triangulate,n.sweep={Triangulate:o.triangulate}}).call(n,e(9))},function(t,n){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n){t.exports={version:"1.5.0"}},function(t,n,e){"use strict";var i=e(0),o=e(3),r=e(2),s=e(4),a=e(5),p=a.Node,h=function(t,n){if(this.p=t,this.q=n,t.y>n.y)this.q=t,this.p=n;else if(t.y===n.y)if(t.x>n.x)this.q=t,this.p=n;else if(t.x===n.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[t]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},u=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};u.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var d=function(t,n){n=n||{},this.triangles_=[],this.map_=[],this.points_=n.cloneArrays?t.slice(0):t,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new u,this.edge_event=new function(){this.constrained_edge=null,this.right=!1},this.initEdges(this.points_)};d.prototype.addHole=function(t){this.initEdges(t);var n,e=t.length;for(n=0;n<e;n++)this.points_.push(t[n]);return this},d.prototype.AddHole=d.prototype.addHole,d.prototype.addHoles=function(t){var n,e=t.length;for(n=0;n<e;n++)this.initEdges(t[n]);return this.points_=this.points_.concat.apply(this.points_,t),this},d.prototype.addPoint=function(t){return this.points_.push(t),this},d.prototype.AddPoint=d.prototype.addPoint,d.prototype.addPoints=function(t){return this.points_=this.points_.concat(t),this},d.prototype.triangulate=function(){return s.triangulate(this),this},d.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},d.prototype.getTriangles=function(){return this.triangles_},d.prototype.GetTriangles=d.prototype.getTriangles,d.prototype.front=function(){return this.front_},d.prototype.pointCount=function(){return this.points_.length},d.prototype.head=function(){return this.head_},d.prototype.setHead=function(t){this.head_=t},d.prototype.tail=function(){return this.tail_},d.prototype.setTail=function(t){this.tail_=t},d.prototype.getMap=function(){return this.map_},d.prototype.initTriangulation=function(){var t,n=this.points_[0].x,e=this.points_[0].x,i=this.points_[0].y,r=this.points_[0].y,s=this.points_.length;for(t=1;t<s;t++){var a=this.points_[t];a.x>n&&(n=a.x),a.x<e&&(e=a.x),a.y>i&&(i=a.y),a.y<r&&(r=a.y)}this.pmin_=new o(e,r),this.pmax_=new o(n,i);var p=.3*(n-e),h=.3*(i-r);this.head_=new o(n+p,r-h),this.tail_=new o(e-p,r-h),this.points_.sort(o.compare)},d.prototype.initEdges=function(t){var n,e=t.length;for(n=0;n<e;++n)this.edge_list.push(new h(t[n],t[(n+1)%e]))},d.prototype.getPoint=function(t){return this.points_[t]},d.prototype.addToMap=function(t){this.map_.push(t)},d.prototype.locateNode=function(t){return this.front_.locateNode(t.x)},d.prototype.createAdvancingFront=function(){var t,n,e,i=new r(this.points_[0],this.tail_,this.head_);this.map_.push(i),t=new p(i.getPoint(1),i),n=new p(i.getPoint(0),i),e=new p(i.getPoint(2)),this.front_=new a(t,e),t.next=n,n.next=e,n.prev=t,e.prev=n},d.prototype.removeNode=function(t){},d.prototype.mapTriangleToNodes=function(t){for(var n=0;n<3;++n)if(!t.getNeighbor(n)){var e=this.front_.locatePoint(t.pointCW(t.getPoint(n)));e&&(e.triangle=t)}},d.prototype.removeFromMap=function(t){var n,e=this.map_,i=e.length;for(n=0;n<i;n++)if(e[n]===t){e.splice(n,1);break}},d.prototype.meshClean=function(t){for(var n,e,i=[t];n=i.pop();)if(!n.isInterior())for(n.setInterior(!0),this.triangles_.push(n),e=0;e<3;e++)n.constrained_edge[e]||i.push(n.getNeighbor(e))},t.exports=d},function(t,n,e){"use strict";t.exports=function(t,n){if(!t)throw new Error(n||"Assert Failed")}},function(t,n,e){"use strict";var i=1e-12;n.EPSILON=i;var o={CW:1,CCW:-1,COLLINEAR:0};n.Orientation=o,n.orient2d=function(t,n,e){var r=(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x);return r>-i&&r<i?o.COLLINEAR:r>0?o.CCW:o.CW},n.inScanArea=function(t,n,e,o){return!((t.x-n.x)*(o.y-n.y)-(o.x-n.x)*(t.y-n.y)>=-i||(t.x-e.x)*(o.y-e.y)-(o.x-e.x)*(t.y-e.y)<=i)},n.isAngleObtuse=function(t,n,e){var i=n.x-t.x,o=n.y-t.y;return i*(e.x-t.x)+o*(e.y-t.y)<0}}]);',r.p+"OBJParser.js")}},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),e}var c=function(){function e(){s(this,e)}return u(e,[{key:"get",value:function(e,t){var r=this._doGet(e);return void 0===r||null===r?t:r}},{key:"set",value:function(e,t){if(void 0===e||null===e)throw new Error("Invalid argument");this._doSet(e,t)}}]),e}(),f=function(e){function t(){var e;return s(this,t),(e=o(this,i(t).call(this))).cache={},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,c),u(t,[{key:"_doGet",value:function(e){var t=this.cache[e];if(t){var r=t.clone();return r.objSpaceBBox=t.objSpaceBBox.clone(),this.deepCloneMaterial(t.objSpaceBBox,r.objSpaceBBox),this.deepCloneMaterial(t,r),r}}},{key:"_doSet",value:function(e,t){var r=t.clone();r.objSpaceBBox=t.objSpaceBBox.clone(),this.deepCloneMaterial(t,r),this.cache[e]=r}},{key:"deepCloneMaterial",value:function(e,t){if("Group"===e.type)for(var r=0;r<e.children.length;r+=1)this.deepCloneMaterial(e.children[r],t.children[r]);else"Mesh"===e.type?e.material instanceof Array?t.material=e.material.map(function(e){return e.clone()}):(t.material=e.material.clone(),e.mtlParams&&(t.mtlParams=JSON.parse(JSON.stringify(e.mtlParams)))):console.warn("deepCloneMaterial",e)}}]),t}();t.a=f},function(e,t,r){"use strict";var n=r(17),o=r(0);r.n(o);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=h(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t,r,n){return(c="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=h(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function f(e,t,r,n,o){if(!c(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?s(e):t}(this,p(t).call(this,e)))._size={width:64,height:64},e.size&&(e.size.width>0&&(r._size.width=e.size.width),e.size.height>0&&(r._size.height=e.size.height)),r._canvas=document.createElement("canvas"),r._canvas.width=r._size.width,r._canvas.height=r._size.height,r._context=r._canvas.getContext("2d"),r._context.fillStyle="black",r._context.fillRect(0,0,r._canvas.width,r._canvas.height),r._texture=new o.Texture(r._canvas,o.UVMapping,o.ClampToEdgeWrapping,o.ClampToEdgeWrapping,o.LinearFilter,o.LinearFilter),r._texture.needsUpdate=!0,f(p(t.prototype),"texture",{texture:r._texture,aspectRatio:r._canvas.width/r._canvas.height},s(r),!0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,n["a"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"destruct",value:function(){return this._texture.dispose(),l(p(t.prototype),"destruct",this).call(this)}},{key:"takeEffects",value:function(){this._texture.needsUpdate=!0}},{key:"context",get:function(){return this._context}},{key:"size",set:function(e){e.width>0&&(this._size.width=e.width),e.height>0&&(this._size.height=e.height),this._canvas.width=this._size.width,this._canvas.height=this._size.height,f(p(t.prototype),"texture",{texture:this._texture,aspectRatio:this._canvas.width/this._canvas.height},this,!0)},get:function(){return{width:this._size.width,height:this._size.height}}}]),t}();t.a=d},function(e,t,r){"use strict";var n=r(34);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,r,n){return(s="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function l(e,t,r,n,o){if(!s(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.sided=void 0===e.sided?91:e.sided,(r=a(this,u(t).call(this,e)))._property.type="CylinderVolumeMarker",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,n["a"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"sided",set:function(e){e<91?console.warn("CylinderVolumeMarker sided cannot be smaller than 91: ",e):l(u(t.prototype),"sided",e,this,!0)},get:function(){return this._sided}}]),t}();t.a=f},function(e,t,r){"use strict";var n=r(21),o=r(0);r.n(o);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e,t,r){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=f(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function u(e,t,r,n){return(u="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=f(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function c(e,t,r,n,o){if(!u(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.volume;if(n.hasTopCover=!1,n.hasBottomCover=!0,n.bottom=void 0===n.bottom||null===n.bottom?0:n.bottom,!function(e){if("number"!=typeof n.bottom)return console.log("DitchMarker bottom must be a number",e),!1;return!0}(e))return s(r,void 0);r=s(this,h(t).call(this,e));for(var i=["#502a12","#1c1505","#1c1505","#1c1505","#64553a","#403027","#403027","#1c1505"].map(function(e){return new o.Color(e)}),a=[],l=0;l<i.length;++l)a.push(255*i[l].r),a.push(255*i[l].g),a.push(255*i[l].b),a.push(255);var u=r._generateDataTexture(a);r.extrudeMesh.material.map=u,r.extrudeMesh.material.map.needsUpdate=!0;for(var c=r.bottomCover.uvs,f=0;f<c.length;++f)c[f]=[new o.Vector2(1,1),new o.Vector2(1,1),new o.Vector2(0,1)];for(var p=r.otherCover.uvs,d=0;d<p.length;d+=2)p[d]=[new o.Vector2(0,1),new o.Vector2(1,1),new o.Vector2(0,0)],p[d+1]=[new o.Vector2(1,1),new o.Vector2(1,0),new o.Vector2(0,0)];return r.extrudeMesh.geometry.faceVertexUvs[0]=[].concat(c).concat(p),r.extrudeMesh.geometry.uvsNeedUpdate=!0,r.extrudeMesh.material.opacity=1,r.extrudeMesh.material.transparent=!1,r.extrudeMesh.material.depthWrite=!0,r.extrudeMesh.material.side=o.BackSide,r.interactShape.material.side=o.BackSide,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n["a"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"_generateDataTexture",value:function(e){var t=new o.DataTexture(new Uint8Array(e),1,Math.floor(e.length/4),o.RGBAFormat,o.UnsignedByteType,o.UVMapping);return t.minFilter=t.magFilter=o.LinearFilter,t.needsUpdate=!0,t}},{key:"destruct",value:function(){return this.interactable&&(this.interactable=!1),this.extrudeMesh&&this.extrudeMesh.material&&this.extrudeMesh.material.map&&this.extrudeMesh.material.map.dispose(),l(h(t.prototype),"destruct",this).call(this)}},{key:"texture",set:function(e){if(Array.isArray(e)){for(var t=e.map(function(e){return new o.Color(e)}),r=[],n=0;n<t.length;++n)r.push(255*t[n].r),r.push(255*t[n].g),r.push(255*t[n].b),r.push(255);var i=this._generateDataTexture(r);this.extrudeMesh.material.map=i,this.extrudeMesh.material.map.needsUpdate=!0}else console.warn("DitchMarker texture the input must be an array",e)}},{key:"bottom",set:function(e){"number"==typeof e?c(h(t.prototype),"bottom",e,this,!0):console.warn("DitchMarker setter bottom: input must be a number",e)},get:function(){return this._bottom}},{key:"hasTopCover",set:function(e){console.warn("DitchMarker cannot set hasTopCover: must be false",e)},get:function(){return!1}},{key:"hasBottomCover",set:function(e){console.warn("DitchMarker cannot set hasBottomCover: must be true",e)},get:function(){return!0}},{key:"opacity",set:function(e){console.warn("DitchMarker cannot set opacity")},get:function(){return 1}}]),t}();t.a=d},function(e,t,r){"use strict";var n=r(22),o=r(1),i=(r.n(o),r(0)),a=(r.n(i),r(9)),s=r(8);function l(e,t,r,n){return(l="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=f(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function u(e,t,r,n,o){if(!l(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=f(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}function m(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _={DASH:"dash"},w={LINEAR:"linear",REPEAT:"repeat"},x={HORIZONTAL:"horizontal",VERTICAL:"vertical",NONE:"none"},k=new i.DataTexture(new Uint8Array([255,255,255,255,0,0,0,0]),2,1,i.RGBAFormat,i.UnsignedByteType,i.UVMapping);k.minFilter=k.magFilter=i.LinearFilter,k.wrapS=k.wrapT=i.RepeatWrapping,k.needsUpdate=!0;var O={DASH:k};function P(){var e=0,t=0,r=0,n=0;function o(o,i,a,s){e=o,t=a,r=-3*o+3*i-2*a-s,n=2*o-2*i+a+s}return{initCatmullRom:function(e,t,r,n,i){o(t,r,i*(r-e),i*(n-t))},initNonuniformCatmullRom:function(e,t,r,n,i,a,s){var l=(t-e)/i-(r-e)/(i+a)+(r-t)/a,u=(r-t)/a-(n-t)/(a+s)+(n-r)/s;o(t,r,l*=a,u*=a)},calc:function(o){var i=o*o;return e+t*o+r*i+n*(i*o)}}}var A=new P,S=new P,M=new P,T=function(e){function t(e,r,n,o,i){var a,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"centripetal";return p(this,t),(a=m(this,y(t).call(this))).p0=e,a.p1=r,a.p2=n,a.p3=o,a.tension=i,a.curveType=s,a}return g(t,i["Curve"]),v(t,[{key:"getPoint",value:function(e,t){var r=t||new i.Vector3,n=this.p0,o=this.p1,a=this.p2,s=this.p3;if("centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25,u=Math.pow(n.distanceToSquared(o),l),c=Math.pow(o.distanceToSquared(a),l),f=Math.pow(a.distanceToSquared(s),l);c<1e-4&&(c=1),u<1e-4&&(u=c),f<1e-4&&(f=c),A.initNonuniformCatmullRom(n.x,o.x,a.x,s.x,u,c,f),S.initNonuniformCatmullRom(n.y,o.y,a.y,s.y,u,c,f),M.initNonuniformCatmullRom(n.z,o.z,a.z,s.z,u,c,f)}else"catmullrom"===this.curveType&&(A.initCatmullRom(n.x,o.x,a.x,s.x,this.tension),S.initCatmullRom(n.y,o.y,a.y,s.y,this.tension),M.initCatmullRom(n.z,o.z,a.z,s.z,this.tension));return r.set(A.calc(e),S.calc(e),M.calc(e)),r}}]),t}(),E=function(e){function t(e){var r,n=e.lineWidth,a=e.color,s=e.depthTest,l=e.opacity;return p(this,t),(r=m(this,y(t).call(this)))._lineMaterial=new o.MeshBasicMaterial2({color:a,depthTest:s,side:i.DoubleSide,opacity:l,transparent:!0,wireframe:!1,map:null}),r._lineWidth=n,r._lineOptions=[],r._uvType=w.REPEAT,r}return g(t,i["Object3D"]),v(t,[{key:"addNewLine",value:function(e){var t=e.curve,r=e.segments,n=void 0===r?10:r,o=e.distance;this._lineOptions.push({curve:t,segments:n,distance:o});var a=new i.TubeBufferGeometry(t,n,this._lineWidth,8,!1),s=new i.Mesh(a,this._lineMaterial);this.add(s),this.updateLineUvs(this._uvType)}},{key:"updateLine",value:function(e,t){var r=t.curve,n=t.segments,o=void 0===n?10:n,a=t.distance,s=new i.TubeBufferGeometry(r,o,this._lineWidth,8,!1);this.children[e].geometry.dispose(),this.children[e].geometry=null,this.children[e].geometry=s,this._lineOptions[e]={curve:r,segments:o,distance:a},this.updateLineUvs(this._uvType)}},{key:"updateLineUvs",value:function(e){this._uvType=e;if(e===w.LINEAR)for(var t=0;t<this.children.length;++t){for(var r=this.children[t].geometry,n=this._lineOptions[t].segments,o=0;o<=n;++o)for(var i=0;i<=8;++i){var a=o/n,s=9*o+i,l=i/8*2-1;l=l<0?-l:l,r.attributes.uv.setXY(s,a,l)}r.attributes.uv.needsUpdate=!0}else for(var u=(this._lineMaterial.map?this._lineMaterial.map.image.width/this._lineMaterial.map.image.height:1)*this._lineWidth*2,c=0,f=0;f<this.children.length;++f){for(var h=this.children[f].geometry,p=this._lineOptions[f],d=(n=p.segments,p.distance),v=0;v<=n;++v)for(var m=0;m<=8;++m){var y=c+v/n*d/u,g=9*v+m,b=m/8*2-1;b=b<0?-b:b,h.attributes.uv.setXY(g,y,b)}h.attributes.uv.needsUpdate=!0,c+=d/u}}},{key:"destruct",value:function(){for(var e=this.children.length-1;e>=0;e-=1){var t=this.children[e];t.geometry&&t.geometry.dispose()}return this._lineMaterial.dispose(),this._lineOptions=[],!0}},{key:"lineWidth",set:function(e){this._lineWidth=e;for(var t=0;t<this.children.length;++t)this.updateLine(t,this._lineOptions[t])}},{key:"opacity",set:function(e){this._lineMaterial.opacity=e}},{key:"depthTest",set:function(e){this._lineMaterial.depthTest=e}},{key:"color",set:function(e){this._lineMaterial.color=e}}]),t}(),C=function(e){function t(e){var r;p(this,t);var n=!0;e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE&&(n=!1),e.__DO_NOT_CONSTRUCT_LINE_INTERAL_USE=!0,(r=m(this,y(t).call(this,e)))._opacity="number"==typeof e.opacity?e.opacity:1,r._property.opacity=r._opacity,r._labelScaleFunc=function(e){return 1/(Math.abs(e)+.005)},r._property.labelScaleFunc=r._labelScaleFunc.toString(),r._labelScale=10*r._labelScaleFunc(r._lineWidth);for(var o=0;o<r.labelHolder._labelOptions.length;++o){var i=r.labelHolder._labelOptions[o],s={x:i.width/i.height*r._labelScale,y:r._labelScale,z:1};r.labelHolder.drawOnLabel(o,{scale:s})}if(n){r.lineHolder=new E({lineWidth:r._lineWidth,color:r._color,opacity:r._opacity,depthTest:r._depthTest}),r.contentHolder.add(r.lineHolder);for(var l=0;l<r._points.length-1;++l){var u=r._constructLineOptions(l,l+1);r.lineHolder.addNewLine(u)}r._updateInteractShape(),r._speed="number"==typeof e.speed?e.speed:1,r._uvAnimation=new a.a({offset:0,speed:r._speed,lastTime:void 0},function(e){if(e.lastTime||(e.lastTime=Date.now()),!r._style)return!0;if(r._style.animation===x.HORIZONTAL||r._style.animation===x.VERTICAL){var t=Date.now(),n=e.speed*(t-e.lastTime)/1e3;e.lastTime=t,e.offset-=n;for(var o=0;o<r.lineHolder.children.length;++o){for(var i=r.lineHolder.children[o].geometry.attributes.uv,a=0;a<i.count;++a){if(r._style.animation===x.HORIZONTAL){var s=i.getX(a);i.setX(a,s-n)}else if(r._style.animation===x.VERTICAL){var l=i.getY(a);i.setY(a,l-n)}if(e.offset<=-1)if(r._style.animation===x.HORIZONTAL){var u=i.getX(a);i.setX(a,u+1)}else if(r._style.animation===x.VERTICAL){var c=i.getY(a);i.setY(a,c+1)}}e.offset<=-1&&(e.offset+=1),i.needsUpdate=!0}}return!0},100),r._uvAnimation.start();var c=Object.assign({texture:_.DASH,alphaMap:"none",alphaChannel:"green",mapping:w.REPEAT,color:r._color,opacity:r._opacity,animation:x.HORIZONTAL},e.style);r.style=c}return r._property.type="PolyTubeLineMarker",r}return g(t,n["a"]),v(t,[{key:"destruct",value:function(){var e=!0;return this._uvAnimation&&(this._uvAnimation.stop(),this._uvAnimation=void 0),e=this.lineHolder.destruct()&&e,e=c(y(t.prototype),"destruct",this).call(this)&&e}},{key:"_updateInteractShape",value:function(){for(var e=new i.Geometry,t=0;t<this.lineHolder.children.length;++t){var r=this.lineHolder.children[t];e.merge((new i.Geometry).fromBufferGeometry(r.geometry),r.matrix)}this.interactShape=new i.Mesh(e,{side:i.DoubleSide})}},{key:"_constructLineOptions",value:function(e,r){var n,o,a=Object.assign({},c(y(t.prototype),"_constructLineOptions",this).call(this,e,r)),s=this._pointsxyz[e].clone(),l=this._pointsxyz[r].clone();n=e>0?this._pointsxyz[e-1]:(new i.Vector3).subVectors(this._pointsxyz[0].clone(),this._pointsxyz[1].clone()).add(this._pointsxyz[0]);var u=this._pointsxyz.length;o=r<u-1?this._pointsxyz[r+1]:(new i.Vector3).subVectors(this._pointsxyz[u-1].clone(),this._pointsxyz[u-2].clone()).add(this._pointsxyz[u-1]);var f=s.clone().sub(n),h=l.clone().sub(s),p=h.dot(f)/(f.length()+.1)/(h.length()+.1),d=Math.floor(l.clone().sub(s).length()/10-2*p);return d=d<1?1:d,a.segments=d>5?5:d,a.curve=new T(n,s,l,o,.2,"centripetal"),a.distance=l.clone().sub(s).length(),a}},{key:"addPoint",value:function(e){c(y(t.prototype),"addPoint",this).call(this,e);var r=this._constructLineOptions(this.pointsNumber-2,this.pointsNumber-1);this.lineHolder.addNewLine(r);var n=this._constructLineOptions(this.pointsNumber-3,this.pointsNumber-2);this.lineHolder.updateLine(this.pointsNumber-3,n);var o=this.pointsNumber-2,i=this.labelHolder._labelOptions[o],a={x:i.width/i.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(o,{scale:a}),this._updateInteractShape()}},{key:"setPoint",value:function(e,r){c(y(t.prototype),"setPoint",this).call(this,e,r);var n=this;function o(e){var t=n._constructLineOptions(e,e+1);n.lineHolder.updateLine(e,t)}function i(e,t){var r=n.labelHolder._labelOptions[e],o={x:r.width/r.height*t,y:t,z:1};n.labelHolder.drawOnLabel(e,{scale:o})}0!==e&&(o(e-1),i(e-1,this._labelScale)),e!==this.pointsNumber-1&&(o(e),i(e,this._labelScale)),this._updateInteractShape()}},{key:"_loadTexture",value:function(e,t){e===_.DASH?t(O.DASH):(this._textureLoader=this._textureLoader||new s.a,this._textureLoader.load(e,function(e){e.minFilter=e.magFilter=i.LinearFilter,e.wrapS=e.wrapT=i.RepeatWrapping,e.needsUpdate=!0,t(e)}))}},{key:"lineWidth",set:function(e){this._lineWidth=e,this._property.lineWidth=e,this.lineHolder.lineWidth=e,this._updateInteractShape()},get:function(){return this._lineWidth}},{key:"labelScaleFunc",set:function(e){u(y(t.prototype),"labelScaleFunc",e,this,!0),this._labelScale=10*this._labelScaleFunc(this._lineWidth);for(var r=0;r<this.labelHolder._labelOptions.length;++r){var n=this.labelHolder._labelOptions[r],o={x:n.width/n.height*this._labelScale,y:this._labelScale,z:1};this.labelHolder.drawOnLabel(r,{scale:o})}},get:function(){return this._labelScaleFunc}},{key:"opacity",set:function(e){this._opacity=e,this._property.opacity=e,this.lineHolder.opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){this._color=e,this._property.color=e;var t=new i.Color(this._color);this.lineHolder.color=t},get:function(){return this._color}},{key:"depthTest",set:function(e){this._depthTest=e,this._property.depthTest=e,this.lineHolder.depthTest=e},get:function(){return this._depthTest}},{key:"style",set:function(e){var t=this;e=e||{};var r=this._style,n=Object.assign({},r,e);this._style=n,n.mapping!==w.LINEAR&&n.mapping!==w.REPEAT&&(console.warn("invalid mapping: ",n.mapping," mapping set to 'repeat'"),n.mapping=w.REPEAT);var o=void 0!==n.texture&&(!r||r.texture!==n.texture),i=void 0!==n.alphaMap&&(!r||r.alphaMap!==n.alphaMap),a=n.animation&&(!r||r.animation!==n.animation),s=!a&&n.mapping&&(!r||r.mapping!==n.mapping);o&&("none"===this._style.texture?this.lineHolder._lineMaterial.map&&(this.lineHolder._lineMaterial.map.dispose(),this.lineHolder._lineMaterial.map=null,this.lineHolder._lineMaterial.needsUpdate=!0):this._loadTexture(this._style.texture,function(e){t.lineHolder._lineMaterial.map&&(t.lineHolder._lineMaterial.map.dispose(),t.lineHolder._lineMaterial.map=null),t.lineHolder._lineMaterial.map=e,t.lineHolder._lineMaterial.map.needsUpdate=!0,t.lineHolder._lineMaterial.needsUpdate=!0,t.lineHolder.updateLineUvs(t._style.mapping)})),i&&("none"===this._style.alphaMap?this.lineHolder._lineMaterial.alphaMap&&(this.lineHolder._lineMaterial.alphaMap.dispose(),this.lineHolder._lineMaterial.alphaMap=null,this.lineHolder._lineMaterial.needsUpdate=!0):this._loadTexture(this._style.alphaMap,function(e){t.lineHolder._lineMaterial.alphaMap&&(t.lineHolder._lineMaterial.alphaMap.dispose(),t.lineHolder._lineMaterial.alphaMap=null),t.lineHolder._lineMaterial.alphaMap=e,t.lineHolder._lineMaterial.alphaMap.needsUpdate=!0,t.lineHolder._lineMaterial.needsUpdate=!0,t.lineHolder.updateLineUvs(t._style.mapping)})),a&&(this.lineHolder.updateLineUvs(this._style.mapping),this._uvAnimation&&this._uvAnimation.changeStates({offset:0}),this._style.animation=e.animation),s&&this.lineHolder.updateLineUvs(this._style.mapping),this.color=this._style.color,this.opacity=this._style.opacity;var l=function(e){var t={value:1,valid:!0};switch(e){case"red":t.value=0;break;case"green":t.value=1;break;case"blue":t.value=2;break;case"alpha":t.value=3;break;default:t.valid=!1}return t}(this._style.alphaChannel);l.valid&&(this.lineHolder._lineMaterial.alphaChannel=l.value)},get:function(){return this._style}},{key:"speed",set:function(e){"number"==typeof e&&(this._speed=e,this._uvAnimation&&this._uvAnimation.changeStates({speed:this._speed}))},get:function(){return this._speed}}]),t}();t.a=C},function(e,t,r){"use strict";var n=r(4),o=r(2),i=r(0),a=(r.n(i),r(13));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!function(e){if(!e.points||e.points.length<4)return console.error("[PlanarPatchMarker] at least 4 points should be specified"),!1;e.points[0].equals(e.points[e.points.length-1])||(console.warn("[PlanarPatchMarker] the first and last point should be the same, auto fixed"),e.points.push(e.points[0]));return!0}(e))return u(r,void 0);var n=new i.Vector3,s=e.points.map(function(e){var t=o.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0);return n.add(t),t});n.multiplyScalar(1/s.length);var l=o.a.getLngLatAltFromNoneGroundCartesian(void 0,n,void 0);e.position=l,(r=u(this,f(t).call(this,e)))._points=e.points,r._color=void 0===e.color?16777215:e.color,r._opacity=void 0===e.opacity?1:e.opacity,r._wireframe=void 0!==e.wireframe&&e.wireframe,r._offset=void 0===e.offset?0:e.offset;var c=o.a.getLocalSystemOnEarthSurface(void 0,l.lng,l.lat,void 0);c.origin.add(c.alt.clone().multiplyScalar(l.alt));var h=function(e,t){t=t.map(function(t){var r=t.clone().sub(e.origin),n=1*r.dot(e.lng),o=1*r.dot(e.lat),a=1*r.dot(e.alt);return new i.Vector3(n,o,a)});var r,n=Object(a.b)(t),o=n.normal,s=n.centroid;r=0===o.x&&0===o.y?new i.Vector3(1,0,0):new i.Vector3(-o.y,o.x,0).normalize();var l=o.clone().cross(r).normalize(),u=t.map(function(e){var t=e.clone().sub(s);return{x:t.dot(r),y:t.dot(l)}}),c=[],f=new i.Shape;f.moveTo(u[0].x,u[0].y),c.push(u[0].x),c.push(u[0].y);for(var h=1;h<u.length;++h)f.lineTo(u[h].x,u[h].y),c.push(u[h].x),c.push(u[h].y);var p=new i.ShapeGeometry(f);c=new Float32Array(c);var d={},m={};p.vertices.map(function(e,t){var r=v(e,1e4,10);m[r]=t});for(var y=0;y<c.length;y+=2){var g=v({x:c[y],y:c[y+1]},1e4,10);void 0!==m[g]&&(d[y/2]=m[g],p.vertices[m[g]]=t[y/2])}return{planeGeometry:p,indexMapping:d,planeInfo:n}}(c,s);r._system=c,r._indexMapping=h.indexMapping,r._planeInfo=h.planeInfo;var p=r._planeInfo.normal.clone().multiplyScalar(r._offset);h.planeGeometry.vertices.map(function(e){e.copy(e.clone().add(p))}),r._plane=new i.Mesh(h.planeGeometry,new i.MeshBasicMaterial({color:r._color,opacity:r._opacity,transparent:!0,side:i.DoubleSide,wireframe:r._wireframe})),r.contentHolder.add(r._plane);var d=new i.Geometry;function v(e,t,r){var n=Math.round(e.x*t);n=Math.floor(n/r);var o=Math.round(e.y*t);return n+"_"+(o=Math.floor(o/r))}return d.vertices.push(r._planeInfo.centroid.clone(),r._planeInfo.centroid.clone().add(r._planeInfo.normal.clone().multiplyScalar(20))),r._normal=new i.Line(d,new i.LineBasicMaterial({color:16711680,linewidth:10})),r._normal.visible=void 0===e.showNormal||e.showNormal,r.decoHolder.add(r._normal),r.interactShape=new i.Mesh(r._plane.geometry,{side:i.DoubleSide}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"destruct",value:function(){return this._plane&&(this._plane.geometry&&this._plane.geometry.dispose(),this._plane.material&&this._plane.material.dispose()),this._normal&&(this._normal.geometry&&this._normal.geometry.dispose(),this._normal.material&&this._normal.material.dispose()),c(f(t.prototype),"destruct",this).call(this)}},{key:"opacity",set:function(e){this._opacity=e,this._plane.material.opacity=e},get:function(){return this._opacity}},{key:"color",set:function(e){this._color=e,this._plane.material.color=new i.Color(e)},get:function(){return this._color}},{key:"wireframe",set:function(e){this._wireframe=e,this._plane.material.wireframe=e},get:function(){return this._wireframe}},{key:"showNormal",set:function(e){this._normal.visible=e},get:function(){return this._normal.visible}},{key:"offset",set:function(e){var t=e-this._offset,r=this._planeInfo.normal.clone().multiplyScalar(t);this._plane.geometry.vertices.map(function(e){e.copy(e.clone().add(r))}),this._plane.geometry.verticesNeedUpdate=!0,this._offset=e},get:function(){return this._offset}},{key:"area",get:function(){for(var e=0,t=this._plane.geometry.faces,r=this._plane.geometry.vertices,n=0;n<t.length;++n){e+=o(r[t[n].a],r[t[n].b],r[t[n].c])}return Object.defineProperty(this,"area",{value:e,writable:!1,configurable:!0}),this.area;function o(e,t,r){return.5*r.clone().sub(t).cross(e.clone().sub(t)).length()}}},{key:"boundaryLength",get:function(){for(var e=0,t=0;t<this._points.length-1;++t)e+=this.earth.calculateDistanceBetweenTwoPoints(this._points[t],this._points[t+1]);return Object.defineProperty(this,"boundaryLength",{value:e,writable:!1,configurable:!0}),this.boundaryLength}}]),t}();t.a=p},function(e,t,r){"use strict";var n=r(0),o=(r.n(n),r(4)),i=r(7);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(e){function t(e){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.showXYZ=!1,r=l(this,c(t).call(this,e)),void 0===t.textureCache){var o=new Image;o.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAABfGlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGAqSSwoyGFhYGDIzSspCnJ3UoiIjFJgv8PAzcDDIMRgxSCemFxc4BgQ4MOAE3y7xsAIoi/rgsxK8/x506a1fP4WNq+ZclYlOrj1gQF3SmpxMgMDIweQnZxSnJwLZOcA2TrJBUUlQPYMIFu3vKQAxD4BZIsUAR0IZN8BsdMh7A8gdhKYzcQCVhMS5AxkSwDZAkkQtgaInQ5hW4DYyRmJKUC2B8guiBvAgNPDRcHcwFLXkYC7SQa5OaUwO0ChxZOaFxoMcgcQyzB4MLgwKDCYMxgwWDLoMjiWpFaUgBQ65xdUFmWmZ5QoOAJDNlXBOT+3oLQktUhHwTMvWU9HwcjA0ACkDhRnEKM/B4FNZxQ7jxDLX8jAYKnMwMDcgxBLmsbAsH0PA4PEKYSYyjwGBn5rBoZt5woSixLhDmf8xkKIX5xmbARh8zgxMLDe+///sxoDA/skBoa/E////73o//+/i4H2A+PsQA4AJHdp4IxrEg8AAAIGaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWURpbWVuc2lvbj4xNDQwPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjI1NjA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4K4sTvTgAADIZJREFUeAHlmtFy4zCuRGM7mf//4NhZHIiHblGyJ1Nbe18up2SAIAigmxQlO3P5+Pj4qev/bfv8DfLPz1+5/SbU/7nP9/f325yXGj3dAf8K+na7vU30vxi83+//FPaMjAMBfwP+Cugr+z9V+I/Orwh4ZTd8ErEj4BX4M3BnNhNcr1fVj8uFFP9d+/l5btLH4/Ey2BnwMxsBJOGvBKxA177VCPoMcNpSd+4qE3Dq+ml7RcYKeu0T50DA2eon2NQt5Ay0AJX6Zj91x5WCo5969tOufkZGAk/dXJAwd8BKQAJOnckAF8SZ1GYi+mlLXR+lgOijZ3+1OZZyJSKBp06slwQk4NQTOAES2DsdX5rAlZt1/5lgHEnb33Tm4JNEJPDUIeDtA/4V+Hdg340J6DcECEQJKOYhJcE+Pur6sViSAI4Ejr/tQECC1ilXnkR54fNqnLHVFxsN+9oEpl2w2s/6gCSWPsxFx5YkGHMlo8+AvP8lQJng0GkJKm2ppw+681oZMdSVKwjsCVodO8D1V1/Hne9OcBcoGT/sAIxnLUEITsBIbWeSeGm3v+YRkECQzMu+OjnRAYcuSGLmvDXH2t8R4Kor3wFbx7KPTqN47faxqbcSHxROE6S6K0xfPcGjkydJwNfmGLhYfSXjOwKcsMosOkEJDknLPn556YOfdvRsCRy7YPHPMcEDRB8kOSQBH+dljlV/S0AWuoLL/qqTBBuXurGKlmJgI6EH44Oi+WpW53wDZr6AkAkywaXdOUr83rUDAbn9mWjhqRMcO3LVteGvDujLdb8jzgpzlad87Lc28SSE+AJPHRux3QGMoTs3tz9jBwIw0s6Aa0NOcKFrU+pvP+MytrYJnJ1QDTACIgb62rAxRtPXvNiSCPprOyXAgAZCCkLdMRhFR+pzvdTOuD13h3MYR6cpsyCKpSEFw5zZZyfVfC980TnYkPoiacZAJwZ2bNkmAW79HERfkxkcycX4DvywS0z6WSTS2K3UxyvwFJxAPvb1N3hrggh0QVq7sc2FpD78JwE56ERtWTh6AlZPufo4X8Lo05ToFonkEriABEXfFWfe2hxznuOZSxtyRwAgbEzwwoZOUK7U6Sf47KfuHKUxzScBAJUApaCYi7425yLJSdPGHK60Ua9xdgS0V3w42QAMoZNEqX5GQtviPNC3447H4Uw3Hn/4CBwyqvzOZcHTvxQBI1PXp/MMAhg/awcCKCBbAk0A6F4JHt2Lccecq7Q4cwkCCXD8kI/rY2555iQRxKblXOsVsNI8xrV/IIABi0PatBHA63Z9nvyC5otV2+spoI25KxHGM36CaOAFHrDkwhfd3bDO6ZensQuMwxybuZArIQcC0hndAtIuAbzcCBJb60XK7XPsAggKIua83v5sbUtkFUsHRP2TAPwT+P1S93/9zP9z27Y8+WiAuv48b521VsbT1pPGx4GAHHSShSux86x3VZGs/OetVl/ww5Y+zO+5Q6LbXLnc/vrerxtwfVMyjxw/9db4uGy3jrGUmSfnor8lYHW2oCaiVpb+DmDZIILxJoTboYq7sitqTAIlIguzWFcfeSmSH4/tJcdamNOgP7YvQsRv0ogfu0D/v8mXBJAoryy63/QK5A589AUvGfh5SYKxLXAloLd+bXmeevja+B2PWE3CIqmLXYA/eTYSnziMkXISQFCbxSkFb/G+5jIHG4ceOrdAgm/b2AXo+hsvga0EzFwVH9C7xiOT84JtX08J4uYuYG7335DAHEieBJBgLUwCGFN39fVtUG79ISEBu2SoM6f9SxqP2LQkgMKMnyRtnts7flHdIG8/A3zFZA71ZewzHT8Iou0IMAEyExukixpfa9EFoxS4gCUg7foa05xJALG3W2Dbvvog8SMeklgAUXbMqq/rHLewcxOPNuSBgNWRYF4WbR/ZYDn9q5i8KPLr66uLbZ+xK3IuBRATMDTAuHXxM581JUn49S3wYk7mgUybsewfCHAgk6vn9jcB4HzW92Mwtv66A+g7D0kj9koA4MyJpAm+Jff+AH57bPdyxs3bYI3TweJjR4DJVol/B4rtb8J5AAIuzoAEr+4Oca5xVwLOtn8SAPjPn+0MeNy3Z78xs05xrnjsM74jICd0oHEfEZy+SZAC922QZ71AU3obYPstAeaxBupaCXjULiDe93V7LEIEL0w5F90YSjEqDwTgSEuJbrCZIF6DN2DbeYCeBKw648Ywz7oDzNWF1McKfst3r9tgO3fYERBh3Kw3cZjPuMgDAenE5HmNr6UmoQjGNkDPA3AFTN9dgC99Y5hrJWDmHIuxEsAtQqx7rTrSlyPskleVP2sfcYi7tiaAIGctC2GrG9zDkHnb9Xz1BSA2gQue/hyrpwbnBY0ck4AC9H2vv9mXbS0Wn773Kw5A0SWCfA1+vAN0neO8Oosl1q7TjtLETkzpykkGfc+CjYiNEMEqz0hgLo34k4BbHWj37c3PvPgIHtBcmYv8Z3U5P6X5kLbdLYAzzUmpkwS7yZAU4iHYbI5VFnjKP19/Pj6/9geh8ScBBW7Gr9WkMbYSwGq7+uaf86LOMxzm7OD1sSNAo04GyOdqJtqtxLgdEjT6XP0C71jPq5UzjwTc65sf8clLe/xsr6srAd7zmT/rOqvbmB04Pk4J0NlA2+8X41CpzkxWq6SexagDGH2SMHZI3zb1uwGNHBJw+d7f+9i5iOOKGxtpbs8k+hXhuYOLx4lh5Oqk8bEjIJ3xoa9E7wQchgO42y+LQnelkYCf12e9GtdOIA5+xpaAttejzR3HuCRAwHrwmXeeSRyCcVhn/Z2sPlaMOwJWJ50FT4F91Qlu8pQJvMEXYFf/C/3P15zHOI3YEsDWBig2muB5508CmHt6G1Rds8ZxKyUG43bw8TEJYGI2ndcA+GHLRJKATb3l+HmsiRkHYOsFwDjEEqi5qOPnqx57dQb0qU+cbx+529Y3T9ZhXcZREg89G/MgdRLg4OpI32Ld+lt/Y9tCkICzz4rTd/uj55Ngxqj4j77X45vgyROAeBRsntwBM1aBQvcW2ux74Cu+AwEQgVNe0zZeLjpJ6RSz6cvKQ4anfv5KFDZehMzhDuB93gJZfez9jv9Zj72vAh+7YM19zXt/1DnrDjzYsh0IsACcusA4VS1Y0MgsxD6rhZ3LZ/88C+pQdI7xJgH18xaHGK3B13sB83k7ZA5xWfl3+Y055ai/g9YH9mwHAhjUqWX5IzPpqjfQ2uLe3/w07vbvrf+nXoLydhivwsTlmgTwKlxfamjakJDH9v/+rP/YmHmKlLWW7Gf9xOw+SrRTAhjXGbleeRYA3hVtIuLXIYp13DOhfzitVaVQ4wqWHzhp3R8/enTMiOOPLsw39gTNY/CkXmJiP2uTACems7aUJKtoB+Yppovy5B9EuPXZyk3COAfwN64EsMo2bLwZ+uwXOLtL8BN41ZR1GTflGS5skwATK5lsy0DoHDibPD4SLc5Cuz9+NvevRuwM7MaVAPrq/NSVX3Scy7y89nUcd2tiUE/5lgALbFmHiVvfpA0u7kO3pDJX33tXG+A48IjVoHnZqRW39crXyY+NOfnYc7et+Wdd3Aonh7exUx4IIEi22cdc10wSKyFgt2ne+wJfJXOIxeWqX+5bbvpu/T78xl+DjGueJMJd0fWOWsHR/QC09ncE5CD6q8tkB7m8ikpMSkHceBKQo3ZB/7xdoG399lcE5bxdriVPjr2qecVmrh0BGtMZWwYlWfbRswB1gG5/FN0D2UDxyIwdcOXP208CEji6P7gaO+VZLWkTkziyj34ggMm2DIROYu6tLGArcDuY0NmerjIg0b24l/slqZ8Uxx3QOSrPegsQp2MTazxdrCHzZ31r7YlJHXkgACOTV2nAGpw7oBMOYuaJHduT4rxm4TXO9n+1AwDPEwD/79v2BrgDOeKbr0mLXZn1neFoYPFxSkCM78jYSNjfEhLju32vTJ3CrpAFMm7R/l+BHitf3/tv9T8/Ho/hN4DO+Ry6I27bahx5vJ715SImptRfEtCBOfarHZOM22Gsfu4E9H5m8+z3+T92AiS4E7gtjOt/bCCXf+9z57Q0Vt0KB2LH6luDMZVdPzdu1XrWDgTkxJ58yvIW0GLOZJMwzoBt5cftoK1IMZePQfJ5C/QBWsD7POEMCPBn+Yx1JgXumH3kgQAHcWYDtNRY0iCrpCi3+GGM7c9VgHbF88IyH4Pb11/j9G1yss0dR6557Ee5W/0nOPR5SYAOSAP/Vu5AVqGz30Q83+WN93Op/8X1s53+bPn77fk3vjl3xHHOb2XiONP/A3B8kO2nBFoEAAAAAElFTkSuQmCC",t.textureCache=new n.Texture,t.textureCache.image=o,o.onload=function(){t.textureCache.needsUpdate=!0}}return r._radius=void 0===e.radius?5:e.radius,r._height=void 0===e.height?50:e.height,r._material=new n.MeshBasicMaterial({alphaMap:t.textureCache,transparent:!0,depthWrite:!1,color:void 0===e.color?16777215:e.color,side:n.DoubleSide,opacity:void 0===e.opacity?1:e.opacity}),r._beam=r._createBeam(r._radius,r._height),r.contentHolder.add(r._beam),r.interactShape=new n.Mesh(r._beam.geometry,{side:n.DoubleSide}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o["a"]),function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(t,[{key:"destruct",value:function(){return this._disposeBeam(),u(c(t.prototype),"destruct",this).call(this)}},{key:"_disposeBeam",value:function(){this.contentHolder.traverse(function(e){"Mesh"===e.type&&(e.geometry.dispose(),e.material.map&&e.material.map.dispose(),e.material.dispose())}),this.contentHolder.remove.apply(this.contentHolder,this.contentHolder.children)}},{key:"_createBeam",value:function(e,t){for(var r=new n.BufferGeometry,o=[],a=[],s=0,l=[],u=0;u<3;++u){var c=u/3*Math.PI*2,f=Math.sin(c),h=e*Math.cos(c),p=e*f;o.push(h,p,0),o.push(-h,-p,0),o.push(-h,-p,t),o.push(h,p,t),a.push(0,0,1,0,1,1,0,1),l.push(s,s+1,s+2),l.push(s,s+2,s+3),s+=4}r.addAttribute("position",new n.BufferAttribute(new Float32Array(o),3)),r.addAttribute("uv",new n.BufferAttribute(new Float32Array(a),2)),r.setIndex(l);var d=new n.Mesh(r,this._material);return d.renderOrder=i.a.LIGHTBEAM_RENDER_ORDER,d}},{key:"radius",set:function(e){!isNaN(e)&&e>0&&e!==this._radius&&(this._disposeBeam(),this.contentHolder.add(this._createBeam(e,this._height)),this._radius=e)},get:function(){return this._radius}},{key:"height",set:function(e){!isNaN(e)&&e>0&&e!==this._height&&(this._disposeBeam(),this.contentHolder.add(this._createBeam(this._radius,e)),this._height=e)},get:function(){return this._height}},{key:"color",set:function(e){this._material.color.set(e)},get:function(){return this._material.color}},{key:"opacity",set:function(e){this._material.opacity=e},get:function(){return this._material.opacity}}]),t}();h.textureCache=void 0,t.a=h},function(e,t,r){"use strict";var n=r(21),o=r(0),i=(r.n(o),r(2)),a=r(19),s=r(9),l=r(8);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e,t,r,n){return(h="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=v(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function p(e,t,r,n,o){if(!h(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function d(e,t,r){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=v(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function v(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.volume;if(n.hasTopCover=!1,n.hasBottomCover=!1,n.bottom=void 0===n.bottom||null===n.bottom?.1:n.bottom,!function(e){if("number"!=typeof n.top||"number"!=typeof n.bottom)return console.warn("[ZoneMarker] the top and bottom must be a number"),!1;var r=!1;for(var o in t.TAG_ORIENTATION){var i=t.TAG_ORIENTATION[o];if(i===e.tagOrientation){r=!0;break}}r||(e.tagOrientation=t.TAG_ORIENTATION.HORIZONTAL);if(!(e.textOptions&&e.textOptions.text||e.imgUrl&&""!==e.imgUrl))return console.warn("ZoneMarker a valid textOption with non-empty text or a non-empty imgUrl must be provided",e),!1;return!0}(e))return f(r,void 0);(r=f(this,m(t).call(this,e)))._property.type="ZoneMarker",r._tagOrientation=e.tagOrientation,r._property.tagOrientation=r._tagOrientation,r._tagScale="number"==typeof e.tagScale?e.tagScale:1,r._property.tagScale=r._tagScale,r._color=e.volume.color?e.volume.color:16777215,r._property.color=r._color,r._opactiy="number"==typeof e.volume.opacity?e.volume.opacity:1,r._property.opacity=r._opactiy,r._imgUrl=e.imgUrl,r._property.imgUrl=r._imgUrl,r._textOptions=e.textOptions,r._property.textOptions=r._textOptions,r.extrudeMesh.material.depthWrite=!1,r.extrudeMesh.material.depthTest=!0,r.extrudeMesh.material.alphaMap=t.alphaMap,r.extrudeMesh.material.needsUpdate=!0;for(var i=r.otherCover.faces,a=r.otherCover.uvs,l=r.extrudeMesh.geometry.vertices,u=t.alphaMap.image.width/t.alphaMap.image.height,c=0,h=0;h<a.length;h+=2){var p=i[h].a,d=i[h].b,v=i[h].c,y=l[p].clone().sub(l[d]).length()/l[p].clone().sub(l[v]).length()*1/u;a[h]=[new o.Vector2(c,1),new o.Vector2(c+y,1),new o.Vector2(c,0)],a[h+1]=[new o.Vector2(c+y,1),new o.Vector2(c+y,0),new o.Vector2(c,0)],c+=y}r.extrudeMesh.geometry.faceVertexUvs[0]=[].concat(a),r.extrudeMesh.geometry.uvsNeedUpdate=!0;for(var g=r._points[0].array,b=0;b<r._points.length;++b)if(!r._points[b].hole){g=r._points[b].array;break}var _=r._lnglatalt2localxyz(r.position),w=r._lnglatalt2localxyz({lng:r.position.lng,lat:r.position.lat,alt:r.position.alt+1});r._unitAltVec3=w.clone().sub(_),r._tagAspectRatio=1,r._boundaryPtsvec3=g.map(function(e){var t={lng:e.lng,lat:e.lat,alt:r._bottom};return r._lnglatalt2localxyz(t)}),r._tagAlignIndex=0;var x=r._getAlignTagParams(r._boundaryPtsvec3[0],r._boundaryPtsvec3[1],r._tagOrientation,r._bottom),k=function(e,t,r){var n=new o.BufferGeometry;return n.addAttribute("position",new o.Float32BufferAttribute(new Float32Array(e),3)),n.addAttribute("uv",new o.Float32BufferAttribute(new Float32Array(t),2)),n.index=new o.Uint16BufferAttribute(new Uint16Array(r),1),n}(x.positionArray,[0,0,1,0,0,1,1,1],[0,1,2,2,1,3]),O=new o.MeshBasicMaterial({transparent:!0,map:null,depthWrite:!1,depthTest:!0,color:r._color,opacity:r._opactiy,side:o.DoubleSide}),P=new o.Mesh(k,O);P.position.copy(x.position),P.scale.set(r._tagScale,r._tagScale,r._tagScale),r.tag=P,r.contentHolder.add(r.tag),r._textOptions&&r._textOptions.text?r.textOptions=r._textOptions:r.imgUrl=r._imgUrl;for(var A=[],S=0;S<g.length-1;++S){var M=180*new o.Vector2(g[S+1].lng-g[S].lng,g[S+1].lat-g[S].lat).angle()/Math.PI;A.push(M)}return r._angles=A,r._tagAnimation=new s.a({tagOrientation:r._tagOrientation,opacityInscrease:!0},function(e){var n=e.tagOrientation;if(n===t.TAG_ORIENTATION.VERTICAL){if(r.tag.material.opacity+=.1,r.tag.material.opacity<r._opactiy)return!0}else if(n===t.TAG_ORIENTATION.HORIZONTAL){var o=e.opacityInscrease;if(r.tag.material.opacity+=o?.1:-.1,r.tag.material.opacity>=r._opactiy&&(e.opacityInscrease=!1),r.tag.material.opacity>0)return!0}var i=r._tagAlignIndex;return r._alignTag(r._boundaryPtsvec3[i],r._boundaryPtsvec3[i+1],r._tagOrientation,r._bottom),r.tag.material.opacity=r._opactiy,!1},100),r._uvAnimation=new s.a({offsetv:0,speed:.1},function(e){var t=e.speed;e.offsetv-=t;for(var n=r.extrudeMesh.geometry.faceVertexUvs[0],o=0;o<n.length;o+=1)for(var i=0;i<n[o].length;i+=1)n[o][i].x-=t,e.offsetv<=-1&&(n[o][i].x+=1);return e.offsetv<=-1&&(e.offsetv+=1),r.extrudeMesh.geometry.faceVertexUvs[0]=n,r.extrudeMesh.geometry.uvsNeedUpdate=!0,!0},100),r._uvAnimation.start(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,n["a"]),function(e,t,r){t&&c(e.prototype,t),r&&c(e,r)}(t,[{key:"_lnglatalt2localxyz",value:function(e){void 0===this.system&&(this.system=i.a.getLocalSystemOnEarthSurface(void 0,this.position.lng,this.position.lat,void 0));var t=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0).clone().sub(this.system.origin),r=t.dot(this.system.lng),n=t.dot(this.system.lat),a=t.dot(this.system.alt);return new o.Vector3(r,n,a)}},{key:"_getAlignTagParams",value:function(e,r,n,o){var i=this._unitAltVec3.clone(),a=e.clone(),s=r.clone(),l=a.clone().add(s).multiplyScalar(.5);a.sub(l),s.sub(l);var u,c,f,h,p=s.clone().sub(a),d=p.length();if(n===t.TAG_ORIENTATION.HORIZONTAL){var v=p.clone().cross(i.clone().normalize()).normalize().multiplyScalar(d/this._tagAspectRatio);u=a.clone().add(v),c=s.clone().add(v),f=a.clone(),h=s.clone()}else{var m=i.clone().normalize().multiplyScalar(d/this._tagAspectRatio);u=a.clone(),c=s.clone(),f=u.clone().add(m),h=c.clone().add(m)}return l.z=o,{positionArray:[u.x,u.y,u.z,c.x,c.y,c.z,f.x,f.y,f.z,h.x,h.y,h.z],position:l}}},{key:"_alignTag",value:function(e,t,r,n){var o=this._getAlignTagParams(e,t,r,n);this.tag.geometry.attributes.position.setArray(new Float32Array(o.positionArray)),this.tag.geometry.attributes.position.needsUpdate=!0,this.tag.position.copy(o.position)}},{key:"destruct",value:function(){return this._uvAnimation.stop(),this._tagAnimation.stop(),this.contentHolder.remove(this.tag),this.tag&&(this.tag.geometry&&this.tag.geometry.dispose(),this.tag.material&&(this.tag.material.map&&this.tag.material.map.dispose(),this.tag.material.dispose())),d(m(t.prototype),"destruct",this).call(this)}},{key:"onCameraChange",value:function(e){for(var r=e.north,n=[],o=0;o<this._angles.length;++o){var i=this._angles[o],a=Math.abs(i-r);a=a<360-a?a:360-a,n.push({angle:i,index:o,diff:a})}n.sort(function(e,t){return e.diff-t.diff});var s=n[0].index;s!==this._tagAlignIndex&&(this._tagAnimation.stop(),this._tagAlignIndex=s,this._alignTag(this._boundaryPtsvec3[s],this._boundaryPtsvec3[s+1],t.TAG_ORIENTATION.VERTICAL,this._bottom),this.tag.material.opacity=0,this._tagAnimation.changeStates({tagOrientation:this._tagOrientation,opacityInscrease:!0}),this._tagAnimation.start())}},{key:"hasTopCover",set:function(e){console.warn("ZoneMarker cannot set hasTopCover: must be false",e)},get:function(){return!1}},{key:"hasBottomCover",set:function(e){console.warn("ZoneMarker cannot set hasBottomCover: must be false",e)},get:function(){return!1}},{key:"top",set:function(e){"number"==typeof e?p(m(t.prototype),"top",e,this,!0):console.warn("ZoneMarker top must be a number")},get:function(){return this._top}},{key:"bottom",set:function(e){if("number"==typeof e){p(m(t.prototype),"bottom",e,this,!0);var r=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[r],this._boundaryPtsvec3[r+1],this._tagOrientation,this._bottom)}else console.warn("ZoneMarker top must be a number")},get:function(){return this._bottom}},{key:"tagOrientation",set:function(e){var r=!1;for(var n in t.TAG_ORIENTATION){if(e===t.TAG_ORIENTATION[n]){r=!0;break}}if(r){this._tagOrientation=e;var o=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[o],this._boundaryPtsvec3[o+1],this._tagOrientation,this._bottom)}else console.warn("ZoneMarker set tagOrientation not valid",e)},get:function(){return this._tagOrientation}},{key:"tagScale",set:function(e){this._tagScale=e,this._property.tagScale=e,this.tag.scale.set(this._tagScale,this._tagScale,this._tagScale)},get:function(){return this._tagScale}},{key:"color",set:function(e){p(m(t.prototype),"color",e,this,!0),this.tag.material.color.set(e)},get:function(){return this._color}},{key:"opacity",set:function(e){p(m(t.prototype),"opacity",e,this,!0),this.tag.material.opacity=e},get:function(){return this._opactiy}},{key:"tagTexture",set:function(e){this.tag.material.map&&(this.tag.material.map.dispose(),this.tag.material.map=null),this.tag.material.map=e.texture,this.tag.material.needsUpdate=!0,this._tagAspectRatio=e.aspectRatio;var t=this._tagAlignIndex;this._alignTag(this._boundaryPtsvec3[t],this._boundaryPtsvec3[t+1],this._tagOrientation,this._bottom)}},{key:"imgUrl",set:function(e){var t=this;this._textureLoader||(this._textureLoader=new l.a),this._textureLoader.load(e,function(r){var n=r.image?r.image.width/r.image.height:1;n="number"==typeof n?n:1,t.tagTexture={texture:r,aspectRatio:n},t._imgUrl=e,t._property.imgUrl=t._imgUrl})},get:function(){return this._imgUrl}},{key:"textOptions",set:function(e){var t=64*e.text.length+64,r=Math.log(t)/Math.log(2);r=Math.floor(r)+1,t=Math.pow(2,r);var n=new a.a(t,128);n=n.drawTextCooked(e),this.tagTexture={texture:n.texture,aspectRatio:t/128},this._textOptions=e,this._property.textOptions=this._textOptions},get:function(){return this._textOptions}}]),t}();g.TAG_ORIENTATION={VERTICAL:0,HORIZONTAL:1};for(var b=[],_=0;_<128;++_){for(var w=Math.abs(_-64),x=64-w,k=0;k<64+4*x;++k)b.push(0);for(var O=0;O<128;++O)b.push(255);for(var P=0;P<64+4*w;++P)b.push(0)}var A=new o.DataTexture(new Uint8Array(b),128,128,o.RGBAFormat,o.UnsignedByteType,o.UVMapping);A.minFilter=A.magFilter=o.LinearFilter,A.wrapS=A.wrapT=o.RepeatWrapping,A.needsUpdate=!0,g.alphaMap=A,t.a=g},function(e,t,r){"use strict";var n=r(23);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,r,n){return(s="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=c(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function l(e,t,r,n,o){if(!s(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function u(e,t,r){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=c(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?a(e):t}(this,f(t).call(this,e)))._projectMarker=e.projectMarker,r.videoType=e.videoType,r.videoSrcUrl=e.videoSrcUrl,r.videoDom=e.videoDom,r._manager=r._projectMarker.showVideo(a(r)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&i(e.prototype,t),r&&i(e,r)}(t,[{key:"destruct",value:function(){return this._manager.remove(),this._manager=null,this._projectMarker=null,u(f(t.prototype),"destruct",this).call(this)}},{key:"setPose",value:function(e,r,n){u(f(t.prototype),"setPose",this).call(this,e,r,n),this._fullUpdate()}},{key:"_fullUpdate",value:function(){this._manager&&this._manager.update({cameraMarker:this})}},{key:"updateDepthTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._manager.update(e)}},{key:"fov",set:function(e){l(f(t.prototype),"fov",e,this,!0),this._fullUpdate()},get:function(){return u(f(t.prototype),"fov",this)}},{key:"aspect",set:function(e){l(f(t.prototype),"aspect",e,this,!0),this._fullUpdate()},get:function(){return u(f(t.prototype),"aspect",this)}},{key:"near",set:function(e){l(f(t.prototype),"near",e,this,!0),this._fullUpdate()},get:function(){return u(f(t.prototype),"near",this)}},{key:"far",set:function(e){l(f(t.prototype),"far",e,this,!0),this._fullUpdate()},get:function(){return u(f(t.prototype),"far",this)}},{key:"visible",set:function(e){l(f(t.prototype),"visible",e,this,!0),this._manager&&this._manager.update({visible:e,updateDepth:!1})},get:function(){return u(f(t.prototype),"visible",this)}}]),t}();t.a=p},function(e,t,r){"use strict";var n=r(23),o=r(0);r.n(o);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t,r,n){return(l="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,i=f(e,t);if(i){if((o=Object.getOwnPropertyDescriptor(i,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function u(e,t,r,n,o){if(!l(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=f(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?s(e):t}(this,h(t).call(this,e)))._projectMarker=e.projectMarker,r._imgUrl=e.imgUrl;var n=s(r);return(new o.TextureLoader).load(r._imgUrl,function(e){e.minFilter=e.magFilter=o.LinearFilter,n._texture=e,n._manager=r._projectMarker._showImage(s(r))}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n["a"]),function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(t,[{key:"destruct",value:function(){return this._manager&&(this._manager.remove(),this._manager=null),this._texture&&(this._texture.dispose(),this._texture=null),this._projectMarker=null,c(h(t.prototype),"destruct",this).call(this)}},{key:"setPose",value:function(e,r,n){c(h(t.prototype),"setPose",this).call(this,e,r,n),this._fullUpdate()}},{key:"_fullUpdate",value:function(){this._manager&&this._manager.update({cameraMarker:this})}},{key:"updateDepthTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._manager&&this._manager.update(e)}},{key:"fov",set:function(e){u(h(t.prototype),"fov",e,this,!0),this._fullUpdate()},get:function(){return c(h(t.prototype),"fov",this)}},{key:"aspect",set:function(e){u(h(t.prototype),"aspect",e,this,!0),this._fullUpdate()},get:function(){return c(h(t.prototype),"aspect",this)}},{key:"near",set:function(e){u(h(t.prototype),"near",e,this,!0),this._fullUpdate()},get:function(){return c(h(t.prototype),"near",this)}},{key:"far",set:function(e){u(h(t.prototype),"far",e,this,!0),this._fullUpdate()},get:function(){return c(h(t.prototype),"far",this)}},{key:"visible",set:function(e){u(h(t.prototype),"visible",e,this,!0),this._manager&&this._manager.update({visible:e,updateDepth:!1})},get:function(){return c(h(t.prototype),"visible",this)}}]),t}();t.a=d},function(e,t,r){"use strict";var n=r(4),o=r(1),i=(r.n(o),r(0)),a=(r.n(i),r(2));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e,t,r){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e){var r,n=e.earth,o=e.sandbox,s=e.name,l=e.visible,u=e.eventHandlers,f=e.position,p=e.orientation,d=e.scale,v=e.pose,m=e.spec,y=e.showBBox,g=void 0!==y&&y;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===f||null===f){var b=m.rootNode,_=a.a.getTileGeographicEnvelopByGrid(b.level,b.x,b.y);f={lng:(_.minLng+_.maxLng)/2,lat:(_.minLat+_.maxLat)/2,alt:10}}return(r=c(this,h(t).call(this,{earth:n,sandbox:o,name:s,visible:l,interactable:!1,eventHandlers:u,position:f,orientation:p,scale:d,pose:v,showXYZ:!0}))).spec=m,r.showBBox=g,r.treeNode=new i.Object3D,r.treeNode.name="treeNode",r.contentHolder.add(r.treeNode),r.import(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,n["a"]),function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(t,[{key:"destruct",value:function(){return this.deport(),f(h(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){return this._createTree(this.spec)}},{key:"deport",value:function(){var e,t=!0;this._tree&&((e=this.treeNode).remove.apply(e,l(this.treeNode.children)),this.forest.remove(this._tree),t=t&&this._tree.destruct(),this._tree=null);return t||console.warn("DemMarker deport error."),t}},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid spec."));var t=this.treeNode,r=e.name,n=e.maxLevel,i=e.minLevel,a=this,s={onTileDownloaded:function(){a.earth.earthView.updateScene()}},l=this.showBBox;return this._tree=new o.DEMTree(o.DEMTile,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:i,debug:!1,eventHandlers:s,spec:e,showBBox:l,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this.forest.add(this._tree),this._tree.initialized}},{key:"forest",get:function(){return this.earth.markerLayer.forest}},{key:"interactable",set:function(e){console.warn("Dem does not support interaction.")}}]),t}();t.a=d},function(e,t,r){"use strict";t.a=function(e,t){for(var r=[],n=function(e){var t=[];if("Feature"===e.type){var r;r=Object.keys(e.properties.tags).indexOf("height")>-1?parseFloat(e.properties.tags.height):20,t.push({geometry:e.geometry,height:r})}else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++){var o=void 0;o=Object.keys(e.features[n].properties.tags).indexOf("height")>-1?parseFloat(e.features[n].properties.tags.height):20,t.push({geometry:e.features[n].geometry,height:o})}else{if("GeometryCollection"!==e.type)throw new Error("The geoJSON is not valid.");for(var i=0;i<e.geometries.length;i++)t.push({geometry:e.geometries[i],height:20})}return t}(e),o=0;o<n.length;o++)if("Polygon"===n[o].geometry.type)for(var i=0;i<n[o].geometry.coordinates.length;i++){for(var a=n[o].geometry.coordinates[i],s=n[o].height,l=[],u=0;u<a.length;u++)l.push(new altizure.LngLatAlt(a[u][0],a[u][1],10));var c={points:l,height:s,color:15827200,opacity:.2};r.push(c)}else if("MultiPolygon"===n[o].geometry.type)for(var f=0;f<n[o].geometry.coordinates.length;f++)for(var h=0;h<n[o].geometry.coordinates[f].length;h++){for(var p=n[o].geometry.coordinates[f][h],d=n[o].height,v=[],m=0;m<p.length;m++)v.push(new altizure.LngLatAlt(p[m][0],p[m][1],10));var y={points:v,height:d,color:15827200,opacity:.2};r.push(y)}return r}},function(e,t,r){"use strict";var n=r(24),o=r(1),i=(r.n(o),r(2)),a=r(12),s=r(31),l=r(32),u=r(6),c=r(20),f=r(18),h=r(35),p=r(36),d=r(94),v=r(0),m=(r.n(v),r(9)),y=r(97),g=r(5);function b(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function x(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function O(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?P(e):t}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t,r){return(A="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=o.SessionEnv.countryName,E=function(e){function t(e,r){var n,i=r.HOST,s=r.altizureApi,l=r.api,u=void 0===l?{}:l,c=r.camera,f=r.renderItems,h=r.eventHandlers;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!function(e,t){if(!document.getElementById(e))return console.error("div ".concat(e," is missing.")),!1;if(!t||!t.altizureApi||!t.altizureApi.key)return console.error("Altizure sdk key is not found."),!1;t.altizureApi.region||(t.altizureApi.region="CN");t.altizureApi.apiUrl||("CN"===t.altizureApi.region?t.altizureApi.apiUrl="https://api.altizure.cn/graphql":t.altizureApi.apiUrl="https://api.altizure.com/graphql");return!0}(e,{HOST:i,altizureApi:s,camera:c,renderItems:f,eventHandlers:h}))return O(n,void 0);var p=P(n=O(this,S(t).call(this,e,{HOST:i,api:u,camera:c,renderItems:f,eventHandlers:h})));return n.HOST=i,n._apiService=new o.AltizureApi({apiUrl:s.apiUrl,key:s.key,altitoken:s.altitoken}),n._mouseInteraction=null,n._updateGPUPicker=null,n._updateZoneMarkers=null,n._bonCameraChange=n._onCameraChange.bind(P(n)),n.GL={_maxAnisotropy:n.renderer.capabilities.getMaxAnisotropy()},function(){(function(){try{window.GA_INITIALIZED||(!function(e,t,r,n,o,i,a){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(r),a=t.getElementsByTagName(r)[0],i.async=1,i.src="https://www.google-analytics.com/analytics.js",a.parentNode.insertBefore(i,a)}(window,document,"script",0,"ga"),window.GA_INITIALIZED=!0),window.ga("create","UA-140333643-2",{name:"sdk"}),window.ga("sdk.send","pageview");var e=p._apiService.key,t=window.location.hostname;e&&t&&Object(y.a)({key:e,hostname:t}),p.renderItems.planet.showDem&&Object(y.b)()}catch(e){console.warn(e)}})(),function(){p._mouseInteraction=new d.a({camera:p.viewerCamera,domElement:p.domElement,scene:p.markerLayer.sceneNode,renderer:p.renderer,snapshoter:p.snapshoter});var e={promiseFn:function(e){var t=e.force;return p.interaction.gpuPicker.update(t),Promise.resolve()},timer:500,timeout:2e3,debug:!1};p._updateGPUPicker=new o.RefreshQueue(e),p._updateZoneMarkers=new m.b(function(){for(var e=p.camera.center,t=0;t<p.markerLayer.children.length;++t){var r=p.markerLayer.children[t];"ZoneMarker"===r._property.type&&r.onCameraChange(e)}},500),p.on("cameraChange",p._bonCameraChange)}(),a.a.MAXANISOTROPY=p.GL._maxAnisotropy}(),n.background=n.earthView.background,n._markerControl=null,window._devDisplayTexture=function(e,t,r){n._devDisplayTexture(e,t,r)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,n["a"]),function(e,t,r){t&&k(e.prototype,t),r&&k(e,r)}(t,[{key:"destruct",value:function(){var e=!0;return this.background=void 0,this._markerControl&&this._markerControl.dispose(),e=this.apiService.destruct()&&e,this.off("cameraChange",this._bonCameraChange),this._updateGPUPicker.processingTask=null,this._updateGPUPicker.deferredTask=null,this._updateZoneMarkers(!1),e=this._mouseInteraction.destruct()&&e,e=A(S(t.prototype),"destruct",this).call(this)&&e}},{key:"add",value:function(e,t){var r=this,n={pose:{position:t.pose&&t.pose.position?t.pose.position:t.position,orientation:t.pose&&t.pose.orientation?t.pose.orientation:t.orientation,scale:t.pose&&t.pose.scale?t.pose.scale:t.scale}};if("AltizureProjectMarker"===e)return function(e){var t=e.pid,n=x(e,["pid"]);return Object(o.altizureSpecLoader)(r.apiService,t).then(function(e){return d(e,n)}).catch(function(e){return console.error("catch",e),Promise.resolve()})}(t);if("AltizureProjectMarkerV2"===e)return function(e){return r.apiService.project({pid:e.pid}).then(function(t){return v(t,e)}).catch(function(e){return console.warn("[Sandbox.add] AltizureProjectMarker failed",e),Promise.reject(e)})}(t);if("AltizureProjectInfo"===e)return console.warn("deprecated."),v(t.info,t.data);if("AltizureProjectSpec"===e)return d(t);if("TagMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),o=new l.a(t);return Promise.resolve(o)}(t);if("PolygonMarker"===e)return function(e){for(var t=e.volume,o=0;o<t.points.length;++o)t.points[o]=new u.a(t.points[o].lng,t.points[o].lat,t.points[o].alt);var i=Object.assign(e,n,{volume:t,earth:r}),a=new c.a(i);return Promise.resolve(a)}(t);if("OBJMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),o=new s.a(t);return Promise.resolve(o)}(t);if("TextTagMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),o=new f.a(t);return Promise.resolve(o)}(t);if("PolyFenceLineMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),o=new p.a(t);return Promise.resolve(o)}(t);if("PolyCylinderLineMarker"===e)return function(e){var t=Object.assign(e,n,{earth:r}),o=new h.a(t);return Promise.resolve(o)}(t);var i="[Sandbox.add] unknown type "+e;return console.warn(i),Promise.reject(new Error(i));function d(e,t){var n=Object.assign({sandbox:r,spec:e,countryName:T},t),o=new a.a(n);return r.earthView.updateScene(),Promise.resolve(o)}function v(e,t){return e?(e.views=1e3,e.geoInfo||(e.geoInfo={}),null!==e.geoInfo.centerLat&&void 0!==e.geoInfo.centerLat||(e.geoInfo.centerLat=1.40625),null!==e.geoInfo.centerLong&&void 0!==e.geoInfo.centerLong||(e.geoInfo.centerLong=1.40625),n.pose.position||(n.pose.position={lng:e.geoInfo.centerLong,lat:e.geoInfo.centerLat,alt:.01}),r.earthView.countryName.then(function(o){var i=Object.assign(t,n,{sandbox:r,projInfo:e,countryName:o}),s=new a.a(i);return r.earthView.updateScene(!0),Promise.resolve(s)})):Promise.reject(new Error("Invalid info."))}}},{key:"positionsAltitude",value:function(e,t){if(e instanceof Array&&(void 0===t||t instanceof Array)){void 0===t&&(t=[],this.markerLayer.children.map(function(e){e instanceof a.a&&t.push(e)}));var r=[],n=[],o=[],i=[];t.map(function(e){var t=e.geoCoverage,a=[{lng:t.minLong,lat:t.minLat},{lng:t.maxLong,lat:t.maxLat}],s=w(e.pickDepthMap(a,!0),3),l=s[1],u=s[2];r.push(u),n.push(l),o.push(e.projInfo.max_bound.z-e.projInfo.min_bound.z),i.push(e.position.alt)});var s=[];return e.map(function(e){var t=0;n.map(function(n,a){if(e.lng>n[1].lng&&e.lng<n[0].lng&&e.lat>n[1].lat&&e.lat<n[0].lat){var s,l,u,c;s=n,l=r[a],u=o[a],c=i[a];var f=function(e,t,r,n,o){if(void 0===t)return 0;var i=t[0].lat-t[1].lat,a=t[0].lng-t[1].lng,s=r.dimension.width,l=r.dimension.height,u=r.buffer,c=0+o,f=n+o,h=(e.lat-t[1].lat)/i,p=(e.lng-t[1].lng)/a,d=1===p?parseInt(s*p)-1:parseInt(s*p),v=1===h?parseInt(l*h)-1:parseInt(l*h);if(p>=0&&p<=1&&h>=0&&h<=1){var m=v*s+d,y=(1-u[m]/255)*(f-c)+c;return y}return 0}(e,s,l,u,c);f>t&&(t=f)}}),s.push(t)}),s}console.error("Bad arguments",e,t)}},{key:"polygonsFromGeoJson",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.warn("Please check altizure-plugin-geojson: https://unpkg.com/altizure-plugin-geojson")}},{key:"queryGeoJsonForAltizureProjectMarker",value:function(e){console.warn("Please check altizure-plugin-geojson: https://unpkg.com/altizure-plugin-geojson")}},{key:"getMatchingPose",value:function(e){var t=e.videoSize,r=e.focalLength,n=e.pairs;if(!function(e){var t=e.videoSize,r=e.focalLength,n=e.pairs,o=!0;return o=(o=(o=o&&t&&t.width>0&&t.height>0)&&"number"==typeof r&&r>0)&&n.length>=5}({videoSize:t,focalLength:r,pairs:n}))return Promise.reject(new Error("invalid input"));for(var o=1,a=[],s=new v.Vector3(0,0,0),l=0;l<5;++l){var u=n[l].objectCoord,c=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,u.lng,u.lat,u.alt,void 0);a.push(c),s.add(c)}s.multiplyScalar(.2);for(var f=i.a.getLngLatAltFromNoneGroundCartesian(void 0,s,void 0),h=i.a.getLocalSystemOnEarthSurface(void 0,f.lng,f.lat,void 0),p=[],d=0;d<5;++d){var m=g(h,a[d]);p.push({imageCoord:n[d].imageCoord,objectCoord:[m.x,m.y,m.z]})}return this._apiService.getMatchingPose({intrinsic:{u:t.width/2,v:t.height/2,f:r},pairs:p}).then(function(e){var t=e.data.data.utility.poseEstimation.pose,r=function(e,t){var r=new v.Vector3(t[3],t[7],t[11]),n=(new v.Matrix3).set(t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]),o=r.clone().applyMatrix3(n.clone().transpose()).multiplyScalar(-1),a=new v.Vector3(0,0,1).applyMatrix3(n.clone().transpose()).add(o),s=new v.Vector3(0,-1,0).applyMatrix3(n.clone().transpose()).add(o),l=i.a.getLngLatAltFromNoneGroundCartesian(void 0,y(e,o),void 0),u=i.a.getLngLatAltFromNoneGroundCartesian(void 0,y(e,a),void 0),c=i.a.getLngLatAltFromNoneGroundCartesian(void 0,y(e,s),void 0),f=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,l.lng,l.lat,l.alt,void 0),h=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,u.lng,u.lat,u.alt,void 0),p=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,c.lng,c.lat,c.alt,void 0).sub(f);return(new v.Matrix4).setPosition(f).lookAt(f,h,p).elements}(h,t);return Promise.resolve(r)});function y(e,t){return e.origin.clone().add(e.lng.clone().multiplyScalar(1/o*t.x)).add(e.lat.clone().multiplyScalar(1/o*t.y)).add(e.alt.clone().multiplyScalar(1/o*t.z))}function g(e,t){var r=t.clone().sub(e.origin);return new v.Vector3(r.dot(e.lng)*o,r.dot(e.lat)*o,r.dot(e.alt)*o)}}},{key:"animate",value:function(){}},{key:"updateVisibility",value:function(){this.earthView._updateVisibility()}},{key:"on",value:function(e,t){switch(e){case"cameraChange":this.earthView.control.addEventListener("onCameraChange",t);break;default:console.log("unknown eventType "+e)}}},{key:"off",value:function(e,t){switch(e){case"cameraChange":this.earthView&&this.earthView.control&&this.earthView.control.removeEventListener("onCameraChange",t);break;default:console.log("unknown eventType "+e)}}},{key:"login",value:function(e){var t=e.key,r=e.altitoken;if(!function(){if(!r)return!1}())return console.error("Invalid login info",t,r),!1;t&&(this._apiService.key=t),r&&(this._apiService.altitoken=r)}},{key:"_changeAltizureDisplayMode",value:function(e,t){return console.log("deprecated"),!0}},{key:"render",value:function(e,t){switch(e.modelType){case"PTLOD":console.warn("PTLOD do not support this function");break;default:var r=t.toUpperCase(),n={BASIC:1,TEXTURE:1,PHONG:2,PBR:3,WIREFRAME:40,FLAT:41}[r],o={SELECT:3,CROP:4,VISIBILITY:5,VIDEO:7}[r];if(void 0!==n)return e.displayMode=n,!0;void 0!==o||console.warn("Unknown render mode",t)}}},{key:"_onCameraChange",value:function(){this._updateGPUPicker.add({force:!0}),this._updateZoneMarkers()}},{key:"_refreshOffset",value:function(){this.control.updateOffset()}},{key:"_devDisplayTexture",value:function(e,t,r){this.earthView._displayTexture(e,t,r)}},{key:"_devHideTexture",value:function(){this.earthView._hideTexture()}},{key:"apiService",get:function(){return this._apiService}},{key:"camera",get:function(){var e=this,t=e.earthView.control,r={set center(e){t.pose=e},get center(){return t.pose},flyToCenter:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2500;return t.flyToPose(e,r)},get pose(){return console.error("sandbox.camera.pose deprecated, plz use camera.center"),t.pose},set pose(e){console.error("sandbox.camera.pose deprecated, plz use camera.center"),t.pose=e},set range(e){var r=e.tilt,n=e.alt;return void 0!==r&&t.tiltRange(r),void 0!==n&&t.altRange(n),!0},flyTo:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2500;return console.error("sandbox.camera.flyTo deprecated"),t.flyToPose(e,r)},stop:function(){return t.stopFlying()},lookAt:function(r,n,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,l={};"object"===_(n)?(l=n,s="number"==typeof o?o:s):(l.north=n,l.tilt=o,l.alt=a);var u=function(t,r){var n=r.north,o=r.tilt,a=r.alt,s=new v.Vector3(-Math.cos((n-90)*Math.PI/180)*Math.tan(o*Math.PI/180),-Math.sin((n-90)*Math.PI/180)*Math.tan(o*Math.PI/180),-1).normalize(),l=function(e){var t=e.position;"number"==typeof e.pinLength&&(t.alt+=e.pinLength);return t}(t),u=i.a.getLocalSystemOnEarthSurface(void 0,l.lng,l.lat,void 0),c=-l.alt/s.z*s.x,f=-l.alt/s.z*s.y,h=u.origin.clone(),p=u.lng.clone().multiplyScalar(1*c),d=u.lat.clone().multiplyScalar(1*f);h=h.add(p).add(d);var m,y,g,_=i.a.getLngLatAltFromNoneGroundCartesian(void 0,h,void 0),w=_.lng,x=_.lat;if(void 0===a||null===a){m=new v.Vector3(-Math.cos((n-90)*Math.PI/180)*Math.cos(o*Math.PI/180),-Math.sin((n-90)*Math.PI/180)*Math.cos(o*Math.PI/180),Math.sin(o*Math.PI/180)).normalize(),y=e.earthView.camera.fov,g=e.earthView.camera.aspect;var k=t._interactBox();if(0!==k.length){var O=function(e,t,r,n,o){var i=e.map(function(e){return function(e,t,r,n,o){var i=e.clone().dot(t),a=t.clone().multiplyScalar(i),s=e.clone().sub(a),l=r.clone().multiplyScalar(s.clone().dot(r)),u=s.clone().sub(l),c=l.length()/Math.tan(n/2*Math.PI/180),f=u.length()/(Math.tan(n/2*Math.PI/180)*o);return Math.max(c,f)+(i>0?-a.length():a.length())}(e,t,r,n,o)});return Math.max.apply(Math,b(i))}(k,s,m,y,g),P=l.alt/Math.cos(o*Math.PI/180)+O;a=P}else console.warn("[Sandbox] camera.lookAt alt improvement not supported for ",t)}return{lng:w,lat:x,alt:a,north:n,tilt:o}}(r,l);return t.flyToPose(u,s)},matToPose:function(e){console.error("sandbox.camera.matToPose deprecated")},get mat(){return t.camToEarth.elements},flyToMat:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;if(isNaN(r)||r<=0||r>9999999)return Promise.reject(new Error(r+"is not a valid number."));var n=(new v.Matrix4).fromArray(e);return t.flyToMat(n,r)},flyToCamToEarth:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;if(isNaN(r)||r<=0||r>9999999)return Promise.reject(new Error(r+"is not a valid number."));var n=(new v.Matrix4).fromArray(e);return t.flyToMat(n,r)},movePath:function(e){var r,n=e.curves,o=e.speed,a=void 0===o?10:o,s=(e.total,n.map(function(e){return i.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0)})),l=new v.CatmullRomCurve3(s),u=l.getLength(),c=1*u/a*1e3,f=t._pose.tilt,h=Math.tan(f/180*Math.PI);return t.flyAlong(function(e){var t=l.getUtoTmapping(0,e*u),n=l.getPoint(t),o=l.getTangent(t);if(void 0===r){var a=i.a.getLngLatAltFromNoneGroundCartesian(void 0,n,void 0),s=a.lng,c=a.lat,f=i.a.getLocalSystemOnEarthSurface(void 0,s,c,void 0);r=f.alt.normalize()}if(h<1e-6)o=r.clone().multiplyScalar(-1);else{var p=o.clone(),d=p.add(r.clone().multiplyScalar(r.dot(p))),m=d.length()/h;o=d.clone().add(r.clone().multiplyScalar(-m)).add(n)}return(new v.Matrix4).lookAt(n,o,r).setPosition(n)},c)}};return Object.defineProperty(this,"camera",{value:r,writable:!1,configurable:!0}),this.camera}},{key:"lights",get:function(){return{ambient:this.earthView.lights.ambient,point:this.earthView.lights.point}}},{key:"JSON",get:function(){return this.markerLayer.JSON}},{key:"interaction",get:function(){return this._mouseInteraction}},{key:"control",get:function(){return this.earthView.control}},{key:"Math",get:function(){return i.a}},{key:"Constants",get:function(){return g.a}},{key:"width",get:function(){return this.earthView.width}},{key:"height",get:function(){return this.earthView.height}},{key:"window",get:function(){var e=this,t={toLngLatAlt:function(t){var r=t.x,n=t.y,o=e.pickOnProjects({x:r,y:n});return o||(o=e.pick({x:r,y:n})),o},fromLngLatAlt:function(t){var r=t.lng,n=t.lat,o=t.alt,a=i.a.getNoneGroundCartesianFromLngLatAlt(void 0,r,n,o,void 0);if(a){var s=a.applyMatrix4(e.markerLayer.matrixWorld).project(e.viewerCamera),l=e.earthView.control.mapToWindow(s.x,s.y);return{x:l.x,y:l.y}}},screenshot:function(t){var r=e.renderer.getSize(),n=Object.assign({},r);t&&"number"==typeof t.width&&(n.width=t.width),t&&"number"==typeof t.height&&(n.height=t.height);var o=e.renderer.getContext();if(o){var i=new v.WebGLRenderTarget(n.width,n.height,{minFilter:v.NearestFilter,magFilter:v.NearestFilter,format:v.RGBAFormat}),a=new Uint8Array(n.width*n.height*4);e.renderer.setSize(n.width,n.height),e.earthView.camera.aspect=n.width/n.height,e.earthView.camera.updateProjectionMatrix(),e.renderer.render(e.earthView.scene,e.earthView.camera,i,!0),o.readPixels(0,0,n.width,n.height,o.RGBA,o.UNSIGNED_BYTE,a),e.renderer.setSize(r.width,r.height),e.earthView.camera.aspect=r.width/r.height,e.earthView.camera.updateProjectionMatrix();for(var s=0;s<n.width;++s)for(var l=0;l<n.height/2;++l)for(var u=4*(n.width*l+s),c=4*(n.width*(n.height-1-l)+s),f=0;f<4;++f){var h=a[u+f];a[u+f]=a[c+f],a[c+f]=h}return{data:a,width:n.width,height:n.height}}console.warn("[Sandbox] window screenshot no context")}};return Object.defineProperty(this,"window",{value:t,writable:!1,configurable:!0}),this.window}},{key:"visibilityCamera",set:function(e){e?(this.__currentCameraMarker!==e&&(this.__currentCameraMarker&&this.__currentCameraMarker.unbindSpotLight(),this.__currentCameraMarker=e),e.bindSpotLight(this.spotLight)):(this.__currentCameraMarker.unbindSpotLight(),this.__currentCameraMarker=void 0)},get:function(){return this.__currentCameraMarker}},{key:"spotLight",get:function(){return this.earthView.spotLights[0]}},{key:"quality",set:function(e){console.warn("Not allowed to change the sandbox quality after initialization.")},get:function(){return a.a.quality}}]),t}();t.a=E},function(e,t,r){"use strict";var n=r(95),o=r(96),i=r(1);r.n(i);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(){var e=!0;try{t=Object.assign({},{capacity:100},t)}catch(t){console.error("MouseInteraction",t),e=!1}return e=e&&t.camera&&t.domElement&&t.scene&&t.renderer}()){this.capacity=t.capacity,this.camera=t.camera,this.listening=function(){for(var t={},r=e.MouseEventList,n=0;n<r.length;n++)t[r[n]]={};return t}(),this.domElement=t.domElement;var r=this;this.mouseOffset=a(),this.domElement.addEventListener("mousedown",s),this.domElement.addEventListener("mouseup",l),this.domElement.addEventListener("mousemove",u),this.domElement.addEventListener("touchstart",c),this.domElement.addEventListener("touchend",f);var n=i.EventUtil.debounce(function(e){r.mouseOffset=a()},100);window.addEventListener("scroll",n),window.addEventListener("resize",n),this.removeListeners=function(){return r.domElement.removeEventListener("mousedown",s),r.domElement.removeEventListener("mouseup",l),r.domElement.removeEventListener("mousemove",u),r.domElement.removeEventListener("touchstart",c),r.domElement.removeEventListener("touchend",f),window.removeEventListener("scroll",n),window.removeEventListener("resize",n),!0},this.gpuPicker=new o.a({renderer:t.renderer,debug:!1,camera:t.camera,snapshoter:t.snapshoter}),this.hoveredMarkerID=void 0}else console.error("MouseInteraction invalid options.",t);function a(){var e=r.domElement.getBoundingClientRect();return{left:e.left,top:e.top}}function s(e){h(e,"mousedown")}function l(e){h(e,"mouseup")}function u(e){h(e,"mousemove")}function c(e){e.clientX=e.touches[0].pageX,e.clientY=e.touches[0].pageY,h(e,"mousedown")}function f(e){e.clientX=e.changedTouches[0].pageX,e.clientY=e.changedTouches[0].pageY,h(e,"mouseup")}function h(e,t){var n={x:e.clientX-r.mouseOffset.left,y:e.clientY-r.mouseOffset.top},o=r.gpuPicker.pick(n);if(o){if("mousemove"===t){if(r.hoveredMarkerID)if(r.hoveredMarkerID===o.ID){var i=r.listening.mouseover[r.hoveredMarkerID],a=i?i.handler:void 0;a&&a(e)}else{var s=r.listening.mouseleave[r.hoveredMarkerID],l=s?s.handler:void 0;l&&l(e),(l=(s=r.listening.mouseenter[o.ID])?s.handler:void 0)&&l(e)}else{var u=r.listening.mouseenter[o.ID],c=u?u.handler:void 0;c&&c(e)}r.hoveredMarkerID=o.ID}var f=r.listening[t][o.ID],h=f?f.handler:void 0;h&&h(e),r.lastPickedMarkerID=o.ID}else{if(r.hoveredMarkerID){var p=r.listening.mouseleave[r.hoveredMarkerID],d=p?p.handler:void 0;d&&d(e)}if(r.hoveredMarkerID=void 0,("mousemove"===t||"mouseup"===t)&&r.lastPickedMarkerID){var v=r.listening[t][r.lastPickedMarkerID],m=v?v.handler:void 0;m&&m(e),"mouseup"===t&&(r.lastPickedMarkerID=void 0)}}}}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(e,[{key:"destruct",value:function(){return this.gpuPicker.destruct()&&this.removeListeners()}},{key:"register",value:function(e,t,r){if(!this._checkResponsibility(t))return console.warn(t+" is not MouseInteraction responsibility."),!1;if(void 0!==this.listening[t][e.ID])return console.warn("[MouseInteraction.register] "+t+" is already registered for "+e.name+". Each event can only have one handler."),!1;var n=!1;for(var o in this.listening)if(this.listening[o][e.ID]){n=!0;break}return n||this.gpuPicker.addInteractableObject(e),this.listening[t][e.ID]={handler:r},!0}},{key:"unregister",value:function(e,t){if(!this._checkResponsibility(t))return console.warn(t+" is not MouseInteraction responsibility."),!1;if(void 0!==this.listening[t][e.ID]){var r=delete this.listening[t][e.ID],n=!0;for(var o in this.listening)if(this.listening[o][e.ID]){n=!1;break}return n&&this.gpuPicker.removeInteractableObject(e),r}return console.warn("[MouseInteraction.unregister] "+t+" was not registered for "+e.name),!1}},{key:"_checkResponsibility",value:function(t){var r=e.MouseEventList;return n.a.include(r,t)}}],[{key:"MouseEventList",get:function(){return["mousedown","mouseup","mousemove","mouseover","mouseleave","mouseenter","mousewheel"]}}]),e}();t.a=s},function(e,t,r){"use strict";var n={include:Array.prototype.indexOf?function(e,t){return-1!==e.indexOf(t)}:function(e,t){for(var r=-1,n=e.length;++r<n;)if(e[r]===t)return!0;return!1},getIndex:Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1}};t.a=n},function(e,t,r){"use strict";var n=r(0);r.n(n);function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.snapshoter=t.snapshoter,this.debug=void 0!==t.debug&&t.debug,this.renderer=t.renderer,this.camera=t.camera,this.mapping={},this.inverseMapping={},this.baseID=1,this.pixelBuffer=void 0,this.pixelBufferDimension=void 0,this.needUpdate=!0}return function(e,t,r){t&&o(e.prototype,t),r&&o(e,r)}(e,[{key:"destruct",value:function(){return this.pixelBuffer=void 0,this.pixelBufferDimension=void 0,!0}},{key:"update",value:function(e){if(e||this.needUpdate){var t=[];for(var r in this.mapping)this.mapping[r].marker.interactShape&&this.mapping[r].marker.interactShape.interactShapeNeedUpdate&&(this.__formatInteractShape(this.mapping[r].marker.interactShape,this.mapping[r].colorID),this.mapping[r].marker.interactShape.interactShapeNeedUpdate=!1,this.mapping[r].added=!0),!0===this.mapping[r].added&&(this.mapping[r].marker.interactShape.visible=!0,t.push(this.mapping[r].marker.interactShape));var n=this.renderer.getSize();this.pixelBuffer=this.snapshoter.renderColorSnapshot(this.camera,t,n.width,n.height),this.pixelBufferDimension=n,t.map(function(e){e.visible=!1}),this.needUpdate=!1,this.debug&&console.log("[GPUPicker] rendering updated")}}},{key:"__formatInteractShape",value:function(t,r){if(t instanceof n.Mesh||t instanceof n.Sprite){var o=new n.Color,i=t;if(t instanceof n.Sprite){o.setHex(r);var a=new n.SpriteMaterial({map:null,color:o,depthTest:!1});i.material=a,this.debug&&console.log("[gpupicker] material map",a)}else{var s=e.pickingMaterial.clone();s.uniforms.color.value=o.setHex(r),s.side=t.material?t.material.side:n.FrontSide,i.material=s}}else console.error("[GPUPicker] object is not a Mesh or a Sprite",t)}},{key:"addInteractableObject",value:function(e){var t;this.debug&&console.log("[GPUPicker] add interactable object",e);var r=this.mapping[e.ID];t=(r=this.mapping[e.ID]={}).colorID=this.baseID++,r.marker=e,this.inverseMapping[t]=e;var n=e.interactShape;n?(this.__formatInteractShape(n,t),r.added=!0):this.debug&&console.log("[GPUPicker] add null interactable object",n),this.needUpdate=!0}},{key:"removeInteractableObject",value:function(e){this.debug&&console.log("[GPUPicker] remove interactable object",e);var t=this.mapping[e.ID];if(t){t.added=!1;var r=delete this.inverseMapping[t.colorID];r=r&&delete this.mapping[e.ID],this.needUpdate=!0,this.debug&&(console.log("[GPUPicker] object removed from picking scene"),r||console.warn("[GPUPicker] deletion fail"))}else console.warn("[GPUPicker] object has not been added to the picker",e)}},{key:"pick",value:function(e){e.x=Math.round(e.x),e.y=Math.round(e.y),this.update();var t=4*(e.x+(this.pixelBufferDimension.height-e.y)*this.pixelBufferDimension.width),r=256*this.pixelBuffer[t]*256+256*this.pixelBuffer[t+1]+this.pixelBuffer[t+2],n=this.inverseMapping[r];if(this.debug&&16777215!==r&&console.log("[GPUPicker] pick id:",r,n),n)return n}}]),e}();i.pickingMaterial=new n.ShaderMaterial({uniforms:{color:{value:new n.Color}},vertexShader:"\n  void main(){\n    vec3 transformed = vec3( position );\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n  }\n  ",fragmentShader:"\n  uniform vec3 color;\n  void main(){\n    gl_FragColor = vec4(color, 1.0);\n  }\n  "}),t.a=i},function(e,t,r){"use strict";t.a=function(e){var t=e.key,r=e.hostname;s(t,r),l(o)},t.b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,r=e.hostname;s(t,r),l("showDem")};var n=r(37),o=r.n(n).a.version,i={},a={key:void 0,hostname:void 0};function s(e,t){e&&!a.key&&(a.key=e),t&&!a.hostname&&(a.hostname=t)}function l(e){if(window.ga){var t=a.key,r=a.hostname,n=t,o=e,s=r,l=t+","+o+","+r;i[l]?console.warn("Duplicate",o):window.ga("sdk.send",{hitType:"event",eventCategory:n,eventAction:o,eventLabel:s,eventValue:1,nonInteraction:!0,hitCallback:function(){i[l]=!0}})}}},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t){var r=t.sandbox;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sandbox=r,this.prevX=0,this.prevY=0,this._enablePan=!1,this.camera.setViewOffset(this.fullWidth,this.fullHeight,0,0,this.fullWidth,this.fullHeight)}return function(e,t,r){t&&n(e.prototype,t),r&&n(e,r)}(e,[{key:"pan",value:function(e,t){if(this._enablePan){var r=this.prevX?e-this.prevX:0,n=this.prevY?t-this.prevY:0;if(0!==r||0!==n){var o=this.view.offsetX-r,i=this.view.offsetY-n,a=this.fullWidth,s=this.fullHeight;this.camera.setViewOffset(a,s,o,i,this.view.width,this.view.height),this.sandbox.control.triggerChangeEvent()}this.prevX=e,this.prevY=t;var l=Math.abs(this.view.offsetX+this.view.width/2-this.view.fullWidth/2),u=Math.abs(this.view.offsetY+this.view.height/2-this.view.fullHeight/2),c=this.camera.fov,f=l/this.view.fullWidth*c,h=u/this.view.fullHeight*c;return Math.max(f,h)}}},{key:"zoom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.1,t=this.view.width/2+this.view.offsetX,r=this.view.height/2+this.view.offsetY,n=this.view.width*e,o=this.view.height*e,i=this.fullWidth,a=this.fullHeight;n=Math.max(i/2,Math.min(n,2*i)),o=Math.max(a/2,Math.min(o,2*a));var s=Math.floor(t-n/2),l=Math.floor(r-o/2);this.camera.setViewOffset(i,a,s,l,n,o)}},{key:"restore",value:function(){var e=this.fullWidth,t=this.fullHeight;this.camera.setViewOffset(e,t,0,0,e,t)}},{key:"camera",get:function(){return this.sandbox.viewerCamera}},{key:"view",get:function(){return this.camera.view}},{key:"fullWidth",get:function(){return this.sandbox.width}},{key:"fullHeight",get:function(){return this.sandbox.height}},{key:"enablePan",set:function(e){this._enablePan=e,this.prevX=0,this.prevY=0}}]),e}();t.a=o},function(e,t,r){"use strict";r.d(t,"a",function(){return c});var n=r(18),o=r(6),i=r(100);function a(e,t,r){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&s(o,r.prototype),o}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t){var r=t.sandbox,n=t.earth,o=t.textStyle,i=t.pinLength,a=void 0===i?20:i,s=t.scale,l=void 0===s?2:s,u=t.visualizeForm,c=void 0===u?"text_tag":u,f=t.visualizeProperty,h=void 0===f?"point_count_abbreviated":f,p=t.clustersTagReserve,d=void 0===p?25:p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sandbox=r||n,this.visualizeProperty=h,this.visualizeForm=c,this.defalutTextStyle={fillStyle:"rgb(155, 155, 255)",font:"normal 500 40px Arial",margin:5,outlineWidth:2,outlineStyle:"rgb(0, 0, 0)"},this.textStyle=Object.assign(this.defalutTextStyle,o),this.pinLength=a,this.scale=l,this.markers=[],this.markersMapping={},this.needUpdate=!1,this.initialized=!1,this.clusters=void 0,this.clustersTag=[],this.clustersTagReserve=void 0!==d?d:25,this.clustersTagCount=0;for(var v=0;v<this.clustersTagReserve;++v)this.clustersTag.push(this._createClusterTags())}return function(e,t,r){t&&u(e.prototype,t),r&&u(e,r)}(e,[{key:"destruct",value:function(){return this.markersMapping={},this.needUpdate=!1,this.initialized=!1,this.clustersTag.forEach(function(e){return e.destruct()}),this.clustersTag=[],this.clustersTagCount=0,!0}},{key:"_createClusterTags",value:function(){var e=new n.a({text:"cluster",textStyle:{fillStyle:this.textStyle.fillStyle,font:this.textStyle.font,outlineWidth:this.textStyle.outlineWidth,outlineStyle:this.textStyle.outlineStyle},position:new o.a(0,0,0),sandbox:this.sandbox,scale:7});return e.visible=!1,e}},{key:"add",value:function(e){var t=!1;this.markers.map(function(r){r.ID===e&&(t=!0)}),t||(this.markers.push(e),this.markersMapping[e.ID]=e,this.needUpdate=!0)}},{key:"remove",value:function(e){var t=this;this.markers.map(function(r,n){r.ID===e.ID&&(t.markers.splice(n,1),delete t.markersMapping[e.ID],t.needUpdate=!0)})}},{key:"clustering",value:function(){var e=this,t=this,r=this.sandbox.camera.center,n=r.lng,o=r.lat,a=r.alt,s=Math.min(Math.max(62585623e-13*a,.01),80),l=Math.floor(33.78608-2.6936*Math.log(a)),u=[n-s,o-s,n+s,o+s];return t.debug&&console.log(l,a),new Promise(function(r,n){function o(e){t.clusters=e,r(e)}if(t.debug&&console.log("default clustering algo"),t.initialized)if(t.needUpdate){var a=e._markersToPoints();Object(i.c)(a,{radius:30,maxZoom:22}).then(function(e){"updated"===e&&(t.debug&&console.log("cluster updated"),t.needUpdate=!1,Object(i.b)(u,l,{radius:30,maxZoom:22},a).then(o))})}else{var s=e._markersToPoints();t.debug&&console.log("cluster no need to update"),Object(i.b)(u,l,{radius:30,maxZoom:22},s).then(o)}else{var c=e._markersToPoints();Object(i.a)({radius:30,maxZoom:22},c).then(function(e){"ready"===e&&(t.initialized=!0,t.needUpdate=!1,t.debug&&console.log("cluster initialized"),Object(i.b)(u,l,{radius:30,maxZoom:22},c).then(o))})}})}},{key:"_markersToPoints",value:function(){return this.markers.map(function(e){var t=e.position;return{marker_id:e.ID,geometry:{coordinates:[t.lng,t.lat,t.alt]},properties:{visualizeWeight:e.visualizeWeight,altitude:t.alt}}})}},{key:"enable",value:function(e){var t,r=this,n=e.adjustHeight,i=void 0!==n&&n;if(this.debug&&(t=new Date),void 0!==this.clusters){this.markers.forEach(function(e){e.visible=!1}),this.clustersTag.forEach(function(e){e.visible=!1}),this.clustersTagCount=0;var s=[],u=[],c=this.visualizeProperty;if(this.clusters.map(function(e){if("Feature"===e.type){var t;r.clustersTagCount<r.clustersTagReserve?t=r.clustersTag[r.clustersTagCount]:(t=r._createClusterTags(),r.clustersTagReserve++,r.clustersTag.push(t)),t.visible=!0,t.text=e.properties[c].toString(),t.pinLength=.045*r.sandbox.camera.center.alt*r.pinLength/10;var n=a(o.a,l(e.geometry.coordinates).concat([e.properties.altitude]));t.position=n,s.push(n),t.scale=.0018*r.sandbox.camera.center.alt*r.scale,r.clustersTagCount++}else void 0!==e.marker_id&&(r.markersMapping[e.marker_id].visible=!0)}),i){this.debug&&(console.log("before altitude adjustment",new Date-t),t=new Date),u=this.sandbox.positionsAltitude(s);for(var f=0;f<this.clustersTagCount;++f){var h=this.clustersTag[f].position;this.clustersTag[f].position=Object.assign({},h,{alt:u[f]})}this.debug&&console.log("altitude adjustment time",new Date-t)}}}},{key:"disable",value:function(){this.clustersTag.map(function(e){e.visible=!1}),this.markers.map(function(e){e.visible=!0})}}]),e}()},function(e,t,r){"use strict";t.a=function(e,t){return new Promise(function(r,n){var s={data:{action:"init",options:e,points:t}};a(s,null,i),r(s.data),o.onerror=function(e){console.log("reject"),n(new Error("MarkerCluster worker runtime error",e.message))}})},t.c=function(e,t){return new Promise(function(r,n){var o={action:"update",points:t,options:e};a(o)})},t.b=function(e,t,r,n){var i;return new Promise(function(s,l){var u={data:{action:"query",bbox:e,zoom:t,options:r,points:n}};i=a(u,i),s(i),o.onerror=function(e){l(new Error("MarkerCluster worker runtime error",e.message))}})};var n=r(101),o=new(r(106)),i=!1;function a(e,t,r){var o=e.data.options;if("init"===e.data.action)Object(n.a)(o).load(e.data.points),!0,e.data="ready";else{if("query"===e.data.action)return Object(n.a)(o).load(e.data.points).getClusters(e.data.bbox,e.data.zoom);"update"===e.data.action&&(Object(n.a)(e.data.options).load(e.data.points),postMessage("updated"))}}},function(e,t,r){"use strict";t.a=function(e){return new i(e)};var n=r(102),o=r.n(n);function i(e){this.options=h(Object.create(this.options),e),this.trees=new Array(this.options.maxZoom+1)}function a(e,t,r,n,o,i,a){return{x:e,y:t,z:r,zoom:1/0,id:n,parentId:-1,numPoints:o,properties:i,visualizeWeight:a}}function s(e,t){var r=e.geometry.coordinates;return{x:c(r[0]),y:f(r[1]),z:r[2],zoom:1/0,id:t,parentId:-1,visualizeWeight:e.properties.visualizeWeight}}function l(e){return{type:"Feature",properties:u(e),geometry:{type:"Point",coordinates:[function(e){return 360*(e-.5)}(e.x),function(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}(e.y),e.z]}}}function u(e){var t=e.numPoints,r=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return h(h({},e.properties),{visualizeWeight:e.visualizeWeight,cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function c(e){return e/360+.5}function f(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function h(e,t){for(var r in t)e[r]=t[r];return e}function p(e){return e.x}function d(e){return e.y}i.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(e){return e}},load:function(e){var t=this.options.log;t&&console.time("total time");var r="prepare "+e.length+" points";t&&console.time(r),this.points=e;for(var n=[],i=0;i<e.length;i++)n.push(s(e[i],i));this.trees[this.options.maxZoom+1]=o()(n,p,d,this.options.nodeSize,Float32Array),t&&console.timeEnd(r);for(var a=this.options.maxZoom;a>=this.options.minZoom;a--){var l=+Date.now();n=this._cluster(n,a),this.trees[a]=o()(n,p,d,this.options.nodeSize,Float32Array),t&&console.log("z%d: %d clusters in %dms",a,n.length,+Date.now()-l)}return t&&console.timeEnd("total time"),this},getClusters:function(e,t){if(e[0]>e[2]){var r=this.getClusters([e[0],e[1],180,e[3]],t),n=this.getClusters([-180,e[1],e[2],e[3]],t);return r.concat(n)}for(var o=this.trees[this._limitZoom(t)],i=o.range(c(e[0]),f(e[3]),c(e[2]),f(e[1])),a=[],s=0;s<i.length;s++){var u=o.points[i[s]];a.push(u.numPoints?l(u):this.points[u.id])}return a},getChildren:function(e){var t=e>>5,r=e%32,n="No cluster with the specified id.",o=this.trees[r];if(!o)throw new Error(n);var i=o.points[t];if(!i)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=o.within(i.x,i.y,a),u=[],c=0;c<s.length;c++){var f=o.points[s[c]];f.parentId===e&&u.push(f.numPoints?l(f):this.points[f.id])}if(0===u.length)throw new Error(n);return u},getLeaves:function(e,t,r){t=t||10,r=r||0;var n=[];return this._appendLeaves(n,e,t,r,0),n},getTile:function(e,t,r){var n=this.trees[this._limitZoom(e)],o=Math.pow(2,e),i=this.options.extent,a=this.options.radius/i,s=(r-a)/o,l=(r+1+a)/o,u={features:[]};return this._addTileFeatures(n.range((t-a)/o,s,(t+1+a)/o,l),n.points,t,r,o,u),0===t&&this._addTileFeatures(n.range(1-a/o,s,1,l),n.points,o,r,o,u),t===o-1&&this._addTileFeatures(n.range(0,s,a/o,l),n.points,-1,r,o,u),u.features.length?u:null},getClusterExpansionZoom:function(e){for(var t=e%32-1;t<this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t},_appendLeaves:function(e,t,r,n,o){for(var i=this.getChildren(t),a=0;a<i.length;a++){var s=i[a].properties;if(s&&s.cluster?o+s.point_count<=n?o+=s.point_count:o=this._appendLeaves(e,s.cluster_id,r,n,o):o<n?o++:e.push(i[a]),e.length===r)break}return o},_addTileFeatures:function(e,t,r,n,o,i){for(var a=0;a<e.length;a++){var s=t[e[a]];i.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*o-r)),Math.round(this.options.extent*(s.y*o-n))]],tags:s.numPoints?u(s):this.points[s.id].properties})}},_limitZoom:function(e){return Math.max(this.options.minZoom,Math.min(e,this.options.maxZoom+1))},_cluster:function(e,t){for(var r=[],n=this.options.radius/(this.options.extent*Math.pow(2,t)),o=0;o<e.length;o++){var i=e[o];if(!(i.zoom<=t)){i.zoom=t;var s=this.trees[t+1],l=s.within(i.x,i.y,n),u=i.numPoints||1,c=i.x*u,f=i.y*u,h=i.z*u,p=i.visualizeWeight,d=null;this.options.reduce&&(d=this.options.initial(),this._accumulate(d,i));for(var v=(o<<5)+(t+1),m=0;m<l.length;m++){var y=s.points[l[m]];if(!(y.zoom<=t)){y.zoom=t;var g=y.numPoints||1;c+=y.x*g,f+=y.y*g,h+=y.z*g,p+=y.visualizeWeight,u+=g,y.parentId=v,this.options.reduce&&this._accumulate(d,y)}}1===u?r.push(i):(i.parentId=v,r.push(a(c/u,f/u,h/u,v,u,d,p)))}}return r},_accumulate:function(e,t){var r=t.numPoints?t.properties:this.options.map(this.points[t.id].properties);this.options.reduce(e,r)}}},function(e,t,r){"use strict";var n=r(103),o=r(104),i=r(105);function a(e,t,r,o,i){t=t||s,r=r||l,i=i||Array,this.nodeSize=o||64,this.points=e,this.ids=new i(e.length),this.coords=new i(2*e.length);for(var a=0;a<e.length;a++)this.ids[a]=a,this.coords[2*a]=t(e[a]),this.coords[2*a+1]=r(e[a]);n(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function s(e){return e[0]}function l(e){return e[1]}e.exports=function(e,t,r,n,o){return new a(e,t,r,n,o)},a.prototype={range:function(e,t,r,n){return o(this.ids,this.coords,e,t,r,n,this.nodeSize)},within:function(e,t,r){return i(this.ids,this.coords,e,t,r,this.nodeSize)}}},function(e,t,r){"use strict";function n(e,t,r,n){o(e,r,n),o(t,2*r,2*n),o(t,2*r+1,2*n+1)}function o(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}e.exports=function e(t,r,o,i,a,s){if(a-i<=o)return;var l=Math.floor((i+a)/2);!function e(t,r,o,i,a,s){for(;a>i;){if(a-i>600){var l=a-i+1,u=o-i+1,c=Math.log(l),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(l-f)/l)*(u-l/2<0?-1:1),p=Math.max(i,Math.floor(o-u*f/l+h)),d=Math.min(a,Math.floor(o+(l-u)*f/l+h));e(t,r,o,p,d,s)}var v=r[2*o+s],m=i,y=a;for(n(t,r,i,o),r[2*a+s]>v&&n(t,r,i,a);m<y;){for(n(t,r,m,y),m++,y--;r[2*m+s]<v;)m++;for(;r[2*y+s]>v;)y--}r[2*i+s]===v?n(t,r,i,y):n(t,r,++y,a),y<=o&&(i=y+1),o<=y&&(a=y-1)}}(t,r,l,i,a,s%2);e(t,r,o,i,l-1,s+1);e(t,r,o,l+1,a,s+1)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,o,i,a){var s,l,u=[0,e.length-1,0],c=[];for(;u.length;){var f=u.pop(),h=u.pop(),p=u.pop();if(h-p<=a)for(var d=p;d<=h;d++)s=t[2*d],l=t[2*d+1],s>=r&&s<=o&&l>=n&&l<=i&&c.push(e[d]);else{var v=Math.floor((p+h)/2);s=t[2*v],l=t[2*v+1],s>=r&&s<=o&&l>=n&&l<=i&&c.push(e[v]);var m=(f+1)%2;(0===f?r<=s:n<=l)&&(u.push(p),u.push(v-1),u.push(m)),(0===f?o>=s:i>=l)&&(u.push(v+1),u.push(h),u.push(m))}}return c}},function(e,t,r){"use strict";function n(e,t,r,n){var o=e-r,i=t-n;return o*o+i*i}e.exports=function(e,t,r,o,i,a){var s=[0,e.length-1,0],l=[],u=i*i;for(;s.length;){var c=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a)for(var p=h;p<=f;p++)n(t[2*p],t[2*p+1],r,o)<=u&&l.push(e[p]);else{var d=Math.floor((h+f)/2),v=t[2*d],m=t[2*d+1];n(v,m,r,o)<=u&&l.push(e[d]);var y=(c+1)%2;(0===c?r-i<=v:o-i<=m)&&(s.push(h),s.push(d-1),s.push(y)),(0===c?r+i>=v:o+i>=m)&&(s.push(d+1),s.push(f),s.push(y))}}return l}},function(e,t,r){e.exports=function(){return r(14)('!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,r,i=n(1),s=n.n(i),a=!1;self.onmessage=function(t){"init"===t.data.action?((r=t.data.options).reduce=function(t,e){t.visualizeWeight+=e.visualizeWeight,t.altitude=(e.altitude+t.altitude)/2},o=new s.a(r).load(t.data.points),a=!0,postMessage("ready")):"query"===t.data.action&&a?postMessage(o.getClusters(t.data.bbox,t.data.zoom)):"update"===t.data.action&&a&&(o=new s.a(r).load(t.data.points),postMessage("updated"))}},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){"use strict";function t(n,o,r,i,s,a){if(!(s-i<=r)){var u=i+s>>1;!function t(n,o,r,i,s,a){for(;s>i;){if(s-i>600){var u=s-i+1,p=r-i+1,h=Math.log(u),d=.5*Math.exp(2*h/3),f=.5*Math.sqrt(h*d*(u-d)/u)*(p-u/2<0?-1:1),l=Math.max(i,Math.floor(r-p*d/u+f)),c=Math.min(s,Math.floor(r+(u-p)*d/u+f));t(n,o,r,l,c,a)}var m=o[2*r+a],v=i,g=s;for(e(n,o,i,r),o[2*s+a]>m&&e(n,o,i,s);v<g;){for(e(n,o,v,g),v++,g--;o[2*v+a]<m;)v++;for(;o[2*g+a]>m;)g--}o[2*i+a]===m?e(n,o,i,g):e(n,o,++g,s),g<=r&&(i=g+1),r<=g&&(s=g-1)}}(n,o,u,i,s,a%2),t(n,o,r,i,u-1,a+1),t(n,o,r,u+1,s,a+1)}}function e(t,e,o,r){n(t,o,r),n(e,2*o,2*r),n(e,2*o+1,2*r+1)}function n(t,e,n){var o=t[e];t[e]=t[n],t[n]=o}function o(t,e,n,o){var r=t-n,i=e-o;return r*r+i*i}var r=function(t){return t[0]},i=function(t){return t[1]},s=function(e,n,o,s,a){void 0===n&&(n=r),void 0===o&&(o=i),void 0===s&&(s=64),void 0===a&&(a=Float64Array),this.nodeSize=s,this.points=e;for(var u=e.length<65536?Uint16Array:Uint32Array,p=this.ids=new u(e.length),h=this.coords=new a(2*e.length),d=0;d<e.length;d++)p[d]=d,h[2*d]=n(e[d]),h[2*d+1]=o(e[d]);t(p,h,s,0,p.length-1,0)};s.prototype.range=function(t,e,n,o){return function(t,e,n,o,r,i,s){for(var a,u,p=[0,t.length-1,0],h=[];p.length;){var d=p.pop(),f=p.pop(),l=p.pop();if(f-l<=s)for(var c=l;c<=f;c++)a=e[2*c],u=e[2*c+1],a>=n&&a<=r&&u>=o&&u<=i&&h.push(t[c]);else{var m=Math.floor((l+f)/2);a=e[2*m],u=e[2*m+1],a>=n&&a<=r&&u>=o&&u<=i&&h.push(t[m]);var v=(d+1)%2;(0===d?n<=a:o<=u)&&(p.push(l),p.push(m-1),p.push(v)),(0===d?r>=a:i>=u)&&(p.push(m+1),p.push(f),p.push(v))}}return h}(this.ids,this.coords,t,e,n,o,this.nodeSize)},s.prototype.within=function(t,e,n){return function(t,e,n,r,i,s){for(var a=[0,t.length-1,0],u=[],p=i*i;a.length;){var h=a.pop(),d=a.pop(),f=a.pop();if(d-f<=s)for(var l=f;l<=d;l++)o(e[2*l],e[2*l+1],n,r)<=p&&u.push(t[l]);else{var c=Math.floor((f+d)/2),m=e[2*c],v=e[2*c+1];o(m,v,n,r)<=p&&u.push(t[c]);var g=(h+1)%2;(0===h?n-i<=m:r-i<=v)&&(a.push(f),a.push(c-1),a.push(g)),(0===h?n+i>=m:r+i>=v)&&(a.push(c+1),a.push(d),a.push(g))}}return u}(this.ids,this.coords,t,e,n,this.nodeSize)};var a={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},u=function(t){this.options=m(Object.create(a),t),this.trees=new Array(this.options.maxZoom+1)};function p(t,e,n,o,r){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:o,properties:r}}function h(t,e){var n=t.geometry.coordinates,o=n[0],r=n[1];return{x:l(o),y:c(r),zoom:1/0,index:e,parentId:-1}}function d(t){return{type:"Feature",id:t.id,properties:f(t),geometry:{type:"Point",coordinates:[function(t){return 360*(t-.5)}(t.x),function(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(t.y)]}}}function f(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return m(m({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function l(t){return t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function m(t,e){for(var n in e)t[n]=e[n];return t}function v(t){return t.x}function g(t){return t.y}return u.prototype.load=function(t){var e=this.options,n=e.log,o=e.minZoom,r=e.maxZoom,i=e.nodeSize;n&&console.time("total time");var a="prepare "+t.length+" points";n&&console.time(a),this.points=t;for(var u=[],p=0;p<t.length;p++)t[p].geometry&&u.push(h(t[p],p));this.trees[r+1]=new s(u,v,g,i,Float32Array),n&&console.timeEnd(a);for(var d=r;d>=o;d--){var f=+Date.now();u=this._cluster(u,d),this.trees[d]=new s(u,v,g,i,Float32Array),n&&console.log("z%d: %d clusters in %dms",d,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},u.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[1])),r=180===t[2]?180:((t[2]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,r=180;else if(n>r){var s=this.getClusters([n,o,180,i],e),a=this.getClusters([-180,o,r,i],e);return s.concat(a)}for(var u=this.trees[this._limitZoom(e)],p=[],h=0,f=u.range(l(n),c(i),l(r),c(o));h<f.length;h+=1){var m=f[h],v=u.points[m];p.push(v.numPoints?d(v):this.points[v.index])}return p},u.prototype.getChildren=function(t){var e=t>>5,n=t%32,o="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(o);var i=r.points[e];if(!i)throw new Error(o);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=[],u=0,p=r.within(i.x,i.y,s);u<p.length;u+=1){var h=p[u],f=r.points[h];f.parentId===t&&a.push(f.numPoints?d(f):this.points[f.index])}if(0===a.length)throw new Error(o);return a},u.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var o=[];return this._appendLeaves(o,t,e,n,0),o},u.prototype.getTile=function(t,e,n){var o=this.trees[this._limitZoom(t)],r=Math.pow(2,t),i=this.options,s=i.extent,a=i.radius/s,u=(n-a)/r,p=(n+1+a)/r,h={features:[]};return this._addTileFeatures(o.range((e-a)/r,u,(e+1+a)/r,p),o.points,e,n,r,h),0===e&&this._addTileFeatures(o.range(1-a/r,u,1,p),o.points,r,n,r,h),e===r-1&&this._addTileFeatures(o.range(0,u,a/r,p),o.points,-1,n,r,h),h.features.length?h:null},u.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},u.prototype._appendLeaves=function(t,e,n,o,r){for(var i=0,s=this.getChildren(e);i<s.length;i+=1){var a=s[i],u=a.properties;if(u&&u.cluster?r+u.point_count<=o?r+=u.point_count:r=this._appendLeaves(t,u.cluster_id,n,o,r):r<o?r++:t.push(a),t.length===n)break}return r},u.prototype._addTileFeatures=function(t,e,n,o,r,i){for(var s=0,a=t;s<a.length;s+=1){var u=e[a[s]],p={type:1,geometry:[[Math.round(this.options.extent*(u.x*r-n)),Math.round(this.options.extent*(u.y*r-o))]],tags:u.numPoints?f(u):this.points[u.index].properties},h=u.numPoints?u.id:this.points[u.index].id;void 0!==h&&(p.id=h),i.features.push(p)}},u.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},u.prototype._cluster=function(t,e){for(var n=[],o=this.options,r=o.radius,i=o.extent,s=o.reduce,a=r/(i*Math.pow(2,e)),u=0;u<t.length;u++){var h=t[u];if(!(h.zoom<=e)){h.zoom=e;for(var d=this.trees[e+1],f=d.within(h.x,h.y,a),l=h.numPoints||1,c=h.x*l,m=h.y*l,v=s&&l>1?this._map(h,!0):null,g=(u<<5)+(e+1),y=0,x=f;y<x.length;y+=1){var M=x[y],_=d.points[M];if(!(_.zoom<=e)){_.zoom=e;var w=_.numPoints||1;c+=_.x*w,m+=_.y*w,l+=w,_.parentId=g,s&&(v||(v=this._map(h,!0)),s(v,this._map(_)))}}1===l?n.push(h):(h.parentId=g,n.push(p(c/l,m/l,g,l,v)))}}return n},u.prototype._map=function(t,e){if(t.numPoints)return e?m({},t.properties):t.properties;var n=this.points[t.index].properties,o=this.options.map(n);return e&&o===n?m({},o):o},u})}]);',r.p+"SuperCluster_worker.js")}},function(e,t,r){"use strict";var n=r(2),o=r(5),i=r(0);r.n(i);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sandbox=t.sandbox,this.polygon=t.polygon,this.viewPoint=t.viewPoint,this.blockMarkers=t.blockMarkers,this.skylineLength=t.skylineLength>0?t.skylineLength:512,this.polygonSampleResolution=t.polygonSampleResolution>0?t.polygonSampleResolution:50,this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.fov=t.fov>0?t.fov:45,this.heightResolution=t.heightResolution>0?t.heightResolution:1,this._perspectiveCamera=new i.PerspectiveCamera,this._skylineInLLA=[]}return function(e,t,r){t&&a(e.prototype,t),r&&a(e,r)}(e,[{key:"_getPerspectiveCameraParameters",value:function(){var e=this.viewPoint,t=Object.assign({},e);t.alt+=1;var r={lng:0,lat:0,alt:e.alt};r.lng=this.polygon.position.lng,r.lat=this.polygon.position.lat,this.targetPoint=r;var n=this.sandbox.lngLatAlt2XYZ(e),o=this.sandbox.lngLatAlt2XYZ(t),a=this.sandbox.lngLatAlt2XYZ(r),s=o.clone().sub(n).normalize(),l=new i.Matrix4;l.lookAt(n,a,s);var u,c,f,h,p=new i.Vector2(1e5*(r.lng-e.lng),1e5*(r.lat-e.lat)),d=this.polygon.boundaryPts.map(function(t){return new i.Vector2(1e5*(t.lng-e.lng),1e5*(t.lat-e.lat))});if(this.nearDistance>0&&this.nearDistance<this.farDistance)u=1*this.nearDistance/1,c=1*this.farDistance/1,f=this.nearDistance,h=this.farDistance;else{u=this.sandbox.earthView.camera.near;var v=function(e){if(0===e.length)return-1;for(var t=e[0],r=0,n=0;n<e.length;++n)e[n]>t&&(t=e[n],r=n);return r}(d.map(function(e){return e.dot(p)/p.length()})),m=Object.assign({},this.polygon.boundaryPts[v]);m.alt=e.alt;var y=this.sandbox.calculateDistanceBetweenTwoPoints(e,m);c=1.01*y*1/1,f=1*u,h=y}var g=d.map(function(e){return e.dot(p)/(e.length()*p.length())}),b=g[function(e){if(0===e.length)return-1;for(var t=e[0],r=0,n=0;n<e.length;++n)e[n]<t&&(t=e[n],r=n);return r}(g)],_=Math.abs(Math.sqrt(1-b*b)/b),w=this.fov,x=w/2*Math.PI/180,k=_/Math.tan(x);return{position:n.clone(),quaternion:(new i.Quaternion).setFromRotationMatrix(l),fov:w,near:u,far:c,aspect:k,nearDistance:f,farDistance:h}}},{key:"_getDepthMap",value:function(e,t,r,n){var o={dimension:{width:r,height:n}};return o.buffer=this.sandbox.snapshoter.renderDepthSnapshot(e,t,r,n),o}},{key:"_findSkylineInLLA",value:function(e){for(var t=this,r=e.dimension.width,o=e.dimension.height,a=[],s=0;s<r;++s)for(var l=0;l<o;++l){var u=l*r+s,c=e.buffer[u];if(l===o-1){a.push([s,l,c]);break}if(c<255){a.push([s,l,c]);break}}var f=new i.Matrix4;f.getInverse(this.sandbox.earthToScene());var h=new i.Vector3;return{skyline:a.map(function(e){var i=e[0]/(r-1)*2-1,a=-(e[1]/(o-1)*2-1),s=e[2]/255*2-1;h.set(i,a,s).unproject(t._perspectiveCamera),h.applyMatrix4(f);var l=n.a.getLngLatAltFromNoneGroundCartesian(void 0,h,void 0);return{lng:l.lng,lat:l.lat,alt:l.alt}}),near:[[-1,0,-1],[1,0,-1]].map(function(e){h.set(e[0],e[1],e[2]).unproject(t._perspectiveCamera),h.applyMatrix4(f);var r=n.a.getLngLatAltFromNoneGroundCartesian(void 0,h,void 0);return{lng:r.lng,lat:r.lat,alt:r.alt}}),far:[[-1,0,1],[1,0,1]].map(function(e){h.set(e[0],e[1],e[2]).unproject(t._perspectiveCamera),h.applyMatrix4(f);var r=n.a.getLngLatAltFromNoneGroundCartesian(void 0,h,void 0);return{lng:r.lng,lat:r.lat,alt:r.alt}})}}},{key:"computeSkyline",value:function(){var e=this,t=this._getPerspectiveCameraParameters();this._perspectiveCamera.copy(this.sandbox.earthView.camera),this._perspectiveCamera.position.copy(t.position),this._perspectiveCamera.quaternion.copy(t.quaternion),this._perspectiveCamera.near=t.near,this._perspectiveCamera.far=t.far,this._perspectiveCamera.fov=t.fov,this._perspectiveCamera.aspect=t.aspect,this._perspectiveCamera.updateProjectionMatrix(),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance;var r=this.skylineLength,n=t.fov*Math.PI/180,o=t.farDistance*Math.tan(n/2)/this.heightResolution;o=Math.round(o);var a=this.blockMarkers.map(function(e){return e.contentHolder}),s=this._getDepthMap(this._perspectiveCamera,a,r,o);!function(e,t){for(var r=0;r<e.dimension.height/2;++r)for(var n=0;n<e.dimension.width*t;++n){var o=r*e.dimension.width*t+n,i=(e.dimension.height-1-r)*e.dimension.width*t+n,a=e.buffer[o];e.buffer[o]=e.buffer[i],e.buffer[i]=a}}(s,1);var l=this._findSkylineInLLA(s);this._skylineInLLA=l.skyline,this._nearPtsInLLA=l.near,this._farPtsInLLA=l.far;this._skylineInLLADiffvec2=this._skylineInLLA.map(function(t){var r=new i.Vector2;return r.x=1e4*t.lng-1e4*e.viewPoint.lng,r.y=1e4*t.lat-1e4*e.viewPoint.lat,r})}},{key:"getHeightLimitHere",value:function(e){if(!(this._skylineInLLA.length<1)){var t=this.viewPoint,r=this._skylineInLLA,n=this._skylineInLLADiffvec2,o=new i.Vector2;o.x=1e4*e.lng-1e4*t.lng,o.y=1e4*e.lat-1e4*t.lat;var a=n.map(function(e,t){return{angleDiff:e.dot(o)/(e.length()*o.length())*1e4,index:t}}),s=a[0];a.map(function(e){s.angleDiff<=e.angleDiff&&(s=e)});var l,u=s.index;l=0===u?u+1:u===a.length-1?u-1:a[u-1].angleDiff>a[u+1].angleDiff?u-1:u+1;var c=n[u].x,f=n[u].y,h=n[l].x,p=n[l].y,d=o.x,v=o.y,m=(d*p-v*h)/(v*(c-h)-d*(f-p)),y=m*c+(1-m)*h,g=m*f+(1-m)*p,b=r[u],_=r[l],w=m*(b.alt-t.alt)+(1-m)*(_.alt-t.alt),x=(d/y+v/g)/2;if(!(x<=1))return x*w+t.alt}}},{key:"computeHeightLimitMap",value:function(){if(!(this._skylineInLLA.length<1)){var e=this.polygon.boundaryPts,t={max:{lat:e[0].lat,lng:e[0].lng},min:{lat:e[0].lat,lng:e[0].lng}};e.map(function(e){e.lat>t.max.lat&&(t.max.lat=e.lat),e.lng>t.max.lng&&(t.max.lng=e.lng),e.lat<t.min.lat&&(t.min.lat=e.lat),e.lng<t.min.lng&&(t.min.lng=e.lng)});for(var r=this.sandbox.markerSnapshot([t.max,t.min],{max:this.polygon.top+.1,min:this.polygon.bottom-.1},[this.polygon.contentHolder],!1,this.polygonSampleResolution),n={bbox:t,dimension:Object.assign({},r.dimension),buffer:new Array(r.dimension.width*r.dimension.height)},o=0;o<r.dimension.width;++o)for(var i=0;i<r.dimension.height;++i){var a=4*(i*r.dimension.width+o)+3;if(0!==r.buffer[a]){var s={lng:(t.max.lng-t.min.lng)*(o/(r.dimension.width-1))+t.min.lng,lat:(t.max.lat-t.min.lat)*(i/(r.dimension.height-1))+t.min.lat},l=this.getHeightLimitHere(s);void 0!==l&&(s.alt=l,n.buffer[i*r.dimension.width+o]=s)}}return n}}},{key:"skyline",get:function(){return this._skylineInLLA.slice()}},{key:"near",get:function(){return this._nearPtsInLLA.slice()}},{key:"far",get:function(){return this._farPtsInLLA.slice()}},{key:"camera",get:function(){var e=o.a.EARTH_RADIUS/o.a.scale,t=this._perspectiveCamera;return{near:t.near/e,far:t.far/e,fov:t.fov,aspect:t.aspect}}}]),e}();t.a=s},function(e,t,r){"use strict";var n=r(4),o=r(2),i=r(7),a=r(0);r.n(a);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e,t,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=e.heightMap,o={lng:0,lat:0,alt:0},s=0;s<n.buffer.length;++s){var l=n.buffer[s];if(l){o.lng=l.lng,o.lat=l.lat;break}}e.position=o,(r=u(this,f(t).call(this,e)))._heightMap=n,r._lineWidth=e.lineWidth>0?e.lineWidth:2,r._scaledLineWidth=r._lineWidth,r._calculateSystem(),r._unitAltVector=r._convertPointToXYZPoint({lng:r.position.lng,lat:r.position.lat,alt:r.position.alt+1}).sub(r._convertPointToXYZPoint(r.position)),r._pointsxyz={};for(var c=0;c<n.buffer.length;++c){var h=n.buffer[c];h&&(r._pointsxyz[c]=r._convertPointToXYZPoint(h))}var p=r._buildUpGeometryData(n),d=new a.Geometry;p.vertices.map(function(e){var t;t=e?r._convertPointToXYZPoint(e):e,d.vertices.push(t)}),p.faces.map(function(e){d.faces.push(new a.Face3(e[0],e[1],e[2]))}),r.up=new a.Mesh(d,new a.MeshBasicMaterial({transparent:!1,color:16711680,opacity:1,side:a.DoubleSide,wireframe:!0})),r.up.renderOrder=i.a.HEIGHTMAP_RENDER_ORDER,r.contentHolder.add(r.up);var v=r._buildSideLineOptions(n),m=r._buildLineGeometry(v);return r.side=new a.Mesh(m,new a.MeshBasicMaterial({transparent:!1,color:16711935,opacity:1})),r.side.renderOrder=i.a.HEIGHTMAP_RENDER_ORDER,r.contentHolder.add(r.side),r.interactShape=r.up.clone(),r._property.type="HeightMapMarker",r._property.heightMap=r._heightMap,r._property.lineWidth=r._lineWidth,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,n["a"]),function(e,t,r){t&&l(e.prototype,t),r&&l(e,r)}(t,[{key:"_calculateSystem",value:function(){this.system=o.a.getLocalSystemOnEarthSurface(void 0,this.position.lng,this.position.lat,void 0)}},{key:"_convertPointToXYZPoint",value:function(e){null!==this.system&&void 0!==this.system||this._calculateSystem();var t=o.a.getNoneGroundCartesianFromLngLatAlt(void 0,e.lng,e.lat,e.alt,void 0).clone().sub(this.system.origin),r=1*t.dot(this.system.lng),n=1*t.dot(this.system.lat),i=1*t.dot(this.system.alt);return new a.Vector3(r,n,i)}},{key:"_constructLineOptions",value:function(e,t){var r={},n=e.clone().add(t).multiplyScalar(.5),o={};return o.y=t.clone().add(e.clone().negate()).normalize(),o.x=this._unitAltVector.clone().normalize(),o.z=o.y.clone().cross(o.x.clone()).normalize(),o.x=o.y.clone().cross(o.z.clone()).normalize(),o.origin=n.clone(),r.system=o,r.distance=t.clone().add(e.clone().negate()).length(),r}},{key:"_buildUpLineOptions",value:function(e){for(var t=[],r=0;r<e.dimension.width;++r)for(var n=0;n<e.dimension.height-1;++n){var o=n*e.dimension.width+r,i=e.buffer[o],a=(n+1)*e.dimension.width+r,s=e.buffer[a];void 0!==i&&void 0!==s&&t.push(this._constructLineOptions(this._pointsxyz[o],this._pointsxyz[a]))}for(var l=0;l<e.dimension.height;++l)for(var u=0;u<e.dimension.width-1;++u){var c=l*e.dimension.width+u,f=e.buffer[c],h=l*e.dimension.width+u+1,p=e.buffer[h];void 0!==f&&void 0!==p&&t.push(this._constructLineOptions(this._pointsxyz[c],this._pointsxyz[h]))}return t}},{key:"_buildUpGeometryData",value:function(e){for(var t=e.dimension.width,r=e.dimension.height,n=e.buffer,o=[],i={},a=0,s=0;s<n.length;++s)n[s]&&(i[s]=a,a+=1,o.push(n[s]));for(var l=[],u=0;u<t-1;++u)for(var c=0;c<r-1;++c){var f=c*t+u,h=f+1,p=f+t,d=p+1;n[f]&&n[h]&&n[p]&&n[d]&&(l.push([i[f],i[h],i[p]]),l.push([i[p],i[h],i[d]]))}return{vertices:o,faces:l}}},{key:"_buildSideLineOptions",value:function(e){for(var t=[],r=0;r<e.dimension.width;++r)for(var n=0;n<e.dimension.height;++n){var o=n*e.dimension.width+r,i=e.buffer[o];if(void 0!==i)if(0===r||r===e.dimension.width||0===n||n===e.dimension.height)t.push(this._constructLineOptions(this._pointsxyz[o],this._convertPointToXYZPoint({lng:i.lng,lat:i.lat,alt:0})));else for(var a=-1;a<2;++a)for(var s=-1;s<2;++s){void 0===e.buffer[(n+s)*e.dimension.width+(r+a)]&&(t.push(this._constructLineOptions(this._pointsxyz[o],this._convertPointToXYZPoint({lng:i.lng,lat:i.lat,alt:0}))),a=3,s=3)}}return t}},{key:"_buildLineGeometry",value:function(e){for(var t=new a.Geometry,r=new a.CylinderGeometry(1,1,1,8),n=this._scaledLineWidth,o=0;o<e.length;o++){var i=e[o];if(!(i.distance<=0)){var s=(new a.Matrix4).makeScale(n,i.distance,n),l=new a.Matrix4;l.makeBasis(i.system.x,i.system.y,i.system.z),l.setPosition(i.system.origin),t.merge(r,l.multiply(s))}}t.applyMatrix((new a.Matrix4).makeScale(1e7,1e7,1e7));var u=(new a.BufferGeometry).fromGeometry(t);return u.applyMatrix((new a.Matrix4).makeScale(1e-7,1e-7,1e-7)),u}},{key:"destruct",value:function(){return this.up&&(this.up.geometry&&this.up.geometry.dispose(),this.up.material&&this.up.material.dispose()),this.side&&(this.side.geometry&&this.side.geometry.dispose(),this.side.material&&this.side.material.dispose()),c(f(t.prototype),"destruct",this).call(this)}}]),t}();t.a=p}])});